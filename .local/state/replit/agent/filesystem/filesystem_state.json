{"file_contents":{"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  // @replit\n  // Whitespace-nowrap: Badges should never wrap.\n  \"whitespace-nowrap inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\" +\n  \" hover-elevate \",\n  {\n    variants: {\n      variant: {\n        default:\n          // @replit shadow-xs instead of shadow, no hover because we use hover-elevate\n          \"border-transparent bg-primary text-primary-foreground shadow-xs\",\n        secondary:\n          // @replit no hover because we use hover-elevate\n          \"border-transparent bg-secondary text-secondary-foreground\",\n        destructive:\n          // @replit shadow-xs instead of shadow, no hover because we use hover-elevate\n          \"border-transparent bg-destructive text-destructive-foreground shadow-xs\",\n          // @replit shadow-xs\" - use badge outline variable\n        outline: \"text-foreground border [border-color:var(--badge-outline)]\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  )\n}\n\nexport { Badge, badgeVariants }\n","path":null,"size_bytes":1522,"size_tokens":null},"client/src/components/ui/hover-card.tsx":{"content":"import * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","path":null,"size_bytes":1237,"size_tokens":null},"client/src/components/ui/drawer.tsx":{"content":"import * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","path":null,"size_bytes":3007,"size_tokens":null},"client/src/components/ui/field.tsx":{"content":"\"use client\"\n\nimport { useMemo } from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\nimport { Separator } from \"@/components/ui/separator\"\n\nfunction FieldSet({ className, ...props }: React.ComponentProps<\"fieldset\">) {\n  return (\n    <fieldset\n      data-slot=\"field-set\"\n      className={cn(\n        \"flex flex-col gap-6\",\n        \"has-[>[data-slot=checkbox-group]]:gap-3 has-[>[data-slot=radio-group]]:gap-3\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction FieldLegend({\n  className,\n  variant = \"legend\",\n  ...props\n}: React.ComponentProps<\"legend\"> & { variant?: \"legend\" | \"label\" }) {\n  return (\n    <legend\n      data-slot=\"field-legend\"\n      data-variant={variant}\n      className={cn(\n        \"mb-3 font-medium\",\n        \"data-[variant=legend]:text-base\",\n        \"data-[variant=label]:text-sm\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction FieldGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"field-group\"\n      className={cn(\n        \"group/field-group @container/field-group flex w-full flex-col gap-7 data-[slot=checkbox-group]:gap-3 [&>[data-slot=field-group]]:gap-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nconst fieldVariants = cva(\n  \"group/field data-[invalid=true]:text-destructive flex w-full gap-3\",\n  {\n    variants: {\n      orientation: {\n        vertical: [\"flex-col [&>*]:w-full [&>.sr-only]:w-auto\"],\n        horizontal: [\n          \"flex-row items-center\",\n          \"[&>[data-slot=field-label]]:flex-auto\",\n          \"has-[>[data-slot=field-content]]:[&>[role=checkbox],[role=radio]]:mt-px has-[>[data-slot=field-content]]:items-start\",\n        ],\n        responsive: [\n          \"@md/field-group:flex-row @md/field-group:items-center @md/field-group:[&>*]:w-auto flex-col [&>*]:w-full [&>.sr-only]:w-auto\",\n          \"@md/field-group:[&>[data-slot=field-label]]:flex-auto\",\n          \"@md/field-group:has-[>[data-slot=field-content]]:items-start @md/field-group:has-[>[data-slot=field-content]]:[&>[role=checkbox],[role=radio]]:mt-px\",\n        ],\n      },\n    },\n    defaultVariants: {\n      orientation: \"vertical\",\n    },\n  }\n)\n\nfunction Field({\n  className,\n  orientation = \"vertical\",\n  ...props\n}: React.ComponentProps<\"div\"> & VariantProps<typeof fieldVariants>) {\n  return (\n    <div\n      role=\"group\"\n      data-slot=\"field\"\n      data-orientation={orientation}\n      className={cn(fieldVariants({ orientation }), className)}\n      {...props}\n    />\n  )\n}\n\nfunction FieldContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"field-content\"\n      className={cn(\n        \"group/field-content flex flex-1 flex-col gap-1.5 leading-snug\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction FieldLabel({\n  className,\n  ...props\n}: React.ComponentProps<typeof Label>) {\n  return (\n    <Label\n      data-slot=\"field-label\"\n      className={cn(\n        \"group/field-label peer/field-label flex w-fit gap-2 leading-snug group-data-[disabled=true]/field:opacity-50\",\n        \"has-[>[data-slot=field]]:w-full has-[>[data-slot=field]]:flex-col has-[>[data-slot=field]]:rounded-md has-[>[data-slot=field]]:border [&>[data-slot=field]]:p-4\",\n        \"has-data-[state=checked]:bg-primary/5 has-data-[state=checked]:border-primary dark:has-data-[state=checked]:bg-primary/10\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction FieldTitle({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"field-label\"\n      className={cn(\n        \"flex w-fit items-center gap-2 text-sm font-medium leading-snug group-data-[disabled=true]/field:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction FieldDescription({ className, ...props }: React.ComponentProps<\"p\">) {\n  return (\n    <p\n      data-slot=\"field-description\"\n      className={cn(\n        \"text-muted-foreground text-sm font-normal leading-normal group-has-[[data-orientation=horizontal]]/field:text-balance\",\n        \"nth-last-2:-mt-1 last:mt-0 [[data-variant=legend]+&]:-mt-1.5\",\n        \"[&>a:hover]:text-primary [&>a]:underline [&>a]:underline-offset-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction FieldSeparator({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  children?: React.ReactNode\n}) {\n  return (\n    <div\n      data-slot=\"field-separator\"\n      data-content={!!children}\n      className={cn(\n        \"relative -my-2 h-5 text-sm group-data-[variant=outline]/field-group:-mb-2\",\n        className\n      )}\n      {...props}\n    >\n      <Separator className=\"absolute inset-0 top-1/2\" />\n      {children && (\n        <span\n          className=\"bg-background text-muted-foreground relative mx-auto block w-fit px-2\"\n          data-slot=\"field-separator-content\"\n        >\n          {children}\n        </span>\n      )}\n    </div>\n  )\n}\n\nfunction FieldError({\n  className,\n  children,\n  errors,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  errors?: Array<{ message?: string } | undefined>\n}) {\n  const content = useMemo(() => {\n    if (children) {\n      return children\n    }\n\n    if (!errors) {\n      return null\n    }\n\n    if (errors?.length === 1 && errors[0]?.message) {\n      return errors[0].message\n    }\n\n    return (\n      <ul className=\"ml-4 flex list-disc flex-col gap-1\">\n        {errors.map(\n          (error, index) =>\n            error?.message && <li key={index}>{error.message}</li>\n        )}\n      </ul>\n    )\n  }, [children, errors])\n\n  if (!content) {\n    return null\n  }\n\n  return (\n    <div\n      role=\"alert\"\n      data-slot=\"field-error\"\n      className={cn(\"text-destructive text-sm font-normal\", className)}\n      {...props}\n    >\n      {content}\n    </div>\n  )\n}\n\nexport {\n  Field,\n  FieldLabel,\n  FieldDescription,\n  FieldError,\n  FieldGroup,\n  FieldLegend,\n  FieldSeparator,\n  FieldSet,\n  FieldContent,\n  FieldTitle,\n}\n","path":null,"size_bytes":6044,"size_tokens":null},"server/seed-products.ts":{"content":"import { getUncachableStripeClient } from './stripeClient';\n\nasync function seedProducts() {\n  const stripe = await getUncachableStripeClient();\n\n  console.log('Creating membership products...');\n\n  const proProduct = await stripe.products.create({\n    name: 'Pro Membership',\n    description: 'For serious competitors climbing the ranks',\n    metadata: {\n      tier: 'pro',\n      monthlyBonusCoins: '500',\n    },\n  });\n\n  const proPrice = await stripe.prices.create({\n    product: proProduct.id,\n    unit_amount: 999,\n    currency: 'usd',\n    recurring: { interval: 'month' },\n    metadata: { tier: 'pro' },\n  });\n\n  console.log(`Created Pro: ${proProduct.id} with price ${proPrice.id}`);\n\n  const eliteProduct = await stripe.products.create({\n    name: 'Elite Membership',\n    description: 'For the ultimate SongVersus champions',\n    metadata: {\n      tier: 'elite',\n      monthlyBonusCoins: '1500',\n    },\n  });\n\n  const elitePrice = await stripe.prices.create({\n    product: eliteProduct.id,\n    unit_amount: 1999,\n    currency: 'usd',\n    recurring: { interval: 'month' },\n    metadata: { tier: 'elite' },\n  });\n\n  console.log(`Created Elite: ${eliteProduct.id} with price ${elitePrice.id}`);\n\n  console.log('Creating coin packages...');\n\n  const coinPackages = [\n    { name: '500 Versus Coins', amount: 499, coins: 500, bonus: null },\n    { name: '1200 Versus Coins', amount: 999, coins: 1200, bonus: '20% Bonus' },\n    { name: '2500 Versus Coins', amount: 1999, coins: 2500, bonus: '25% Bonus' },\n    { name: '6500 Versus Coins', amount: 4999, coins: 6500, bonus: '30% Bonus' },\n  ];\n\n  for (const pkg of coinPackages) {\n    const product = await stripe.products.create({\n      name: pkg.name,\n      description: pkg.bonus ? `${pkg.coins} coins with ${pkg.bonus}` : `${pkg.coins} Versus Coins`,\n      metadata: {\n        type: 'coins',\n        coinAmount: pkg.coins.toString(),\n        bonus: pkg.bonus || '',\n      },\n    });\n\n    const price = await stripe.prices.create({\n      product: product.id,\n      unit_amount: pkg.amount,\n      currency: 'usd',\n      metadata: {\n        type: 'coins',\n        coinAmount: pkg.coins.toString(),\n      },\n    });\n\n    console.log(`Created ${pkg.name}: ${product.id} with price ${price.id}`);\n  }\n\n  console.log('All products created successfully!');\n}\n\nseedProducts().catch(console.error);\n","path":null,"size_bytes":2341,"size_tokens":null},"client/src/components/ui/dropdown-menu.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md\",\n        \"data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&>svg]:size-4 [&>svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","path":null,"size_bytes":7606,"size_tokens":null},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary shadow focus:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-3.5 w-3.5 fill-primary\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","path":null,"size_bytes":1410,"size_tokens":null},"client/src/components/ui/spinner.tsx":{"content":"import { Loader2Icon } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction Spinner({ className, ...props }: React.ComponentProps<\"svg\">) {\n  return (\n    <Loader2Icon\n      role=\"status\"\n      aria-label=\"Loading\"\n      className={cn(\"size-4 animate-spin\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Spinner }\n","path":null,"size_bytes":331,"size_tokens":null},"client/src/pages/Battles.tsx":{"content":"import { useState } from \"react\";\nimport { Navbar } from \"@/components/layout/Navbar\";\nimport { Footer } from \"@/components/layout/Footer\";\nimport { BattleCard } from \"@/components/battle/BattleCard\";\nimport { Button } from \"@/components/ui/button\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Filter, Coins, Loader2 } from \"lucide-react\";\nimport { useUser } from \"@/context/UserContext\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useQuery, useQueryClient } from \"@tanstack/react-query\";\nimport { fetchBattles } from \"@/lib/api\";\nimport { StartBattleDialog } from \"@/components/battle/StartBattleDialog\";\nimport { JoinBattleDialog } from \"@/components/battle/JoinBattleDialog\";\n\nimport cover1 from \"@assets/generated_images/synthwave_geometric_album_art.png\";\nimport cover2 from \"@assets/generated_images/dark_trap_music_album_art.png\";\nimport cover3 from \"@assets/generated_images/lo-fi_anime_album_art.png\";\nimport cover4 from \"@assets/generated_images/future_bass_crystal_album_art.png\";\nimport { Link } from \"wouter\";\nimport { AudioOrb } from \"@/components/battle/AudioOrb\";\n\ninterface BattleSide {\n  artist: string;\n  track: string;\n  cover: string;\n  votes: number;\n  isLeading: boolean;\n}\n\ninterface FormattedBattle {\n  id: number;\n  type: string;\n  genre: string;\n  timeLeft: string;\n  left: BattleSide;\n  right: BattleSide | null;\n  canJoin: boolean;\n}\n\ninterface CompleteBattle extends FormattedBattle {\n  right: BattleSide;\n}\n\nfunction isCompleteBattle(battle: FormattedBattle): battle is CompleteBattle {\n  return battle.right !== null;\n}\n\nexport default function Battles() {\n  const { user, spendCoins, login } = useUser();\n  const { toast } = useToast();\n  const BATTLE_COST = 250;\n  const BATTLE_JOIN_COST = 250;\n  const queryClient = useQueryClient();\n  const [showStartBattleDialog, setShowStartBattleDialog] = useState(false);\n  const [showJoinBattleDialog, setShowJoinBattleDialog] = useState(false);\n  const [selectedBattleToJoin, setSelectedBattleToJoin] = useState<{\n    id: number;\n    type: string;\n    genre: string;\n    opponentName: string;\n    opponentTrack: string;\n  } | null>(null);\n\n  const { data: battlesData, isLoading, refetch } = useQuery({\n    queryKey: [\"battles\"],\n    queryFn: fetchBattles,\n    refetchInterval: 5000,\n  });\n\n  const handleStartBattle = () => {\n    if (!user) {\n      login();\n      return;\n    }\n    setShowStartBattleDialog(true);\n  };\n\n  const handleJoinBattle = (battleId: number, battleType: string, battleGenre: string, opponentName: string, opponentTrack: string) => {\n    if (!user) {\n      login();\n      return;\n    }\n\n    const userBattleType = user.role === \"producer\" ? \"beat\" : \"song\";\n    if (battleType !== userBattleType) {\n      toast({\n        title: \"Wrong Battle Type\",\n        description: user.role === \"producer\" \n          ? \"As a Producer, you can only join Beat Battles\" \n          : \"As an Artist, you can only join Song Battles\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (user.coins < BATTLE_JOIN_COST) {\n      toast({\n        title: \"Not Enough Coins\",\n        description: `You need ${BATTLE_JOIN_COST} coins to join a battle. You only have ${user.coins} coins. Visit the store!`,\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setSelectedBattleToJoin({\n      id: battleId,\n      type: battleType,\n      genre: battleGenre,\n      opponentName,\n      opponentTrack,\n    });\n    setShowJoinBattleDialog(true);\n  };\n\n  const formatBattles = (battles: typeof battlesData): FormattedBattle[] => {\n    if (!battles) return [];\n    \n    const covers = [cover1, cover2, cover3, cover4];\n    \n    return battles.map((battle) => {\n      const now = new Date();\n      const endsAt = battle.endsAt ? new Date(battle.endsAt) : new Date(now.getTime() + 24 * 60 * 60 * 1000);\n      const timeLeft = Math.max(0, endsAt.getTime() - now.getTime());\n      const hours = Math.floor(timeLeft / (1000 * 60 * 60));\n      const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));\n      const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);\n\n      return {\n        id: battle.id,\n        type: battle.type,\n        genre: battle.genre || \"general\",\n        timeLeft: `${hours.toString().padStart(2, \"0\")}:${minutes.toString().padStart(2, \"0\")}:${seconds.toString().padStart(2, \"0\")}`,\n        left: {\n          artist: battle.leftArtist,\n          track: battle.leftTrack,\n          cover: battle.leftAudio || covers[0],\n          votes: battle.leftVotes,\n          isLeading: battle.leftVotes > battle.rightVotes,\n        },\n        right: battle.rightArtist ? {\n          artist: battle.rightArtist,\n          track: battle.rightTrack || \"\",\n          cover: battle.rightAudio || covers[1],\n          votes: battle.rightVotes,\n          isLeading: battle.rightVotes > battle.leftVotes,\n        } : null,\n        canJoin: !battle.rightArtist,\n      };\n    });\n  };\n\n  const allFormattedBattles = formatBattles(battlesData) || [];\n  const completeBattles = allFormattedBattles.filter(isCompleteBattle);\n  const openBattles = allFormattedBattles.filter(b => b.canJoin);\n  const beatBattles = completeBattles.filter(b => b.type === \"beat\");\n  const songBattles = completeBattles.filter(b => b.type === \"song\");\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-sv-black flex flex-col\">\n        <Navbar />\n        <main className=\"flex-grow pt-24 pb-20 flex items-center justify-center\">\n          <Loader2 className=\"w-8 h-8 animate-spin text-sv-pink\" />\n        </main>\n        <Footer />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-sv-black flex flex-col\">\n      <Navbar />\n      \n      <main className=\"flex-grow pt-24 pb-20 relative\">\n        {/* Cyber Grid Background */}\n        <div className=\"absolute inset-0 cyber-grid opacity-10 pointer-events-none\"></div>\n        \n        <div className=\"max-w-7xl mx-auto px-4 relative z-10\">\n          <div className=\"flex flex-col md:flex-row items-end md:items-center justify-between gap-6 mb-10\">\n            <div className=\"border-l-4 border-sv-pink pl-6\">\n              <h1 className=\"text-4xl font-cyber font-bold text-white mb-2 uppercase\">Battle Arena</h1>\n              <p className=\"text-gray-500 font-body\">Vote for your favorites and help them climb the charts.</p>\n            </div>\n            \n            <div className=\"flex items-center gap-2\">\n               <button className=\"font-hud font-bold uppercase tracking-widest text-gray-400 hover:text-sv-pink transition-colors flex items-center gap-2 border border-sv-gray px-4 py-2\">\n                 <Filter className=\"w-4 h-4\" /> Filter\n               </button>\n            </div>\n          </div>\n\n          {/* Create Battle Area */}\n          <div className=\"bg-sv-dark border border-sv-gray p-8 mb-12 text-center relative overflow-hidden\">\n             <div className=\"absolute inset-0 cyber-grid opacity-20 pointer-events-none\" />\n             <div className=\"absolute -top-3 -left-3 bg-sv-gold text-black font-bold font-mono text-xs px-2 py-1 rotate-[-5deg] sketch-border z-20\">\n               ENTER THE ARENA\n             </div>\n             <div className=\"relative z-10\">\n                <h2 className=\"text-2xl font-cyber font-bold text-white mb-2 uppercase\">Ready to Battle?</h2>\n                <p className=\"text-gray-400 mb-6 max-w-lg mx-auto font-body\">\n                  Challenge another artist or producer to a battle. Winner takes home the pot and climbs the leaderboard.\n                </p>\n                <div className=\"flex flex-col items-center gap-4\">\n                  <button \n                    className=\"cyber-btn bg-sv-pink text-black font-cyber font-bold py-4 px-10 uppercase tracking-wider text-lg hover:bg-white hover:glow-pink transition-all\"\n                    onClick={handleStartBattle}\n                    data-testid=\"button-start-battle\"\n                  >\n                    <span>Start a New Battle</span>\n                  </button>\n                  <span className=\"text-xs text-sv-gold font-hud font-bold flex items-center gap-1 bg-sv-black px-3 py-1 border border-sv-gold/30 uppercase tracking-widest\">\n                    <Coins className=\"w-3 h-3\" /> Cost: {BATTLE_COST} Coins\n                  </span>\n                </div>\n             </div>\n          </div>\n\n          <Tabs defaultValue=\"open\" className=\"w-full\">\n            <TabsList className=\"bg-sv-dark border border-sv-gray p-1 mb-8 w-full md:w-auto flex-wrap h-auto\">\n              <TabsTrigger value=\"open\" className=\"flex-1 md:flex-none font-hud uppercase tracking-widest data-[state=active]:bg-sv-gold/20 data-[state=active]:text-sv-gold rounded-none\">Open ({openBattles.length})</TabsTrigger>\n              <TabsTrigger value=\"all\" className=\"flex-1 md:flex-none font-hud uppercase tracking-widest data-[state=active]:bg-white/10 data-[state=active]:text-white rounded-none\">All ({completeBattles.length})</TabsTrigger>\n              <TabsTrigger value=\"beats\" className=\"flex-1 md:flex-none font-hud uppercase tracking-widest data-[state=active]:bg-sv-purple/20 data-[state=active]:text-sv-purple rounded-none\">Beats ({beatBattles.length})</TabsTrigger>\n              <TabsTrigger value=\"songs\" className=\"flex-1 md:flex-none font-hud uppercase tracking-widest data-[state=active]:bg-sv-pink/20 data-[state=active]:text-sv-pink rounded-none\">Songs ({songBattles.length})</TabsTrigger>\n            </TabsList>\n\n            <TabsContent value=\"open\" className=\"mt-0\">\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8\">\n                {openBattles.length === 0 ? (\n                  <div className=\"col-span-full text-center py-12 bg-sv-dark border border-sv-gray\">\n                    <p className=\"text-gray-500 font-body\">No open battles right now. Start one to get the party going!</p>\n                  </div>\n                ) : (\n                  openBattles.map((battle) => {\n                    const isBeat = battle.type === \"beat\";\n                    const userBattleType = user?.role === \"producer\" ? \"beat\" : \"song\";\n                    const canJoin = !user || battle.type === userBattleType;\n                    return (\n                      <div key={battle.id} className={`relative bg-sv-dark border overflow-hidden transition-all duration-300 group ${canJoin ? 'border-sv-gray hover:border-sv-gold/50' : 'border-sv-gray/50 opacity-60'}`}>\n                        <div className=\"absolute top-0 right-0 bg-sv-gold text-black font-mono text-xs px-2 py-1 font-bold\">\n                          OPEN\n                        </div>\n                        <div className=\"p-6\">\n                          <div className=\"flex items-center justify-between mb-4\">\n                            <div className=\"flex items-center gap-2\">\n                              <div className={`w-2 h-2 ${isBeat ? 'bg-sv-purple' : 'bg-sv-pink'} animate-pulse`} />\n                              <span className={`text-xs font-hud font-bold uppercase tracking-widest ${isBeat ? 'text-sv-purple' : 'text-sv-pink'}`}>\n                                {isBeat ? 'Beat Battle' : 'Song Battle'}\n                              </span>\n                            </div>\n                            <span className=\"text-xs font-mono text-gray-500\">{battle.timeLeft}</span>\n                          </div>\n                          \n                          <div className=\"flex items-center justify-center mb-3\">\n                            <span className=\"text-xs font-mono text-sv-gold bg-sv-gold/10 px-2 py-0.5 uppercase\">\n                              {battle.genre}\n                            </span>\n                          </div>\n                          \n                          <div className=\"relative aspect-square flex items-center justify-center mb-4\">\n                            <AudioOrb \n                              isPlaying={false} \n                              color={isBeat ? \"purple\" : \"pink\"} \n                              size=\"lg\"\n                            />\n                          </div>\n                          \n                          <h3 className=\"font-punk text-white truncate text-center\">{battle.left.track}</h3>\n                          <p className=\"text-sm text-gray-500 truncate mb-4 text-center font-hud\">{battle.left.artist}</p>\n                          \n                          {canJoin ? (\n                            <button\n                              className=\"w-full punk-btn font-punk text-sv-gold border-2 border-sv-gold py-3 hover:bg-sv-gold/10 transition-all sketch-border\"\n                              onClick={() => handleJoinBattle(battle.id, battle.type, battle.genre, battle.left.artist, battle.left.track)}\n                              data-testid={`button-join-battle-${battle.id}`}\n                            >\n                              Join Battle ({BATTLE_JOIN_COST} Coins)\n                            </button>\n                          ) : (\n                            <div className=\"w-full py-3 text-center text-sm text-gray-500 border-2 border-sv-gray bg-sv-gray/20\">\n                              {isBeat ? 'Producers Only' : 'Artists Only'}\n                            </div>\n                          )}\n                        </div>\n                      </div>\n                    );\n                  })\n                )}\n              </div>\n            </TabsContent>\n\n            <TabsContent value=\"all\" className=\"mt-0\">\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8\">\n                {completeBattles.map((battle) => (\n                  <Link key={battle.id} href={`/battle/${battle.id}`}>\n                    <div className=\"cursor-pointer\">\n                      <BattleCard {...battle} />\n                    </div>\n                  </Link>\n                ))}\n              </div>\n            </TabsContent>\n            \n            <TabsContent value=\"beats\" className=\"mt-0\">\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8\">\n                {beatBattles.length === 0 ? (\n                  <div className=\"col-span-full text-center py-12 bg-sv-dark border border-sv-gray\">\n                    <p className=\"text-gray-500 font-body\">No beat battles in progress. Start one if you're a producer!</p>\n                  </div>\n                ) : (\n                  beatBattles.map((battle) => (\n                    <Link key={battle.id} href={`/battle/${battle.id}`}>\n                      <div className=\"cursor-pointer\">\n                        <BattleCard {...battle} />\n                      </div>\n                    </Link>\n                  ))\n                )}\n              </div>\n            </TabsContent>\n\n            <TabsContent value=\"songs\" className=\"mt-0\">\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8\">\n                {songBattles.length === 0 ? (\n                  <div className=\"col-span-full text-center py-12 bg-sv-dark border border-sv-gray\">\n                    <p className=\"text-gray-500 font-body\">No song battles in progress. Start one if you're an artist!</p>\n                  </div>\n                ) : (\n                  songBattles.map((battle) => (\n                    <Link key={battle.id} href={`/battle/${battle.id}`}>\n                      <div className=\"cursor-pointer\">\n                        <BattleCard {...battle} />\n                      </div>\n                    </Link>\n                  ))\n                )}\n              </div>\n            </TabsContent>\n          </Tabs>\n\n        </div>\n      </main>\n      <Footer />\n      \n      <StartBattleDialog\n        open={showStartBattleDialog}\n        onOpenChange={setShowStartBattleDialog}\n        battleCost={BATTLE_COST}\n      />\n\n      {selectedBattleToJoin && (\n        <JoinBattleDialog\n          open={showJoinBattleDialog}\n          onOpenChange={(open) => {\n            setShowJoinBattleDialog(open);\n            if (!open) setSelectedBattleToJoin(null);\n          }}\n          battleId={selectedBattleToJoin.id}\n          battleType={selectedBattleToJoin.type}\n          battleGenre={selectedBattleToJoin.genre}\n          opponentName={selectedBattleToJoin.opponentName}\n          opponentTrack={selectedBattleToJoin.opponentTrack}\n          battleCost={BATTLE_JOIN_COST}\n        />\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":16456,"size_tokens":null},"client/src/components/chat/GlobalChat.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { MessageCircle, X, Send, Users } from \"lucide-react\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { motion, AnimatePresence } from \"framer-motion\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { fetchChatMessages, sendChatMessage } from \"@/lib/api\";\nimport { useUser } from \"@/context/UserContext\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useSoundEffects } from \"@/hooks/useSoundEffects\";\n\nexport function GlobalChat() {\n  const [isOpen, setIsOpen] = useState(false);\n  const [inputText, setInputText] = useState(\"\");\n  const scrollRef = useRef<HTMLDivElement>(null);\n  const prevMessageCountRef = useRef<number>(0);\n  const { user } = useUser();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const { playSound } = useSoundEffects();\n\n  const { data: messages } = useQuery({\n    queryKey: [\"chat\"],\n    queryFn: fetchChatMessages,\n    refetchInterval: 5000, // Refresh every 5 seconds\n  });\n\n  const sendMessageMutation = useMutation({\n    mutationFn: (text: string) => sendChatMessage(user!.id, text),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"chat\"] });\n      setInputText(\"\");\n      playSound(\"chatMessage\");\n    },\n    onError: () => {\n      toast({\n        title: \"Failed to send message\",\n        variant: \"destructive\",\n      });\n      playSound(\"error\");\n    },\n  });\n\n  useEffect(() => {\n    if (messages && isOpen) {\n      const messageCount = messages.length;\n      if (prevMessageCountRef.current > 0 && messageCount > prevMessageCountRef.current) {\n        const lastMessage = messages[messages.length - 1];\n        if (lastMessage && lastMessage.userId !== user?.id) {\n          playSound(\"chatMessage\");\n        }\n      }\n      prevMessageCountRef.current = messageCount;\n    }\n  }, [messages, isOpen, user?.id, playSound]);\n\n  const handleSend = () => {\n    if (!inputText.trim() || !user) return;\n    sendMessageMutation.mutate(inputText);\n  };\n\n  // Auto scroll to bottom\n  useEffect(() => {\n    if (scrollRef.current) {\n      scrollRef.current.scrollTop = scrollRef.current.scrollHeight;\n    }\n  }, [messages, isOpen]);\n\n  return (\n    <div className=\"fixed bottom-4 right-4 z-50 flex flex-col items-end\">\n      <AnimatePresence>\n        {isOpen && (\n          <motion.div\n            initial={{ opacity: 0, y: 20, scale: 0.95 }}\n            animate={{ opacity: 1, y: 0, scale: 1 }}\n            exit={{ opacity: 0, y: 20, scale: 0.95 }}\n            className=\"mb-4 w-80 sm:w-96 bg-black/90 border border-white/10 backdrop-blur-xl rounded-2xl shadow-2xl shadow-black/50 overflow-hidden flex flex-col\"\n            style={{ height: \"500px\" }}\n          >\n            {/* Header */}\n            <div className=\"p-4 border-b border-white/10 bg-white/5 flex items-center justify-between\">\n              <div className=\"flex items-center gap-2\">\n                <div className=\"w-2 h-2 rounded-full bg-green-500 animate-pulse\" />\n                <span className=\"font-bold text-white text-sm\">Global Chat</span>\n                <span className=\"text-xs text-muted-foreground flex items-center gap-1\">\n                  <Users className=\"w-3 h-3\" /> 124 Online\n                </span>\n              </div>\n              <Button variant=\"ghost\" size=\"icon\" className=\"h-6 w-6\" onClick={() => setIsOpen(false)}>\n                <X className=\"w-4 h-4\" />\n              </Button>\n            </div>\n\n            {/* Messages */}\n            <div className=\"flex-grow overflow-y-auto p-4 space-y-4 custom-scrollbar\" ref={scrollRef}>\n              {(messages || []).map((msg) => {\n                const time = new Date(msg.createdAt).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });\n                return (\n                  <div key={msg.id} className=\"flex gap-3\">\n                    <Avatar className=\"w-8 h-8 border border-white/10 mt-1 flex-shrink-0\">\n                      <AvatarImage src={msg.userAvatar} />\n                      <AvatarFallback>{msg.userName[0]}</AvatarFallback>\n                    </Avatar>\n                    <div className=\"flex flex-col\">\n                      <div className=\"flex items-baseline gap-2 mb-1\">\n                        <span className=\"text-xs font-bold text-white\">{msg.userName}</span>\n                        <span className=\"text-[10px] text-muted-foreground\">{time}</span>\n                      </div>\n                      <p className=\"text-sm text-muted-foreground bg-white/5 p-2 rounded-r-xl rounded-bl-xl\">\n                        {msg.text}\n                      </p>\n                    </div>\n                  </div>\n                );\n              })}\n            </div>\n\n            {/* Input */}\n            <div className=\"p-3 border-t border-white/10 bg-black/20\">\n              <form \n                className=\"flex gap-2\"\n                onSubmit={(e) => { e.preventDefault(); handleSend(); }}\n              >\n                <Input \n                  value={inputText}\n                  onChange={(e) => setInputText(e.target.value)}\n                  placeholder={user ? \"Type a message...\" : \"Login to chat\"}\n                  className=\"bg-white/5 border-white/10 focus-visible:ring-violet-500 h-9 text-sm\"\n                  disabled={!user}\n                />\n                <Button type=\"submit\" size=\"icon\" className=\"h-9 w-9 bg-violet-500 hover:bg-violet-600 text-white\" disabled={!user}>\n                  <Send className=\"w-4 h-4\" />\n                </Button>\n              </form>\n            </div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n\n      <Button \n        onClick={() => setIsOpen(!isOpen)}\n        size=\"lg\" \n        className={`rounded-full h-14 w-14 shadow-lg shadow-violet-500/20 transition-all duration-300 ${isOpen ? 'bg-white text-black hover:bg-white/90' : 'bg-violet-600 hover:bg-violet-500 text-white hover:scale-110'}`}\n      >\n        {isOpen ? <X className=\"w-6 h-6\" /> : <MessageCircle className=\"w-6 h-6\" />}\n      </Button>\n    </div>\n  );\n}\n","path":null,"size_bytes":6261,"size_tokens":null},"client/src/components/ui/calendar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport {\n  ChevronDownIcon,\n  ChevronLeftIcon,\n  ChevronRightIcon,\n} from \"lucide-react\"\nimport { DayButton, DayPicker, getDefaultClassNames } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button, buttonVariants } from \"@/components/ui/button\"\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  captionLayout = \"label\",\n  buttonVariant = \"ghost\",\n  formatters,\n  components,\n  ...props\n}: React.ComponentProps<typeof DayPicker> & {\n  buttonVariant?: React.ComponentProps<typeof Button>[\"variant\"]\n}) {\n  const defaultClassNames = getDefaultClassNames()\n\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\n        \"bg-background group/calendar p-3 [--cell-size:2rem] [[data-slot=card-content]_&]:bg-transparent [[data-slot=popover-content]_&]:bg-transparent\",\n        String.raw`rtl:**:[.rdp-button\\_next>svg]:rotate-180`,\n        String.raw`rtl:**:[.rdp-button\\_previous>svg]:rotate-180`,\n        className\n      )}\n      captionLayout={captionLayout}\n      formatters={{\n        formatMonthDropdown: (date) =>\n          date.toLocaleString(\"default\", { month: \"short\" }),\n        ...formatters,\n      }}\n      classNames={{\n        root: cn(\"w-fit\", defaultClassNames.root),\n        months: cn(\n          \"relative flex flex-col gap-4 md:flex-row\",\n          defaultClassNames.months\n        ),\n        month: cn(\"flex w-full flex-col gap-4\", defaultClassNames.month),\n        nav: cn(\n          \"absolute inset-x-0 top-0 flex w-full items-center justify-between gap-1\",\n          defaultClassNames.nav\n        ),\n        button_previous: cn(\n          buttonVariants({ variant: buttonVariant }),\n          \"h-[--cell-size] w-[--cell-size] select-none p-0 aria-disabled:opacity-50\",\n          defaultClassNames.button_previous\n        ),\n        button_next: cn(\n          buttonVariants({ variant: buttonVariant }),\n          \"h-[--cell-size] w-[--cell-size] select-none p-0 aria-disabled:opacity-50\",\n          defaultClassNames.button_next\n        ),\n        month_caption: cn(\n          \"flex h-[--cell-size] w-full items-center justify-center px-[--cell-size]\",\n          defaultClassNames.month_caption\n        ),\n        dropdowns: cn(\n          \"flex h-[--cell-size] w-full items-center justify-center gap-1.5 text-sm font-medium\",\n          defaultClassNames.dropdowns\n        ),\n        dropdown_root: cn(\n          \"has-focus:border-ring border-input shadow-xs has-focus:ring-ring/50 has-focus:ring-[3px] relative rounded-md border\",\n          defaultClassNames.dropdown_root\n        ),\n        dropdown: cn(\n          \"bg-popover absolute inset-0 opacity-0\",\n          defaultClassNames.dropdown\n        ),\n        caption_label: cn(\n          \"select-none font-medium\",\n          captionLayout === \"label\"\n            ? \"text-sm\"\n            : \"[&>svg]:text-muted-foreground flex h-8 items-center gap-1 rounded-md pl-2 pr-1 text-sm [&>svg]:size-3.5\",\n          defaultClassNames.caption_label\n        ),\n        table: \"w-full border-collapse\",\n        weekdays: cn(\"flex\", defaultClassNames.weekdays),\n        weekday: cn(\n          \"text-muted-foreground flex-1 select-none rounded-md text-[0.8rem] font-normal\",\n          defaultClassNames.weekday\n        ),\n        week: cn(\"mt-2 flex w-full\", defaultClassNames.week),\n        week_number_header: cn(\n          \"w-[--cell-size] select-none\",\n          defaultClassNames.week_number_header\n        ),\n        week_number: cn(\n          \"text-muted-foreground select-none text-[0.8rem]\",\n          defaultClassNames.week_number\n        ),\n        day: cn(\n          \"group/day relative aspect-square h-full w-full select-none p-0 text-center [&:first-child[data-selected=true]_button]:rounded-l-md [&:last-child[data-selected=true]_button]:rounded-r-md\",\n          defaultClassNames.day\n        ),\n        range_start: cn(\n          \"bg-accent rounded-l-md\",\n          defaultClassNames.range_start\n        ),\n        range_middle: cn(\"rounded-none\", defaultClassNames.range_middle),\n        range_end: cn(\"bg-accent rounded-r-md\", defaultClassNames.range_end),\n        today: cn(\n          \"bg-accent text-accent-foreground rounded-md data-[selected=true]:rounded-none\",\n          defaultClassNames.today\n        ),\n        outside: cn(\n          \"text-muted-foreground aria-selected:text-muted-foreground\",\n          defaultClassNames.outside\n        ),\n        disabled: cn(\n          \"text-muted-foreground opacity-50\",\n          defaultClassNames.disabled\n        ),\n        hidden: cn(\"invisible\", defaultClassNames.hidden),\n        ...classNames,\n      }}\n      components={{\n        Root: ({ className, rootRef, ...props }) => {\n          return (\n            <div\n              data-slot=\"calendar\"\n              ref={rootRef}\n              className={cn(className)}\n              {...props}\n            />\n          )\n        },\n        Chevron: ({ className, orientation, ...props }) => {\n          if (orientation === \"left\") {\n            return (\n              <ChevronLeftIcon className={cn(\"size-4\", className)} {...props} />\n            )\n          }\n\n          if (orientation === \"right\") {\n            return (\n              <ChevronRightIcon\n                className={cn(\"size-4\", className)}\n                {...props}\n              />\n            )\n          }\n\n          return (\n            <ChevronDownIcon className={cn(\"size-4\", className)} {...props} />\n          )\n        },\n        DayButton: CalendarDayButton,\n        WeekNumber: ({ children, ...props }) => {\n          return (\n            <td {...props}>\n              <div className=\"flex size-[--cell-size] items-center justify-center text-center\">\n                {children}\n              </div>\n            </td>\n          )\n        },\n        ...components,\n      }}\n      {...props}\n    />\n  )\n}\n\nfunction CalendarDayButton({\n  className,\n  day,\n  modifiers,\n  ...props\n}: React.ComponentProps<typeof DayButton>) {\n  const defaultClassNames = getDefaultClassNames()\n\n  const ref = React.useRef<HTMLButtonElement>(null)\n  React.useEffect(() => {\n    if (modifiers.focused) ref.current?.focus()\n  }, [modifiers.focused])\n\n  return (\n    <Button\n      ref={ref}\n      variant=\"ghost\"\n      size=\"icon\"\n      data-day={day.date.toLocaleDateString()}\n      data-selected-single={\n        modifiers.selected &&\n        !modifiers.range_start &&\n        !modifiers.range_end &&\n        !modifiers.range_middle\n      }\n      data-range-start={modifiers.range_start}\n      data-range-end={modifiers.range_end}\n      data-range-middle={modifiers.range_middle}\n      className={cn(\n        \"data-[selected-single=true]:bg-primary data-[selected-single=true]:text-primary-foreground data-[range-middle=true]:bg-accent data-[range-middle=true]:text-accent-foreground data-[range-start=true]:bg-primary data-[range-start=true]:text-primary-foreground data-[range-end=true]:bg-primary data-[range-end=true]:text-primary-foreground group-data-[focused=true]/day:border-ring group-data-[focused=true]/day:ring-ring/50 flex aspect-square h-auto w-full min-w-[--cell-size] flex-col gap-1 font-normal leading-none data-[range-end=true]:rounded-md data-[range-middle=true]:rounded-none data-[range-start=true]:rounded-md group-data-[focused=true]/day:relative group-data-[focused=true]/day:z-10 group-data-[focused=true]/day:ring-[3px] [&>span]:text-xs [&>span]:opacity-70\",\n        defaultClassNames.day,\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport { Calendar, CalendarDayButton }\n","path":null,"size_bytes":7569,"size_tokens":null},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"grid place-content-center peer h-4 w-4 shrink-0 rounded-sm border border-primary shadow focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"grid place-content-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","path":null,"size_bytes":1031,"size_tokens":null},"client/src/components/layout/Footer.tsx":{"content":"import { Link } from \"wouter\";\nimport { useToast } from \"@/hooks/use-toast\";\n\nexport function Footer() {\n  const { toast } = useToast();\n\n  const handleComingSoon = (feature: string) => {\n    toast({\n      title: \"Coming Soon!\",\n      description: `${feature} will be available soon. Stay tuned!`,\n    });\n  };\n\n  return (\n    <footer className=\"border-t border-sv-gray bg-sv-black py-12 relative overflow-hidden\">\n      {/* Cyber Grid Background */}\n      <div className=\"absolute inset-0 cyber-grid opacity-10 pointer-events-none\"></div>\n      \n      <div className=\"max-w-7xl mx-auto px-4 relative z-10\">\n        <div className=\"grid grid-cols-1 md:grid-cols-4 gap-8 mb-12\">\n          <div>\n            <div className=\"flex items-center gap-2 mb-4\">\n              <div className=\"w-8 h-8 bg-sv-pink skew-x-[-12deg] flex items-center justify-center border-2 border-white\">\n                <span className=\"font-punk text-black text-xl font-bold -skew-x-[12deg]\">S</span>\n              </div>\n              <span className=\"font-cyber font-bold text-xl tracking-wider text-white\">\n                SONG<span className=\"text-sv-pink\">VERSUS</span>\n              </span>\n            </div>\n            <p className=\"text-gray-500 text-sm leading-relaxed font-body\">\n              The underground arena where Artists and Producers clash. \n              Drop tracks. Win ORBs. Become Legend.\n            </p>\n          </div>\n          \n          <div>\n            <h4 className=\"text-sv-gold font-hud font-bold tracking-widest uppercase mb-4\">Platform</h4>\n            <ul className=\"space-y-2 text-sm text-gray-400 font-hud\">\n              <li><Link href=\"/battles\" className=\"hover:text-sv-pink cursor-pointer transition-colors\" data-testid=\"link-battles\">Active Battles</Link></li>\n              <li><button onClick={() => handleComingSoon(\"Tournaments\")} className=\"hover:text-sv-pink cursor-pointer transition-colors\" data-testid=\"button-tournaments\">Tournaments</button></li>\n              <li><Link href=\"/leaderboard\" className=\"hover:text-sv-pink cursor-pointer transition-colors\" data-testid=\"link-leaderboard\">Leaderboards</Link></li>\n              <li><Link href=\"/store\" className=\"hover:text-sv-pink cursor-pointer transition-colors\" data-testid=\"link-pricing\">Pricing</Link></li>\n            </ul>\n          </div>\n\n          <div>\n            <h4 className=\"text-sv-gold font-hud font-bold tracking-widest uppercase mb-4\">Community</h4>\n            <ul className=\"space-y-2 text-sm text-gray-400 font-hud\">\n              <li><a href=\"https://discord.gg/pNdgdWqW4j\" target=\"_blank\" rel=\"noopener noreferrer\" className=\"hover:text-sv-pink cursor-pointer transition-colors\">Discord Server</a></li>\n              <li><Link href=\"/legal/guidelines\" className=\"hover:text-sv-pink cursor-pointer transition-colors\" data-testid=\"link-guidelines\">Guidelines</Link></li>\n              <li><Link href=\"/legal/ai\" className=\"hover:text-sv-pink cursor-pointer transition-colors\" data-testid=\"link-ai-rules\">AI Rules</Link></li>\n              <li><Link href=\"/support\" className=\"hover:text-sv-pink cursor-pointer transition-colors\" data-testid=\"link-support\">Support</Link></li>\n            </ul>\n          </div>\n\n          <div>\n            <h4 className=\"text-sv-gold font-hud font-bold tracking-widest uppercase mb-4\">Legal</h4>\n            <ul className=\"space-y-2 text-sm text-gray-400 font-hud\">\n              <li><Link href=\"/legal/privacy\" className=\"hover:text-sv-pink cursor-pointer transition-colors\" data-testid=\"link-privacy\">Privacy Policy</Link></li>\n              <li><Link href=\"/legal/terms\" className=\"hover:text-sv-pink cursor-pointer transition-colors\" data-testid=\"link-terms\">Terms of Service</Link></li>\n              <li><Link href=\"/legal/copyright\" className=\"hover:text-sv-pink cursor-pointer transition-colors\" data-testid=\"link-copyright\">Copyright</Link></li>\n            </ul>\n          </div>\n        </div>\n        \n        <div className=\"border-t border-sv-gray pt-8 flex flex-col md:flex-row items-center justify-between gap-4\">\n          <p className=\"text-sm text-gray-500 font-mono\">\n             2024 SongVersus Inc. All rights reserved.\n          </p>\n          <div className=\"flex items-center gap-4\">\n            <span className=\"text-xs font-hud text-gray-600 uppercase tracking-widest\">Powered by the underground</span>\n          </div>\n        </div>\n      </div>\n    </footer>\n  );\n}\n","path":null,"size_bytes":4436,"size_tokens":null},"client/src/pages/Producers.tsx":{"content":"import { Navbar } from \"@/components/layout/Navbar\";\nimport { Footer } from \"@/components/layout/Footer\";\nimport { Button } from \"@/components/ui/button\";\nimport { Music4, UserPlus, User, UserCheck, Loader2, Crown, Star } from \"lucide-react\";\nimport { Link } from \"wouter\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useUser } from \"@/context/UserContext\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport type { User as UserType } from \"@shared/schema\";\n\nasync function fetchProducers(): Promise<UserType[]> {\n  const response = await fetch(\"/api/users/role/producer\");\n  if (!response.ok) throw new Error(\"Failed to fetch producers\");\n  return response.json();\n}\n\nasync function checkFollowStatus(userId: number): Promise<boolean> {\n  const response = await fetch(`/api/follow/${userId}/status`, {\n    credentials: \"include\",\n  });\n  if (!response.ok) return false;\n  const data = await response.json();\n  return data.isFollowing;\n}\n\nfunction MembershipBadge({ membership }: { membership: string }) {\n  if (membership === \"elite\") {\n    return (\n      <div className=\"flex items-center gap-1 px-2 py-0.5 bg-sv-gold/20 border border-sv-gold/50 rounded text-sv-gold text-xs font-bold\">\n        <Crown className=\"w-3 h-3\" />\n        ELITE\n      </div>\n    );\n  }\n  if (membership === \"pro\") {\n    return (\n      <div className=\"flex items-center gap-1 px-2 py-0.5 bg-sv-purple/20 border border-sv-purple/50 rounded text-sv-purple text-xs font-bold\">\n        <Star className=\"w-3 h-3\" />\n        PRO\n      </div>\n    );\n  }\n  return null;\n}\n\nfunction ProducerCard({ producer, currentUserId }: { producer: UserType; currentUserId?: number }) {\n  const queryClient = useQueryClient();\n  const { toast } = useToast();\n\n  const { data: isFollowing = false } = useQuery({\n    queryKey: [\"followStatus\", producer.id],\n    queryFn: () => checkFollowStatus(producer.id),\n    enabled: !!currentUserId && currentUserId !== producer.id,\n  });\n\n  const followMutation = useMutation({\n    mutationFn: async () => {\n      const response = await fetch(`/api/follow/${producer.id}`, {\n        method: \"POST\",\n        credentials: \"include\",\n      });\n      if (!response.ok) throw new Error(\"Failed to follow\");\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"followStatus\", producer.id] });\n      toast({ title: \"Followed!\", description: `You are now following ${producer.name}` });\n    },\n  });\n\n  const unfollowMutation = useMutation({\n    mutationFn: async () => {\n      const response = await fetch(`/api/follow/${producer.id}`, {\n        method: \"DELETE\",\n        credentials: \"include\",\n      });\n      if (!response.ok) throw new Error(\"Failed to unfollow\");\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"followStatus\", producer.id] });\n      toast({ title: \"Unfollowed\", description: `You unfollowed ${producer.name}` });\n    },\n  });\n\n  const handleFollowClick = () => {\n    if (!currentUserId) {\n      toast({ title: \"Login Required\", description: \"Please login to follow producers\", variant: \"destructive\" });\n      return;\n    }\n    if (isFollowing) {\n      unfollowMutation.mutate();\n    } else {\n      followMutation.mutate();\n    }\n  };\n\n  return (\n    <div className=\"bg-card/50 border border-white/5 rounded-xl p-6 hover:border-violet-500/30 transition-all group relative overflow-hidden\" data-testid={`producer-card-${producer.id}`}>\n      <div className=\"absolute inset-0 bg-gradient-to-b from-violet-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity\" />\n      \n      <div className=\"relative z-10 flex items-center gap-4\">\n        <div className=\"relative\">\n          <img \n            src={producer.profileImageUrl || \"https://github.com/shadcn.png\"} \n            alt={producer.name || \"Producer\"} \n            className=\"w-16 h-16 rounded-full border-2 border-white/10 group-hover:border-violet-500 transition-colors object-cover\" \n          />\n          <div className=\"absolute -top-1 -right-1 w-5 h-5 bg-violet-500 rounded-full flex items-center justify-center border border-black\">\n            <Music4 className=\"w-3 h-3 text-white\" />\n          </div>\n        </div>\n        \n        <div className=\"flex-grow min-w-0\">\n          <div className=\"flex items-center gap-2 flex-wrap\">\n            <h3 className=\"font-bold text-white text-lg group-hover:text-violet-400 transition-colors truncate\">\n              {producer.name || \"Unknown Producer\"}\n            </h3>\n            <MembershipBadge membership={producer.membership} />\n          </div>\n          <p className=\"text-sm text-muted-foreground\">Level {producer.level}  {producer.wins} wins</p>\n        </div>\n\n        {currentUserId !== producer.id && (\n          <Button \n            size=\"icon\" \n            variant=\"ghost\" \n            className={isFollowing ? \"text-violet-400\" : \"text-muted-foreground hover:text-white\"}\n            onClick={handleFollowClick}\n            disabled={followMutation.isPending || unfollowMutation.isPending}\n            data-testid={`button-follow-${producer.id}`}\n          >\n            {isFollowing ? <UserCheck className=\"w-5 h-5\" /> : <UserPlus className=\"w-5 h-5\" />}\n          </Button>\n        )}\n      </div>\n\n      <div className=\"mt-6 flex items-center justify-between border-t border-white/5 pt-4\">\n        <span className=\"text-xs font-medium text-muted-foreground\">{producer.xp} XP</span>\n        <Button \n          size=\"sm\" \n          variant=\"outline\" \n          className=\"h-8 border-white/10 hover:bg-violet-500/20 hover:text-violet-400 hover:border-violet-500/50 text-xs\"\n          data-testid={`button-view-producer-${producer.id}`}\n          asChild\n        >\n          <Link href={`/user/${producer.id}`}>\n            <User className=\"w-3 h-3 mr-2\" /> View Profile\n          </Link>\n        </Button>\n      </div>\n    </div>\n  );\n}\n\nexport default function Producers() {\n  const { user } = useUser();\n\n  const { data: producers = [], isLoading } = useQuery({\n    queryKey: [\"producers\"],\n    queryFn: fetchProducers,\n  });\n\n  return (\n    <div className=\"min-h-screen bg-background flex flex-col\">\n      <Navbar />\n      <main className=\"flex-grow pt-24 pb-20\">\n        <div className=\"container mx-auto px-4\">\n          <div className=\"text-center max-w-2xl mx-auto mb-16\">\n            <h1 className=\"text-4xl md:text-6xl font-bold font-heading text-white mb-4\">Top Producers</h1>\n            <p className=\"text-muted-foreground text-lg\">\n              The masterminds behind the beats. Connect with producers for your next hit.\n            </p>\n          </div>\n\n          {isLoading ? (\n            <div className=\"flex justify-center py-12\">\n              <Loader2 className=\"w-8 h-8 animate-spin text-violet-500\" />\n            </div>\n          ) : producers.length === 0 ? (\n            <div className=\"text-center py-12\">\n              <p className=\"text-muted-foreground\">No producers found yet. Be the first to join!</p>\n            </div>\n          ) : (\n            <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6\">\n              {producers.map((producer) => (\n                <ProducerCard key={producer.id} producer={producer} currentUserId={user?.id} />\n              ))}\n            </div>\n          )}\n        </div>\n      </main>\n      <Footer />\n    </div>\n  );\n}\n","path":null,"size_bytes":7371,"size_tokens":null},"client/src/components/ui/form.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue | null>(null)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  if (!itemContext) {\n    throw new Error(\"useFormField should be used within <FormItem>\")\n  }\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue | null>(null)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-[0.8rem] text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-[0.8rem] font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","path":null,"size_bytes":4175,"size_tokens":null},"client/src/components/battle/BattleCard.tsx":{"content":"import { Button } from \"@/components/ui/button\";\nimport { Play, Pause, BarChart2 } from \"lucide-react\";\nimport { useState, useEffect } from \"react\";\nimport { AudioOrb } from \"./AudioOrb\";\nimport { cn } from \"@/lib/utils\";\nimport { useShouldReduceMotion } from \"@/hooks/useIsMobile\";\n\ninterface BattleSide {\n  artist: string;\n  track: string;\n  cover: string;\n  votes: number;\n  isLeading?: boolean;\n}\n\ninterface BattleCardProps {\n  left: BattleSide;\n  right: BattleSide;\n  timeLeft: string;\n  type?: string;\n  genre?: string;\n}\n\nexport function BattleCard({ left, right, timeLeft, type = \"beat\", genre = \"general\" }: BattleCardProps) {\n  const [playing, setPlaying] = useState<\"left\" | \"right\" | null>(null);\n  const [displayTime, setDisplayTime] = useState(timeLeft);\n  const reduceMotion = useShouldReduceMotion();\n  const totalVotes = left.votes + right.votes || 1;\n  const leftPercent = (left.votes / totalVotes) * 100;\n  const rightPercent = (right.votes / totalVotes) * 100;\n\n  useEffect(() => {\n    setDisplayTime(timeLeft);\n  }, [timeLeft]);\n\n  useEffect(() => {\n    const interval = setInterval(() => {\n      setDisplayTime(prev => {\n        const parts = prev.split(':').map(Number);\n        if (parts.length !== 3) return prev;\n        \n        let [hours, minutes, seconds] = parts;\n        \n        if (seconds > 0) {\n          seconds--;\n        } else if (minutes > 0) {\n          minutes--;\n          seconds = 59;\n        } else if (hours > 0) {\n          hours--;\n          minutes = 59;\n          seconds = 59;\n        }\n        \n        return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;\n      });\n    }, 1000);\n\n    return () => clearInterval(interval);\n  }, []);\n\n  const isBeat = type === \"beat\";\n\n  return (\n    <div \n      className={cn(\n        \"bg-sv-dark border border-sv-gray overflow-hidden hover:border-sv-pink/50 transition-all duration-300 group relative\",\n        !reduceMotion && \"hover:-translate-y-1\"\n      )}\n    >\n      {/* Header */}\n      <div className=\"px-6 py-4 flex items-center justify-between border-b border-sv-gray bg-sv-black/50\">\n        <div className=\"flex items-center gap-3\">\n          <div className=\"flex items-center gap-2\">\n            <div className={`w-2 h-2 ${isBeat ? 'bg-sv-purple' : 'bg-sv-pink'} animate-pulse`} />\n            <span className={`text-xs font-hud font-bold uppercase tracking-widest ${isBeat ? 'text-sv-purple' : 'text-sv-pink'}`}>\n              {isBeat ? 'Beat Battle' : 'Song Battle'}\n            </span>\n          </div>\n          <span className=\"text-xs font-mono text-sv-gold bg-sv-gold/10 px-2 py-0.5 uppercase\">\n            {genre}\n          </span>\n        </div>\n        <span className=\"text-xs font-mono text-gray-500\">{displayTime}</span>\n      </div>\n\n      {/* Battle Area */}\n      <div className=\"grid grid-cols-2 relative min-h-[200px]\">\n        \n        {/* VS Badge */}\n        <div className=\"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-10\">\n          <div className=\"w-12 h-12 bg-sv-black border-2 border-sv-gold flex items-center justify-center skew-x-[-12deg] glow-gold\">\n            <span className=\"font-punk text-sv-gold text-lg skew-x-[12deg]\">VS</span>\n          </div>\n        </div>\n\n        {/* Left Side */}\n        <div className=\"relative p-6 border-r border-sv-gray group/side\">\n          <div className=\"absolute inset-0 bg-gradient-to-br from-sv-pink/5 to-transparent opacity-0 group-hover/side:opacity-100 transition-opacity\" />\n          <div className=\"relative z-10 flex flex-col h-full items-center\">\n            <div className=\"relative aspect-square w-full flex items-center justify-center mb-4\">\n              <AudioOrb \n                isPlaying={playing === \"left\"} \n                color=\"pink\" \n                size=\"lg\"\n              />\n              <Button \n                size=\"icon\" \n                className=\"absolute bottom-0 right-0 w-10 h-10 bg-sv-pink text-black hover:bg-white hover:glow-pink\"\n                onClick={(e) => {\n                  e.preventDefault();\n                  e.stopPropagation();\n                  setPlaying(playing === \"left\" ? null : \"left\");\n                }}\n                data-testid=\"button-play-left\"\n              >\n                {playing === \"left\" ? <Pause className=\"w-4 h-4\" /> : <Play className=\"w-4 h-4 ml-0.5\" />}\n              </Button>\n            </div>\n            <div className=\"mt-auto text-center w-full\">\n              <h3 className=\"font-punk text-white truncate\">{left.track}</h3>\n              <p className=\"text-sm text-gray-500 truncate font-hud\">{left.artist}</p>\n            </div>\n          </div>\n        </div>\n\n        {/* Right Side */}\n        <div className=\"relative p-6 group/side\">\n          <div className=\"absolute inset-0 bg-gradient-to-bl from-sv-purple/5 to-transparent opacity-0 group-hover/side:opacity-100 transition-opacity\" />\n          <div className=\"relative z-10 flex flex-col h-full items-center\">\n            <div className=\"relative aspect-square w-full flex items-center justify-center mb-4\">\n              <AudioOrb \n                isPlaying={playing === \"right\"} \n                color=\"purple\" \n                size=\"lg\"\n              />\n              <Button \n                size=\"icon\" \n                className=\"absolute bottom-0 left-0 w-10 h-10 bg-sv-purple text-white hover:bg-white hover:text-sv-purple hover:glow-purple\"\n                onClick={(e) => {\n                  e.preventDefault();\n                  e.stopPropagation();\n                  setPlaying(playing === \"right\" ? null : \"right\");\n                }}\n                data-testid=\"button-play-right\"\n              >\n                {playing === \"right\" ? <Pause className=\"w-4 h-4\" /> : <Play className=\"w-4 h-4 ml-0.5\" />}\n              </Button>\n            </div>\n            <div className=\"mt-auto text-center w-full\">\n              <h3 className=\"font-punk text-white truncate\">{right.track}</h3>\n              <p className=\"text-sm text-gray-500 truncate font-hud\">{right.artist}</p>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Voting Bar */}\n      <div className=\"px-6 pb-6 pt-2\">\n        <div className=\"flex items-center justify-between text-xs font-hud font-bold mb-2 uppercase tracking-widest\">\n          <span className={cn(\"transition-colors\", left.isLeading ? \"text-sv-pink\" : \"text-gray-500\")}>\n            {left.votes} Votes\n          </span>\n          <span className={cn(\"transition-colors\", !left.isLeading ? \"text-sv-purple\" : \"text-gray-500\")}>\n            {right.votes} Votes\n          </span>\n        </div>\n        <div className=\"h-2 w-full bg-sv-gray overflow-hidden flex\">\n          <div \n            className=\"h-full bg-sv-pink transition-all duration-300\"\n            style={{ width: `${leftPercent}%` }}\n          />\n          <div \n            className=\"h-full bg-sv-purple transition-all duration-300\"\n            style={{ width: `${rightPercent}%` }}\n          />\n        </div>\n        \n        <div className=\"grid grid-cols-2 gap-4 mt-4\">\n          <button \n            className=\"punk-btn font-punk text-sv-pink border-2 border-sv-pink py-2 px-4 rotate-1 hover:-rotate-1 hover:bg-sv-pink/10 transition-all sketch-border\"\n            onClick={(e) => {\n              e.preventDefault();\n              e.stopPropagation();\n            }}\n            data-testid=\"button-vote-left\"\n          >\n            Vote Left\n          </button>\n          <button \n            className=\"punk-btn font-punk text-sv-purple border-2 border-sv-purple py-2 px-4 -rotate-1 hover:rotate-1 hover:bg-sv-purple/10 transition-all sketch-border\"\n            onClick={(e) => {\n              e.preventDefault();\n              e.stopPropagation();\n            }}\n            data-testid=\"button-vote-right\"\n          >\n            Vote Right\n          </button>\n        </div>\n      </div>\n\n      {/* Audio Status */}\n      <div className=\"h-12 bg-sv-black border-t border-sv-gray flex items-center justify-center px-4\">\n        {playing ? (\n          <div className=\"flex items-center gap-2\">\n            <div className={cn(\"w-2 h-2 animate-pulse\", playing === \"left\" ? \"bg-sv-pink\" : \"bg-sv-purple\")} />\n            <span className={cn(\"text-xs font-hud font-bold uppercase tracking-widest\", playing === \"left\" ? \"text-sv-pink\" : \"text-sv-purple\")}>\n              Now Playing: {playing === \"left\" ? left.track : right.track}\n            </span>\n          </div>\n        ) : (\n          <span className=\"text-xs text-gray-500 flex items-center gap-2 font-hud uppercase tracking-widest\">\n            <BarChart2 className=\"w-3 h-3\" />\n            Click play to preview\n          </span>\n        )}\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":8778,"size_tokens":null},"client/src/pages/Settings.tsx":{"content":"import { Navbar } from \"@/components/layout/Navbar\";\nimport { Footer } from \"@/components/layout/Footer\";\nimport { Button } from \"@/components/ui/button\";\nimport { useUser } from \"@/context/UserContext\";\nimport { useLocation } from \"wouter\";\nimport { AlertCircle, LogOut, Camera, Volume2, VolumeX, Play } from \"lucide-react\";\nimport { Avatar, AvatarImage, AvatarFallback } from \"@/components/ui/avatar\";\nimport { ObjectUploader } from \"@/components/ObjectUploader\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useState, useEffect } from \"react\";\nimport { useSoundEffects, getSoundSettings, SOUND_EFFECT_LABELS, type SoundEffect } from \"@/hooks/useSoundEffects\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Slider } from \"@/components/ui/slider\";\n\nexport default function Settings() {\n  const { user, logout, refreshUser } = useUser();\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const { playSound, updateSettings, updateEffectSetting, getSettings } = useSoundEffects();\n  const [soundSettings, setSoundSettings] = useState(getSoundSettings);\n\n  useEffect(() => {\n    setSoundSettings(getSettings());\n  }, [getSettings]);\n\n  const handleMasterToggle = (enabled: boolean) => {\n    updateSettings({ enabled });\n    setSoundSettings(prev => ({ ...prev, enabled }));\n  };\n\n  const handleVolumeChange = (value: number[]) => {\n    const volume = value[0];\n    updateSettings({ volume });\n    setSoundSettings(prev => ({ ...prev, volume }));\n  };\n\n  const handleEffectToggle = (effect: SoundEffect, enabled: boolean) => {\n    updateEffectSetting(effect, enabled);\n    setSoundSettings(prev => ({\n      ...prev,\n      effects: { ...prev.effects, [effect]: enabled },\n    }));\n  };\n\n  const previewSound = (effect: SoundEffect) => {\n    const wasEnabled = soundSettings.enabled;\n    const effectWasEnabled = soundSettings.effects[effect];\n    \n    if (!wasEnabled) updateSettings({ enabled: true });\n    if (!effectWasEnabled) updateEffectSetting(effect, true);\n    \n    playSound(effect);\n    \n    if (!wasEnabled) {\n      setTimeout(() => updateSettings({ enabled: wasEnabled }), 100);\n    }\n    if (!effectWasEnabled) {\n      setTimeout(() => updateEffectSetting(effect, effectWasEnabled), 100);\n    }\n  };\n\n  if (!user) {\n    return (\n      <div className=\"min-h-screen bg-background flex flex-col\">\n        <Navbar />\n        <main className=\"flex-grow pt-24 pb-20 flex items-center justify-center\">\n          <div className=\"text-center\">\n            <p className=\"text-muted-foreground mb-4\">You need to login to access settings</p>\n            <Button onClick={() => setLocation(\"/\")} className=\"bg-white text-black hover:bg-white/90\">\n              Go Home\n            </Button>\n          </div>\n        </main>\n        <Footer />\n      </div>\n    );\n  }\n\n  const handleLogout = () => {\n    logout();\n    setLocation(\"/\");\n  };\n\n  const handleGetUploadParameters = async () => {\n    const response = await fetch(\"/api/objects/upload\", {\n      method: \"POST\",\n      credentials: \"include\",\n    });\n    if (!response.ok) throw new Error(\"Failed to get upload URL\");\n    const { uploadURL } = await response.json();\n    return { method: \"PUT\" as const, url: uploadURL };\n  };\n\n  const handleUploadComplete = async (uploadUrl: string) => {\n    try {\n      const response = await fetch(\"/api/profile-image\", {\n        method: \"PUT\",\n        headers: { \"Content-Type\": \"application/json\" },\n        credentials: \"include\",\n        body: JSON.stringify({ imageURL: uploadUrl }),\n      });\n      \n      if (!response.ok) throw new Error(\"Failed to update profile\");\n      \n      await refreshUser();\n      toast({\n        title: \"Profile picture updated!\",\n        description: \"Your new profile picture is now visible.\",\n      });\n    } catch (error) {\n      console.error(\"Failed to update profile image:\", error);\n      toast({\n        title: \"Error\",\n        description: \"Failed to update profile picture. Please try again.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background flex flex-col\">\n      <Navbar />\n      \n      <main className=\"flex-grow pt-24 pb-20\">\n        <div className=\"container mx-auto px-4\">\n          <div className=\"max-w-2xl mx-auto\">\n            <h1 className=\"text-4xl font-bold text-white mb-8\">Settings</h1>\n\n            {/* Profile Picture Section */}\n            <div className=\"bg-card/50 border border-white/10 rounded-2xl p-6 mb-6 backdrop-blur-sm\">\n              <h2 className=\"text-xl font-bold text-white mb-4\">Profile Picture</h2>\n              <div className=\"flex items-center gap-6\">\n                <Avatar className=\"w-24 h-24 border-4 border-sv-pink\">\n                  <AvatarImage src={user.profileImageUrl || undefined} />\n                  <AvatarFallback className=\"text-2xl font-bold bg-sv-gray\">\n                    {(user.name || \"?\")[0]}\n                  </AvatarFallback>\n                </Avatar>\n                <div className=\"space-y-2\">\n                  <ObjectUploader\n                    onGetUploadParameters={handleGetUploadParameters}\n                    onComplete={handleUploadComplete}\n                    maxFileSize={5242880}\n                    allowedFileTypes={[\"image/jpeg\", \"image/png\", \"image/gif\", \"image/webp\"]}\n                    buttonClassName=\"bg-sv-pink hover:bg-sv-pink/80 text-black font-bold\"\n                  >\n                    <Camera className=\"w-4 h-4 mr-2\" />\n                    Upload New Picture\n                  </ObjectUploader>\n                  <p className=\"text-xs text-muted-foreground\">\n                    JPG, PNG, GIF or WebP. Max 5MB.\n                  </p>\n                </div>\n              </div>\n            </div>\n\n            {/* Account Section */}\n            <div className=\"bg-card/50 border border-white/10 rounded-2xl p-6 mb-6 backdrop-blur-sm\">\n              <h2 className=\"text-xl font-bold text-white mb-4\">Account</h2>\n              <div className=\"space-y-4\">\n                <div className=\"flex justify-between items-center\">\n                  <div>\n                    <p className=\"text-white font-medium\">Username</p>\n                    <p className=\"text-muted-foreground text-sm\">{user.name}</p>\n                  </div>\n                </div>\n                <div className=\"flex justify-between items-center\">\n                  <div>\n                    <p className=\"text-white font-medium\">Role</p>\n                    <p className=\"text-muted-foreground text-sm capitalize\">\n                      {user.role === \"producer\" ? \"Producer\" : \"Artist\"}\n                    </p>\n                  </div>\n                </div>\n              </div>\n            </div>\n\n            {/* Sound Effects Section */}\n            <div className=\"bg-card/50 border border-white/10 rounded-2xl p-6 mb-6 backdrop-blur-sm\">\n              <div className=\"flex items-center justify-between mb-6\">\n                <div className=\"flex items-center gap-3\">\n                  {soundSettings.enabled ? (\n                    <Volume2 className=\"w-6 h-6 text-sv-pink\" />\n                  ) : (\n                    <VolumeX className=\"w-6 h-6 text-muted-foreground\" />\n                  )}\n                  <h2 className=\"text-xl font-bold text-white\">Sound Effects</h2>\n                </div>\n                <Switch\n                  checked={soundSettings.enabled}\n                  onCheckedChange={handleMasterToggle}\n                  data-testid=\"switch-sound-master\"\n                />\n              </div>\n\n              <div className={`space-y-6 ${!soundSettings.enabled ? \"opacity-50 pointer-events-none\" : \"\"}`}>\n                <div>\n                  <label className=\"text-sm font-medium text-white mb-3 block\">\n                    Volume: {Math.round(soundSettings.volume * 100)}%\n                  </label>\n                  <Slider\n                    value={[soundSettings.volume]}\n                    onValueChange={handleVolumeChange}\n                    max={1}\n                    step={0.1}\n                    className=\"w-full\"\n                    data-testid=\"slider-volume\"\n                  />\n                </div>\n\n                <div className=\"border-t border-white/10 pt-4\">\n                  <p className=\"text-sm text-muted-foreground mb-4\">\n                    Choose which sounds you want to hear\n                  </p>\n                  <div className=\"grid gap-3\">\n                    {(Object.keys(SOUND_EFFECT_LABELS) as SoundEffect[]).map((effect) => (\n                      <div\n                        key={effect}\n                        className=\"flex items-center justify-between p-3 bg-white/5 rounded-lg hover:bg-white/10 transition-colors\"\n                      >\n                        <div className=\"flex-1\">\n                          <p className=\"text-white font-medium text-sm\">\n                            {SOUND_EFFECT_LABELS[effect].label}\n                          </p>\n                          <p className=\"text-xs text-muted-foreground\">\n                            {SOUND_EFFECT_LABELS[effect].description}\n                          </p>\n                        </div>\n                        <div className=\"flex items-center gap-3\">\n                          <button\n                            onClick={() => previewSound(effect)}\n                            className=\"p-2 rounded-full hover:bg-white/10 transition-colors text-sv-pink\"\n                            data-testid={`button-preview-${effect}`}\n                          >\n                            <Play className=\"w-4 h-4\" />\n                          </button>\n                          <Switch\n                            checked={soundSettings.effects[effect]}\n                            onCheckedChange={(checked) => handleEffectToggle(effect, checked)}\n                            data-testid={`switch-sound-${effect}`}\n                          />\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              </div>\n            </div>\n\n            {/* Preferences Section */}\n            <div className=\"bg-card/50 border border-white/10 rounded-2xl p-6 mb-6 backdrop-blur-sm\">\n              <h2 className=\"text-xl font-bold text-white mb-4\">Preferences</h2>\n              <div className=\"space-y-4\">\n                <label className=\"flex items-center gap-3 cursor-pointer hover:opacity-80\">\n                  <input type=\"checkbox\" defaultChecked className=\"w-4 h-4\" />\n                  <span className=\"text-white\">Enable notifications</span>\n                </label>\n                <label className=\"flex items-center gap-3 cursor-pointer hover:opacity-80\">\n                  <input type=\"checkbox\" defaultChecked className=\"w-4 h-4\" />\n                  <span className=\"text-white\">Email updates</span>\n                </label>\n              </div>\n            </div>\n\n            {/* Danger Zone */}\n            <div className=\"bg-red-500/10 border border-red-500/30 rounded-2xl p-6 backdrop-blur-sm\">\n              <div className=\"flex items-start gap-3 mb-4\">\n                <AlertCircle className=\"w-5 h-5 text-red-400 mt-1\" />\n                <div>\n                  <h2 className=\"text-xl font-bold text-red-400 mb-2\">Danger Zone</h2>\n                  <p className=\"text-muted-foreground text-sm\">Irreversible actions</p>\n                </div>\n              </div>\n              <Button \n                className=\"bg-red-600 hover:bg-red-700 text-white font-bold w-full flex items-center justify-center gap-2\"\n                onClick={handleLogout}\n              >\n                <LogOut className=\"w-4 h-4\" /> Logout\n              </Button>\n            </div>\n          </div>\n        </div>\n      </main>\n      <Footer />\n    </div>\n  );\n}\n","path":null,"size_bytes":11824,"size_tokens":null},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport tailwindcss from \"@tailwindcss/vite\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\nimport { metaImagesPlugin } from \"./vite-plugin-meta-images\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    tailwindcss(),\n    metaImagesPlugin(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n          await import(\"@replit/vite-plugin-dev-banner\").then((m) =>\n            m.devBanner(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  css: {\n    postcss: {\n      plugins: [],\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    host: \"0.0.0.0\",\n    allowedHosts: true,\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","path":null,"size_bytes":1330,"size_tokens":null},"client/src/components/ui/dialog.tsx":{"content":"import * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogTrigger,\n  DialogClose,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","path":null,"size_bytes":3835,"size_tokens":null},"client/src/pages/Profile.tsx":{"content":"import { Navbar } from \"@/components/layout/Navbar\";\nimport { Footer } from \"@/components/layout/Footer\";\nimport { Avatar, AvatarImage, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Button } from \"@/components/ui/button\";\nimport { Trophy, Zap, Coins, TrendingUp, Edit } from \"lucide-react\";\nimport { useUser } from \"@/context/UserContext\";\nimport { useLocation } from \"wouter\";\nimport { useState } from \"react\";\nimport { EditProfileDialog } from \"@/components/profile/EditProfileDialog\";\nimport { MembershipBadge } from \"@/components/MembershipBadge\";\nimport { FoundersBadge } from \"@/components/FoundersBadge\";\n\nexport default function Profile() {\n  const { user } = useUser();\n  const [, setLocation] = useLocation();\n  const [editOpen, setEditOpen] = useState(false);\n\n  if (!user) {\n    return (\n      <div className=\"min-h-screen bg-background flex flex-col\">\n        <Navbar />\n        <main className=\"flex-grow pt-24 pb-20 flex items-center justify-center\">\n          <div className=\"text-center\">\n            <p className=\"text-muted-foreground mb-4\">You need to login to view your profile</p>\n            <Button onClick={() => setLocation(\"/\")} className=\"bg-white text-black hover:bg-white/90\">\n              Go Home\n            </Button>\n          </div>\n        </main>\n        <Footer />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background flex flex-col\">\n      <Navbar />\n      \n      <main className=\"flex-grow pt-24 pb-20\">\n        <div className=\"container mx-auto px-4\">\n          <div className=\"max-w-2xl mx-auto\">\n            {/* Profile Header */}\n            <div className=\"bg-card/50 border border-white/10 rounded-2xl p-8 text-center mb-8 backdrop-blur-sm\">\n              <Avatar className=\"w-32 h-32 border-4 border-violet-500 mx-auto mb-6\">\n                <AvatarImage src={user.profileImageUrl || undefined} />\n                <AvatarFallback>{user.name?.[0] || \"?\"}</AvatarFallback>\n              </Avatar>\n              \n              <div className=\"flex items-center justify-center gap-3 mb-2 flex-wrap\">\n                <h1 className=\"text-4xl font-bold text-white\">{user.name}</h1>\n                {user.foundersBadge && <FoundersBadge size=\"md\" />}\n                <MembershipBadge membership={user.membership} size=\"md\" />\n              </div>\n              <p className=\"text-violet-400 font-mono mb-6 capitalize\">\n                {user.role === \"producer\" ? \" Producer\" : \" Artist\"}  Level {user.level}\n              </p>\n              {user.bio && (\n                <p className=\"text-muted-foreground mb-6 max-w-md mx-auto\">{user.bio}</p>\n              )}\n              \n              <div className=\"flex justify-center gap-8 flex-wrap\">\n                <div className=\"flex flex-col items-center\">\n                  <span className=\"text-3xl font-bold text-yellow-400\">{user.xp.toLocaleString()}</span>\n                  <span className=\"text-xs text-muted-foreground flex items-center gap-1 mt-1\">\n                    <TrendingUp className=\"w-3 h-3\" /> XP\n                  </span>\n                </div>\n                <div className=\"flex flex-col items-center\">\n                  <span className=\"text-3xl font-bold text-violet-400\">{user.wins}</span>\n                  <span className=\"text-xs text-muted-foreground flex items-center gap-1 mt-1\">\n                    <Trophy className=\"w-3 h-3\" /> Wins\n                  </span>\n                </div>\n                <div className=\"flex flex-col items-center\">\n                  <span className=\"text-3xl font-bold text-green-400\">{user.coins.toLocaleString()}</span>\n                  <span className=\"text-xs text-muted-foreground flex items-center gap-1 mt-1\">\n                    <Coins className=\"w-3 h-3\" /> Coins\n                  </span>\n                </div>\n              </div>\n            </div>\n\n            {/* Quick Actions */}\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n              <Button className=\"bg-white text-black hover:bg-white/90 font-bold\" onClick={() => setLocation(\"/battles\")} data-testid=\"button-join-battle\">\n                Join a Battle\n              </Button>\n              <Button variant=\"outline\" className=\"border-white/10\" onClick={() => setLocation(\"/store\")} data-testid=\"button-visit-store\">\n                Visit Store\n              </Button>\n              <Button variant=\"outline\" className=\"border-white/10\" onClick={() => setEditOpen(true)} data-testid=\"button-edit-profile\">\n                <Edit className=\"w-4 h-4 mr-2\" />\n                Edit Profile\n              </Button>\n            </div>\n\n            <EditProfileDialog\n              open={editOpen}\n              onOpenChange={setEditOpen}\n              userId={user.id}\n              currentAvatar={user.profileImageUrl || \"\"}\n              currentBio={user.bio || \"\"}\n              userName={user.name || \"User\"}\n            />\n          </div>\n        </div>\n      </main>\n      <Footer />\n    </div>\n  );\n}\n","path":null,"size_bytes":5007,"size_tokens":null},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","path":null,"size_bytes":1753,"size_tokens":null},"client/src/pages/MyBattles.tsx":{"content":"import { Navbar } from \"@/components/layout/Navbar\";\nimport { Footer } from \"@/components/layout/Footer\";\nimport { Button } from \"@/components/ui/button\";\nimport { useUser } from \"@/context/UserContext\";\nimport { useLocation } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { fetchBattles } from \"@/lib/api\";\nimport { Loader2 } from \"lucide-react\";\nimport { Link } from \"wouter\";\n\nexport default function MyBattles() {\n  const { user } = useUser();\n  const [, setLocation] = useLocation();\n  const { data: battlesData, isLoading } = useQuery({\n    queryKey: [\"battles\"],\n    queryFn: fetchBattles,\n  });\n\n  if (!user) {\n    return (\n      <div className=\"min-h-screen bg-background flex flex-col\">\n        <Navbar />\n        <main className=\"flex-grow pt-24 pb-20 flex items-center justify-center\">\n          <div className=\"text-center\">\n            <p className=\"text-muted-foreground mb-4\">You need to login to view your battles</p>\n            <Button onClick={() => setLocation(\"/\")} className=\"bg-white text-black hover:bg-white/90\">\n              Go Home\n            </Button>\n          </div>\n        </main>\n        <Footer />\n      </div>\n    );\n  }\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-background flex flex-col\">\n        <Navbar />\n        <main className=\"flex-grow pt-24 pb-20 flex items-center justify-center\">\n          <Loader2 className=\"w-8 h-8 animate-spin text-violet-500\" />\n        </main>\n        <Footer />\n      </div>\n    );\n  }\n\n  const userBattles = (battlesData || []).filter(\n    battle => battle.leftUserId === user.id || battle.rightUserId === user.id\n  );\n\n  return (\n    <div className=\"min-h-screen bg-background flex flex-col\">\n      <Navbar />\n      \n      <main className=\"flex-grow pt-24 pb-20\">\n        <div className=\"container mx-auto px-4\">\n          <div className=\"mb-10\">\n            <h1 className=\"text-4xl font-bold text-white mb-2\">My Battles</h1>\n            <p className=\"text-muted-foreground\">Battles you've participated in</p>\n          </div>\n\n          {userBattles.length === 0 ? (\n            <div className=\"text-center py-12 bg-card/30 border border-white/5 rounded-xl\">\n              <p className=\"text-muted-foreground mb-4\">You haven't participated in any battles yet</p>\n              <Button \n                className=\"bg-white text-black hover:bg-white/90 font-bold\"\n                onClick={() => setLocation(\"/battles\")}\n              >\n                Start Your First Battle\n              </Button>\n            </div>\n          ) : (\n            <div className=\"space-y-4\">\n              {userBattles.map((battle) => (\n                <Link key={battle.id} href={`/battle/${battle.id}`}>\n                  <div className=\"bg-card/50 border border-white/10 rounded-xl p-4 hover:border-white/20 transition-all cursor-pointer\">\n                    <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4 items-center\">\n                      <div>\n                        <p className=\"text-xs text-muted-foreground\">Battle Type</p>\n                        <p className=\"text-white font-bold capitalize\">{battle.type}</p>\n                      </div>\n                      \n                      <div>\n                        <p className=\"text-xs text-muted-foreground\">Your Side</p>\n                        <p className=\"text-white font-mono text-sm\">\n                          {battle.leftUserId === user.id ? battle.leftArtist : battle.rightArtist || \"Waiting...\"}\n                        </p>\n                      </div>\n\n                      <div>\n                        <p className=\"text-xs text-muted-foreground\">Status</p>\n                        <p className={`font-bold text-sm ${battle.rightArtist ? \"text-green-400\" : \"text-yellow-400\"}`}>\n                          {battle.rightArtist ? \"Complete\" : \"Open\"}\n                        </p>\n                      </div>\n\n                      <div className=\"text-right\">\n                        <p className=\"text-xs text-muted-foreground\">Votes</p>\n                        <p className=\"text-white font-mono\">\n                          {battle.leftUserId === user.id ? `${battle.leftVotes} vs ${battle.rightVotes}` : `${battle.rightVotes} vs ${battle.leftVotes}`}\n                        </p>\n                      </div>\n                    </div>\n                  </div>\n                </Link>\n              ))}\n            </div>\n          )}\n        </div>\n      </main>\n      <Footer />\n    </div>\n  );\n}\n","path":null,"size_bytes":4502,"size_tokens":null},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Portal>\n    <TooltipPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 overflow-hidden rounded-md bg-primary px-3 py-1.5 text-xs text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </TooltipPrimitive.Portal>\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","path":null,"size_bytes":1267,"size_tokens":null},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-base shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","path":null,"size_bytes":649,"size_tokens":null},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 text-sm font-medium transition-all hover:underline text-left [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 text-muted-foreground transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","path":null,"size_bytes":2001,"size_tokens":null},"vite-plugin-meta-images.ts":{"content":"import type { Plugin } from 'vite';\nimport fs from 'fs';\nimport path from 'path';\n\n/**\n * Vite plugin that updates og:image and twitter:image meta tags\n * to point to the app's opengraph image with the correct Replit domain.\n */\nexport function metaImagesPlugin(): Plugin {\n  return {\n    name: 'vite-plugin-meta-images',\n    transformIndexHtml(html) {\n      const baseUrl = getDeploymentUrl();\n      if (!baseUrl) {\n        log('[meta-images] no Replit deployment domain found, skipping meta tag updates');\n        return html;\n      }\n\n      // Check if opengraph image exists in public directory\n      const publicDir = path.resolve(process.cwd(), 'client', 'public');\n      const opengraphPngPath = path.join(publicDir, 'opengraph.png');\n      const opengraphJpgPath = path.join(publicDir, 'opengraph.jpg');\n      const opengraphJpegPath = path.join(publicDir, 'opengraph.jpeg');\n\n      let imageExt: string | null = null;\n      if (fs.existsSync(opengraphPngPath)) {\n        imageExt = 'png';\n      } else if (fs.existsSync(opengraphJpgPath)) {\n        imageExt = 'jpg';\n      } else if (fs.existsSync(opengraphJpegPath)) {\n        imageExt = 'jpeg';\n      }\n\n      if (!imageExt) {\n        log('[meta-images] OpenGraph image not found, skipping meta tag updates');\n        return html;\n      }\n\n      const imageUrl = `${baseUrl}/opengraph.${imageExt}`;\n\n      log('[meta-images] updating meta image tags to:', imageUrl);\n\n      html = html.replace(\n        /<meta\\s+property=\"og:image\"\\s+content=\"[^\"]*\"\\s*\\/>/g,\n        `<meta property=\"og:image\" content=\"${imageUrl}\" />`\n      );\n\n      html = html.replace(\n        /<meta\\s+name=\"twitter:image\"\\s+content=\"[^\"]*\"\\s*\\/>/g,\n        `<meta name=\"twitter:image\" content=\"${imageUrl}\" />`\n      );\n\n      return html;\n    },\n  };\n}\n\nfunction getDeploymentUrl(): string | null {\n  if (process.env.REPLIT_INTERNAL_APP_DOMAIN) {\n    const url = `https://${process.env.REPLIT_INTERNAL_APP_DOMAIN}`;\n    log('[meta-images] using internal app domain:', url);\n    return url;\n  }\n\n  if (process.env.REPLIT_DEV_DOMAIN) {\n    const url = `https://${process.env.REPLIT_DEV_DOMAIN}`;\n    log('[meta-images] using dev domain:', url);\n    return url;\n  }\n\n  return null;\n}\n\nfunction log(...args: any[]): void {\n  if (process.env.NODE_ENV === 'production') {\n    console.log(...args);\n  }\n}\n","path":null,"size_bytes":2333,"size_tokens":null},"server/routes.ts":{"content":"import type { Express } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { storage } from \"./storage\";\nimport {\n  insertBattleSchema,\n  insertVoteSchema,\n  insertCommentSchema,\n  insertChatMessageSchema,\n  insertMessageSchema,\n} from \"@shared/schema\";\nimport { fromZodError } from \"zod-validation-error\";\nimport { getUncachableStripeClient, getStripePublishableKey } from \"./stripeClient\";\nimport { setupAuth, isAuthenticated } from \"./replitAuth\";\nimport { ObjectStorageService, ObjectNotFoundError } from \"./objectStorage\";\nimport { sendVerificationEmail, sendPasswordResetEmail, sendWelcomeEmail } from \"./email\";\n\nexport async function registerRoutes(\n  httpServer: Server,\n  app: Express\n): Promise<Server> {\n  \n  await setupAuth(app);\n\n  app.get('/api/auth/user', isAuthenticated, async (req: any, res) => {\n    try {\n      const replitAuthId = req.user.claims.sub;\n      const user = await storage.getUserByReplitAuthId(replitAuthId);\n      res.json(user);\n    } catch (error) {\n      console.error(\"Error fetching user:\", error);\n      res.status(500).json({ message: \"Failed to fetch user\" });\n    }\n  });\n\n  app.post(\"/api/auth/resend-verification\", isAuthenticated, async (req: any, res) => {\n    try {\n      const replitAuthId = req.user.claims.sub;\n      const user = await storage.getUserByReplitAuthId(replitAuthId);\n      \n      if (!user) {\n        return res.status(404).json({ error: \"User not found\" });\n      }\n\n      if (!user.email) {\n        return res.status(400).json({ error: \"No email associated with this account\" });\n      }\n\n      const token = await storage.createEmailVerificationToken(user.id);\n      const baseUrl = `${req.protocol}://${req.get('host')}`;\n      const verificationUrl = `${baseUrl}/verify-email?token=${token}`;\n      \n      const result = await sendVerificationEmail(\n        user.email,\n        verificationUrl,\n        user.firstName || user.name || 'User'\n      );\n\n      if (!result.success) {\n        return res.status(500).json({ error: result.error || \"Failed to send verification email\" });\n      }\n\n      res.json({ success: true, message: \"Verification email sent\" });\n    } catch (error) {\n      console.error(\"Error sending verification email:\", error);\n      res.status(500).json({ error: \"Failed to send verification email\" });\n    }\n  });\n\n  app.get(\"/api/auth/verify-email\", async (req, res) => {\n    try {\n      const { token } = req.query;\n      \n      if (!token || typeof token !== 'string') {\n        return res.status(400).json({ error: \"Invalid token\" });\n      }\n\n      const result = await storage.verifyEmailToken(token);\n      \n      if (!result.success) {\n        return res.status(400).json({ error: result.error });\n      }\n\n      const user = await storage.getUser(result.userId!);\n      if (user) {\n        await sendWelcomeEmail(user.email!, user.firstName || user.name || 'User');\n      }\n\n      res.json({ success: true, message: \"Email verified successfully\" });\n    } catch (error) {\n      console.error(\"Error verifying email:\", error);\n      res.status(500).json({ error: \"Failed to verify email\" });\n    }\n  });\n\n  app.post(\"/api/auth/forgot-password\", async (req, res) => {\n    try {\n      const { email } = req.body;\n      \n      if (!email || typeof email !== 'string') {\n        return res.status(400).json({ error: \"Email is required\" });\n      }\n\n      const user = await storage.getUserByEmail(email);\n      \n      if (!user) {\n        return res.json({ success: true, message: \"If an account exists with this email, a reset link has been sent\" });\n      }\n\n      const token = await storage.createPasswordResetToken(user.id);\n      const baseUrl = `${req.protocol}://${req.get('host')}`;\n      const resetUrl = `${baseUrl}/reset-password?token=${token}`;\n      \n      await sendPasswordResetEmail(\n        email,\n        resetUrl,\n        user.firstName || user.name || 'User'\n      );\n\n      res.json({ success: true, message: \"If an account exists with this email, a reset link has been sent\" });\n    } catch (error) {\n      console.error(\"Error sending password reset email:\", error);\n      res.status(500).json({ error: \"Failed to send password reset email\" });\n    }\n  });\n\n  app.post(\"/api/auth/verify-reset-token\", async (req, res) => {\n    try {\n      const { token } = req.body;\n      \n      if (!token || typeof token !== 'string') {\n        return res.status(400).json({ error: \"Invalid token\" });\n      }\n\n      const result = await storage.verifyPasswordResetToken(token);\n      res.json({ valid: result.success });\n    } catch (error) {\n      console.error(\"Error verifying reset token:\", error);\n      res.status(500).json({ error: \"Failed to verify token\" });\n    }\n  });\n\n  app.post(\"/api/objects/upload\", isAuthenticated, async (req, res) => {\n    try {\n      const objectStorageService = new ObjectStorageService();\n      const uploadURL = await objectStorageService.getObjectEntityUploadURL();\n      res.json({ uploadURL });\n    } catch (error) {\n      console.error(\"Error getting upload URL:\", error);\n      res.status(500).json({ error: \"Failed to get upload URL\" });\n    }\n  });\n\n  app.get(\"/objects/:objectPath(*)\", async (req, res) => {\n    const objectStorageService = new ObjectStorageService();\n    try {\n      const objectFile = await objectStorageService.getObjectEntityFile(req.path);\n      objectStorageService.downloadObject(objectFile, res);\n    } catch (error) {\n      console.error(\"Error serving object:\", error);\n      if (error instanceof ObjectNotFoundError) {\n        return res.sendStatus(404);\n      }\n      return res.sendStatus(500);\n    }\n  });\n\n  app.put(\"/api/profile-image\", isAuthenticated, async (req: any, res) => {\n    if (!req.body.imageURL) {\n      return res.status(400).json({ error: \"imageURL is required\" });\n    }\n\n    const replitAuthId = req.user.claims.sub;\n    const authUser = await storage.getUserByReplitAuthId(replitAuthId);\n    if (!authUser) {\n      return res.status(404).json({ error: \"User not found\" });\n    }\n\n    try {\n      const objectStorageService = new ObjectStorageService();\n      const objectPath = await objectStorageService.trySetObjectEntityAclPolicy(\n        req.body.imageURL,\n        {\n          owner: replitAuthId,\n          visibility: \"public\",\n        }\n      );\n\n      const updatedUser = await storage.updateUserProfile(\n        authUser.id,\n        objectPath,\n        authUser.bio || \"\",\n        authUser.name || undefined,\n        authUser.role || undefined\n      );\n\n      res.status(200).json({ profileImageUrl: objectPath, user: updatedUser });\n    } catch (error) {\n      console.error(\"Error setting profile image:\", error);\n      res.status(500).json({ error: \"Failed to update profile image\" });\n    }\n  });\n\n  app.post(\"/api/objects/set-acl\", isAuthenticated, async (req: any, res) => {\n    const { objectUrl, visibility } = req.body;\n    \n    if (!objectUrl) {\n      return res.status(400).json({ error: \"objectUrl is required\" });\n    }\n\n    const replitAuthId = req.user.claims.sub;\n\n    try {\n      const objectStorageService = new ObjectStorageService();\n      const objectPath = await objectStorageService.trySetObjectEntityAclPolicy(\n        objectUrl,\n        {\n          owner: replitAuthId,\n          visibility: visibility || \"public\",\n        }\n      );\n\n      res.status(200).json({ objectPath });\n    } catch (error) {\n      console.error(\"Error setting object ACL:\", error);\n      res.status(500).json({ error: \"Failed to set object ACL\" });\n    }\n  });\n\n  app.get(\"/api/users/:id\", async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const user = await storage.getUser(id);\n      \n      if (!user) {\n        return res.status(404).json({ error: \"User not found\" });\n      }\n\n      res.json(user);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch user\" });\n    }\n  });\n\n  app.patch(\"/api/users/:id/coins\", async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const { coins } = req.body;\n      \n      if (typeof coins !== \"number\") {\n        return res.status(400).json({ error: \"Invalid coins value\" });\n      }\n\n      await storage.updateUserCoins(id, coins);\n      res.json({ success: true });\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to update coins\" });\n    }\n  });\n\n  app.patch(\"/api/users/:id/profile\", async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const { profileImageUrl, bio, name, role } = req.body;\n      \n      if (bio === undefined) {\n        return res.status(400).json({ error: \"Bio is required\" });\n      }\n\n      const user = await storage.updateUserProfile(id, profileImageUrl || \"\", bio, name, role);\n      res.json(user);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to update profile\" });\n    }\n  });\n\n  app.patch(\"/api/users/:id/role\", isAuthenticated, async (req: any, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const { role, name } = req.body;\n      \n      if (!role || ![\"artist\", \"producer\"].includes(role)) {\n        return res.status(400).json({ error: \"Invalid role. Must be 'artist' or 'producer'\" });\n      }\n\n      const replitAuthId = req.user.claims.sub;\n      const authUser = await storage.getUserByReplitAuthId(replitAuthId);\n      if (!authUser || authUser.id !== id) {\n        return res.status(403).json({ error: \"Not authorized to update this user\" });\n      }\n\n      const currentUser = await storage.getUser(id);\n      if (!currentUser) {\n        return res.status(404).json({ error: \"User not found\" });\n      }\n\n      const displayName = name?.trim() || currentUser.name;\n\n      const user = await storage.updateUserProfile(\n        id, \n        currentUser.profileImageUrl || \"\", \n        currentUser.bio || \"\", \n        displayName, \n        role\n      );\n      res.json(user);\n    } catch (error) {\n      console.error(\"Failed to update user role:\", error);\n      res.status(500).json({ error: \"Failed to update role\" });\n    }\n  });\n\n  app.get(\"/api/leaderboard\", async (req, res) => {\n    try {\n      const users = await storage.getLeaderboard();\n      res.json(users);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch leaderboard\" });\n    }\n  });\n\n  app.post(\"/api/users/:id/follow\", async (req, res) => {\n    try {\n      const followerId = req.body.followerId;\n      const followingId = parseInt(req.params.id);\n\n      const isFollowing = await storage.isFollowing(followerId, followingId);\n      if (isFollowing) {\n        return res.status(400).json({ error: \"Already following\" });\n      }\n\n      const follow = await storage.followUser(followerId, followingId);\n      const fromUser = await storage.getUser(followerId);\n      \n      await storage.createNotification({\n        userId: followingId,\n        fromUserId: followerId,\n        type: \"follow\",\n        message: `${fromUser?.name || 'Someone'} started following you`,\n      });\n\n      res.json(follow);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to follow user\" });\n    }\n  });\n\n  app.post(\"/api/users/:id/unfollow\", async (req, res) => {\n    try {\n      const followerId = req.body.followerId;\n      const followingId = parseInt(req.params.id);\n\n      await storage.unfollowUser(followerId, followingId);\n      res.json({ success: true });\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to unfollow user\" });\n    }\n  });\n\n  app.get(\"/api/users/:id/followers\", async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const followers = await storage.getFollowers(id);\n      res.json(followers);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch followers\" });\n    }\n  });\n\n  app.get(\"/api/users/:id/following\", async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const following = await storage.getFollowing(id);\n      res.json(following);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch following\" });\n    }\n  });\n\n  app.get(\"/api/notifications/:userId\", isAuthenticated, async (req: any, res) => {\n    try {\n      const replitAuthId = req.user.claims.sub;\n      const authUser = await storage.getUserByReplitAuthId(replitAuthId);\n      \n      if (!authUser) {\n        return res.status(403).json({ error: \"Forbidden\" });\n      }\n\n      const userId = parseInt(req.params.userId);\n      if (authUser.id !== userId) {\n        return res.status(403).json({ error: \"Forbidden\" });\n      }\n\n      const notifications = await storage.getNotifications(userId);\n      res.json(notifications);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch notifications\" });\n    }\n  });\n\n  app.post(\"/api/notifications/:id/read\", isAuthenticated, async (req: any, res) => {\n    try {\n      const replitAuthId = req.user.claims.sub;\n      const authUser = await storage.getUserByReplitAuthId(replitAuthId);\n      \n      if (!authUser) {\n        return res.status(403).json({ error: \"Forbidden\" });\n      }\n\n      const id = parseInt(req.params.id);\n      const notification = await storage.getNotification(id);\n      if (!notification) {\n        return res.status(404).json({ error: \"Notification not found\" });\n      }\n      \n      if (authUser.id !== notification.userId) {\n        return res.status(403).json({ error: \"Forbidden\" });\n      }\n\n      await storage.markNotificationAsRead(id);\n      res.json({ success: true });\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to mark notification as read\" });\n    }\n  });\n\n  app.post(\"/api/notifications/:userId/read-all\", isAuthenticated, async (req: any, res) => {\n    try {\n      const replitAuthId = req.user.claims.sub;\n      const authUser = await storage.getUserByReplitAuthId(replitAuthId);\n      \n      if (!authUser) {\n        return res.status(403).json({ error: \"Forbidden\" });\n      }\n\n      const userId = parseInt(req.params.userId);\n      if (authUser.id !== userId) {\n        return res.status(403).json({ error: \"Forbidden\" });\n      }\n\n      await storage.markAllNotificationsAsRead(userId);\n      res.json({ success: true });\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to mark all notifications as read\" });\n    }\n  });\n\n  app.get(\"/api/notifications/:userId/count\", isAuthenticated, async (req: any, res) => {\n    try {\n      const replitAuthId = req.user.claims.sub;\n      const authUser = await storage.getUserByReplitAuthId(replitAuthId);\n      \n      if (!authUser) {\n        return res.status(403).json({ error: \"Forbidden\" });\n      }\n\n      const userId = parseInt(req.params.userId);\n      if (authUser.id !== userId) {\n        return res.status(403).json({ error: \"Forbidden\" });\n      }\n\n      const count = await storage.getUnreadNotificationCount(userId);\n      res.json({ count });\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch notification count\" });\n    }\n  });\n\n  app.get(\"/api/messages/:userId\", isAuthenticated, async (req: any, res) => {\n    try {\n      const replitAuthId = req.user.claims.sub;\n      const authUser = await storage.getUserByReplitAuthId(replitAuthId);\n      \n      if (!authUser) {\n        return res.status(403).json({ error: \"Forbidden\" });\n      }\n\n      const userId = parseInt(req.params.userId);\n      if (authUser.id !== userId) {\n        return res.status(403).json({ error: \"Forbidden\" });\n      }\n\n      const messages = await storage.getMessages(userId);\n      res.json(messages);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch messages\" });\n    }\n  });\n\n  app.get(\"/api/messages/:userId/sent\", isAuthenticated, async (req: any, res) => {\n    try {\n      const replitAuthId = req.user.claims.sub;\n      const authUser = await storage.getUserByReplitAuthId(replitAuthId);\n      \n      if (!authUser) {\n        return res.status(403).json({ error: \"Forbidden\" });\n      }\n\n      const userId = parseInt(req.params.userId);\n      if (authUser.id !== userId) {\n        return res.status(403).json({ error: \"Forbidden\" });\n      }\n\n      const messages = await storage.getSentMessages(userId);\n      res.json(messages);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch sent messages\" });\n    }\n  });\n\n  app.get(\"/api/messages/:userId/count\", isAuthenticated, async (req: any, res) => {\n    try {\n      const replitAuthId = req.user.claims.sub;\n      const authUser = await storage.getUserByReplitAuthId(replitAuthId);\n      \n      if (!authUser) {\n        return res.status(403).json({ error: \"Forbidden\" });\n      }\n\n      const userId = parseInt(req.params.userId);\n      if (authUser.id !== userId) {\n        return res.status(403).json({ error: \"Forbidden\" });\n      }\n\n      const count = await storage.getUnreadMessageCount(userId);\n      res.json({ count });\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch message count\" });\n    }\n  });\n\n  app.post(\"/api/messages\", isAuthenticated, async (req: any, res) => {\n    try {\n      const replitAuthId = req.user.claims.sub;\n      const authUser = await storage.getUserByReplitAuthId(replitAuthId);\n      \n      if (!authUser) {\n        return res.status(403).json({ error: \"Forbidden\" });\n      }\n\n      const data = insertMessageSchema.parse(req.body);\n      \n      const messageData = {\n        ...data,\n        fromUserId: authUser.id,\n      };\n\n      const message = await storage.createMessage(messageData);\n      \n      await storage.createNotification({\n        userId: data.toUserId,\n        fromUserId: authUser.id,\n        type: \"message\",\n        message: `${authUser.name || 'Someone'} sent you a message: \"${data.subject}\"`,\n      });\n\n      res.json(message);\n    } catch (error: any) {\n      if (error.name === \"ZodError\") {\n        return res.status(400).json({ error: fromZodError(error).toString() });\n      }\n      res.status(500).json({ error: \"Failed to send message\" });\n    }\n  });\n\n  app.post(\"/api/messages/:id/read\", isAuthenticated, async (req: any, res) => {\n    try {\n      const replitAuthId = req.user.claims.sub;\n      const authUser = await storage.getUserByReplitAuthId(replitAuthId);\n      \n      if (!authUser) {\n        return res.status(403).json({ error: \"Forbidden\" });\n      }\n\n      const id = parseInt(req.params.id);\n      const message = await storage.getMessage(id);\n      if (!message) {\n        return res.status(404).json({ error: \"Message not found\" });\n      }\n      \n      if (authUser.id !== message.toUserId) {\n        return res.status(403).json({ error: \"Forbidden\" });\n      }\n\n      await storage.markMessageAsRead(id);\n      res.json({ success: true });\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to mark message as read\" });\n    }\n  });\n\n  app.get(\"/api/battles\", async (req, res) => {\n    try {\n      const battles = await storage.getAllBattles();\n      res.json(battles);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch battles\" });\n    }\n  });\n\n  app.get(\"/api/battles/:id\", async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const battle = await storage.getBattle(id);\n      \n      if (!battle) {\n        return res.status(404).json({ error: \"Battle not found\" });\n      }\n\n      res.json(battle);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch battle\" });\n    }\n  });\n\n  app.post(\"/api/battles\", async (req: any, res) => {\n    try {\n      console.log(\"Battle creation request body:\", JSON.stringify(req.body));\n      const data = insertBattleSchema.parse(req.body);\n      console.log(\"Parsed battle data:\", JSON.stringify(data));\n      \n      if (data.leftUserId) {\n        const user = await storage.getUser(data.leftUserId);\n        if (user) {\n          const expectedType = user.role === \"producer\" ? \"beat\" : \"song\";\n          if (data.type !== expectedType) {\n            return res.status(400).json({ \n              error: user.role === \"producer\" \n                ? \"Producers can only create Beat Battles\" \n                : \"Artists can only create Song Battles\" \n            });\n          }\n          \n          const canBattleResult = await storage.canUserBattle(data.leftUserId);\n          if (!canBattleResult.canBattle) {\n            return res.status(403).json({ \n              error: canBattleResult.reason,\n              needsMembership: true\n            });\n          }\n          \n          const BATTLE_COST = 250;\n          if (user.membership === 'free') {\n            await storage.updateUserCoins(data.leftUserId, user.coins - BATTLE_COST);\n          }\n        }\n      }\n      \n      const battleData = {\n        ...data,\n        status: \"pending\" as const,\n      };\n      const battle = await storage.createBattle(battleData);\n      res.json(battle);\n    } catch (error: any) {\n      console.error(\"Battle creation error:\", error);\n      if (error.name === \"ZodError\") {\n        return res.status(400).json({ error: fromZodError(error).toString() });\n      }\n      res.status(500).json({ error: error.message || \"Failed to create battle\" });\n    }\n  });\n\n  app.post(\"/api/battles/:id/join\", async (req: any, res) => {\n    try {\n      const battleId = parseInt(req.params.id);\n      const { userId, artist, track, audio } = req.body;\n\n      const existingBattle = await storage.getBattle(battleId);\n      if (!existingBattle) {\n        return res.status(404).json({ error: \"Battle not found\" });\n      }\n\n      if (userId) {\n        const user = await storage.getUser(userId);\n        if (user) {\n          const expectedType = user.role === \"producer\" ? \"beat\" : \"song\";\n          if (existingBattle.type !== expectedType) {\n            return res.status(400).json({ \n              error: user.role === \"producer\" \n                ? \"Producers can only join Beat Battles\" \n                : \"Artists can only join Song Battles\" \n            });\n          }\n          \n          const canBattleResult = await storage.canUserBattle(userId);\n          if (!canBattleResult.canBattle) {\n            return res.status(403).json({ \n              error: canBattleResult.reason,\n              needsMembership: true\n            });\n          }\n          \n          const BATTLE_COST = 250;\n          if (user.membership === 'free') {\n            await storage.updateUserCoins(userId, user.coins - BATTLE_COST);\n          }\n        }\n      }\n\n      const battle = await storage.joinBattle(battleId, userId, artist, track, audio);\n      res.json(battle);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to join battle\" });\n    }\n  });\n\n  app.post(\"/api/votes\", async (req, res) => {\n    try {\n      const data = insertVoteSchema.parse(req.body);\n      \n      const existing = await storage.getUserVote(data.battleId, data.userId);\n      if (existing) {\n        return res.status(400).json({ error: \"Already voted\" });\n      }\n\n      const vote = await storage.createVote(data);\n      await storage.updateBattleVotes(data.battleId, data.side as \"left\" | \"right\", 1);\n      \n      res.json(vote);\n    } catch (error: any) {\n      if (error.name === \"ZodError\") {\n        return res.status(400).json({ error: fromZodError(error).toString() });\n      }\n      res.status(500).json({ error: \"Failed to vote\" });\n    }\n  });\n\n  app.get(\"/api/votes/:battleId/:userId\", async (req, res) => {\n    try {\n      const battleId = parseInt(req.params.battleId);\n      const userId = parseInt(req.params.userId);\n      \n      const vote = await storage.getUserVote(battleId, userId);\n      res.json(vote || null);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch vote\" });\n    }\n  });\n\n  app.get(\"/api/comments/:battleId\", async (req, res) => {\n    try {\n      const battleId = parseInt(req.params.battleId);\n      const comments = await storage.getCommentsByBattle(battleId);\n      res.json(comments);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch comments\" });\n    }\n  });\n\n  app.post(\"/api/comments\", async (req, res) => {\n    try {\n      const data = insertCommentSchema.parse(req.body);\n      const comment = await storage.createComment(data);\n      res.json(comment);\n    } catch (error: any) {\n      if (error.name === \"ZodError\") {\n        return res.status(400).json({ error: fromZodError(error).toString() });\n      }\n      res.status(500).json({ error: \"Failed to create comment\" });\n    }\n  });\n\n  app.get(\"/api/chat\", async (req, res) => {\n    try {\n      const messages = await storage.getChatMessages();\n      res.json(messages);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch messages\" });\n    }\n  });\n\n  app.post(\"/api/chat\", async (req, res) => {\n    try {\n      const data = insertChatMessageSchema.parse(req.body);\n      const message = await storage.createChatMessage(data);\n      res.json(message);\n    } catch (error: any) {\n      if (error.name === \"ZodError\") {\n        return res.status(400).json({ error: fromZodError(error).toString() });\n      }\n      res.status(500).json({ error: \"Failed to send message\" });\n    }\n  });\n\n  app.get(\"/api/stripe/config\", async (req, res) => {\n    try {\n      const publishableKey = await getStripePublishableKey();\n      res.json({ publishableKey });\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to get Stripe config\" });\n    }\n  });\n\n  app.get(\"/api/stripe/products\", async (req, res) => {\n    try {\n      const products = await storage.getProductsWithPrices();\n      res.json({ data: products });\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch products\" });\n    }\n  });\n\n  app.post(\"/api/stripe/checkout\", async (req, res) => {\n    try {\n      const { priceId, userId, mode } = req.body;\n\n      if (!priceId || !userId) {\n        return res.status(400).json({ error: \"priceId and userId are required\" });\n      }\n\n      const user = await storage.getUser(userId);\n      if (!user) {\n        return res.status(404).json({ error: \"User not found\" });\n      }\n\n      const stripe = await getUncachableStripeClient();\n\n      let customerId = user.stripeCustomerId;\n      if (!customerId) {\n        const customer = await stripe.customers.create({\n          metadata: { userId: user.id.toString() },\n        });\n        await storage.updateUserStripeInfo(user.id, customer.id, null, user.membership);\n        customerId = customer.id;\n      }\n\n      const domains = process.env.REPLIT_DOMAINS;\n      const baseUrl = domains ? `https://${domains.split(',')[0]}` : 'http://localhost:5000';\n      \n      const session = await stripe.checkout.sessions.create({\n        customer: customerId,\n        payment_method_types: ['card'],\n        line_items: [{ price: priceId, quantity: 1 }],\n        mode: mode || 'subscription',\n        success_url: `${baseUrl}/store?success=true&session_id={CHECKOUT_SESSION_ID}`,\n        cancel_url: `${baseUrl}/store?canceled=true`,\n        metadata: { \n          userId: user.id.toString(),\n          mode: mode || 'subscription',\n        },\n      });\n\n      res.json({ url: session.url });\n    } catch (error: any) {\n      console.error('Checkout error:', error.message);\n      res.status(500).json({ error: \"Failed to create checkout session\" });\n    }\n  });\n\n  app.get(\"/api/stripe/subscription/:userId\", async (req, res) => {\n    try {\n      const userId = parseInt(req.params.userId);\n      const user = await storage.getUser(userId);\n\n      if (!user) {\n        return res.status(404).json({ error: \"User not found\" });\n      }\n\n      if (!user.stripeSubscriptionId) {\n        return res.json({ subscription: null, membership: user.membership });\n      }\n\n      const subscription = await storage.getSubscription(user.stripeSubscriptionId);\n      res.json({ subscription, membership: user.membership });\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch subscription\" });\n    }\n  });\n\n  app.post(\"/api/stripe/portal\", async (req, res) => {\n    try {\n      const { userId } = req.body;\n\n      if (!userId) {\n        return res.status(400).json({ error: \"userId is required\" });\n      }\n\n      const user = await storage.getUser(userId);\n      if (!user || !user.stripeCustomerId) {\n        return res.status(404).json({ error: \"No Stripe customer found\" });\n      }\n\n      const stripe = await getUncachableStripeClient();\n      const domains = process.env.REPLIT_DOMAINS;\n      const baseUrl = domains ? `https://${domains.split(',')[0]}` : 'http://localhost:5000';\n\n      const session = await stripe.billingPortal.sessions.create({\n        customer: user.stripeCustomerId,\n        return_url: `${baseUrl}/store`,\n      });\n\n      res.json({ url: session.url });\n    } catch (error: any) {\n      console.error('Portal error:', error.message);\n      res.status(500).json({ error: \"Failed to create portal session\" });\n    }\n  });\n\n  app.post(\"/api/stripe/verify-purchase\", async (req, res) => {\n    try {\n      const { sessionId, userId } = req.body;\n\n      if (!sessionId || !userId) {\n        return res.status(400).json({ error: \"sessionId and userId are required\" });\n      }\n\n      const stripe = await getUncachableStripeClient();\n      \n      const session = await stripe.checkout.sessions.retrieve(sessionId, {\n        expand: ['line_items', 'line_items.data.price.product'],\n      });\n\n      if (!session.metadata?.userId || parseInt(session.metadata.userId) !== userId) {\n        return res.status(403).json({ error: \"Session does not belong to this user\" });\n      }\n\n      if (session.payment_status !== 'paid') {\n        return res.status(400).json({ error: \"Payment not completed\" });\n      }\n\n      const user = await storage.getUser(userId);\n      if (!user) {\n        return res.status(404).json({ error: \"User not found\" });\n      }\n\n      const lineItem = session.line_items?.data[0];\n      const product = lineItem?.price?.product as any;\n      const metadata = product?.metadata || {};\n\n      if (metadata.type === 'coins') {\n        const coinAmount = parseInt(metadata.coinAmount || '0');\n        if (coinAmount > 0) {\n          const currentUser = await storage.getUser(userId);\n          if (!currentUser) {\n            return res.status(404).json({ error: \"User not found\" });\n          }\n          await storage.updateUserCoins(userId, currentUser.coins + coinAmount);\n          return res.json({ \n            success: true, \n            type: 'coins', \n            amount: coinAmount,\n            newBalance: currentUser.coins + coinAmount \n          });\n        }\n      }\n\n      if (metadata.tier === 'pro' || metadata.tier === 'elite') {\n        const subscriptionId = session.subscription as string;\n        const currentUser = await storage.getUser(userId);\n        if (!currentUser) {\n          return res.status(404).json({ error: \"User not found\" });\n        }\n        \n        if (currentUser.membership === metadata.tier) {\n          return res.json({ \n            success: true, \n            type: 'membership', \n            tier: metadata.tier,\n            bonusCoins: 0,\n            alreadyApplied: true\n          });\n        }\n        \n        const updatedUser = await storage.updateUserStripeInfo(\n          userId, \n          session.customer as string, \n          subscriptionId, \n          metadata.tier,\n          true\n        );\n        \n        const bonusCoins = metadata.tier === 'elite' ? 1500 : 500;\n        await storage.updateUserCoins(userId, currentUser.coins + bonusCoins);\n        \n        return res.json({ \n          success: true, \n          type: 'membership', \n          tier: metadata.tier,\n          bonusCoins,\n          isFounder: updatedUser.foundersBadge\n        });\n      }\n\n      res.json({ success: true, type: 'unknown' });\n    } catch (error: any) {\n      console.error('Verify purchase error:', error.message);\n      res.status(500).json({ error: \"Failed to verify purchase\" });\n    }\n  });\n\n  app.get(\"/api/customizations\", async (req, res) => {\n    try {\n      const customizations = await storage.getAllCustomizations();\n      res.json(customizations);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch customizations\" });\n    }\n  });\n\n  app.get(\"/api/customizations/category/:category\", async (req, res) => {\n    try {\n      const category = req.params.category;\n      const customizations = await storage.getCustomizationsByCategory(category);\n      res.json(customizations);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch customizations\" });\n    }\n  });\n\n  app.get(\"/api/customizations/user/:userId\", isAuthenticated, async (req: any, res) => {\n    try {\n      const replitAuthId = req.user.claims.sub;\n      const authUser = await storage.getUserByReplitAuthId(replitAuthId);\n      \n      if (!authUser) {\n        return res.status(403).json({ error: \"Forbidden\" });\n      }\n\n      const userId = parseInt(req.params.userId);\n      if (authUser.id !== userId) {\n        return res.status(403).json({ error: \"Forbidden\" });\n      }\n\n      const customizations = await storage.getUserCustomizations(userId);\n      res.json(customizations);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch user customizations\" });\n    }\n  });\n\n  app.post(\"/api/customizations/unlock\", isAuthenticated, async (req: any, res) => {\n    try {\n      const replitAuthId = req.user.claims.sub;\n      const authUser = await storage.getUserByReplitAuthId(replitAuthId);\n      \n      if (!authUser) {\n        return res.status(403).json({ error: \"Forbidden\" });\n      }\n\n      const { customizationId } = req.body;\n      const customizations = await storage.getAllCustomizations();\n      const customization = customizations.find(c => c.id === customizationId);\n      \n      if (!customization) {\n        return res.status(404).json({ error: \"Customization not found\" });\n      }\n\n      const alreadyOwned = await storage.hasCustomization(authUser.id, customizationId);\n      if (alreadyOwned) {\n        return res.status(400).json({ error: \"Already owned\" });\n      }\n\n      if (customization.unlockType === 'level') {\n        if ((authUser.level || 1) < (customization.requiredLevel || 1)) {\n          return res.status(400).json({ error: \"Level too low\" });\n        }\n      } else if (customization.unlockType === 'coin') {\n        if (authUser.coins < (customization.coinCost || 0)) {\n          return res.status(400).json({ error: \"Not enough coins\" });\n        }\n        await storage.updateUserCoins(authUser.id, authUser.coins - (customization.coinCost || 0));\n      }\n\n      const unlock = await storage.unlockCustomization(authUser.id, customizationId);\n      res.json(unlock);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to unlock customization\" });\n    }\n  });\n\n  app.post(\"/api/customizations/equip\", isAuthenticated, async (req: any, res) => {\n    try {\n      const replitAuthId = req.user.claims.sub;\n      const authUser = await storage.getUserByReplitAuthId(replitAuthId);\n      \n      if (!authUser) {\n        return res.status(403).json({ error: \"Forbidden\" });\n      }\n\n      const { category, customizationId } = req.body;\n      \n      const customizations = await storage.getAllCustomizations();\n      const customization = customizations.find(c => c.id === customizationId);\n      \n      if (!customization) {\n        return res.status(404).json({ error: \"Customization not found\" });\n      }\n\n      if (customization.category !== category) {\n        return res.status(400).json({ error: \"Category mismatch\" });\n      }\n\n      if (!customization.isDefault) {\n        const owned = await storage.hasCustomization(authUser.id, customizationId);\n        if (!owned) {\n          return res.status(400).json({ error: \"You don't own this customization\" });\n        }\n      }\n\n      const user = await storage.equipCustomization(authUser.id, category, customizationId);\n      res.json(user);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to equip customization\" });\n    }\n  });\n\n  app.post(\"/api/customizations/:id/purchase\", isAuthenticated, async (req: any, res) => {\n    try {\n      const replitAuthId = req.user.claims.sub;\n      const authUser = await storage.getUserByReplitAuthId(replitAuthId);\n      \n      if (!authUser) {\n        return res.status(403).json({ error: \"Forbidden\" });\n      }\n\n      const customizationId = parseInt(req.params.id);\n      const result = await storage.buyCustomization(authUser.id, customizationId);\n      \n      if (!result.success) {\n        return res.status(400).json({ error: result.error });\n      }\n\n      res.json({ success: true, newBalance: result.newBalance });\n    } catch (error) {\n      console.error(\"Error purchasing customization:\", error);\n      res.status(500).json({ error: \"Failed to purchase customization\" });\n    }\n  });\n\n  app.post(\"/api/tutorial/complete\", isAuthenticated, async (req: any, res) => {\n    try {\n      const replitAuthId = req.user.claims.sub;\n      const authUser = await storage.getUserByReplitAuthId(replitAuthId);\n      \n      if (!authUser) {\n        return res.status(403).json({ error: \"Forbidden\" });\n      }\n\n      await storage.completeTutorial(authUser.id);\n      res.json({ success: true });\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to complete tutorial\" });\n    }\n  });\n\n  app.post(\"/api/follow/:userId\", isAuthenticated, async (req: any, res) => {\n    try {\n      const replitAuthId = req.user.claims.sub;\n      const authUser = await storage.getUserByReplitAuthId(replitAuthId);\n      \n      if (!authUser) {\n        return res.status(403).json({ error: \"Forbidden\" });\n      }\n\n      const targetUserId = parseInt(req.params.userId);\n      \n      if (authUser.id === targetUserId) {\n        return res.status(400).json({ error: \"Cannot follow yourself\" });\n      }\n\n      const alreadyFollowing = await storage.isFollowing(authUser.id, targetUserId);\n      if (alreadyFollowing) {\n        return res.status(400).json({ error: \"Already following\" });\n      }\n\n      await storage.followUser(authUser.id, targetUserId);\n      \n      const targetUser = await storage.getUser(targetUserId);\n      await storage.createNotification({\n        userId: targetUserId,\n        fromUserId: authUser.id,\n        type: \"follow\",\n        message: `${authUser.name || 'Someone'} started following you`,\n      });\n\n      res.json({ success: true });\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to follow user\" });\n    }\n  });\n\n  app.delete(\"/api/follow/:userId\", isAuthenticated, async (req: any, res) => {\n    try {\n      const replitAuthId = req.user.claims.sub;\n      const authUser = await storage.getUserByReplitAuthId(replitAuthId);\n      \n      if (!authUser) {\n        return res.status(403).json({ error: \"Forbidden\" });\n      }\n\n      const targetUserId = parseInt(req.params.userId);\n      await storage.unfollowUser(authUser.id, targetUserId);\n      res.json({ success: true });\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to unfollow user\" });\n    }\n  });\n\n  app.get(\"/api/follow/:userId/status\", isAuthenticated, async (req: any, res) => {\n    try {\n      const replitAuthId = req.user.claims.sub;\n      const authUser = await storage.getUserByReplitAuthId(replitAuthId);\n      \n      if (!authUser) {\n        return res.status(403).json({ error: \"Forbidden\" });\n      }\n\n      const targetUserId = parseInt(req.params.userId);\n      const isFollowing = await storage.isFollowing(authUser.id, targetUserId);\n      res.json({ isFollowing });\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to check follow status\" });\n    }\n  });\n\n  app.get(\"/api/users/:userId/followers\", async (req, res) => {\n    try {\n      const userId = parseInt(req.params.userId);\n      const followers = await storage.getFollowers(userId);\n      res.json(followers);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch followers\" });\n    }\n  });\n\n  app.get(\"/api/users/:userId/following\", async (req, res) => {\n    try {\n      const userId = parseInt(req.params.userId);\n      const following = await storage.getFollowing(userId);\n      res.json(following);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch following\" });\n    }\n  });\n\n  app.get(\"/api/users/role/:role\", async (req, res) => {\n    try {\n      const role = req.params.role;\n      const users = await storage.getUsersByRole(role);\n      res.json(users);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch users by role\" });\n    }\n  });\n\n  app.get(\"/api/users/search\", async (req, res) => {\n    try {\n      const query = req.query.q as string;\n      if (!query || query.length < 2) {\n        return res.json([]);\n      }\n      const users = await storage.searchUsers(query);\n      res.json(users);\n    } catch (error) {\n      console.error(\"Error searching users:\", error);\n      res.status(500).json({ error: \"Failed to search users\" });\n    }\n  });\n\n  app.post(\"/api/battle-requests\", isAuthenticated, async (req: any, res) => {\n    try {\n      const replitAuthId = req.user.claims.sub;\n      const authUser = await storage.getUserByReplitAuthId(replitAuthId);\n      \n      if (!authUser) {\n        return res.status(403).json({ error: \"Forbidden\" });\n      }\n\n      const { challengedId, battleType, genre, challengerTrack, challengerAudio, message } = req.body;\n\n      if (!challengedId || !battleType || !challengerTrack || !challengerAudio) {\n        return res.status(400).json({ error: \"Missing required fields\" });\n      }\n\n      if (challengedId === authUser.id) {\n        return res.status(400).json({ error: \"Cannot challenge yourself\" });\n      }\n\n      const expiresAt = new Date(Date.now() + 7 * 24 * 60 * 60 * 1000);\n\n      const battleRequest = await storage.createBattleRequest({\n        challengerId: authUser.id,\n        challengedId,\n        battleType,\n        genre: genre || 'general',\n        challengerTrack,\n        challengerAudio,\n        message: message || null,\n        expiresAt,\n      });\n\n      await storage.createNotification({\n        userId: challengedId,\n        fromUserId: authUser.id,\n        type: 'battle_request',\n        message: `${authUser.name || 'Someone'} challenged you to a ${battleType} battle!`,\n      });\n\n      res.json(battleRequest);\n    } catch (error) {\n      console.error(\"Error creating battle request:\", error);\n      res.status(500).json({ error: \"Failed to create battle request\" });\n    }\n  });\n\n  app.get(\"/api/battle-requests/pending\", isAuthenticated, async (req: any, res) => {\n    try {\n      const replitAuthId = req.user.claims.sub;\n      const authUser = await storage.getUserByReplitAuthId(replitAuthId);\n      \n      if (!authUser) {\n        return res.status(403).json({ error: \"Forbidden\" });\n      }\n\n      const requests = await storage.getPendingBattleRequests(authUser.id);\n      res.json(requests);\n    } catch (error) {\n      console.error(\"Error fetching pending battle requests:\", error);\n      res.status(500).json({ error: \"Failed to fetch pending battle requests\" });\n    }\n  });\n\n  app.get(\"/api/battle-requests/sent\", isAuthenticated, async (req: any, res) => {\n    try {\n      const replitAuthId = req.user.claims.sub;\n      const authUser = await storage.getUserByReplitAuthId(replitAuthId);\n      \n      if (!authUser) {\n        return res.status(403).json({ error: \"Forbidden\" });\n      }\n\n      const requests = await storage.getSentBattleRequests(authUser.id);\n      res.json(requests);\n    } catch (error) {\n      console.error(\"Error fetching sent battle requests:\", error);\n      res.status(500).json({ error: \"Failed to fetch sent battle requests\" });\n    }\n  });\n\n  app.post(\"/api/battle-requests/:id/accept\", isAuthenticated, async (req: any, res) => {\n    try {\n      const replitAuthId = req.user.claims.sub;\n      const authUser = await storage.getUserByReplitAuthId(replitAuthId);\n      \n      if (!authUser) {\n        return res.status(403).json({ error: \"Forbidden\" });\n      }\n\n      const requestId = parseInt(req.params.id);\n      const { challengedTrack, challengedAudio } = req.body;\n\n      if (!challengedTrack || !challengedAudio) {\n        return res.status(400).json({ error: \"Track name and audio are required\" });\n      }\n\n      const battleRequest = await storage.getBattleRequest(requestId);\n      if (!battleRequest) {\n        return res.status(404).json({ error: \"Battle request not found\" });\n      }\n\n      if (battleRequest.challengedId !== authUser.id) {\n        return res.status(403).json({ error: \"Not authorized to accept this request\" });\n      }\n\n      if (battleRequest.status !== 'pending') {\n        return res.status(400).json({ error: \"This request has already been processed\" });\n      }\n\n      const challenger = await storage.getUser(battleRequest.challengerId);\n      if (!challenger) {\n        return res.status(404).json({ error: \"Challenger not found\" });\n      }\n\n      const battle = await storage.createCompleteBattle({\n        leftArtist: challenger.name || 'Unknown',\n        leftTrack: battleRequest.challengerTrack,\n        leftAudio: battleRequest.challengerAudio,\n        leftUserId: battleRequest.challengerId,\n        rightArtist: authUser.name || 'Unknown',\n        rightTrack: challengedTrack,\n        rightAudio: challengedAudio,\n        rightUserId: authUser.id,\n        status: 'active',\n        battleType: battleRequest.battleType,\n        genre: battleRequest.genre,\n        endsAt: new Date(Date.now() + 48 * 60 * 60 * 1000),\n      });\n\n      await storage.updateBattleRequestStatus(requestId, 'accepted', challengedTrack, challengedAudio);\n      await storage.linkBattleToRequest(requestId, battle.id);\n\n      await storage.createNotification({\n        userId: battleRequest.challengerId,\n        fromUserId: authUser.id,\n        type: 'battle_accepted',\n        battleId: battle.id,\n        message: `${authUser.name || 'Someone'} accepted your battle challenge! The battle is now live.`,\n      });\n\n      res.json({ battleRequest: await storage.getBattleRequest(requestId), battle });\n    } catch (error) {\n      console.error(\"Error accepting battle request:\", error);\n      res.status(500).json({ error: \"Failed to accept battle request\" });\n    }\n  });\n\n  app.post(\"/api/battle-requests/:id/decline\", isAuthenticated, async (req: any, res) => {\n    try {\n      const replitAuthId = req.user.claims.sub;\n      const authUser = await storage.getUserByReplitAuthId(replitAuthId);\n      \n      if (!authUser) {\n        return res.status(403).json({ error: \"Forbidden\" });\n      }\n\n      const requestId = parseInt(req.params.id);\n\n      const battleRequest = await storage.getBattleRequest(requestId);\n      if (!battleRequest) {\n        return res.status(404).json({ error: \"Battle request not found\" });\n      }\n\n      if (battleRequest.challengedId !== authUser.id) {\n        return res.status(403).json({ error: \"Not authorized to decline this request\" });\n      }\n\n      if (battleRequest.status !== 'pending') {\n        return res.status(400).json({ error: \"This request has already been processed\" });\n      }\n\n      const updatedRequest = await storage.updateBattleRequestStatus(requestId, 'declined');\n\n      await storage.createNotification({\n        userId: battleRequest.challengerId,\n        fromUserId: authUser.id,\n        type: 'battle_declined',\n        message: `${authUser.name || 'Someone'} declined your battle challenge.`,\n      });\n\n      res.json(updatedRequest);\n    } catch (error) {\n      console.error(\"Error declining battle request:\", error);\n      res.status(500).json({ error: \"Failed to decline battle request\" });\n    }\n  });\n\n  return httpServer;\n}\n","path":null,"size_bytes":47619,"size_tokens":null},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-2 w-full overflow-hidden rounded-full bg-primary/20\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","path":null,"size_bytes":792,"size_tokens":null},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\" +\n\" hover-elevate active-elevate-2\",\n  {\n    variants: {\n      variant: {\n        default:\n           // @replit: no hover, and add primary border\n           \"bg-primary text-primary-foreground border border-primary-border\",\n        destructive:\n          \"bg-destructive text-destructive-foreground shadow-sm border-destructive-border\",\n        outline:\n          // @replit Shows the background color of whatever card / sidebar / accent background it is inside of.\n          // Inherits the current text color. Uses shadow-xs. no shadow on active\n          // No hover state\n          \" border [border-color:var(--button-outline)] shadow-xs active:shadow-none \",\n        secondary:\n          // @replit border, no hover, no shadow, secondary border.\n          \"border bg-secondary text-secondary-foreground border border-secondary-border \",\n        // @replit no hover, transparent border\n        ghost: \"border border-transparent\",\n        link: \"text-primary underline-offset-4 hover:underline\",\n      },\n      size: {\n        // @replit changed sizes\n        default: \"min-h-9 px-4 py-2\",\n        sm: \"min-h-8 rounded-md px-3 text-xs\",\n        lg: \"min-h-10 rounded-md px-8\",\n        icon: \"h-9 w-9\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","path":null,"size_bytes":2356,"size_tokens":null},"client/src/pages/Home.tsx":{"content":"import { Navbar } from \"@/components/layout/Navbar\";\nimport { Footer } from \"@/components/layout/Footer\";\nimport { Hero } from \"@/components/home/Hero\";\nimport { BattleCard } from \"@/components/battle/BattleCard\";\nimport { ArrowRight, Zap, Crown, Loader2 } from \"lucide-react\";\nimport { Link } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Avatar, AvatarImage, AvatarFallback } from \"@/components/ui/avatar\";\n\nimport cover1 from \"@assets/generated_images/synthwave_geometric_album_art.png\";\nimport cover2 from \"@assets/generated_images/dark_trap_music_album_art.png\";\nimport cover3 from \"@assets/generated_images/lo-fi_anime_album_art.png\";\nimport cover4 from \"@assets/generated_images/future_bass_crystal_album_art.png\";\n\nconst DEFAULT_COVERS = [cover1, cover2, cover3, cover4];\n\nfunction getTimeLeft(endsAt: string | null): string {\n  if (!endsAt) return \"00:00:00\";\n  const end = new Date(endsAt).getTime();\n  const now = Date.now();\n  const diff = Math.max(0, end - now);\n  \n  const hours = Math.floor(diff / (1000 * 60 * 60));\n  const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));\n  const seconds = Math.floor((diff % (1000 * 60)) / 1000);\n  \n  return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;\n}\n\nexport default function Home() {\n  const { data: battles = [], isLoading: battlesLoading } = useQuery({\n    queryKey: [\"battles-home\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/battles\");\n      if (!res.ok) throw new Error(\"Failed to fetch battles\");\n      return res.json();\n    },\n  });\n\n  const { data: leaderboard = [], isLoading: leaderboardLoading } = useQuery({\n    queryKey: [\"leaderboard-home\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/leaderboard\");\n      if (!res.ok) throw new Error(\"Failed to fetch leaderboard\");\n      return res.json();\n    },\n  });\n\n  const activeBattles = battles\n    .filter((b: any) => b.status === \"active\")\n    .slice(0, 3)\n    .map((battle: any, index: number) => ({\n      id: battle.id,\n      timeLeft: getTimeLeft(battle.endsAt),\n      type: battle.type || \"beat\",\n      left: {\n        artist: battle.leftArtist || \"Unknown\",\n        track: battle.leftTrack || \"Untitled\",\n        cover: DEFAULT_COVERS[index % 4],\n        votes: battle.leftVotes || 0,\n        isLeading: (battle.leftVotes || 0) > (battle.rightVotes || 0),\n      },\n      right: {\n        artist: battle.rightArtist || \"Waiting...\",\n        track: battle.rightTrack || \"Challenger\",\n        cover: DEFAULT_COVERS[(index + 1) % 4],\n        votes: battle.rightVotes || 0,\n        isLeading: (battle.rightVotes || 0) > (battle.leftVotes || 0),\n      },\n    }));\n\n  const topUsers = leaderboard\n    .filter((user: any) => user.id && user.name)\n    .slice(0, 5)\n    .map((user: any, index: number) => ({\n      id: user.id,\n      rank: index + 1,\n      name: user.name,\n      wins: user.wins || 0,\n      score: user.xp || 0,\n      avatar: user.profileImageUrl,\n    }));\n  return (\n    <div className=\"min-h-screen bg-sv-black flex flex-col\">\n      <Navbar />\n      \n      <main className=\"flex-grow\">\n        <Hero />\n        \n        {/* Trending Battles Section */}\n        <section className=\"py-20 max-w-7xl mx-auto px-4 relative\">\n          {/* Section Header */}\n          <div className=\"flex items-center justify-between mb-10\">\n            <div className=\"border-l-4 border-sv-pink pl-6\">\n              <h2 className=\"text-3xl font-cyber font-bold text-white mb-2 flex items-center gap-3 uppercase\">\n                <Zap className=\"w-6 h-6 text-sv-gold fill-sv-gold\" />\n                Live Battles\n              </h2>\n              <p className=\"text-gray-500 font-body\">The hottest matchups happening right now.</p>\n            </div>\n            <Link href=\"/battles\">\n              <button className=\"font-hud font-bold uppercase tracking-widest text-sv-pink hover:text-white transition-colors flex items-center gap-2\">\n                View All <ArrowRight className=\"w-4 h-4\" />\n              </button>\n            </Link>\n          </div>\n          \n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8\">\n            {battlesLoading ? (\n              <div className=\"col-span-3 flex justify-center py-12\">\n                <Loader2 className=\"w-8 h-8 animate-spin text-sv-pink\" />\n              </div>\n            ) : activeBattles.length === 0 ? (\n              <div className=\"col-span-3 text-center py-12\">\n                <p className=\"text-gray-500 font-body\">No active battles right now. Start one!</p>\n              </div>\n            ) : (\n              activeBattles.map((battle: any) => (\n                <Link key={battle.id} href={`/battle/${battle.id}`}>\n                  <BattleCard {...battle} />\n                </Link>\n              ))\n            )}\n          </div>\n        </section>\n\n        {/* Top Producers Section (Leaderboard Teaser) */}\n        <section className=\"py-20 bg-sv-dark border-y border-sv-gray relative overflow-hidden\">\n          {/* Cyber Grid Background */}\n          <div className=\"absolute inset-0 cyber-grid opacity-20 pointer-events-none\"></div>\n          \n          <div className=\"max-w-7xl mx-auto px-4 relative z-10\">\n            <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-16 items-center\">\n              <div>\n                <div className=\"border-l-4 border-sv-gold pl-6 mb-8\">\n                  <h2 className=\"text-4xl font-cyber font-bold text-white mb-2 uppercase\">\n                    Top Legends\n                  </h2>\n                  <p className=\"text-gray-500 font-hud uppercase tracking-widest\">of the Week</p>\n                </div>\n                <p className=\"text-gray-400 mb-8 leading-relaxed font-body\">\n                  Climb the ranks by winning battles. Top producers earn exclusive badges, \n                  cash prizes, and features on our social channels.\n                </p>\n                <Link href=\"/leaderboard\">\n                  <button className=\"cyber-btn bg-sv-gold text-black font-cyber font-bold py-3 px-8 uppercase tracking-wider hover:glow-gold\">\n                    <span>View Leaderboard</span>\n                  </button>\n                </Link>\n              </div>\n\n              <div className=\"bg-sv-black border border-sv-gray p-6 relative\">\n                <div className=\"absolute -top-3 -left-3 bg-sv-purple text-white font-bold font-mono text-xs px-2 py-1 rotate-[-5deg] sketch-border\">\n                  TOP 5\n                </div>\n                <div className=\"space-y-4\">\n                  {leaderboardLoading ? (\n                    <div className=\"flex justify-center py-8\">\n                      <Loader2 className=\"w-6 h-6 animate-spin text-sv-gold\" />\n                    </div>\n                  ) : topUsers.length === 0 ? (\n                    <div className=\"text-center py-8\">\n                      <p className=\"text-gray-500 font-body\">No rankings yet. Be the first to battle!</p>\n                    </div>\n                  ) : (\n                    topUsers.map((artist: any) => (\n                      <Link key={artist.rank} href={`/user/${artist.id}`}>\n                        <div className=\"flex items-center gap-4 p-3 hover:bg-sv-purple/10 border border-transparent hover:border-sv-purple/30 transition-all group cursor-pointer\">\n                          <div className={`font-cyber font-bold w-8 text-center ${artist.rank === 1 ? 'text-sv-gold' : artist.rank === 2 ? 'text-gray-300' : artist.rank === 3 ? 'text-amber-600' : 'text-gray-500'}`}>\n                            {artist.rank === 1 ? <Crown className=\"w-6 h-6 fill-sv-gold text-sv-gold mx-auto\" /> : `#${artist.rank}`}\n                          </div>\n                          <Avatar className=\"w-10 h-10 border border-sv-gray\">\n                            <AvatarImage src={artist.avatar || undefined} />\n                            <AvatarFallback className=\"bg-sv-dark text-white\">{artist.name[0]}</AvatarFallback>\n                          </Avatar>\n                          <div className=\"flex-grow\">\n                            <h4 className=\"font-punk text-white group-hover:text-sv-pink transition-colors\">{artist.name}</h4>\n                            <p className=\"text-xs text-gray-500 font-hud uppercase tracking-widest\">{artist.wins} Wins</p>\n                          </div>\n                          <div className=\"font-mono text-sm font-bold text-sv-gold\">{artist.score.toLocaleString()}</div>\n                        </div>\n                      </Link>\n                    ))\n                  )}\n                </div>\n              </div>\n            </div>\n          </div>\n        </section>\n      </main>\n\n      <Footer />\n    </div>\n  );\n}\n","path":null,"size_bytes":8787,"size_tokens":null},"client/src/components/ui/kbd.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Kbd({ className, ...props }: React.ComponentProps<\"kbd\">) {\n  return (\n    <kbd\n      data-slot=\"kbd\"\n      className={cn(\n        \"bg-muted text-muted-foreground pointer-events-none inline-flex h-5 w-fit min-w-5 select-none items-center justify-center gap-1 rounded-sm px-1 font-sans text-xs font-medium\",\n        \"[&_svg:not([class*='size-'])]:size-3\",\n        \"[[data-slot=tooltip-content]_&]:bg-background/20 [[data-slot=tooltip-content]_&]:text-background dark:[[data-slot=tooltip-content]_&]:bg-background/10\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction KbdGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <kbd\n      data-slot=\"kbd-group\"\n      className={cn(\"inline-flex items-center gap-1\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Kbd, KbdGroup }\n","path":null,"size_bytes":862,"size_tokens":null},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","path":null,"size_bytes":157,"size_tokens":null},"server/static.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(__dirname, \"public\");\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","path":null,"size_bytes":547,"size_tokens":null},"server/vite.ts":{"content":"import { type Express } from \"express\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport async function setupVite(server: Server, app: Express) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server, path: \"/vite-hmr\" },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n","path":null,"size_bytes":1534,"size_tokens":null},"client/src/pages/Store.tsx":{"content":"import { Navbar } from \"@/components/layout/Navbar\";\nimport { Footer } from \"@/components/layout/Footer\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Check, Crown, Coins, Loader2, ExternalLink, Plug, Palette, Sparkles, Circle, Frame, ArrowRight } from \"lucide-react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { fetchStripeProducts, createCheckoutSession, verifyPurchase, createPortalSession, type StripeProduct } from \"@/lib/api\";\nimport { useUser } from \"@/context/UserContext\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useEffect, useState } from \"react\";\nimport { Link } from \"wouter\";\nimport { useSoundEffects } from \"@/hooks/useSoundEffects\";\n\nconst MEMBERSHIP_FEATURES: Record<string, string[]> = {\n  free: [\n    \"Join 3 Battles per month\",\n    \"Vote on active battles\",\n    \"Basic profile\",\n    \"Community access\"\n  ],\n  pro: [\n    \"Unlimited Battles\",\n    \"Pro Badge on profile\",\n    \"Detailed battle analytics\",\n    \"Priority support\",\n    \"Featured Artist/Producer spot\",\n    \"Host your own tournaments\",\n    \"Custom profile themes\",\n    \"500 Monthly Bonus Coins\"\n  ],\n  elite: [\n    \"Everything in Pro\",\n    \"Elite Badge on profile\",\n    \"Premium Featured spot\",\n    \"Priority tournament hosting\",\n    \"Exclusive profile themes\",\n    \"Early access to new features\",\n    \"1500 Monthly Bonus Coins\"\n  ]\n};\n\nexport default function Store() {\n  const { user, refreshUser, login } = useUser();\n  const { toast } = useToast();\n  const { playSound } = useSoundEffects();\n  const [processingPurchase, setProcessingPurchase] = useState(false);\n\n  const { data: products, isLoading } = useQuery({\n    queryKey: ['stripe-products'],\n    queryFn: fetchStripeProducts,\n  });\n\n  useEffect(() => {\n    const urlParams = new URLSearchParams(window.location.search);\n    const success = urlParams.get('success');\n    const sessionId = urlParams.get('session_id');\n\n    if (success === 'true' && sessionId && user && !processingPurchase) {\n      setProcessingPurchase(true);\n      verifyPurchase(sessionId, user.id)\n        .then((result) => {\n          if (result.success) {\n            if (result.type === 'coins') {\n              playSound(\"coinEarn\");\n              toast({\n                title: \"Purchase Complete!\",\n                description: `You received ${result.amount} coins! New balance: ${result.newBalance}`,\n              });\n            } else if (result.type === 'membership') {\n              playSound(\"levelUp\");\n              toast({\n                title: \"Welcome to \" + (result.tier === 'elite' ? 'Elite' : 'Pro') + \"!\",\n                description: `You received ${result.bonusCoins} bonus coins with your membership.`,\n              });\n            }\n            refreshUser();\n          }\n          window.history.replaceState({}, '', '/store');\n        })\n        .catch((err) => {\n          console.error('Verify error:', err);\n        })\n        .finally(() => {\n          setProcessingPurchase(false);\n        });\n    }\n\n    if (urlParams.get('canceled') === 'true') {\n      playSound(\"error\");\n      toast({\n        title: \"Purchase Canceled\",\n        description: \"Your purchase was canceled. No charges were made.\",\n        variant: \"destructive\",\n      });\n      window.history.replaceState({}, '', '/store');\n    }\n  }, [user, toast, refreshUser, processingPurchase, playSound]);\n\n  const checkoutMutation = useMutation({\n    mutationFn: async ({ priceId, mode }: { priceId: string; mode: 'subscription' | 'payment' }) => {\n      if (!user) throw new Error(\"Please sign in first\");\n      return createCheckoutSession(priceId, user.id, mode);\n    },\n    onSuccess: (data) => {\n      if (data.url) {\n        window.location.href = data.url;\n      }\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const portalMutation = useMutation({\n    mutationFn: async () => {\n      if (!user) throw new Error(\"Please sign in first\");\n      return createPortalSession(user.id);\n    },\n    onSuccess: (data) => {\n      if (data.url) {\n        window.location.href = data.url;\n      }\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handlePurchase = (priceId: string, mode: 'subscription' | 'payment') => {\n    if (!user) {\n      login();\n      return;\n    }\n    checkoutMutation.mutate({ priceId, mode });\n  };\n\n  const membershipProducts = products?.filter(p => p.metadata.tier === 'pro' || p.metadata.tier === 'elite') || [];\n  const coinProducts = products?.filter(p => p.metadata.type === 'coins') || [];\n\n  const formatPrice = (amount: number) => {\n    return `$${(amount / 100).toFixed(2)}`;\n  };\n\n  const userMembership = user?.membership || 'free';\n\n  return (\n    <div className=\"min-h-screen bg-background flex flex-col\">\n      <Navbar />\n      \n      <main className=\"flex-grow pt-24 pb-20\">\n        <div className=\"container mx-auto px-4\">\n          \n          <div className=\"text-center max-w-2xl mx-auto mb-16\">\n            <h1 className=\"text-4xl md:text-6xl font-bold font-heading text-white mb-4\">Upgrade Your Game</h1>\n            <p className=\"text-muted-foreground text-lg\">\n              Unlock unlimited battles, gain exclusive perks, and stock up on coins to boost your favorite tracks.\n            </p>\n            {user && userMembership !== 'free' && (\n              <div className=\"mt-4 inline-flex items-center gap-2 bg-violet-500/20 text-violet-300 px-4 py-2 rounded-full text-sm font-medium\">\n                <Crown className=\"w-4 h-4\" />\n                Current Plan: {userMembership.charAt(0).toUpperCase() + userMembership.slice(1)}\n                <Button \n                  variant=\"ghost\" \n                  size=\"sm\" \n                  className=\"ml-2 h-6 text-xs\"\n                  onClick={() => portalMutation.mutate()}\n                  disabled={portalMutation.isPending}\n                >\n                  {portalMutation.isPending ? <Loader2 className=\"w-3 h-3 animate-spin\" /> : <ExternalLink className=\"w-3 h-3\" />}\n                  Manage\n                </Button>\n              </div>\n            )}\n          </div>\n\n          {/* Membership Tiers */}\n          <div className=\"mb-24\">\n            <h2 className=\"text-2xl font-bold font-heading text-white mb-8 flex items-center gap-2\">\n              <Crown className=\"w-6 h-6 text-yellow-400\" />\n              Memberships\n            </h2>\n            \n            {isLoading ? (\n              <div className=\"flex items-center justify-center py-12\">\n                <Loader2 className=\"w-8 h-8 animate-spin text-violet-500\" />\n              </div>\n            ) : (\n              <div className=\"grid grid-cols-1 md:grid-cols-3 gap-8\">\n                {/* Free tier (always shown) */}\n                <Card className=\"bg-card/50 border-white/10 backdrop-blur-sm relative overflow-hidden\">\n                  <CardHeader>\n                    <CardTitle className=\"text-2xl font-bold text-white\">Free</CardTitle>\n                    <CardDescription>For new artists just starting out.</CardDescription>\n                    <div className=\"mt-4 flex items-baseline text-white\">\n                      <span className=\"text-4xl font-bold tracking-tight\">$0</span>\n                    </div>\n                  </CardHeader>\n                  <CardContent>\n                    <ul className=\"space-y-3\">\n                      {MEMBERSHIP_FEATURES.free.map((feature) => (\n                        <li key={feature} className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                          <Check className=\"w-4 h-4 text-violet-400 shrink-0\" />\n                          {feature}\n                        </li>\n                      ))}\n                    </ul>\n                  </CardContent>\n                  <CardFooter>\n                    <Button \n                      className=\"w-full font-bold bg-white/10 text-white hover:bg-white/20\"\n                      disabled={userMembership === 'free'}\n                    >\n                      {userMembership === 'free' ? 'Current Plan' : 'Free Forever'}\n                    </Button>\n                  </CardFooter>\n                </Card>\n\n                {membershipProducts.map((product) => {\n                  const tier = product.metadata.tier;\n                  const price = product.prices[0];\n                  const isPro = tier === 'pro';\n                  const isCurrentPlan = userMembership === tier;\n                  \n                  return (\n                    <Card \n                      key={product.id} \n                      className={`bg-card/50 border-white/10 backdrop-blur-sm relative overflow-hidden ${isPro ? 'border-violet-500/50 shadow-lg shadow-violet-500/10' : ''}`}\n                    >\n                      {isPro && (\n                        <div className=\"absolute top-0 right-0 bg-violet-500 text-white text-xs font-bold px-3 py-1 rounded-bl-lg\">\n                          MOST POPULAR\n                        </div>\n                      )}\n                      <CardHeader>\n                        <CardTitle className=\"text-2xl font-bold text-white\">\n                          {tier === 'pro' ? 'Pro' : 'Elite'}\n                        </CardTitle>\n                        <CardDescription>{product.description}</CardDescription>\n                        <div className=\"mt-4 flex items-baseline text-white\">\n                          <span className=\"text-4xl font-bold tracking-tight\">\n                            {price ? formatPrice(price.unit_amount) : '$?.??'}\n                          </span>\n                          <span className=\"text-muted-foreground ml-1\">/mo</span>\n                        </div>\n                      </CardHeader>\n                      <CardContent>\n                        <ul className=\"space-y-3\">\n                          {MEMBERSHIP_FEATURES[tier]?.map((feature) => (\n                            <li key={feature} className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                              <Check className=\"w-4 h-4 text-violet-400 shrink-0\" />\n                              {feature}\n                            </li>\n                          ))}\n                        </ul>\n                      </CardContent>\n                      <CardFooter>\n                        <Button \n                          className={`w-full font-bold ${isPro ? 'bg-violet-500 hover:bg-violet-600 text-white' : 'bg-white text-black hover:bg-white/90'}`}\n                          onClick={() => price && handlePurchase(price.id, 'subscription')}\n                          disabled={checkoutMutation.isPending || isCurrentPlan || !price}\n                          data-testid={`button-upgrade-${tier}`}\n                        >\n                          {checkoutMutation.isPending ? (\n                            <Loader2 className=\"w-4 h-4 animate-spin mr-2\" />\n                          ) : null}\n                          {isCurrentPlan ? 'Current Plan' : `Upgrade to ${tier === 'pro' ? 'Pro' : 'Elite'}`}\n                        </Button>\n                      </CardFooter>\n                    </Card>\n                  );\n                })}\n              </div>\n            )}\n          </div>\n\n          {/* Coin Store */}\n          <div className=\"mb-24\">\n            <h2 className=\"text-2xl font-bold font-heading text-white mb-8 flex items-center gap-2\">\n              <Coins className=\"w-6 h-6 text-yellow-400\" />\n              Coin Store\n            </h2>\n            \n            {isLoading ? (\n              <div className=\"flex items-center justify-center py-12\">\n                <Loader2 className=\"w-8 h-8 animate-spin text-violet-500\" />\n              </div>\n            ) : (\n              <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6\">\n                {coinProducts.map((product) => {\n                  const price = product.prices[0];\n                  const coinAmount = product.metadata.coinAmount;\n                  const bonus = product.metadata.bonus;\n                  const isPopular = parseInt(coinAmount) === 2500;\n                  \n                  return (\n                    <Card \n                      key={product.id} \n                      className={`bg-card/50 border-white/10 backdrop-blur-sm relative overflow-hidden hover:border-white/20 transition-colors ${isPopular ? 'border-yellow-500/30' : ''}`}\n                    >\n                      {bonus && (\n                        <div className=\"absolute top-0 right-0 bg-white/10 text-white text-[10px] font-bold px-2 py-1 rounded-bl-lg border-l border-b border-white/5\">\n                          {bonus}\n                        </div>\n                      )}\n                      <CardHeader className=\"text-center pb-2\">\n                        <div className=\"w-16 h-16 bg-yellow-500/10 rounded-full flex items-center justify-center mx-auto mb-4 border border-yellow-500/20\">\n                          <Coins className=\"w-8 h-8 text-yellow-400\" />\n                        </div>\n                        <CardTitle className=\"text-3xl font-bold text-white\">{coinAmount}</CardTitle>\n                        <CardDescription>Versus Coins</CardDescription>\n                      </CardHeader>\n                      <CardFooter>\n                        <Button \n                          variant=\"outline\" \n                          className=\"w-full border-white/10 hover:bg-white/5 hover:text-white\"\n                          onClick={() => price && handlePurchase(price.id, 'payment')}\n                          disabled={checkoutMutation.isPending || !price}\n                          data-testid={`button-buy-coins-${coinAmount}`}\n                        >\n                          {checkoutMutation.isPending ? (\n                            <Loader2 className=\"w-4 h-4 animate-spin mr-2\" />\n                          ) : null}\n                          Buy for {price ? formatPrice(price.unit_amount) : '$?.??'}\n                        </Button>\n                      </CardFooter>\n                    </Card>\n                  );\n                })}\n              </div>\n            )}\n          </div>\n\n          {/* Plugins */}\n          <div className=\"mb-24\">\n            <h2 className=\"text-2xl font-bold font-heading text-white mb-8 flex items-center gap-2\">\n              <Plug className=\"w-6 h-6 text-fuchsia-400\" />\n              Plugins\n            </h2>\n            \n            <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6\">\n              <Card className=\"bg-card/50 border-fuchsia-500/30 backdrop-blur-sm relative overflow-hidden hover:border-fuchsia-500/50 transition-colors group\">\n                <div className=\"absolute top-0 right-0 bg-fuchsia-500 text-white text-xs font-bold px-3 py-1 rounded-bl-lg\">\n                  NEW\n                </div>\n                <CardHeader className=\"text-center\">\n                  <div className=\"w-20 h-20 bg-gradient-to-br from-fuchsia-500/20 to-violet-500/20 rounded-2xl flex items-center justify-center mx-auto mb-4 border border-fuchsia-500/30 group-hover:scale-105 transition-transform\">\n                    <span className=\"text-3xl font-black text-fuchsia-400\">P</span>\n                  </div>\n                  <CardTitle className=\"text-2xl font-bold text-white\">PLUMPIFY</CardTitle>\n                  <CardDescription className=\"text-sm\">\n                    Premium audio plugin to make your beats hit harder. Add warmth, punch, and presence to your mixes.\n                  </CardDescription>\n                </CardHeader>\n                <CardContent>\n                  <ul className=\"space-y-2 text-sm text-muted-foreground\">\n                    <li className=\"flex items-center gap-2\">\n                      <Check className=\"w-4 h-4 text-fuchsia-400 shrink-0\" />\n                      Instant low-end boost\n                    </li>\n                    <li className=\"flex items-center gap-2\">\n                      <Check className=\"w-4 h-4 text-fuchsia-400 shrink-0\" />\n                      Analog warmth saturation\n                    </li>\n                    <li className=\"flex items-center gap-2\">\n                      <Check className=\"w-4 h-4 text-fuchsia-400 shrink-0\" />\n                      Works with any DAW\n                    </li>\n                  </ul>\n                </CardContent>\n                <CardFooter>\n                  <Button \n                    className=\"w-full font-bold bg-fuchsia-500 hover:bg-fuchsia-600 text-white\"\n                    onClick={() => window.open('https://payhip.com/b/MPWUu', '_blank', 'noopener,noreferrer')}\n                    data-testid=\"button-buy-plumpify\"\n                  >\n                    <ExternalLink className=\"w-4 h-4 mr-2\" />\n                    Get PLUMPIFY\n                  </Button>\n                </CardFooter>\n              </Card>\n            </div>\n          </div>\n\n          {/* Customizations */}\n          <div>\n            <div className=\"flex items-center justify-between mb-8\">\n              <div>\n                <h2 className=\"text-2xl font-bold font-heading text-white flex items-center gap-2\">\n                  <Palette className=\"w-6 h-6 text-cyan-400\" />\n                  Customizations\n                </h2>\n                <p className=\"text-muted-foreground mt-1\">\n                  Personalize your battles and profile with unique visual effects.\n                </p>\n              </div>\n              <Link href=\"/customizations\">\n                <Button className=\"bg-fuchsia-500 hover:bg-fuchsia-600 text-white font-bold\" data-testid=\"button-view-all-customizations\">\n                  Browse All\n                  <ArrowRight className=\"w-4 h-4 ml-2\" />\n                </Button>\n              </Link>\n            </div>\n            \n            <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6\">\n              {/* Profile Plates */}\n              <Link href=\"/customizations\">\n                <Card className=\"bg-card/50 border-white/10 backdrop-blur-sm relative overflow-hidden hover:border-cyan-500/30 transition-colors group cursor-pointer\">\n                  <CardHeader className=\"text-center pb-2\">\n                    <div className=\"w-16 h-16 bg-gradient-to-br from-cyan-500/20 to-blue-500/20 rounded-xl flex items-center justify-center mx-auto mb-4 border border-cyan-500/20 group-hover:scale-105 transition-transform\">\n                      <Frame className=\"w-8 h-8 text-cyan-400\" />\n                    </div>\n                    <CardTitle className=\"text-xl font-bold text-white\">Profile Plates</CardTitle>\n                    <CardDescription className=\"text-xs\">Custom frames for your profile card</CardDescription>\n                  </CardHeader>\n                  <CardContent className=\"text-center\">\n                    <div className=\"flex flex-wrap gap-2 justify-center mb-3\">\n                      <span className=\"w-6 h-6 rounded-full bg-gradient-to-r from-cyan-500 to-blue-500 border-2 border-white/20\"></span>\n                      <span className=\"w-6 h-6 rounded-full bg-gradient-to-r from-fuchsia-500 to-violet-500 border-2 border-white/20\"></span>\n                      <span className=\"w-6 h-6 rounded-full bg-gradient-to-r from-yellow-500 to-orange-500 border-2 border-white/20\"></span>\n                    </div>\n                    <p className=\"text-xs text-muted-foreground\">Multiple designs available</p>\n                  </CardContent>\n                  <CardFooter>\n                    <Button \n                      variant=\"outline\" \n                      className=\"w-full border-cyan-500/30 hover:bg-cyan-500/10 hover:text-cyan-400\"\n                      data-testid=\"button-browse-plates\"\n                    >\n                      <Coins className=\"w-4 h-4 mr-2 text-yellow-400\" />\n                      Browse Plates\n                    </Button>\n                  </CardFooter>\n                </Card>\n              </Link>\n\n              {/* Battle Effects */}\n              <Link href=\"/customizations\">\n                <Card className=\"bg-card/50 border-white/10 backdrop-blur-sm relative overflow-hidden hover:border-violet-500/30 transition-colors group cursor-pointer\">\n                  <CardHeader className=\"text-center pb-2\">\n                    <div className=\"w-16 h-16 bg-gradient-to-br from-violet-500/20 to-purple-500/20 rounded-xl flex items-center justify-center mx-auto mb-4 border border-violet-500/20 group-hover:scale-105 transition-transform\">\n                      <Sparkles className=\"w-8 h-8 text-violet-400\" />\n                    </div>\n                    <CardTitle className=\"text-xl font-bold text-white\">Battle Effects</CardTitle>\n                    <CardDescription className=\"text-xs\">Animated effects for your battles</CardDescription>\n                  </CardHeader>\n                  <CardContent className=\"text-center\">\n                    <div className=\"flex flex-wrap gap-2 justify-center mb-3\">\n                      <span className=\"text-lg\"></span>\n                      <span className=\"text-lg\"></span>\n                      <span className=\"text-lg\"></span>\n                    </div>\n                    <p className=\"text-xs text-muted-foreground\">Multiple effects available</p>\n                  </CardContent>\n                  <CardFooter>\n                    <Button \n                      variant=\"outline\" \n                      className=\"w-full border-violet-500/30 hover:bg-violet-500/10 hover:text-violet-400\"\n                      data-testid=\"button-browse-effects\"\n                    >\n                      <Coins className=\"w-4 h-4 mr-2 text-yellow-400\" />\n                      Browse Effects\n                    </Button>\n                  </CardFooter>\n                </Card>\n              </Link>\n\n              {/* Sphere Skins */}\n              <Link href=\"/customizations\">\n                <Card className=\"bg-card/50 border-white/10 backdrop-blur-sm relative overflow-hidden hover:border-fuchsia-500/30 transition-colors group cursor-pointer\">\n                  <div className=\"absolute top-0 right-0 bg-fuchsia-500 text-white text-[10px] font-bold px-2 py-1 rounded-bl-lg\">\n                    POPULAR\n                  </div>\n                  <CardHeader className=\"text-center pb-2\">\n                    <div className=\"w-16 h-16 bg-gradient-to-br from-fuchsia-500/20 to-pink-500/20 rounded-xl flex items-center justify-center mx-auto mb-4 border border-fuchsia-500/20 group-hover:scale-105 transition-transform\">\n                      <Circle className=\"w-8 h-8 text-fuchsia-400\" />\n                    </div>\n                    <CardTitle className=\"text-xl font-bold text-white\">Sphere Skins</CardTitle>\n                    <CardDescription className=\"text-xs\">Custom audio visualizer styles</CardDescription>\n                  </CardHeader>\n                  <CardContent className=\"text-center\">\n                    <div className=\"flex flex-wrap gap-2 justify-center mb-3\">\n                      <span className=\"w-6 h-6 rounded-full bg-gradient-to-r from-fuchsia-500 to-pink-500 animate-pulse\"></span>\n                      <span className=\"w-6 h-6 rounded-full bg-gradient-to-r from-green-500 to-emerald-500 animate-pulse\"></span>\n                      <span className=\"w-6 h-6 rounded-full bg-gradient-to-r from-red-500 to-orange-500 animate-pulse\"></span>\n                    </div>\n                    <p className=\"text-xs text-muted-foreground\">Multiple skins available</p>\n                  </CardContent>\n                  <CardFooter>\n                    <Button \n                      variant=\"outline\" \n                      className=\"w-full border-fuchsia-500/30 hover:bg-fuchsia-500/10 hover:text-fuchsia-400\"\n                      data-testid=\"button-browse-spheres\"\n                    >\n                      <Coins className=\"w-4 h-4 mr-2 text-yellow-400\" />\n                      Browse Spheres\n                    </Button>\n                  </CardFooter>\n                </Card>\n              </Link>\n\n              {/* Profile Themes */}\n              <Link href=\"/customizations\">\n                <Card className=\"bg-card/50 border-white/10 backdrop-blur-sm relative overflow-hidden hover:border-yellow-500/30 transition-colors group cursor-pointer\">\n                  <CardHeader className=\"text-center pb-2\">\n                    <div className=\"w-16 h-16 bg-gradient-to-br from-yellow-500/20 to-amber-500/20 rounded-xl flex items-center justify-center mx-auto mb-4 border border-yellow-500/20 group-hover:scale-105 transition-transform\">\n                      <Palette className=\"w-8 h-8 text-yellow-400\" />\n                    </div>\n                    <CardTitle className=\"text-xl font-bold text-white\">Profile Themes</CardTitle>\n                    <CardDescription className=\"text-xs\">Complete profile makeovers</CardDescription>\n                  </CardHeader>\n                  <CardContent className=\"text-center\">\n                    <div className=\"flex flex-wrap gap-2 justify-center mb-3\">\n                      <span className=\"w-8 h-4 rounded bg-gradient-to-r from-violet-600 via-fuchsia-500 to-pink-500\"></span>\n                      <span className=\"w-8 h-4 rounded bg-gradient-to-r from-cyan-500 via-blue-500 to-violet-500\"></span>\n                    </div>\n                    <p className=\"text-xs text-muted-foreground\">Multiple themes available</p>\n                  </CardContent>\n                  <CardFooter>\n                    <Button \n                      variant=\"outline\" \n                      className=\"w-full border-yellow-500/30 hover:bg-yellow-500/10 hover:text-yellow-400\"\n                      data-testid=\"button-browse-themes\"\n                    >\n                      <Coins className=\"w-4 h-4 mr-2 text-yellow-400\" />\n                      Browse Themes\n                    </Button>\n                  </CardFooter>\n                </Card>\n              </Link>\n            </div>\n\n            <p className=\"text-center text-xs text-muted-foreground mt-6\">\n              Pro and Elite members get exclusive access to premium customizations.\n            </p>\n          </div>\n\n        </div>\n      </main>\n      <Footer />\n    </div>\n  );\n}\n","path":null,"size_bytes":26525,"size_tokens":null},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"rounded-xl border bg-card text-card-foreground shadow\",\n      className\n    )}\n    {...props}\n  />\n))\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n))\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"font-semibold leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\n\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }\n","path":null,"size_bytes":1828,"size_tokens":null},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-9 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-300 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","path":null,"size_bytes":5124,"size_tokens":null},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","path":null,"size_bytes":1877,"size_tokens":null},"client/src/lib/api.ts":{"content":"import type { User, Battle, Comment, ChatMessage } from \"@shared/schema\";\n\nexport async function fetchLeaderboard(): Promise<User[]> {\n  const response = await fetch(\"/api/leaderboard\");\n  if (!response.ok) throw new Error(\"Failed to fetch leaderboard\");\n  return response.json();\n}\n\nexport async function fetchUser(id: number): Promise<User> {\n  const response = await fetch(`/api/users/${id}`);\n  if (!response.ok) throw new Error(\"Failed to fetch user\");\n  return response.json();\n}\n\nexport async function fetchBattles(): Promise<Battle[]> {\n  const response = await fetch(\"/api/battles\");\n  if (!response.ok) throw new Error(\"Failed to fetch battles\");\n  return response.json();\n}\n\nexport async function fetchBattle(id: number): Promise<Battle> {\n  const response = await fetch(`/api/battles/${id}`);\n  if (!response.ok) throw new Error(\"Failed to fetch battle\");\n  return response.json();\n}\n\nexport async function createBattle(data: {\n  type: string;\n  genre: string;\n  leftArtist: string;\n  leftTrack: string;\n  leftAudio: string;\n  leftUserId: number | null;\n  endsAt: Date;\n}): Promise<Battle> {\n  const response = await fetch(\"/api/battles\", {\n    method: \"POST\",\n    headers: { \"Content-Type\": \"application/json\" },\n    credentials: \"include\",\n    body: JSON.stringify({\n      ...data,\n      endsAt: data.endsAt.toISOString(),\n    }),\n  });\n  if (!response.ok) {\n    const error = await response.json();\n    throw new Error(error.error || \"Failed to create battle\");\n  }\n  return response.json();\n}\n\nexport async function joinBattle(battleId: number, userId: number, artist: string, track: string, audio: string): Promise<Battle> {\n  const response = await fetch(`/api/battles/${battleId}/join`, {\n    method: \"POST\",\n    headers: { \"Content-Type\": \"application/json\" },\n    credentials: \"include\",\n    body: JSON.stringify({ userId, artist, track, audio }),\n  });\n  if (!response.ok) {\n    const error = await response.json();\n    throw new Error(error.error || \"Failed to join battle\");\n  }\n  return response.json();\n}\n\nexport async function voteOnBattle(battleId: number, userId: number, side: \"left\" | \"right\"): Promise<void> {\n  const response = await fetch(\"/api/votes\", {\n    method: \"POST\",\n    headers: { \"Content-Type\": \"application/json\" },\n    body: JSON.stringify({ battleId, userId, side }),\n  });\n  if (!response.ok) {\n    const error = await response.json();\n    throw new Error(error.error || \"Failed to vote\");\n  }\n}\n\nexport async function fetchUserVote(battleId: number, userId: number): Promise<{ side: string } | null> {\n  const response = await fetch(`/api/votes/${battleId}/${userId}`);\n  if (!response.ok) throw new Error(\"Failed to fetch vote\");\n  return response.json();\n}\n\nexport async function fetchComments(battleId: number): Promise<Array<Comment & { userName: string; userAvatar: string }>> {\n  const response = await fetch(`/api/comments/${battleId}`);\n  if (!response.ok) throw new Error(\"Failed to fetch comments\");\n  return response.json();\n}\n\nexport async function postComment(battleId: number, userId: number, text: string): Promise<Comment> {\n  const response = await fetch(\"/api/comments\", {\n    method: \"POST\",\n    headers: { \"Content-Type\": \"application/json\" },\n    body: JSON.stringify({ battleId, userId, text }),\n  });\n  if (!response.ok) throw new Error(\"Failed to post comment\");\n  return response.json();\n}\n\nexport async function fetchChatMessages(): Promise<Array<ChatMessage & { userName: string; userAvatar: string }>> {\n  const response = await fetch(\"/api/chat\");\n  if (!response.ok) throw new Error(\"Failed to fetch chat messages\");\n  return response.json();\n}\n\nexport async function sendChatMessage(userId: number, text: string): Promise<ChatMessage> {\n  const response = await fetch(\"/api/chat\", {\n    method: \"POST\",\n    headers: { \"Content-Type\": \"application/json\" },\n    body: JSON.stringify({ userId, text }),\n  });\n  if (!response.ok) throw new Error(\"Failed to send message\");\n  return response.json();\n}\n\nexport async function followUser(followerId: number, followingId: number): Promise<void> {\n  const response = await fetch(`/api/users/${followingId}/follow`, {\n    method: \"POST\",\n    headers: { \"Content-Type\": \"application/json\" },\n    body: JSON.stringify({ followerId }),\n  });\n  if (!response.ok) throw new Error(\"Failed to follow user\");\n}\n\nexport async function unfollowUser(followerId: number, followingId: number): Promise<void> {\n  const response = await fetch(`/api/users/${followingId}/unfollow`, {\n    method: \"POST\",\n    headers: { \"Content-Type\": \"application/json\" },\n    body: JSON.stringify({ followerId }),\n  });\n  if (!response.ok) throw new Error(\"Failed to unfollow user\");\n}\n\nexport async function getFollowers(userId: number): Promise<User[]> {\n  const response = await fetch(`/api/users/${userId}/followers`);\n  if (!response.ok) throw new Error(\"Failed to fetch followers\");\n  return response.json();\n}\n\nexport async function getFollowing(userId: number): Promise<User[]> {\n  const response = await fetch(`/api/users/${userId}/following`);\n  if (!response.ok) throw new Error(\"Failed to fetch following\");\n  return response.json();\n}\n\nexport async function getNotifications(userId: number): Promise<any[]> {\n  const response = await fetch(`/api/notifications/${userId}`);\n  if (!response.ok) throw new Error(\"Failed to fetch notifications\");\n  return response.json();\n}\n\nexport async function markNotificationAsRead(notificationId: number): Promise<void> {\n  const response = await fetch(`/api/notifications/${notificationId}/read`, {\n    method: \"POST\",\n  });\n  if (!response.ok) throw new Error(\"Failed to mark notification as read\");\n}\n\nexport async function markAllNotificationsAsRead(userId: number): Promise<void> {\n  const response = await fetch(`/api/notifications/${userId}/read-all`, {\n    method: \"POST\",\n  });\n  if (!response.ok) throw new Error(\"Failed to mark all notifications as read\");\n}\n\nexport async function updateUserProfile(userId: number, profileImageUrl: string, bio: string): Promise<User> {\n  const response = await fetch(`/api/users/${userId}/profile`, {\n    method: \"PATCH\",\n    headers: { \"Content-Type\": \"application/json\" },\n    body: JSON.stringify({ profileImageUrl, bio }),\n  });\n  if (!response.ok) throw new Error(\"Failed to update profile\");\n  return response.json();\n}\n\nexport interface StripeProduct {\n  id: string;\n  name: string;\n  description: string | null;\n  metadata: Record<string, string>;\n  active: boolean;\n  prices: StripePrice[];\n}\n\nexport interface StripePrice {\n  id: string;\n  product: string;\n  unit_amount: number;\n  currency: string;\n  recurring: { interval: string } | null;\n  active: boolean;\n  metadata: Record<string, string>;\n}\n\nexport async function fetchStripeProducts(): Promise<StripeProduct[]> {\n  const response = await fetch(\"/api/stripe/products\");\n  if (!response.ok) throw new Error(\"Failed to fetch products\");\n  const data = await response.json();\n  return data.data;\n}\n\nexport async function createCheckoutSession(priceId: string, userId: number, mode: 'subscription' | 'payment'): Promise<{ url: string }> {\n  const response = await fetch(\"/api/stripe/checkout\", {\n    method: \"POST\",\n    headers: { \"Content-Type\": \"application/json\" },\n    body: JSON.stringify({ priceId, userId, mode }),\n  });\n  if (!response.ok) throw new Error(\"Failed to create checkout session\");\n  return response.json();\n}\n\nexport async function verifyPurchase(sessionId: string, userId: number): Promise<{\n  success: boolean;\n  type: string;\n  amount?: number;\n  newBalance?: number;\n  tier?: string;\n  bonusCoins?: number;\n}> {\n  const response = await fetch(\"/api/stripe/verify-purchase\", {\n    method: \"POST\",\n    headers: { \"Content-Type\": \"application/json\" },\n    body: JSON.stringify({ sessionId, userId }),\n  });\n  if (!response.ok) throw new Error(\"Failed to verify purchase\");\n  return response.json();\n}\n\nexport async function fetchUserSubscription(userId: number): Promise<{ subscription: any; membership: string }> {\n  const response = await fetch(`/api/stripe/subscription/${userId}`);\n  if (!response.ok) throw new Error(\"Failed to fetch subscription\");\n  return response.json();\n}\n\nexport async function createPortalSession(userId: number): Promise<{ url: string }> {\n  const response = await fetch(\"/api/stripe/portal\", {\n    method: \"POST\",\n    headers: { \"Content-Type\": \"application/json\" },\n    body: JSON.stringify({ userId }),\n  });\n  if (!response.ok) throw new Error(\"Failed to create portal session\");\n  return response.json();\n}\n","path":null,"size_bytes":8513,"size_tokens":null},"client/src/components/ui/empty.tsx":{"content":"import { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction Empty({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"empty\"\n      className={cn(\n        \"flex min-w-0 flex-1 flex-col items-center justify-center gap-6 text-balance rounded-lg border-dashed p-6 text-center md:p-12\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction EmptyHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"empty-header\"\n      className={cn(\n        \"flex max-w-sm flex-col items-center gap-2 text-center\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nconst emptyMediaVariants = cva(\n  \"mb-2 flex shrink-0 items-center justify-center [&_svg]:pointer-events-none [&_svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        icon: \"bg-muted text-foreground flex size-10 shrink-0 items-center justify-center rounded-lg [&_svg:not([class*='size-'])]:size-6\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nfunction EmptyMedia({\n  className,\n  variant = \"default\",\n  ...props\n}: React.ComponentProps<\"div\"> & VariantProps<typeof emptyMediaVariants>) {\n  return (\n    <div\n      data-slot=\"empty-icon\"\n      data-variant={variant}\n      className={cn(emptyMediaVariants({ variant, className }))}\n      {...props}\n    />\n  )\n}\n\nfunction EmptyTitle({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"empty-title\"\n      className={cn(\"text-lg font-medium tracking-tight\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction EmptyDescription({ className, ...props }: React.ComponentProps<\"p\">) {\n  return (\n    <div\n      data-slot=\"empty-description\"\n      className={cn(\n        \"text-muted-foreground [&>a:hover]:text-primary text-sm/relaxed [&>a]:underline [&>a]:underline-offset-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction EmptyContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"empty-content\"\n      className={cn(\n        \"flex w-full min-w-0 max-w-sm flex-col items-center gap-4 text-balance text-sm\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Empty,\n  EmptyHeader,\n  EmptyTitle,\n  EmptyDescription,\n  EmptyContent,\n  EmptyMedia,\n}\n","path":null,"size_bytes":2396,"size_tokens":null},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","path":null,"size_bytes":1148,"size_tokens":null},"client/src/components/ui/item.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Separator } from \"@/components/ui/separator\"\n\nfunction ItemGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      role=\"list\"\n      data-slot=\"item-group\"\n      className={cn(\"group/item-group flex flex-col\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction ItemSeparator({\n  className,\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"item-separator\"\n      orientation=\"horizontal\"\n      className={cn(\"my-0\", className)}\n      {...props}\n    />\n  )\n}\n\nconst itemVariants = cva(\n  \"group/item [a]:hover:bg-accent/50 focus-visible:border-ring focus-visible:ring-ring/50 [a]:transition-colors flex flex-wrap items-center rounded-md border border-transparent text-sm outline-none transition-colors duration-100 focus-visible:ring-[3px]\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline: \"border-border\",\n        muted: \"bg-muted/50\",\n      },\n      size: {\n        default: \"gap-4 p-4 \",\n        sm: \"gap-2.5 px-4 py-3\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction Item({\n  className,\n  variant = \"default\",\n  size = \"default\",\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> &\n  VariantProps<typeof itemVariants> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"div\"\n  return (\n    <Comp\n      data-slot=\"item\"\n      data-variant={variant}\n      data-size={size}\n      className={cn(itemVariants({ variant, size, className }))}\n      {...props}\n    />\n  )\n}\n\nconst itemMediaVariants = cva(\n  \"flex shrink-0 items-center justify-center gap-2 group-has-[[data-slot=item-description]]/item:translate-y-0.5 group-has-[[data-slot=item-description]]/item:self-start [&_svg]:pointer-events-none\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        icon: \"bg-muted size-8 rounded-sm border [&_svg:not([class*='size-'])]:size-4\",\n        image:\n          \"size-10 overflow-hidden rounded-sm [&_img]:size-full [&_img]:object-cover\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nfunction ItemMedia({\n  className,\n  variant = \"default\",\n  ...props\n}: React.ComponentProps<\"div\"> & VariantProps<typeof itemMediaVariants>) {\n  return (\n    <div\n      data-slot=\"item-media\"\n      data-variant={variant}\n      className={cn(itemMediaVariants({ variant, className }))}\n      {...props}\n    />\n  )\n}\n\nfunction ItemContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"item-content\"\n      className={cn(\n        \"flex flex-1 flex-col gap-1 [&+[data-slot=item-content]]:flex-none\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction ItemTitle({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"item-title\"\n      className={cn(\n        \"flex w-fit items-center gap-2 text-sm font-medium leading-snug\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction ItemDescription({ className, ...props }: React.ComponentProps<\"p\">) {\n  return (\n    <p\n      data-slot=\"item-description\"\n      className={cn(\n        \"text-muted-foreground line-clamp-2 text-balance text-sm font-normal leading-normal\",\n        \"[&>a:hover]:text-primary [&>a]:underline [&>a]:underline-offset-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction ItemActions({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"item-actions\"\n      className={cn(\"flex items-center gap-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction ItemHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"item-header\"\n      className={cn(\n        \"flex basis-full items-center justify-between gap-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction ItemFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"item-footer\"\n      className={cn(\n        \"flex basis-full items-center justify-between gap-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Item,\n  ItemMedia,\n  ItemContent,\n  ItemActions,\n  ItemGroup,\n  ItemSeparator,\n  ItemTitle,\n  ItemDescription,\n  ItemHeader,\n  ItemFooter,\n}\n","path":null,"size_bytes":4494,"size_tokens":null},"client/src/components/ui/button-group.tsx":{"content":"import { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Separator } from \"@/components/ui/separator\"\n\nconst buttonGroupVariants = cva(\n  \"flex w-fit items-stretch has-[>[data-slot=button-group]]:gap-2 [&>*]:focus-visible:relative [&>*]:focus-visible:z-10 has-[select[aria-hidden=true]:last-child]:[&>[data-slot=select-trigger]:last-of-type]:rounded-r-md [&>[data-slot=select-trigger]:not([class*='w-'])]:w-fit [&>input]:flex-1\",\n  {\n    variants: {\n      orientation: {\n        horizontal:\n          \"[&>*:not(:first-child)]:rounded-l-none [&>*:not(:first-child)]:border-l-0 [&>*:not(:last-child)]:rounded-r-none\",\n        vertical:\n          \"flex-col [&>*:not(:first-child)]:rounded-t-none [&>*:not(:first-child)]:border-t-0 [&>*:not(:last-child)]:rounded-b-none\",\n      },\n    },\n    defaultVariants: {\n      orientation: \"horizontal\",\n    },\n  }\n)\n\nfunction ButtonGroup({\n  className,\n  orientation,\n  ...props\n}: React.ComponentProps<\"div\"> & VariantProps<typeof buttonGroupVariants>) {\n  return (\n    <div\n      role=\"group\"\n      data-slot=\"button-group\"\n      data-orientation={orientation}\n      className={cn(buttonGroupVariants({ orientation }), className)}\n      {...props}\n    />\n  )\n}\n\nfunction ButtonGroupText({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  asChild?: boolean\n}) {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      className={cn(\n        \"bg-muted shadow-xs flex items-center gap-2 rounded-md border px-4 text-sm font-medium [&_svg:not([class*='size-'])]:size-4 [&_svg]:pointer-events-none\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction ButtonGroupSeparator({\n  className,\n  orientation = \"vertical\",\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"button-group-separator\"\n      orientation={orientation}\n      className={cn(\n        \"bg-input relative !m-0 self-stretch data-[orientation=vertical]:h-auto\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  ButtonGroup,\n  ButtonGroupSeparator,\n  ButtonGroupText,\n  buttonGroupVariants,\n}\n","path":null,"size_bytes":2209,"size_tokens":null},"client/src/pages/Artists.tsx":{"content":"import { Navbar } from \"@/components/layout/Navbar\";\nimport { Footer } from \"@/components/layout/Footer\";\nimport { Button } from \"@/components/ui/button\";\nimport { Mic, UserPlus, User, UserCheck, Loader2, Crown, Star } from \"lucide-react\";\nimport { Link } from \"wouter\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useUser } from \"@/context/UserContext\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport type { User as UserType } from \"@shared/schema\";\n\nasync function fetchArtists(): Promise<UserType[]> {\n  const response = await fetch(\"/api/users/role/artist\");\n  if (!response.ok) throw new Error(\"Failed to fetch artists\");\n  return response.json();\n}\n\nasync function checkFollowStatus(userId: number): Promise<boolean> {\n  const response = await fetch(`/api/follow/${userId}/status`, {\n    credentials: \"include\",\n  });\n  if (!response.ok) return false;\n  const data = await response.json();\n  return data.isFollowing;\n}\n\nfunction MembershipBadge({ membership }: { membership: string }) {\n  if (membership === \"elite\") {\n    return (\n      <div className=\"flex items-center gap-1 px-2 py-0.5 bg-sv-gold/20 border border-sv-gold/50 rounded text-sv-gold text-xs font-bold\">\n        <Crown className=\"w-3 h-3\" />\n        ELITE\n      </div>\n    );\n  }\n  if (membership === \"pro\") {\n    return (\n      <div className=\"flex items-center gap-1 px-2 py-0.5 bg-sv-purple/20 border border-sv-purple/50 rounded text-sv-purple text-xs font-bold\">\n        <Star className=\"w-3 h-3\" />\n        PRO\n      </div>\n    );\n  }\n  return null;\n}\n\nfunction ArtistCard({ artist, currentUserId }: { artist: UserType; currentUserId?: number }) {\n  const queryClient = useQueryClient();\n  const { toast } = useToast();\n\n  const { data: isFollowing = false } = useQuery({\n    queryKey: [\"followStatus\", artist.id],\n    queryFn: () => checkFollowStatus(artist.id),\n    enabled: !!currentUserId && currentUserId !== artist.id,\n  });\n\n  const followMutation = useMutation({\n    mutationFn: async () => {\n      const response = await fetch(`/api/follow/${artist.id}`, {\n        method: \"POST\",\n        credentials: \"include\",\n      });\n      if (!response.ok) throw new Error(\"Failed to follow\");\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"followStatus\", artist.id] });\n      toast({ title: \"Followed!\", description: `You are now following ${artist.name}` });\n    },\n  });\n\n  const unfollowMutation = useMutation({\n    mutationFn: async () => {\n      const response = await fetch(`/api/follow/${artist.id}`, {\n        method: \"DELETE\",\n        credentials: \"include\",\n      });\n      if (!response.ok) throw new Error(\"Failed to unfollow\");\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"followStatus\", artist.id] });\n      toast({ title: \"Unfollowed\", description: `You unfollowed ${artist.name}` });\n    },\n  });\n\n  const handleFollowClick = () => {\n    if (!currentUserId) {\n      toast({ title: \"Login Required\", description: \"Please login to follow artists\", variant: \"destructive\" });\n      return;\n    }\n    if (isFollowing) {\n      unfollowMutation.mutate();\n    } else {\n      followMutation.mutate();\n    }\n  };\n\n  return (\n    <div className=\"bg-card/50 border border-white/5 rounded-xl p-6 hover:border-fuchsia-500/30 transition-all group relative overflow-hidden\" data-testid={`artist-card-${artist.id}`}>\n      <div className=\"absolute inset-0 bg-gradient-to-b from-fuchsia-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity\" />\n      \n      <div className=\"relative z-10 flex items-center gap-4\">\n        <div className=\"relative\">\n          <img \n            src={artist.profileImageUrl || \"https://github.com/shadcn.png\"} \n            alt={artist.name || \"Artist\"} \n            className=\"w-16 h-16 rounded-full border-2 border-white/10 group-hover:border-fuchsia-500 transition-colors object-cover\" \n          />\n          <div className=\"absolute -top-1 -right-1 w-5 h-5 bg-fuchsia-500 rounded-full flex items-center justify-center border border-black\">\n            <Mic className=\"w-3 h-3 text-white\" />\n          </div>\n        </div>\n        \n        <div className=\"flex-grow min-w-0\">\n          <div className=\"flex items-center gap-2 flex-wrap\">\n            <h3 className=\"font-bold text-white text-lg group-hover:text-fuchsia-400 transition-colors truncate\">\n              {artist.name || \"Unknown Artist\"}\n            </h3>\n            <MembershipBadge membership={artist.membership} />\n          </div>\n          <p className=\"text-sm text-muted-foreground\">Level {artist.level}  {artist.wins} wins</p>\n        </div>\n\n        {currentUserId !== artist.id && (\n          <Button \n            size=\"icon\" \n            variant=\"ghost\" \n            className={isFollowing ? \"text-fuchsia-400\" : \"text-muted-foreground hover:text-white\"}\n            onClick={handleFollowClick}\n            disabled={followMutation.isPending || unfollowMutation.isPending}\n            data-testid={`button-follow-${artist.id}`}\n          >\n            {isFollowing ? <UserCheck className=\"w-5 h-5\" /> : <UserPlus className=\"w-5 h-5\" />}\n          </Button>\n        )}\n      </div>\n\n      <div className=\"mt-6 flex items-center justify-between border-t border-white/5 pt-4\">\n        <span className=\"text-xs font-medium text-muted-foreground\">{artist.xp} XP</span>\n        <Button \n          size=\"sm\" \n          variant=\"outline\" \n          className=\"h-8 border-white/10 hover:bg-fuchsia-500/20 hover:text-fuchsia-400 hover:border-fuchsia-500/50 text-xs\"\n          data-testid={`button-view-artist-${artist.id}`}\n          asChild\n        >\n          <Link href={`/user/${artist.id}`}>\n            <User className=\"w-3 h-3 mr-2\" /> View Profile\n          </Link>\n        </Button>\n      </div>\n    </div>\n  );\n}\n\nexport default function Artists() {\n  const { user } = useUser();\n\n  const { data: artists = [], isLoading } = useQuery({\n    queryKey: [\"artists\"],\n    queryFn: fetchArtists,\n  });\n\n  return (\n    <div className=\"min-h-screen bg-background flex flex-col\">\n      <Navbar />\n      <main className=\"flex-grow pt-24 pb-20\">\n        <div className=\"container mx-auto px-4\">\n          <div className=\"text-center max-w-2xl mx-auto mb-16\">\n            <h1 className=\"text-4xl md:text-6xl font-bold font-heading text-white mb-4\">Featured Artists</h1>\n            <p className=\"text-muted-foreground text-lg\">\n              Discover the best vocalists, rappers, and songwriters battling for the top spot.\n            </p>\n          </div>\n\n          {isLoading ? (\n            <div className=\"flex justify-center py-12\">\n              <Loader2 className=\"w-8 h-8 animate-spin text-fuchsia-500\" />\n            </div>\n          ) : artists.length === 0 ? (\n            <div className=\"text-center py-12\">\n              <p className=\"text-muted-foreground\">No artists found yet. Be the first to join!</p>\n            </div>\n          ) : (\n            <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6\">\n              {artists.map((artist) => (\n                <ArtistCard key={artist.id} artist={artist} currentUserId={user?.id} />\n              ))}\n            </div>\n          )}\n        </div>\n      </main>\n      <Footer />\n    </div>\n  );\n}\n","path":null,"size_bytes":7295,"size_tokens":null},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverAnchor = PopoverPrimitive.Anchor\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent, PopoverAnchor }\n","path":null,"size_bytes":1342,"size_tokens":null},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","path":null,"size_bytes":756,"size_tokens":null},"client/src/pages/BattleDetail.tsx":{"content":"import { Navbar } from \"@/components/layout/Navbar\";\nimport { Footer } from \"@/components/layout/Footer\";\nimport { Button } from \"@/components/ui/button\";\nimport { Avatar, AvatarImage, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Heart, MessageCircle, Clock, Loader2 } from \"lucide-react\";\nimport { useState, useCallback } from \"react\";\nimport { AudioReactiveSphere } from \"@/components/battle/AudioReactiveSphere\";\nimport { AudioPlayer } from \"@/components/battle/AudioPlayer\";\nimport { ProfileCard } from \"@/components/battle/ProfileCard\";\nimport { motion } from \"framer-motion\";\nimport { useRoute } from \"wouter\";\nimport { cn } from \"@/lib/utils\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { fetchBattle, fetchUserVote, voteOnBattle, fetchComments, postComment, fetchUser } from \"@/lib/api\";\nimport { useUser } from \"@/context/UserContext\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useSoundEffects } from \"@/hooks/useSoundEffects\";\n\nexport default function BattleDetail() {\n  const [, params] = useRoute(\"/battle/:id\");\n  const battleId = parseInt(params?.id || \"0\");\n  const [playing, setPlaying] = useState<\"left\" | \"right\" | null>(null);\n  const [commentText, setCommentText] = useState(\"\");\n  const { user } = useUser();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const { playSound } = useSoundEffects();\n\n  const { data: battle, isLoading: battleLoading } = useQuery({\n    queryKey: [\"battle\", battleId],\n    queryFn: () => fetchBattle(battleId),\n  });\n\n  const { data: userVote } = useQuery({\n    queryKey: [\"vote\", battleId, user?.id],\n    queryFn: () => user ? fetchUserVote(battleId, user.id) : null,\n    enabled: !!user,\n  });\n\n  const { data: comments } = useQuery({\n    queryKey: [\"comments\", battleId],\n    queryFn: () => fetchComments(battleId),\n    refetchInterval: 5000,\n  });\n\n  const { data: leftUser } = useQuery({\n    queryKey: [\"user\", battle?.leftUserId],\n    queryFn: () => battle?.leftUserId ? fetchUser(battle.leftUserId) : null,\n    enabled: !!battle?.leftUserId,\n  });\n\n  const { data: rightUser } = useQuery({\n    queryKey: [\"user\", battle?.rightUserId],\n    queryFn: () => battle?.rightUserId ? fetchUser(battle.rightUserId) : null,\n    enabled: !!battle?.rightUserId,\n  });\n\n  const voteMutation = useMutation({\n    mutationFn: (side: \"left\" | \"right\") => voteOnBattle(battleId, user!.id, side),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"battle\", battleId] });\n      queryClient.invalidateQueries({ queryKey: [\"vote\", battleId, user?.id] });\n      playSound(\"vote\");\n      toast({\n        title: \"Vote Recorded!\",\n        description: \"Your vote has been counted.\",\n      });\n    },\n    onError: (error: any) => {\n      playSound(\"error\");\n      toast({\n        title: \"Vote Failed\",\n        description: error.message || \"Could not record vote\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const commentMutation = useMutation({\n    mutationFn: (text: string) => postComment(battleId, user!.id, text),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"comments\", battleId] });\n      setCommentText(\"\");\n      playSound(\"success\");\n      toast({\n        title: \"Comment Posted!\",\n      });\n    },\n    onError: () => {\n      playSound(\"error\");\n      toast({\n        title: \"Failed to post comment\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleVote = (side: \"left\" | \"right\") => {\n    if (!user) {\n      toast({\n        title: \"Login Required\",\n        description: \"Please login to vote\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    voteMutation.mutate(side);\n  };\n\n  const handleLeftPlayStateChange = useCallback((isPlaying: boolean) => {\n    if (isPlaying) {\n      setPlaying(\"left\");\n    } else if (playing === \"left\") {\n      setPlaying(null);\n    }\n  }, [playing]);\n\n  const handleRightPlayStateChange = useCallback((isPlaying: boolean) => {\n    if (isPlaying) {\n      setPlaying(\"right\");\n    } else if (playing === \"right\") {\n      setPlaying(null);\n    }\n  }, [playing]);\n\n  const handleComment = () => {\n    if (!user) {\n      toast({\n        title: \"Login Required\",\n        description: \"Please login to comment\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    if (!commentText.trim()) return;\n    commentMutation.mutate(commentText);\n  };\n\n  if (battleLoading || !battle) {\n    return (\n      <div className=\"min-h-screen bg-background flex flex-col\">\n        <Navbar />\n        <main className=\"flex-grow pt-24 pb-20 flex items-center justify-center\">\n          <Loader2 className=\"w-8 h-8 animate-spin text-violet-500\" />\n        </main>\n        <Footer />\n      </div>\n    );\n  }\n\n  // Calculate time left\n  const now = new Date();\n  const endsAt = battle.endsAt ? new Date(battle.endsAt) : new Date(now.getTime() + 48 * 60 * 60 * 1000);\n  const timeLeft = Math.max(0, endsAt.getTime() - now.getTime());\n  const hours = Math.floor(timeLeft / (1000 * 60 * 60));\n  const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));\n  const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);\n  const timeLeftStr = `${hours.toString().padStart(2, \"0\")}:${minutes.toString().padStart(2, \"0\")}:${seconds.toString().padStart(2, \"0\")}`;\n\n  const totalVotes = battle.leftVotes + battle.rightVotes;\n  const leftPercent = totalVotes > 0 ? (battle.leftVotes / totalVotes) * 100 : 50;\n  const rightPercent = totalVotes > 0 ? (battle.rightVotes / totalVotes) * 100 : 50;\n\n  const voted = userVote?.side as \"left\" | \"right\" | null | undefined;\n\n  return (\n    <div className=\"min-h-screen bg-background flex flex-col\">\n      <Navbar />\n      \n      <main className=\"flex-grow pt-24 pb-20\">\n        <div className=\"container mx-auto px-4\">\n          \n          {/* Battle Header */}\n          <div className=\"text-center mb-12\">\n            <div className=\"inline-flex items-center gap-2 px-3 py-1 rounded-full bg-red-500/10 border border-red-500/20 text-red-400 text-sm font-bold mb-4\">\n              <Clock className=\"w-3 h-3\" /> Ends in {timeLeftStr}\n            </div>\n            <h1 className=\"text-3xl md:text-5xl font-bold font-heading text-white mb-2\">\n              {battle.leftArtist} vs {battle.rightArtist || \"TBD\"}\n            </h1>\n            <p className=\"text-muted-foreground uppercase tracking-widest text-sm font-medium\">\n              {battle.type === \"beat\" ? \"Beat Battle\" : \"Song Battle\"}\n            </p>\n          </div>\n\n          {/* The Arena */}\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-20 max-w-6xl mx-auto relative mb-20\">\n            \n            {/* VS Element */}\n            <div className=\"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-10 hidden lg:flex flex-col items-center justify-center\">\n              <div className=\"w-20 h-20 rounded-full bg-black border-4 border-background shadow-2xl shadow-violet-500/20 flex items-center justify-center z-20\">\n                <span className=\"font-black font-heading italic text-white text-2xl\">VS</span>\n              </div>\n              <div className=\"h-full w-px bg-white/5 absolute top-0 bottom-0 -z-10\" />\n            </div>\n\n            {/* Left Contender */}\n            <div className=\"flex flex-col gap-6\">\n              {leftUser && (\n                <ProfileCard\n                  userId={leftUser.id}\n                  name={leftUser.name || battle.leftArtist}\n                  avatar={leftUser.profileImageUrl}\n                  role={leftUser.role || \"artist\"}\n                  level={leftUser.level || 1}\n                  xp={leftUser.xp || 0}\n                  wins={leftUser.wins || 0}\n                  membership={leftUser.membership || \"free\"}\n                  foundersBadge={leftUser.foundersBadge || false}\n                  side=\"left\"\n                  isWinner={battle.status === \"completed\" && battle.leftVotes > battle.rightVotes}\n                />\n              )}\n              \n              <div className=\"relative aspect-square flex items-center justify-center overflow-hidden rounded-2xl\">\n                <AudioReactiveSphere \n                  isPlaying={playing === \"left\"}\n                  color=\"cyan\"\n                  size={280}\n                />\n              </div>\n              \n              {battle.leftAudio && (\n                <AudioPlayer\n                  audioUrl={battle.leftAudio}\n                  trackName={battle.leftTrack}\n                  artistName={battle.leftArtist}\n                  color=\"cyan\"\n                  isPlaying={playing === \"left\"}\n                  onPlayStateChange={handleLeftPlayStateChange}\n                />\n              )}\n\n              <div className=\"flex items-center justify-center mt-4\">\n                <Button \n                  size=\"lg\" \n                  className={cn(\n                    \"rounded-full font-bold text-md px-8 transition-all\",\n                    voted === \"left\" ? \"bg-violet-500 text-white\" : \"bg-white/5 hover:bg-violet-500/20 text-white border border-white/10\"\n                  )}\n                  onClick={() => handleVote(\"left\")}\n                  disabled={!!voted}\n                  data-testid=\"button-vote-left\"\n                >\n                  <Heart className={cn(\"w-5 h-5 mr-2\", voted === \"left\" && \"fill-current\")} />\n                  {voted === \"left\" ? \"Voted\" : \"Vote\"}\n                </Button>\n              </div>\n            </div>\n\n            {/* Right Contender */}\n            <div className=\"flex flex-col gap-6\">\n              {rightUser && (\n                <ProfileCard\n                  userId={rightUser.id}\n                  name={rightUser.name || battle.rightArtist || \"Unknown\"}\n                  avatar={rightUser.profileImageUrl}\n                  role={rightUser.role || \"artist\"}\n                  level={rightUser.level || 1}\n                  xp={rightUser.xp || 0}\n                  wins={rightUser.wins || 0}\n                  membership={rightUser.membership || \"free\"}\n                  foundersBadge={rightUser.foundersBadge || false}\n                  side=\"right\"\n                  isWinner={battle.status === \"completed\" && battle.rightVotes > battle.leftVotes}\n                />\n              )}\n              \n              <div className=\"relative aspect-square flex items-center justify-center overflow-hidden rounded-2xl\">\n                <AudioReactiveSphere \n                  isPlaying={playing === \"right\"}\n                  color=\"fuchsia\"\n                  size={280}\n                />\n              </div>\n              \n              {battle.rightAudio ? (\n                <AudioPlayer\n                  audioUrl={battle.rightAudio}\n                  trackName={battle.rightTrack || \"Unknown Track\"}\n                  artistName={battle.rightArtist || \"Unknown Artist\"}\n                  color=\"fuchsia\"\n                  isPlaying={playing === \"right\"}\n                  onPlayStateChange={handleRightPlayStateChange}\n                />\n              ) : (\n                <div className=\"bg-black/40 backdrop-blur-sm border border-white/10 rounded-xl p-4 text-center\">\n                  <p className=\"text-gray-400\">Waiting for opponent to join...</p>\n                </div>\n              )}\n\n              <div className=\"flex items-center justify-center mt-4\">\n                <Button \n                  size=\"lg\" \n                  className={cn(\n                    \"rounded-full font-bold text-md px-8 transition-all\",\n                    voted === \"right\" ? \"bg-fuchsia-500 text-white\" : \"bg-white/5 hover:bg-fuchsia-500/20 text-white border border-white/10\"\n                  )}\n                  onClick={() => handleVote(\"right\")}\n                  disabled={!!voted || !battle.rightArtist}\n                  data-testid=\"button-vote-right\"\n                >\n                  <Heart className={cn(\"w-5 h-5 mr-2\", voted === \"right\" && \"fill-current\")} />\n                  {voted === \"right\" ? \"Voted\" : \"Vote\"}\n                </Button>\n              </div>\n            </div>\n          </div>\n\n          {/* Live Stats Bar */}\n          <div className=\"max-w-4xl mx-auto mb-20\">\n            <div className=\"flex justify-between text-sm font-bold mb-3\">\n              <span className=\"text-violet-400\">{battle.leftVotes.toLocaleString()} Votes</span>\n              <span className=\"text-fuchsia-400\">{battle.rightVotes.toLocaleString()} Votes</span>\n            </div>\n            <div className=\"h-4 w-full bg-white/5 rounded-full overflow-hidden flex relative\">\n              <motion.div \n                initial={{ width: \"50%\" }}\n                animate={{ width: `${leftPercent}%` }}\n                className=\"h-full bg-violet-500 relative\"\n              >\n                 <div className=\"absolute right-0 top-0 bottom-0 w-0.5 bg-white/50 shadow-[0_0_10px_rgba(255,255,255,0.8)]\" />\n              </motion.div>\n              <motion.div \n                initial={{ width: \"50%\" }}\n                animate={{ width: `${rightPercent}%` }}\n                className=\"h-full bg-fuchsia-500\"\n              />\n            </div>\n          </div>\n\n          {/* Comments Section */}\n          <div className=\"max-w-3xl mx-auto\">\n            <h3 className=\"text-2xl font-bold font-heading text-white mb-6 flex items-center gap-2\">\n              <MessageCircle className=\"w-6 h-6\" />\n              Battle Chat\n            </h3>\n            \n            <div className=\"bg-card/50 border border-white/5 rounded-xl p-6 backdrop-blur-sm mb-8\">\n              <div className=\"flex gap-4 mb-6\">\n                <Avatar>\n                   <AvatarImage src={user?.profileImageUrl || undefined} />\n                   <AvatarFallback>{user?.name?.[0] || \"?\"}</AvatarFallback>\n                </Avatar>\n                <div className=\"flex-grow\">\n                   <Textarea \n                     placeholder={user ? \"Join the discussion...\" : \"Login to comment\"}\n                     className=\"bg-black/20 border-white/10 min-h-[80px] mb-2 focus-visible:ring-violet-500\"\n                     value={commentText}\n                     onChange={(e) => setCommentText(e.target.value)}\n                     disabled={!user}\n                     data-testid=\"input-comment\"\n                   />\n                   <div className=\"flex justify-end\">\n                     <Button \n                       size=\"sm\" \n                       className=\"bg-white text-black hover:bg-white/90 font-bold\"\n                       onClick={handleComment}\n                       disabled={!user || !commentText.trim()}\n                       data-testid=\"button-post-comment\"\n                     >\n                       Post Comment\n                     </Button>\n                   </div>\n                </div>\n              </div>\n\n              <div className=\"space-y-6\">\n                {(comments || []).map((comment) => {\n                  const time = new Date(comment.createdAt);\n                  const now = new Date();\n                  const diff = Math.floor((now.getTime() - time.getTime()) / 1000);\n                  const timeAgo = diff < 60 ? `${diff}s ago` : diff < 3600 ? `${Math.floor(diff / 60)}m ago` : `${Math.floor(diff / 3600)}h ago`;\n\n                  return (\n                    <div key={comment.id} className=\"flex gap-4 animate-in fade-in slide-in-from-bottom-4 duration-500\" data-testid={`comment-${comment.id}`}>\n                      <Avatar className=\"w-10 h-10 border border-white/10\">\n                        <AvatarImage src={comment.userAvatar} />\n                        <AvatarFallback>{comment.userName[0]}</AvatarFallback>\n                      </Avatar>\n                      <div>\n                        <div className=\"flex items-center gap-2 mb-1\">\n                          <span className=\"font-bold text-white text-sm\">{comment.userName}</span>\n                          <span className=\"text-xs text-muted-foreground\">{timeAgo}</span>\n                        </div>\n                        <p className=\"text-sm text-muted-foreground leading-relaxed\">{comment.text}</p>\n                      </div>\n                    </div>\n                  );\n                })}\n              </div>\n            </div>\n          </div>\n\n        </div>\n      </main>\n      <Footer />\n    </div>\n  );\n}\n","path":null,"size_bytes":16387,"size_tokens":null},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-4 w-4 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","path":null,"size_bytes":7406,"size_tokens":null},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500 data-[state=open]:animate-in data-[state=closed]:animate-out\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4 border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n      {children}\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","path":null,"size_bytes":4280,"size_tokens":null},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"px-2 py-1.5 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute right-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","path":null,"size_bytes":5745,"size_tokens":null},"client/src/components/ui/command.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-10 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected=true]:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","path":null,"size_bytes":4887,"size_tokens":null},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","path":null,"size_bytes":4419,"size_tokens":null},"server/db.ts":{"content":"import { Pool, neonConfig } from '@neondatabase/serverless';\nimport { drizzle } from 'drizzle-orm/neon-serverless';\nimport ws from \"ws\";\nimport * as schema from \"@shared/schema\";\n\nneonConfig.webSocketConstructor = ws;\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\n    \"DATABASE_URL must be set. Did you forget to provision a database?\",\n  );\n}\n\nexport const pool = new Pool({ connectionString: process.env.DATABASE_URL });\nexport const db = drizzle({ client: pool, schema });\n","path":null,"size_bytes":483,"size_tokens":null},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":711,"size_tokens":null},"replit.md":{"content":"# SongVersus - Music Battle Platform\n\n## Overview\n\nSongVersus is a competitive music platform where producers and artists can battle against each other by uploading tracks and letting the community vote on winners. The application features real-time battles, a leaderboard system, virtual currency (coins), chat functionality, and gamification elements like a slot machine mini-game.\n\n## User Preferences\n\nPreferred communication style: Simple, everyday language.\n\n## System Architecture\n\n### Frontend Architecture\n\nThe frontend is built with **React** using **TypeScript** and **Vite** as the build tool. The application uses a component-based architecture with the following key decisions:\n\n**UI Framework**: Uses shadcn/ui components (Radix UI primitives) with Tailwind CSS for styling. The design system follows a \"New York\" style variant with extensive customization for a dark, futuristic music platform aesthetic.\n\n**Routing**: Implements client-side routing with `wouter`, a lightweight alternative to React Router. Routes are defined in `App.tsx` and include pages for battles, leaderboard, artists, producers, store, profile, and settings.\n\n**State Management**: \n- Uses React Context (`UserContext`) for global user state management\n- TanStack Query (React Query) for server state management, caching, and data synchronization\n- Local state with React hooks for component-level state\n\n**Animation**: Framer Motion is used for animations and transitions throughout the UI, particularly in battle cards and interactive elements. Mobile devices have reduced animations for performance (using `useShouldReduceMotion` hook).\n\n**Sound Effects**: Customizable sound effects system using Web Audio API with synthesized sounds (no audio files needed):\n- Hook: `useSoundEffects` in `client/src/hooks/useSoundEffects.ts`\n- Settings stored in localStorage under `songversus_sound_settings`\n- 10 different sound effects: battleStart, battleEnd, vote, chatMessage, notification, levelUp, coinEarn, buttonClick, success, error\n- Master volume control and individual effect toggles in Settings page\n\n**Authentication**: Simple authentication system stored in localStorage. User credentials are managed through the `UserContext` provider, with login/signup handled via API calls.\n\n### Backend Architecture\n\nThe backend is an **Express.js** server written in TypeScript with the following design:\n\n**Server Structure**: \n- Entry point at `server/index.ts` sets up Express middleware and HTTP server\n- Routes defined in `server/routes.ts` handle all API endpoints\n- Static file serving configured in `server/static.ts` for production builds\n- Development mode uses Vite middleware (`server/vite.ts`) for hot module replacement\n\n**API Design**: RESTful API endpoints organized by resource:\n- `/api/auth/*` - User authentication (signup, login)\n- `/api/battles/*` - Battle CRUD operations\n- `/api/votes/*` - Voting functionality\n- `/api/comments/*` - Battle comments\n- `/api/chat/*` - Global chat messages\n- `/api/leaderboard` - User rankings\n\n**Data Access Layer**: Abstracted through a storage interface (`IStorage`) implemented by `DatabaseStorage` class. This provides methods for all database operations and allows for potential future storage implementations.\n\n**Validation**: Uses Zod schemas (from `drizzle-zod`) for runtime validation of incoming request data, with helpful error messages via `zod-validation-error`.\n\n### Data Storage\n\n**Database**: PostgreSQL via **Neon Database** (serverless Postgres)\n\n**ORM**: **Drizzle ORM** with the following schema design:\n\n- **users** table: Stores user profiles with name, role (producer/artist), coins, XP, wins, avatar, and password\n- **battles** table: Tracks battles with left/right contestants, vote counts, status, and timestamps\n- **votes** table: Records individual user votes on battles\n- **comments** table: Stores user comments on battles\n- **chatMessages** table: Global chat messages\n\n**Schema Management**: Uses Drizzle Kit for migrations, with schema defined in `shared/schema.ts` and migration configuration in `drizzle.config.ts`.\n\n**Connection Pooling**: Uses `@neondatabase/serverless` with WebSocket connections for optimal serverless performance.\n\n### Build System\n\n**Development**:\n- Vite dev server runs on port 5000 for frontend\n- tsx runs the Express server with hot reload\n- Concurrent development of frontend and backend\n\n**Production**:\n- Frontend built with Vite to `dist/public`\n- Backend bundled with esbuild to `dist/index.cjs`\n- Selective bundling: critical dependencies are bundled, others externalized to reduce cold start times\n- Static assets served by Express in production\n\n**Path Aliases**: Configured in both `tsconfig.json` and `vite.config.ts`:\n- `@/*`  `client/src/*`\n- `@shared/*`  `shared/*`\n- `@assets/*`  `attached_assets/*`\n\n## External Dependencies\n\n### Core Framework Dependencies\n- **React 18**: UI framework\n- **Express**: Backend web framework\n- **TypeScript**: Type safety across the stack\n- **Vite**: Frontend build tool and dev server\n\n### Database & ORM\n- **@neondatabase/serverless**: Serverless PostgreSQL client\n- **drizzle-orm**: TypeScript ORM\n- **drizzle-zod**: Zod schema generation from Drizzle schemas\n- **ws**: WebSocket library for Neon database connections\n\n### UI Component Libraries\n- **@radix-ui/react-***: Headless UI components (accordion, alert-dialog, avatar, checkbox, dialog, dropdown-menu, popover, scroll-area, select, separator, slider, switch, tabs, toast, tooltip, etc.)\n- **tailwindcss**: Utility-first CSS framework\n- **@tailwindcss/vite**: Vite plugin for Tailwind CSS v4\n- **lucide-react**: Icon library\n- **cmdk**: Command menu component\n- **embla-carousel-react**: Carousel component\n\n### Animation & Interactivity\n- **framer-motion**: Animation library\n- **class-variance-authority**: CSS variant management\n- **clsx** / **tailwind-merge**: Utility for conditional className joining\n\n### Data Fetching & Forms\n- **@tanstack/react-query**: Server state management\n- **@hookform/resolvers**: Form validation resolvers\n- **zod**: Schema validation\n- **zod-validation-error**: User-friendly Zod error messages\n\n### Routing\n- **wouter**: Lightweight client-side routing\n\n### Utilities\n- **date-fns**: Date manipulation\n- **nanoid**: Unique ID generation\n\n### Development Tools\n- **@replit/vite-plugin-***: Replit-specific Vite plugins for development banners, error modals, and cartographer\n- Custom `vite-plugin-meta-images.ts`: Updates OpenGraph meta tags with Replit deployment URLs\n\n### Build Tools\n- **esbuild**: Fast JavaScript bundler for server code\n- **tsx**: TypeScript execution for development","path":null,"size_bytes":6643,"size_tokens":null},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","path":null,"size_bytes":329,"size_tokens":null},"client/src/components/battle/AudioOrb.tsx":{"content":"import { motion } from \"framer-motion\";\nimport { cn } from \"@/lib/utils\";\nimport { useState, useEffect } from \"react\";\nimport { useShouldReduceMotion } from \"@/hooks/useIsMobile\";\n\ninterface AudioOrbProps {\n  isPlaying?: boolean;\n  color?: \"violet\" | \"fuchsia\" | \"blue\" | \"green\" | \"pink\" | \"purple\";\n  size?: \"sm\" | \"md\" | \"lg\";\n  className?: string;\n}\n\nexport function AudioOrb({ \n  isPlaying = false, \n  color = \"violet\", \n  size = \"md\",\n  className \n}: AudioOrbProps) {\n  const [audioLevels, setAudioLevels] = useState<number[]>([0.3, 0.5, 0.4, 0.6, 0.3]);\n  const reduceMotion = useShouldReduceMotion();\n\n  useEffect(() => {\n    if (!isPlaying || reduceMotion) {\n      setAudioLevels([0.3, 0.5, 0.4, 0.6, 0.3]);\n      return;\n    }\n\n    const interval = setInterval(() => {\n      setAudioLevels(prev => \n        prev.map(() => 0.3 + Math.random() * 0.7)\n      );\n    }, 100);\n\n    return () => clearInterval(interval);\n  }, [isPlaying, reduceMotion]);\n\n  const colorClasses = {\n    violet: {\n      primary: \"from-violet-600 to-violet-400\",\n      glow: \"shadow-violet-500/50\",\n      ring: \"border-violet-500/30\",\n      pulse: \"bg-violet-500\",\n    },\n    fuchsia: {\n      primary: \"from-fuchsia-600 to-fuchsia-400\",\n      glow: \"shadow-fuchsia-500/50\",\n      ring: \"border-fuchsia-500/30\",\n      pulse: \"bg-fuchsia-500\",\n    },\n    blue: {\n      primary: \"from-blue-600 to-blue-400\",\n      glow: \"shadow-blue-500/50\",\n      ring: \"border-blue-500/30\",\n      pulse: \"bg-blue-500\",\n    },\n    green: {\n      primary: \"from-green-600 to-green-400\",\n      glow: \"shadow-green-500/50\",\n      ring: \"border-green-500/30\",\n      pulse: \"bg-green-500\",\n    },\n    pink: {\n      primary: \"from-[#FF2EC3] to-[#ff6ed8]\",\n      glow: \"shadow-[#FF2EC3]/50\",\n      ring: \"border-[#FF2EC3]/30\",\n      pulse: \"bg-[#FF2EC3]\",\n    },\n    purple: {\n      primary: \"from-[#A64BFF] to-[#c78fff]\",\n      glow: \"shadow-[#A64BFF]/50\",\n      ring: \"border-[#A64BFF]/30\",\n      pulse: \"bg-[#A64BFF]\",\n    },\n  };\n\n  const sizeClasses = {\n    sm: \"w-16 h-16\",\n    md: \"w-24 h-24\",\n    lg: \"w-32 h-32\",\n  };\n\n  const colors = colorClasses[color];\n  const sizeClass = sizeClasses[size];\n\n  return (\n    <div className={cn(\"relative flex items-center justify-center\", sizeClass, className)}>\n      {/* Outer glow rings - static on mobile */}\n      <div\n        className={cn(\n          \"absolute inset-0 rounded-full border-2 opacity-30\",\n          colors.ring\n        )}\n      />\n      \n      <div\n        className={cn(\n          \"absolute inset-2 rounded-full border opacity-40\",\n          colors.ring\n        )}\n      />\n\n      {/* Main orb - static on mobile */}\n      <div\n        className={cn(\n          \"absolute inset-4 rounded-full bg-gradient-to-br\",\n          colors.primary,\n          isPlaying && `shadow-2xl ${colors.glow}`\n        )}\n      />\n\n      {/* Inner glow */}\n      <div\n        className={cn(\n          \"absolute inset-6 rounded-full bg-white/20 backdrop-blur-sm\",\n          isPlaying ? \"opacity-30\" : \"opacity-20\"\n        )}\n      />\n\n      {/* Audio visualizer bars - simplified on mobile */}\n      {isPlaying && !reduceMotion && (\n        <div className=\"absolute inset-0 flex items-center justify-center gap-0.5\">\n          {audioLevels.map((level, i) => (\n            <div\n              key={i}\n              className={cn(\"w-1 rounded-full\", colors.pulse)}\n              style={{\n                height: `${level * 40}%`,\n                opacity: level,\n              }}\n            />\n          ))}\n        </div>\n      )}\n\n      {/* Center dot */}\n      <div\n        className={cn(\n          \"absolute w-2 h-2 rounded-full bg-white\",\n          isPlaying ? \"opacity-100\" : \"opacity-60\"\n        )}\n      />\n    </div>\n  );\n}\n","path":null,"size_bytes":3731,"size_tokens":null},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","path":null,"size_bytes":1642,"size_tokens":null},"client/src/context/UserContext.tsx":{"content":"import React, { createContext, useContext, useEffect, useState } from \"react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useAuth } from \"@/hooks/useAuth\";\n\ninterface User {\n  id: number;\n  replitAuthId: string | null;\n  email: string | null;\n  firstName: string | null;\n  lastName: string | null;\n  profileImageUrl: string | null;\n  name: string | null;\n  role: string | null;\n  roleSelected: boolean;\n  coins: number;\n  xp: number;\n  wins: number;\n  level: number;\n  bio: string | null;\n  membership: string;\n  stripeCustomerId?: string | null;\n  stripeSubscriptionId?: string | null;\n  tutorialCompleted: boolean;\n  equippedPlate?: number | null;\n  equippedAnimation?: number | null;\n  equippedSphere?: number | null;\n  foundersBadge?: boolean;\n}\n\ninterface UserContextType {\n  user: User | null;\n  isLoading: boolean;\n  isAuthenticated: boolean;\n  login: () => void;\n  logout: () => void;\n  spendCoins: (amount: number) => boolean;\n  addCoins: (amount: number) => void;\n  refreshUser: () => Promise<void>;\n  setUserData: (data: Partial<User>) => void;\n}\n\nconst UserContext = createContext<UserContextType | undefined>(undefined);\n\nexport function UserProvider({ children }: { children: React.ReactNode }) {\n  const { user: authUser, isLoading, isAuthenticated } = useAuth();\n  const [user, setUser] = useState<User | null>(null);\n  const { toast } = useToast();\n\n  useEffect(() => {\n    if (authUser) {\n      setUser(authUser as User);\n    } else if (!isLoading) {\n      setUser(null);\n    }\n  }, [authUser, isLoading]);\n\n  const refreshUser = async () => {\n    if (!user) return;\n    \n    try {\n      const response = await fetch(`/api/users/${user.id}`);\n      if (response.ok) {\n        const updatedUser = await response.json();\n        setUser(updatedUser);\n      }\n    } catch (error) {\n      console.error(\"Failed to refresh user:\", error);\n    }\n  };\n\n  const login = () => {\n    window.location.href = \"/api/login\";\n  };\n\n  const logout = () => {\n    window.location.href = \"/api/logout\";\n  };\n\n  const spendCoins = (amount: number): boolean => {\n    if (!user) return false;\n    if (user.coins < amount) {\n      toast({\n        title: \"Insufficient Funds\",\n        description: `You need ${amount} coins but only have ${user.coins}. Visit the store!`,\n        variant: \"destructive\",\n      });\n      return false;\n    }\n\n    const newCoins = user.coins - amount;\n    setUser({ ...user, coins: newCoins });\n\n    fetch(`/api/users/${user.id}/coins`, {\n      method: \"PATCH\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({ coins: newCoins }),\n    }).catch((error) => console.error(\"Failed to update coins on server:\", error));\n\n    return true;\n  };\n\n  const addCoins = (amount: number) => {\n    if (!user) return;\n    const newCoins = user.coins + amount;\n    setUser({ ...user, coins: newCoins });\n\n    fetch(`/api/users/${user.id}/coins`, {\n      method: \"PATCH\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({ coins: newCoins }),\n    }).catch((error) => console.error(\"Failed to update coins on server:\", error));\n  };\n\n  const setUserData = (data: Partial<User>) => {\n    if (user) {\n      setUser({ ...user, ...data });\n    }\n  };\n\n  return (\n    <UserContext.Provider value={{ \n      user, \n      isLoading, \n      isAuthenticated, \n      login, \n      logout, \n      spendCoins, \n      addCoins, \n      refreshUser,\n      setUserData\n    }}>\n      {children}\n    </UserContext.Provider>\n  );\n}\n\nexport function useUser() {\n  const context = useContext(UserContext);\n  if (context === undefined) {\n    throw new Error(\"useUser must be used within a UserProvider\");\n  }\n  return context;\n}\n","path":null,"size_bytes":3693,"size_tokens":null},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","path":null,"size_bytes":772,"size_tokens":null},"client/src/components/ui/sonner.tsx":{"content":"\"use client\"\n\nimport { useTheme } from \"next-themes\"\nimport { Toaster as Sonner } from \"sonner\"\n\ntype ToasterProps = React.ComponentProps<typeof Sonner>\n\nconst Toaster = ({ ...props }: ToasterProps) => {\n  const { theme = \"system\" } = useTheme()\n\n  return (\n    <Sonner\n      theme={theme as ToasterProps[\"theme\"]}\n      className=\"toaster group\"\n      toastOptions={{\n        classNames: {\n          toast:\n            \"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg\",\n          description: \"group-[.toast]:text-muted-foreground\",\n          actionButton:\n            \"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground\",\n          cancelButton:\n            \"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground\",\n        },\n      }}\n      {...props}\n    />\n  )\n}\n\nexport { Toaster }\n","path":null,"size_bytes":894,"size_tokens":null},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-primary/10\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","path":null,"size_bytes":266,"size_tokens":null},"server/stripeClient.ts":{"content":"import Stripe from 'stripe';\n\nlet connectionSettings: any;\n\nasync function getCredentials() {\n  const hostname = process.env.REPLIT_CONNECTORS_HOSTNAME;\n  const xReplitToken = process.env.REPL_IDENTITY\n    ? 'repl ' + process.env.REPL_IDENTITY\n    : process.env.WEB_REPL_RENEWAL\n      ? 'depl ' + process.env.WEB_REPL_RENEWAL\n      : null;\n\n  if (!xReplitToken) {\n    throw new Error('X_REPLIT_TOKEN not found for repl/depl');\n  }\n\n  const connectorName = 'stripe';\n  const isProduction = process.env.REPLIT_DEPLOYMENT === '1';\n  const targetEnvironment = isProduction ? 'production' : 'development';\n\n  const url = new URL(`https://${hostname}/api/v2/connection`);\n  url.searchParams.set('include_secrets', 'true');\n  url.searchParams.set('connector_names', connectorName);\n  url.searchParams.set('environment', targetEnvironment);\n\n  const response = await fetch(url.toString(), {\n    headers: {\n      'Accept': 'application/json',\n      'X_REPLIT_TOKEN': xReplitToken\n    }\n  });\n\n  const data = await response.json();\n  \n  connectionSettings = data.items?.[0];\n\n  if (!connectionSettings || (!connectionSettings.settings.publishable || !connectionSettings.settings.secret)) {\n    throw new Error(`Stripe ${targetEnvironment} connection not found`);\n  }\n\n  return {\n    publishableKey: connectionSettings.settings.publishable,\n    secretKey: connectionSettings.settings.secret,\n  };\n}\n\nexport async function getUncachableStripeClient() {\n  const { secretKey } = await getCredentials();\n\n  return new Stripe(secretKey, {\n    apiVersion: '2025-08-27.basil',\n  });\n}\n\nexport async function getStripePublishableKey() {\n  const { publishableKey } = await getCredentials();\n  return publishableKey;\n}\n\nexport async function getStripeSecretKey() {\n  const { secretKey } = await getCredentials();\n  return secretKey;\n}\n\nlet stripeSync: any = null;\n\nexport async function getStripeSync() {\n  if (!stripeSync) {\n    const { StripeSync } = await import('stripe-replit-sync');\n    const secretKey = await getStripeSecretKey();\n\n    stripeSync = new StripeSync({\n      poolConfig: {\n        connectionString: process.env.DATABASE_URL!,\n        max: 2,\n      },\n      stripeSecretKey: secretKey,\n    });\n  }\n  return stripeSync;\n}\n","path":null,"size_bytes":2220,"size_tokens":null},"client/src/components/ui/menubar.tsx":{"content":"import * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-9 items-center space-x-1 rounded-md border bg-background p-1 shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-4 w-4 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","path":null,"size_bytes":8608,"size_tokens":null},"client/src/components/battle/Waveform.tsx":{"content":"import { useShouldReduceMotion } from \"@/hooks/useIsMobile\";\n\nexport function Waveform({ color = \"bg-violet-500\" }: { color?: string }) {\n  const reduceMotion = useShouldReduceMotion();\n  \n  return (\n    <div className=\"flex items-end gap-0.5 h-8 w-full opacity-80\">\n      {[...Array(20)].map((_, i) => {\n        const height = Math.max(20, Math.random() * 100);\n        return (\n          <div\n            key={i}\n            className={`w-1 ${color} rounded-full`}\n            style={{ height: reduceMotion ? `${height}%` : `${height}%` }}\n          />\n        );\n      })}\n    </div>\n  );\n}\n","path":null,"size_bytes":594,"size_tokens":null},"client/src/components/ui/chart.tsx":{"content":"import * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload\n            .filter((item) => item.type !== \"none\")\n            .map((item, index) => {\n              const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n              const itemConfig = getPayloadConfigFromPayload(config, item, key)\n              const indicatorColor = color || item.payload.fill || item.color\n\n              return (\n                <div\n                  key={item.dataKey}\n                  className={cn(\n                    \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                    indicator === \"dot\" && \"items-center\"\n                  )}\n                >\n                  {formatter && item?.value !== undefined && item.name ? (\n                    formatter(item.value, item.name, item, index, item.payload)\n                  ) : (\n                    <>\n                      {itemConfig?.icon ? (\n                        <itemConfig.icon />\n                      ) : (\n                        !hideIndicator && (\n                          <div\n                            className={cn(\n                              \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                              {\n                                \"h-2.5 w-2.5\": indicator === \"dot\",\n                                \"w-1\": indicator === \"line\",\n                                \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                  indicator === \"dashed\",\n                                \"my-0.5\": nestLabel && indicator === \"dashed\",\n                              }\n                            )}\n                            style={\n                              {\n                                \"--color-bg\": indicatorColor,\n                                \"--color-border\": indicatorColor,\n                              } as React.CSSProperties\n                            }\n                          />\n                        )\n                      )}\n                      <div\n                        className={cn(\n                          \"flex flex-1 justify-between leading-none\",\n                          nestLabel ? \"items-end\" : \"items-center\"\n                        )}\n                      >\n                        <div className=\"grid gap-1.5\">\n                          {nestLabel ? tooltipLabel : null}\n                          <span className=\"text-muted-foreground\">\n                            {itemConfig?.label || item.name}\n                          </span>\n                        </div>\n                        {item.value && (\n                          <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                            {item.value.toLocaleString()}\n                          </span>\n                        )}\n                      </div>\n                    </>\n                  )}\n                </div>\n              )\n            })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload\n          .filter((item) => item.type !== \"none\")\n          .map((item) => {\n            const key = `${nameKey || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n            return (\n              <div\n                key={item.value}\n                className={cn(\n                  \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n                )}\n              >\n                {itemConfig?.icon && !hideIcon ? (\n                  <itemConfig.icon />\n                ) : (\n                  <div\n                    className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                    style={{\n                      backgroundColor: item.color,\n                    }}\n                  />\n                )}\n                {itemConfig?.label}\n              </div>\n            )\n          })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","path":null,"size_bytes":10763,"size_tokens":null},"client/src/components/games/SlotMachine.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Coins, X, RotateCw, Trophy } from \"lucide-react\";\nimport { motion, AnimatePresence } from \"framer-motion\";\nimport { cn } from \"@/lib/utils\";\nimport { useUser } from \"@/context/UserContext\";\n\nconst SYMBOLS = [\"\", \"\", \"\", \"7\", \"\", \"\"];\nconst COST_PER_SPIN = 50;\n\nexport function SlotMachine() {\n  const [isOpen, setIsOpen] = useState(false);\n  const [reels, setReels] = useState([\"7\", \"7\", \"7\"]);\n  const [spinning, setSpinning] = useState(false);\n  const [win, setWin] = useState(0);\n  const { user, spendCoins, addCoins } = useUser();\n\n  const spin = () => {\n    if (!user || spinning) return;\n    \n    if (!spendCoins(COST_PER_SPIN)) return;\n\n    setSpinning(true);\n    setWin(0);\n\n    // Animation sequence\n    let interval = setInterval(() => {\n      setReels([\n        SYMBOLS[Math.floor(Math.random() * SYMBOLS.length)],\n        SYMBOLS[Math.floor(Math.random() * SYMBOLS.length)],\n        SYMBOLS[Math.floor(Math.random() * SYMBOLS.length)]\n      ]);\n    }, 100);\n\n    setTimeout(() => {\n      clearInterval(interval);\n      const finalReels = [\n        SYMBOLS[Math.floor(Math.random() * SYMBOLS.length)],\n        SYMBOLS[Math.floor(Math.random() * SYMBOLS.length)],\n        SYMBOLS[Math.floor(Math.random() * SYMBOLS.length)]\n      ];\n      setReels(finalReels);\n      setSpinning(false);\n      checkWin(finalReels);\n    }, 2000);\n  };\n\n  const checkWin = (finalReels: string[]) => {\n    if (finalReels[0] === finalReels[1] && finalReels[1] === finalReels[2]) {\n      const reward = 500;\n      setWin(reward);\n      addCoins(reward);\n    } else if (finalReels[0] === finalReels[1] || finalReels[1] === finalReels[2]) {\n      const reward = 50;\n      setWin(reward);\n      addCoins(reward);\n    }\n  };\n  \n  // If no user, don't render (or render disabled state, but simpler to hide for now or just show alert on click)\n  // Let's show it but prompt login if they try to open/play without user\n  const walletAmount = user?.coins || 0;\n\n  return (\n    <div className=\"fixed bottom-4 left-4 z-50 flex flex-col items-start\">\n      <AnimatePresence>\n        {isOpen && (\n          <motion.div\n            initial={{ opacity: 0, y: 20, scale: 0.95 }}\n            animate={{ opacity: 1, y: 0, scale: 1 }}\n            exit={{ opacity: 0, y: 20, scale: 0.95 }}\n            className=\"mb-4 w-72 bg-black/90 border-2 border-yellow-500/50 backdrop-blur-xl rounded-2xl shadow-2xl shadow-yellow-500/20 overflow-hidden flex flex-col relative\"\n          >\n            {/* Casino Header */}\n            <div className=\"p-3 bg-linear-to-r from-yellow-600 to-yellow-500 flex items-center justify-between\">\n              <div className=\"flex items-center gap-2 text-black font-bold\">\n                <Coins className=\"w-4 h-4\" />\n                <span>Lucky Slots</span>\n              </div>\n              <Button variant=\"ghost\" size=\"icon\" className=\"h-6 w-6 text-black hover:bg-black/10\" onClick={() => setIsOpen(false)}>\n                <X className=\"w-4 h-4\" />\n              </Button>\n            </div>\n\n            {/* Machine Body */}\n            <div className=\"p-6 flex flex-col items-center gap-6 bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')]\">\n              \n              {/* Reels */}\n              <div className=\"flex gap-2 p-3 bg-black border-4 border-yellow-600 rounded-lg shadow-inner\">\n                {reels.map((symbol, i) => (\n                  <div key={i} className=\"w-12 h-16 bg-white rounded flex items-center justify-center text-3xl border-b-4 border-gray-300 shadow-inner\">\n                    {symbol}\n                  </div>\n                ))}\n              </div>\n\n              {/* Controls */}\n              <div className=\"w-full space-y-3\">\n                <div className=\"flex justify-between text-xs font-mono font-bold text-yellow-400 uppercase\">\n                  <span>Cost: {COST_PER_SPIN}</span>\n                  <span>Wallet: {walletAmount}</span>\n                </div>\n                \n                {user ? (\n                  <Button \n                    onClick={spin} \n                    disabled={spinning || walletAmount < COST_PER_SPIN}\n                    className=\"w-full bg-red-600 hover:bg-red-500 text-white font-bold border-b-4 border-red-800 active:border-b-0 active:translate-y-1 transition-all\"\n                  >\n                    {spinning ? \"Spinning...\" : \"SPIN!\"}\n                  </Button>\n                ) : (\n                  <div className=\"text-center text-xs text-white bg-white/10 p-2 rounded\">Login to Play</div>\n                )}\n              </div>\n\n              {/* Win Display */}\n              <AnimatePresence>\n                {win > 0 && (\n                  <motion.div \n                    initial={{ scale: 0, opacity: 0 }}\n                    animate={{ scale: 1.2, opacity: 1 }}\n                    exit={{ scale: 0, opacity: 0 }}\n                    className=\"absolute inset-0 flex items-center justify-center bg-black/80 z-20 pointer-events-none\"\n                  >\n                    <div className=\"text-center\">\n                      <Trophy className=\"w-12 h-12 text-yellow-400 mx-auto mb-2 animate-bounce\" />\n                      <div className=\"text-2xl font-black text-yellow-400 drop-shadow-lg\">BIG WIN!</div>\n                      <div className=\"text-xl font-bold text-white\">+{win} Coins</div>\n                    </div>\n                  </motion.div>\n                )}\n              </AnimatePresence>\n\n            </div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n\n      <Button \n        onClick={() => setIsOpen(!isOpen)}\n        size=\"lg\" \n        className={`rounded-full h-14 w-14 shadow-lg shadow-yellow-500/20 transition-all duration-300 border-2 border-yellow-500 ${isOpen ? 'bg-yellow-500 text-black hover:bg-yellow-400' : 'bg-black text-yellow-500 hover:scale-110'}`}\n      >\n        {isOpen ? <X className=\"w-6 h-6\" /> : <Coins className=\"w-6 h-6 animate-pulse\" />}\n      </Button>\n    </div>\n  );\n}\n","path":null,"size_bytes":6113,"size_tokens":null},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","path":null,"size_bytes":3895,"size_tokens":null},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","path":null,"size_bytes":6210,"size_tokens":null},"server/storage.ts":{"content":"import {\n  users,\n  battles,\n  votes,\n  comments,\n  chatMessages,\n  follows,\n  notifications,\n  messages,\n  customizations,\n  userCustomizations,\n  emailVerificationTokens,\n  passwordResetTokens,\n  battleRequests,\n  type User,\n  type UpsertUser,\n  type Battle,\n  type InsertBattle,\n  type Vote,\n  type InsertVote,\n  type Comment,\n  type InsertComment,\n  type ChatMessage,\n  type InsertChatMessage,\n  type Follow,\n  type InsertFollow,\n  type Notification,\n  type InsertNotification,\n  type Message,\n  type InsertMessage,\n  type Customization,\n  type UserCustomization,\n  type BattleRequest,\n  type InsertBattleRequest,\n} from \"@shared/schema\";\nimport crypto from \"crypto\";\nimport { db } from \"./db\";\nimport { eq, desc, sql } from \"drizzle-orm\";\n\nexport interface StripeProduct {\n  id: string;\n  name: string;\n  description: string | null;\n  metadata: Record<string, string>;\n  active: boolean;\n}\n\nexport interface StripePrice {\n  id: string;\n  product: string;\n  unit_amount: number;\n  currency: string;\n  recurring: { interval: string } | null;\n  active: boolean;\n  metadata: Record<string, string>;\n}\n\nexport interface IStorage {\n  getUser(id: number): Promise<User | undefined>;\n  getUserByReplitAuthId(replitAuthId: string): Promise<User | undefined>;\n  getUserByName(name: string): Promise<User | undefined>;\n  upsertUser(userData: UpsertUser): Promise<User>;\n  updateUserCoins(id: number, coins: number): Promise<void>;\n  updateUserStats(id: number, xp: number, wins: number): Promise<void>;\n  updateUserProfile(id: number, profileImageUrl: string, bio: string, name?: string, role?: string): Promise<User>;\n  updateUserStripeInfo(id: number, stripeCustomerId: string | null, stripeSubscriptionId: string | null, membership: string, isNewPurchase?: boolean): Promise<User>;\n  getLeaderboard(limit?: number): Promise<User[]>;\n  countFounders(): Promise<number>;\n  canUserBattle(userId: number): Promise<{ canBattle: boolean; reason?: string }>;\n\n  listProducts(active?: boolean): Promise<StripeProduct[]>;\n  listPrices(active?: boolean): Promise<StripePrice[]>;\n  getProductsWithPrices(): Promise<Array<StripeProduct & { prices: StripePrice[] }>>;\n  getSubscription(subscriptionId: string): Promise<any>;\n\n  getBattle(id: number): Promise<Battle | undefined>;\n  getAllBattles(): Promise<Battle[]>;\n  createBattle(battle: InsertBattle): Promise<Battle>;\n  createCompleteBattle(data: {\n    leftArtist: string;\n    leftTrack: string;\n    leftAudio: string;\n    leftUserId: number;\n    rightArtist: string;\n    rightTrack: string;\n    rightAudio: string;\n    rightUserId: number;\n    battleType: string;\n    genre: string;\n    status: string;\n    endsAt: Date;\n  }): Promise<Battle>;\n  joinBattle(battleId: number, userId: number, artist: string, track: string, audio: string): Promise<Battle>;\n  updateBattleVotes(battleId: number, side: \"left\" | \"right\", increment: number): Promise<void>;\n\n  getUserVote(battleId: number, userId: number): Promise<Vote | undefined>;\n  createVote(vote: InsertVote): Promise<Vote>;\n\n  getCommentsByBattle(battleId: number): Promise<Array<Comment & { userName: string | null; userAvatar: string | null }>>;\n  createComment(comment: InsertComment): Promise<Comment>;\n\n  getChatMessages(limit?: number): Promise<Array<ChatMessage & { userName: string | null; userAvatar: string | null }>>;\n  createChatMessage(message: InsertChatMessage): Promise<ChatMessage>;\n\n  followUser(followerId: number, followingId: number): Promise<Follow>;\n  unfollowUser(followerId: number, followingId: number): Promise<void>;\n  isFollowing(followerId: number, followingId: number): Promise<boolean>;\n  getFollowers(userId: number): Promise<User[]>;\n  getFollowing(userId: number): Promise<User[]>;\n\n  getNotifications(userId: number): Promise<Array<Notification & { fromUserName?: string | null; fromUserAvatar?: string | null }>>;\n  createNotification(notification: InsertNotification): Promise<Notification>;\n  markNotificationAsRead(notificationId: number): Promise<void>;\n  markAllNotificationsAsRead(userId: number): Promise<void>;\n  getUnreadNotificationCount(userId: number): Promise<number>;\n\n  getMessages(userId: number): Promise<Array<Message & { fromUserName?: string | null; fromUserAvatar?: string | null }>>;\n  getSentMessages(userId: number): Promise<Array<Message & { toUserName?: string | null; toUserAvatar?: string | null }>>;\n  getMessage(messageId: number): Promise<Message | undefined>;\n  createMessage(message: InsertMessage): Promise<Message>;\n  markMessageAsRead(messageId: number): Promise<void>;\n  getUnreadMessageCount(userId: number): Promise<number>;\n  getNotification(notificationId: number): Promise<Notification | undefined>;\n\n  getAllCustomizations(): Promise<Customization[]>;\n  getCustomizationsByCategory(category: string): Promise<Customization[]>;\n  getCustomization(id: number): Promise<Customization | undefined>;\n  getUserCustomizations(userId: number): Promise<Array<Customization & { unlockedAt: Date }>>;\n  unlockCustomization(userId: number, customizationId: number): Promise<UserCustomization>;\n  buyCustomization(userId: number, customizationId: number): Promise<{ success: boolean; error?: string; newBalance?: number }>;\n  hasCustomization(userId: number, customizationId: number): Promise<boolean>;\n  equipCustomization(userId: number, category: string, customizationId: number): Promise<User>;\n  updateUserLevel(userId: number, level: number): Promise<void>;\n  completeTutorial(userId: number): Promise<void>;\n  searchUsers(query: string): Promise<User[]>;\n  getUsersByRole(role: string): Promise<User[]>;\n\n  createBattleRequest(request: InsertBattleRequest): Promise<BattleRequest>;\n  getBattleRequest(id: number): Promise<BattleRequest | undefined>;\n  getPendingBattleRequests(userId: number): Promise<Array<BattleRequest & { challengerName: string | null; challengerAvatar: string | null }>>;\n  getSentBattleRequests(userId: number): Promise<Array<BattleRequest & { challengedName: string | null; challengedAvatar: string | null }>>;\n  updateBattleRequestStatus(id: number, status: string, challengedTrack?: string, challengedAudio?: string): Promise<BattleRequest>;\n  linkBattleToRequest(requestId: number, battleId: number): Promise<void>;\n}\n\nexport class DatabaseStorage implements IStorage {\n  async getUser(id: number): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.id, id));\n    return user || undefined;\n  }\n\n  async getUserByReplitAuthId(replitAuthId: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.replitAuthId, replitAuthId));\n    return user || undefined;\n  }\n\n  async getUserByName(name: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.name, name));\n    return user || undefined;\n  }\n\n  async upsertUser(userData: UpsertUser): Promise<User> {\n    const existingUser = await this.getUserByReplitAuthId(userData.replitAuthId);\n    \n    if (existingUser) {\n      const [user] = await db\n        .update(users)\n        .set({\n          email: userData.email,\n          firstName: userData.firstName,\n          lastName: userData.lastName,\n          profileImageUrl: userData.profileImageUrl,\n          updatedAt: new Date(),\n        })\n        .where(eq(users.replitAuthId, userData.replitAuthId))\n        .returning();\n      return user;\n    } else {\n      const [user] = await db\n        .insert(users)\n        .values({\n          replitAuthId: userData.replitAuthId,\n          email: userData.email,\n          firstName: userData.firstName,\n          lastName: userData.lastName,\n          profileImageUrl: userData.profileImageUrl,\n          name: userData.firstName || userData.email?.split('@')[0] || 'User',\n          role: 'artist',\n          roleSelected: false,\n        })\n        .returning();\n      return user;\n    }\n  }\n\n  async updateUserCoins(id: number, coins: number): Promise<void> {\n    await db.update(users).set({ coins }).where(eq(users.id, id));\n  }\n\n  async updateUserStats(id: number, xp: number, wins: number): Promise<void> {\n    await db.update(users).set({ xp, wins }).where(eq(users.id, id));\n  }\n\n  async updateUserProfile(id: number, profileImageUrl: string, bio: string, name?: string, role?: string): Promise<User> {\n    const updateData: any = { profileImageUrl, bio, updatedAt: new Date() };\n    if (name) updateData.name = name;\n    if (role) {\n      updateData.role = role;\n      updateData.roleSelected = true;\n    }\n    const [user] = await db.update(users).set(updateData).where(eq(users.id, id)).returning();\n    return user;\n  }\n\n  async updateUserStripeInfo(\n    id: number, \n    stripeCustomerId: string | null, \n    stripeSubscriptionId: string | null, \n    membership: string,\n    isNewPurchase: boolean = false\n  ): Promise<User> {\n    const updateData: any = { stripeCustomerId, stripeSubscriptionId, membership };\n    \n    if (isNewPurchase && (membership === 'pro' || membership === 'elite')) {\n      const currentUser = await this.getUser(id);\n      if (currentUser && !currentUser.membershipPurchasedAt) {\n        updateData.membershipPurchasedAt = new Date();\n        \n        const founderCount = await this.countFounders();\n        if (founderCount < 10) {\n          updateData.foundersBadge = true;\n        }\n      }\n    }\n    \n    const [user] = await db\n      .update(users)\n      .set(updateData)\n      .where(eq(users.id, id))\n      .returning();\n    return user;\n  }\n\n  async getLeaderboard(limit: number = 100): Promise<User[]> {\n    return await db.select().from(users).orderBy(desc(users.xp)).limit(limit);\n  }\n\n  async countFounders(): Promise<number> {\n    const result = await db\n      .select({ count: sql<number>`count(*)` })\n      .from(users)\n      .where(eq(users.foundersBadge, true));\n    return Number(result[0]?.count || 0);\n  }\n\n  async canUserBattle(userId: number): Promise<{ canBattle: boolean; reason?: string }> {\n    const user = await this.getUser(userId);\n    if (!user) {\n      return { canBattle: false, reason: \"User not found\" };\n    }\n\n    const BATTLE_COST = 250;\n\n    if (user.membership === 'pro' || user.membership === 'elite') {\n      return { canBattle: true };\n    }\n\n    if (user.coins >= BATTLE_COST) {\n      return { canBattle: true };\n    }\n\n    return { \n      canBattle: false, \n      reason: \"You need at least 250 coins to battle. Purchase a membership for unlimited battles!\" \n    };\n  }\n\n  async listProducts(active: boolean = true): Promise<StripeProduct[]> {\n    const result = await db.execute(\n      sql`SELECT id, name, description, metadata, active FROM stripe.products WHERE active = ${active}`\n    );\n    return result.rows as unknown as StripeProduct[];\n  }\n\n  async listPrices(active: boolean = true): Promise<StripePrice[]> {\n    const result = await db.execute(\n      sql`SELECT id, product, unit_amount, currency, recurring, active, metadata FROM stripe.prices WHERE active = ${active}`\n    );\n    return result.rows as unknown as StripePrice[];\n  }\n\n  async getProductsWithPrices(): Promise<Array<StripeProduct & { prices: StripePrice[] }>> {\n    const result = await db.execute(sql`\n      SELECT \n        p.id as product_id,\n        p.name as product_name,\n        p.description as product_description,\n        p.active as product_active,\n        p.metadata as product_metadata,\n        pr.id as price_id,\n        pr.unit_amount,\n        pr.currency,\n        pr.recurring,\n        pr.active as price_active,\n        pr.metadata as price_metadata\n      FROM stripe.products p\n      LEFT JOIN stripe.prices pr ON pr.product = p.id AND pr.active = true\n      WHERE p.active = true\n      ORDER BY p.id, pr.unit_amount\n    `);\n\n    const productsMap = new Map<string, StripeProduct & { prices: StripePrice[] }>();\n    for (const row of result.rows as any[]) {\n      if (!productsMap.has(row.product_id)) {\n        productsMap.set(row.product_id, {\n          id: row.product_id,\n          name: row.product_name,\n          description: row.product_description,\n          metadata: row.product_metadata || {},\n          active: row.product_active,\n          prices: []\n        });\n      }\n      if (row.price_id) {\n        productsMap.get(row.product_id)!.prices.push({\n          id: row.price_id,\n          product: row.product_id,\n          unit_amount: row.unit_amount,\n          currency: row.currency,\n          recurring: row.recurring,\n          active: row.price_active,\n          metadata: row.price_metadata || {},\n        });\n      }\n    }\n\n    return Array.from(productsMap.values());\n  }\n\n  async getSubscription(subscriptionId: string): Promise<any> {\n    const result = await db.execute(\n      sql`SELECT * FROM stripe.subscriptions WHERE id = ${subscriptionId}`\n    );\n    return result.rows[0] || null;\n  }\n\n  async getBattle(id: number): Promise<Battle | undefined> {\n    const [battle] = await db.select().from(battles).where(eq(battles.id, id));\n    return battle || undefined;\n  }\n\n  async getAllBattles(): Promise<Battle[]> {\n    return await db.select().from(battles).orderBy(desc(battles.createdAt));\n  }\n\n  async createBattle(insertBattle: InsertBattle): Promise<Battle> {\n    const [battle] = await db.insert(battles).values(insertBattle).returning();\n    return battle;\n  }\n\n  async createCompleteBattle(data: {\n    leftArtist: string;\n    leftTrack: string;\n    leftAudio: string;\n    leftUserId: number;\n    rightArtist: string;\n    rightTrack: string;\n    rightAudio: string;\n    rightUserId: number;\n    battleType: string;\n    genre: string;\n    status: string;\n    endsAt: Date;\n  }): Promise<Battle> {\n    const [battle] = await db.insert(battles).values({\n      type: data.battleType,\n      genre: data.genre,\n      status: data.status,\n      leftArtist: data.leftArtist,\n      leftTrack: data.leftTrack,\n      leftAudio: data.leftAudio,\n      leftUserId: data.leftUserId,\n      rightArtist: data.rightArtist,\n      rightTrack: data.rightTrack,\n      rightAudio: data.rightAudio,\n      rightUserId: data.rightUserId,\n      endsAt: data.endsAt,\n    }).returning();\n    return battle;\n  }\n\n  async joinBattle(battleId: number, userId: number, artist: string, track: string, audio: string): Promise<Battle> {\n    const [battle] = await db\n      .update(battles)\n      .set({\n        rightArtist: artist,\n        rightTrack: track,\n        rightAudio: audio,\n        rightUserId: userId,\n        status: \"active\",\n        endsAt: new Date(Date.now() + 48 * 60 * 60 * 1000),\n      })\n      .where(eq(battles.id, battleId))\n      .returning();\n    return battle;\n  }\n\n  async updateBattleVotes(battleId: number, side: \"left\" | \"right\", increment: number): Promise<void> {\n    if (side === \"left\") {\n      await db\n        .update(battles)\n        .set({ leftVotes: sql`${battles.leftVotes} + ${increment}` })\n        .where(eq(battles.id, battleId));\n    } else {\n      await db\n        .update(battles)\n        .set({ rightVotes: sql`${battles.rightVotes} + ${increment}` })\n        .where(eq(battles.id, battleId));\n    }\n  }\n\n  async getUserVote(battleId: number, userId: number): Promise<Vote | undefined> {\n    const [vote] = await db\n      .select()\n      .from(votes)\n      .where(sql`${votes.battleId} = ${battleId} AND ${votes.userId} = ${userId}`);\n    return vote || undefined;\n  }\n\n  async createVote(insertVote: InsertVote): Promise<Vote> {\n    const [vote] = await db.insert(votes).values(insertVote).returning();\n    return vote;\n  }\n\n  async getCommentsByBattle(battleId: number): Promise<Array<Comment & { userName: string | null; userAvatar: string | null }>> {\n    const result = await db\n      .select({\n        id: comments.id,\n        battleId: comments.battleId,\n        userId: comments.userId,\n        text: comments.text,\n        createdAt: comments.createdAt,\n        userName: users.name,\n        userAvatar: users.profileImageUrl,\n      })\n      .from(comments)\n      .innerJoin(users, eq(comments.userId, users.id))\n      .where(eq(comments.battleId, battleId))\n      .orderBy(desc(comments.createdAt));\n\n    return result;\n  }\n\n  async createComment(insertComment: InsertComment): Promise<Comment> {\n    const [comment] = await db.insert(comments).values(insertComment).returning();\n    return comment;\n  }\n\n  async getChatMessages(limit: number = 50): Promise<Array<ChatMessage & { userName: string | null; userAvatar: string | null }>> {\n    const result = await db\n      .select({\n        id: chatMessages.id,\n        userId: chatMessages.userId,\n        text: chatMessages.text,\n        createdAt: chatMessages.createdAt,\n        userName: users.name,\n        userAvatar: users.profileImageUrl,\n      })\n      .from(chatMessages)\n      .innerJoin(users, eq(chatMessages.userId, users.id))\n      .orderBy(desc(chatMessages.createdAt))\n      .limit(limit);\n\n    return result.reverse();\n  }\n\n  async createChatMessage(insertMessage: InsertChatMessage): Promise<ChatMessage> {\n    const [message] = await db.insert(chatMessages).values(insertMessage).returning();\n    return message;\n  }\n\n  async followUser(followerId: number, followingId: number): Promise<Follow> {\n    const [follow] = await db.insert(follows).values({ followerId, followingId }).returning();\n    return follow;\n  }\n\n  async unfollowUser(followerId: number, followingId: number): Promise<void> {\n    await db.delete(follows).where(\n      sql`${follows.followerId} = ${followerId} AND ${follows.followingId} = ${followingId}`\n    );\n  }\n\n  async isFollowing(followerId: number, followingId: number): Promise<boolean> {\n    const [result] = await db\n      .select()\n      .from(follows)\n      .where(\n        sql`${follows.followerId} = ${followerId} AND ${follows.followingId} = ${followingId}`\n      );\n    return !!result;\n  }\n\n  async getFollowers(userId: number): Promise<User[]> {\n    return await db\n      .select()\n      .from(users)\n      .innerJoin(follows, eq(follows.followerId, users.id))\n      .where(eq(follows.followingId, userId))\n      .then(results => results.map(r => r.users));\n  }\n\n  async getFollowing(userId: number): Promise<User[]> {\n    return await db\n      .select()\n      .from(users)\n      .innerJoin(follows, eq(follows.followingId, users.id))\n      .where(eq(follows.followerId, userId))\n      .then(results => results.map(r => r.users));\n  }\n\n  async getNotifications(userId: number): Promise<Array<Notification & { fromUserName?: string | null; fromUserAvatar?: string | null }>> {\n    const result = await db\n      .select({\n        id: notifications.id,\n        userId: notifications.userId,\n        fromUserId: notifications.fromUserId,\n        type: notifications.type,\n        battleId: notifications.battleId,\n        message: notifications.message,\n        read: notifications.read,\n        createdAt: notifications.createdAt,\n        fromUserName: users.name,\n        fromUserAvatar: users.profileImageUrl,\n      })\n      .from(notifications)\n      .leftJoin(users, eq(notifications.fromUserId, users.id))\n      .where(eq(notifications.userId, userId))\n      .orderBy(desc(notifications.createdAt));\n\n    return result;\n  }\n\n  async createNotification(insertNotification: InsertNotification): Promise<Notification> {\n    const [notification] = await db.insert(notifications).values(insertNotification).returning();\n    return notification;\n  }\n\n  async markNotificationAsRead(notificationId: number): Promise<void> {\n    await db.update(notifications).set({ read: true }).where(eq(notifications.id, notificationId));\n  }\n\n  async markAllNotificationsAsRead(userId: number): Promise<void> {\n    await db.update(notifications).set({ read: true }).where(eq(notifications.userId, userId));\n  }\n\n  async getUnreadNotificationCount(userId: number): Promise<number> {\n    const result = await db\n      .select({ count: sql<number>`count(*)` })\n      .from(notifications)\n      .where(sql`${notifications.userId} = ${userId} AND ${notifications.read} = false`);\n    return result[0]?.count || 0;\n  }\n\n  async getMessages(userId: number): Promise<Array<Message & { fromUserName?: string | null; fromUserAvatar?: string | null }>> {\n    const result = await db\n      .select({\n        id: messages.id,\n        fromUserId: messages.fromUserId,\n        toUserId: messages.toUserId,\n        subject: messages.subject,\n        content: messages.content,\n        read: messages.read,\n        createdAt: messages.createdAt,\n        fromUserName: users.name,\n        fromUserAvatar: users.profileImageUrl,\n      })\n      .from(messages)\n      .leftJoin(users, eq(messages.fromUserId, users.id))\n      .where(eq(messages.toUserId, userId))\n      .orderBy(desc(messages.createdAt));\n\n    return result;\n  }\n\n  async getSentMessages(userId: number): Promise<Array<Message & { toUserName?: string | null; toUserAvatar?: string | null }>> {\n    const result = await db\n      .select({\n        id: messages.id,\n        fromUserId: messages.fromUserId,\n        toUserId: messages.toUserId,\n        subject: messages.subject,\n        content: messages.content,\n        read: messages.read,\n        createdAt: messages.createdAt,\n        toUserName: users.name,\n        toUserAvatar: users.profileImageUrl,\n      })\n      .from(messages)\n      .leftJoin(users, eq(messages.toUserId, users.id))\n      .where(eq(messages.fromUserId, userId))\n      .orderBy(desc(messages.createdAt));\n\n    return result;\n  }\n\n  async getMessage(messageId: number): Promise<Message | undefined> {\n    const [message] = await db.select().from(messages).where(eq(messages.id, messageId));\n    return message || undefined;\n  }\n\n  async createMessage(insertMessage: InsertMessage): Promise<Message> {\n    const [message] = await db.insert(messages).values(insertMessage).returning();\n    return message;\n  }\n\n  async markMessageAsRead(messageId: number): Promise<void> {\n    await db.update(messages).set({ read: true }).where(eq(messages.id, messageId));\n  }\n\n  async getUnreadMessageCount(userId: number): Promise<number> {\n    const result = await db\n      .select({ count: sql<number>`count(*)` })\n      .from(messages)\n      .where(sql`${messages.toUserId} = ${userId} AND ${messages.read} = false`);\n    return result[0]?.count || 0;\n  }\n\n  async getNotification(notificationId: number): Promise<Notification | undefined> {\n    const [notification] = await db.select().from(notifications).where(eq(notifications.id, notificationId));\n    return notification || undefined;\n  }\n\n  async getAllCustomizations(): Promise<Customization[]> {\n    return await db.select().from(customizations).orderBy(customizations.category, customizations.requiredLevel);\n  }\n\n  async getCustomizationsByCategory(category: string): Promise<Customization[]> {\n    return await db.select().from(customizations).where(eq(customizations.category, category)).orderBy(customizations.requiredLevel);\n  }\n\n  async getUserCustomizations(userId: number): Promise<Array<Customization & { unlockedAt: Date }>> {\n    const result = await db\n      .select({\n        id: customizations.id,\n        category: customizations.category,\n        name: customizations.name,\n        description: customizations.description,\n        previewUrl: customizations.previewUrl,\n        cssClass: customizations.cssClass,\n        animationData: customizations.animationData,\n        unlockType: customizations.unlockType,\n        requiredLevel: customizations.requiredLevel,\n        coinCost: customizations.coinCost,\n        rarity: customizations.rarity,\n        isDefault: customizations.isDefault,\n        createdAt: customizations.createdAt,\n        unlockedAt: userCustomizations.unlockedAt,\n      })\n      .from(userCustomizations)\n      .innerJoin(customizations, eq(userCustomizations.customizationId, customizations.id))\n      .where(eq(userCustomizations.userId, userId));\n    return result;\n  }\n\n  async unlockCustomization(userId: number, customizationId: number): Promise<UserCustomization> {\n    const [unlock] = await db.insert(userCustomizations).values({ userId, customizationId }).returning();\n    return unlock;\n  }\n\n  async getCustomization(id: number): Promise<Customization | undefined> {\n    const [customization] = await db.select().from(customizations).where(eq(customizations.id, id));\n    return customization || undefined;\n  }\n\n  async buyCustomization(userId: number, customizationId: number): Promise<{ success: boolean; error?: string; newBalance?: number }> {\n    const user = await this.getUser(userId);\n    if (!user) return { success: false, error: \"User not found\" };\n\n    const customization = await this.getCustomization(customizationId);\n    if (!customization) return { success: false, error: \"Customization not found\" };\n\n    const alreadyOwned = await this.hasCustomization(userId, customizationId);\n    if (alreadyOwned) return { success: false, error: \"You already own this customization\" };\n\n    if (customization.requiredLevel && user.level < customization.requiredLevel) {\n      return { success: false, error: `Requires level ${customization.requiredLevel}` };\n    }\n\n    const cost = customization.coinCost || 0;\n    if (user.coins < cost) {\n      return { success: false, error: `Not enough coins. Need ${cost}, have ${user.coins}` };\n    }\n\n    const newBalance = user.coins - cost;\n    await db.update(users).set({ coins: newBalance }).where(eq(users.id, userId));\n    await this.unlockCustomization(userId, customizationId);\n\n    return { success: true, newBalance };\n  }\n\n  async hasCustomization(userId: number, customizationId: number): Promise<boolean> {\n    const result = await db\n      .select()\n      .from(userCustomizations)\n      .where(sql`${userCustomizations.userId} = ${userId} AND ${userCustomizations.customizationId} = ${customizationId}`);\n    return result.length > 0;\n  }\n\n  async equipCustomization(userId: number, category: string, customizationId: number): Promise<User> {\n    let updateData: any = {};\n    if (category === 'plate') {\n      updateData.equippedPlateId = customizationId;\n    } else if (category === 'animation') {\n      updateData.equippedAnimationId = customizationId;\n    } else if (category === 'sphere') {\n      updateData.equippedSphereId = customizationId;\n    }\n    const [user] = await db.update(users).set(updateData).where(eq(users.id, userId)).returning();\n    return user;\n  }\n\n  async updateUserLevel(userId: number, level: number): Promise<void> {\n    await db.update(users).set({ level }).where(eq(users.id, userId));\n  }\n\n  async completeTutorial(userId: number): Promise<void> {\n    await db.update(users).set({ tutorialCompleted: true }).where(eq(users.id, userId));\n  }\n\n  async searchUsers(query: string): Promise<User[]> {\n    return await db.select().from(users).where(sql`${users.name} ILIKE ${'%' + query + '%'}`).limit(10);\n  }\n\n  async getUsersByRole(role: string): Promise<User[]> {\n    return await db.select().from(users).where(eq(users.role, role)).limit(50);\n  }\n\n  async createEmailVerificationToken(userId: number): Promise<string> {\n    const token = crypto.randomBytes(32).toString('hex');\n    const expiresAt = new Date(Date.now() + 24 * 60 * 60 * 1000);\n\n    await db.insert(emailVerificationTokens).values({\n      userId,\n      token,\n      expiresAt,\n    });\n\n    return token;\n  }\n\n  async verifyEmailToken(token: string): Promise<{ success: boolean; userId?: number; error?: string }> {\n    const [record] = await db\n      .select()\n      .from(emailVerificationTokens)\n      .where(eq(emailVerificationTokens.token, token));\n\n    if (!record) {\n      return { success: false, error: \"Invalid verification token\" };\n    }\n\n    if (record.consumedAt) {\n      return { success: false, error: \"Token has already been used\" };\n    }\n\n    if (new Date() > record.expiresAt) {\n      return { success: false, error: \"Token has expired\" };\n    }\n\n    await db\n      .update(emailVerificationTokens)\n      .set({ consumedAt: new Date() })\n      .where(eq(emailVerificationTokens.id, record.id));\n\n    await db\n      .update(users)\n      .set({ emailVerified: true })\n      .where(eq(users.id, record.userId));\n\n    return { success: true, userId: record.userId };\n  }\n\n  async createPasswordResetToken(userId: number): Promise<string> {\n    const token = crypto.randomBytes(32).toString('hex');\n    const expiresAt = new Date(Date.now() + 60 * 60 * 1000);\n\n    await db.insert(passwordResetTokens).values({\n      userId,\n      token,\n      expiresAt,\n    });\n\n    return token;\n  }\n\n  async verifyPasswordResetToken(token: string): Promise<{ success: boolean; userId?: number; error?: string }> {\n    const [record] = await db\n      .select()\n      .from(passwordResetTokens)\n      .where(eq(passwordResetTokens.token, token));\n\n    if (!record) {\n      return { success: false, error: \"Invalid reset token\" };\n    }\n\n    if (record.consumedAt) {\n      return { success: false, error: \"Token has already been used\" };\n    }\n\n    if (new Date() > record.expiresAt) {\n      return { success: false, error: \"Token has expired\" };\n    }\n\n    await db\n      .update(passwordResetTokens)\n      .set({ consumedAt: new Date() })\n      .where(eq(passwordResetTokens.id, record.id));\n\n    return { success: true, userId: record.userId };\n  }\n\n  async getUserByEmail(email: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.email, email));\n    return user || undefined;\n  }\n\n  async deleteExpiredTokens(): Promise<void> {\n    const now = new Date();\n    await db.delete(emailVerificationTokens).where(sql`${emailVerificationTokens.expiresAt} < ${now}`);\n    await db.delete(passwordResetTokens).where(sql`${passwordResetTokens.expiresAt} < ${now}`);\n  }\n\n  async createBattleRequest(request: InsertBattleRequest): Promise<BattleRequest> {\n    const [battleRequest] = await db.insert(battleRequests).values(request).returning();\n    return battleRequest;\n  }\n\n  async getBattleRequest(id: number): Promise<BattleRequest | undefined> {\n    const [battleRequest] = await db.select().from(battleRequests).where(eq(battleRequests.id, id));\n    return battleRequest || undefined;\n  }\n\n  async getPendingBattleRequests(userId: number): Promise<Array<BattleRequest & { challengerName: string | null; challengerAvatar: string | null }>> {\n    const result = await db\n      .select({\n        id: battleRequests.id,\n        challengerId: battleRequests.challengerId,\n        challengedId: battleRequests.challengedId,\n        status: battleRequests.status,\n        battleType: battleRequests.battleType,\n        genre: battleRequests.genre,\n        challengerTrack: battleRequests.challengerTrack,\n        challengerAudio: battleRequests.challengerAudio,\n        challengedTrack: battleRequests.challengedTrack,\n        challengedAudio: battleRequests.challengedAudio,\n        message: battleRequests.message,\n        battleId: battleRequests.battleId,\n        expiresAt: battleRequests.expiresAt,\n        createdAt: battleRequests.createdAt,\n        updatedAt: battleRequests.updatedAt,\n        challengerName: users.name,\n        challengerAvatar: users.profileImageUrl,\n      })\n      .from(battleRequests)\n      .innerJoin(users, eq(battleRequests.challengerId, users.id))\n      .where(sql`${battleRequests.challengedId} = ${userId} AND ${battleRequests.status} = 'pending'`)\n      .orderBy(desc(battleRequests.createdAt));\n    return result;\n  }\n\n  async getSentBattleRequests(userId: number): Promise<Array<BattleRequest & { challengedName: string | null; challengedAvatar: string | null }>> {\n    const result = await db\n      .select({\n        id: battleRequests.id,\n        challengerId: battleRequests.challengerId,\n        challengedId: battleRequests.challengedId,\n        status: battleRequests.status,\n        battleType: battleRequests.battleType,\n        genre: battleRequests.genre,\n        challengerTrack: battleRequests.challengerTrack,\n        challengerAudio: battleRequests.challengerAudio,\n        challengedTrack: battleRequests.challengedTrack,\n        challengedAudio: battleRequests.challengedAudio,\n        message: battleRequests.message,\n        battleId: battleRequests.battleId,\n        expiresAt: battleRequests.expiresAt,\n        createdAt: battleRequests.createdAt,\n        updatedAt: battleRequests.updatedAt,\n        challengedName: users.name,\n        challengedAvatar: users.profileImageUrl,\n      })\n      .from(battleRequests)\n      .innerJoin(users, eq(battleRequests.challengedId, users.id))\n      .where(eq(battleRequests.challengerId, userId))\n      .orderBy(desc(battleRequests.createdAt));\n    return result;\n  }\n\n  async updateBattleRequestStatus(id: number, status: string, challengedTrack?: string, challengedAudio?: string): Promise<BattleRequest> {\n    const updateData: any = { status, updatedAt: new Date() };\n    if (challengedTrack) updateData.challengedTrack = challengedTrack;\n    if (challengedAudio) updateData.challengedAudio = challengedAudio;\n    const [battleRequest] = await db.update(battleRequests).set(updateData).where(eq(battleRequests.id, id)).returning();\n    return battleRequest;\n  }\n\n  async linkBattleToRequest(requestId: number, battleId: number): Promise<void> {\n    await db.update(battleRequests).set({ battleId, updatedAt: new Date() }).where(eq(battleRequests.id, requestId));\n  }\n}\n\nexport const storage = new DatabaseStorage();\n","path":null,"size_bytes":33189,"size_tokens":null},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border px-4 py-3 text-sm [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground [&>svg~*]:pl-7\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","path":null,"size_bytes":1598,"size_tokens":null},"client/src/components/ui/input-group.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Textarea } from \"@/components/ui/textarea\"\n\nfunction InputGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"input-group\"\n      role=\"group\"\n      className={cn(\n        \"group/input-group border-input dark:bg-input/30 shadow-xs relative flex w-full items-center rounded-md border outline-none transition-[color,box-shadow]\",\n        \"h-9 has-[>textarea]:h-auto\",\n\n        // Variants based on alignment.\n        \"has-[>[data-align=inline-start]]:[&>input]:pl-2\",\n        \"has-[>[data-align=inline-end]]:[&>input]:pr-2\",\n        \"has-[>[data-align=block-start]]:h-auto has-[>[data-align=block-start]]:flex-col has-[>[data-align=block-start]]:[&>input]:pb-3\",\n        \"has-[>[data-align=block-end]]:h-auto has-[>[data-align=block-end]]:flex-col has-[>[data-align=block-end]]:[&>input]:pt-3\",\n\n        // Focus state.\n        \"has-[[data-slot=input-group-control]:focus-visible]:ring-ring has-[[data-slot=input-group-control]:focus-visible]:ring-1\",\n\n        // Error state.\n        \"has-[[data-slot][aria-invalid=true]]:ring-destructive/20 has-[[data-slot][aria-invalid=true]]:border-destructive dark:has-[[data-slot][aria-invalid=true]]:ring-destructive/40\",\n\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nconst inputGroupAddonVariants = cva(\n  \"text-muted-foreground flex h-auto cursor-text select-none items-center justify-center gap-2 py-1.5 text-sm font-medium group-data-[disabled=true]/input-group:opacity-50 [&>kbd]:rounded-[calc(var(--radius)-5px)] [&>svg:not([class*='size-'])]:size-4\",\n  {\n    variants: {\n      align: {\n        \"inline-start\":\n          \"order-first pl-3 has-[>button]:ml-[-0.45rem] has-[>kbd]:ml-[-0.35rem]\",\n        \"inline-end\":\n          \"order-last pr-3 has-[>button]:mr-[-0.4rem] has-[>kbd]:mr-[-0.35rem]\",\n        \"block-start\":\n          \"[.border-b]:pb-3 order-first w-full justify-start px-3 pt-3 group-has-[>input]/input-group:pt-2.5\",\n        \"block-end\":\n          \"[.border-t]:pt-3 order-last w-full justify-start px-3 pb-3 group-has-[>input]/input-group:pb-2.5\",\n      },\n    },\n    defaultVariants: {\n      align: \"inline-start\",\n    },\n  }\n)\n\nfunction InputGroupAddon({\n  className,\n  align = \"inline-start\",\n  ...props\n}: React.ComponentProps<\"div\"> & VariantProps<typeof inputGroupAddonVariants>) {\n  return (\n    <div\n      role=\"group\"\n      data-slot=\"input-group-addon\"\n      data-align={align}\n      className={cn(inputGroupAddonVariants({ align }), className)}\n      onClick={(e) => {\n        if ((e.target as HTMLElement).closest(\"button\")) {\n          return\n        }\n        e.currentTarget.parentElement?.querySelector(\"input\")?.focus()\n      }}\n      {...props}\n    />\n  )\n}\n\nconst inputGroupButtonVariants = cva(\n  \"flex items-center gap-2 text-sm shadow-none\",\n  {\n    variants: {\n      size: {\n        xs: \"h-6 gap-1 rounded-[calc(var(--radius)-5px)] px-2 has-[>svg]:px-2 [&>svg:not([class*='size-'])]:size-3.5\",\n        sm: \"h-8 gap-1.5 rounded-md px-2.5 has-[>svg]:px-2.5\",\n        \"icon-xs\":\n          \"size-6 rounded-[calc(var(--radius)-5px)] p-0 has-[>svg]:p-0\",\n        \"icon-sm\": \"size-8 p-0 has-[>svg]:p-0\",\n      },\n    },\n    defaultVariants: {\n      size: \"xs\",\n    },\n  }\n)\n\nfunction InputGroupButton({\n  className,\n  type = \"button\",\n  variant = \"ghost\",\n  size = \"xs\",\n  ...props\n}: Omit<React.ComponentProps<typeof Button>, \"size\"> &\n  VariantProps<typeof inputGroupButtonVariants>) {\n  return (\n    <Button\n      type={type}\n      data-size={size}\n      variant={variant}\n      className={cn(inputGroupButtonVariants({ size }), className)}\n      {...props}\n    />\n  )\n}\n\nfunction InputGroupText({ className, ...props }: React.ComponentProps<\"span\">) {\n  return (\n    <span\n      className={cn(\n        \"text-muted-foreground flex items-center gap-2 text-sm [&_svg:not([class*='size-'])]:size-4 [&_svg]:pointer-events-none\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction InputGroupInput({\n  className,\n  ...props\n}: React.ComponentProps<\"input\">) {\n  return (\n    <Input\n      data-slot=\"input-group-control\"\n      className={cn(\n        \"flex-1 rounded-none border-0 bg-transparent shadow-none focus-visible:ring-0 dark:bg-transparent\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction InputGroupTextarea({\n  className,\n  ...props\n}: React.ComponentProps<\"textarea\">) {\n  return (\n    <Textarea\n      data-slot=\"input-group-control\"\n      className={cn(\n        \"flex-1 resize-none rounded-none border-0 bg-transparent py-3 shadow-none focus-visible:ring-0 dark:bg-transparent\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  InputGroup,\n  InputGroupAddon,\n  InputGroupButton,\n  InputGroupText,\n  InputGroupInput,\n  InputGroupTextarea,\n}\n","path":null,"size_bytes":4971,"size_tokens":null},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-1.5 w-full grow overflow-hidden rounded-full bg-primary/20\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-4 w-4 rounded-full border border-primary/50 bg-background shadow transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","path":null,"size_bytes":1037,"size_tokens":null},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","path":null,"size_bytes":1723,"size_tokens":null},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","path":null,"size_bytes":80,"size_tokens":null},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","path":null,"size_bytes":166,"size_tokens":null},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-10 px-2 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\n      \"p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]\",\n      className\n    )}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","path":null,"size_bytes":2859,"size_tokens":null},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","path":null,"size_bytes":325,"size_tokens":null},"client/src/components/ui/label.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","path":null,"size_bytes":724,"size_tokens":null},"client/src/index.css":{"content":"@import \"tailwindcss\";\n@import \"tw-animate-css\";\n\n@custom-variant dark (&:is(.dark *));\n\n@theme inline {\n  --color-background: hsl(var(--background));\n  --color-foreground: hsl(var(--foreground));\n  --color-card: hsl(var(--card));\n  --color-card-foreground: hsl(var(--card-foreground));\n  --color-popover: hsl(var(--popover));\n  --color-popover-foreground: hsl(var(--popover-foreground));\n  --color-primary: hsl(var(--primary));\n  --color-primary-foreground: hsl(var(--primary-foreground));\n  --color-secondary: hsl(var(--secondary));\n  --color-secondary-foreground: hsl(var(--secondary-foreground));\n  --color-muted: hsl(var(--muted));\n  --color-muted-foreground: hsl(var(--muted-foreground));\n  --color-accent: hsl(var(--accent));\n  --color-accent-foreground: hsl(var(--accent-foreground));\n  --color-destructive: hsl(var(--destructive));\n  --color-destructive-foreground: hsl(var(--destructive-foreground));\n  --color-border: hsl(var(--border));\n  --color-input: hsl(var(--input));\n  --color-ring: hsl(var(--ring));\n  \n  --radius-sm: calc(var(--radius) - 4px);\n  --radius-md: calc(var(--radius) - 2px);\n  --radius-lg: var(--radius);\n  --radius-xl: calc(var(--radius) + 4px);\n  \n  --font-sans: \"Inter\", sans-serif;\n  --font-heading: \"Orbitron\", sans-serif;\n  --font-punk: \"Permanent Marker\", cursive;\n  --font-hud: \"Rajdhani\", sans-serif;\n\n  --color-sv-black: #050505;\n  --color-sv-dark: #0f0f13;\n  --color-sv-pink: #FF2EC3;\n  --color-sv-purple: #A64BFF;\n  --color-sv-gold: #F6C844;\n  --color-sv-gray: #2a2a35;\n  --color-sv-offwhite: #e0e0e0;\n\n  --animate-float: float 3s ease-in-out infinite;\n  --animate-flicker: flicker 2s infinite;\n  --animate-blob: blob 7s infinite;\n  --animate-audio-pulse: audio-pulse 0.8s infinite ease-in-out;\n  --animate-pulse-fast: pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite;\n}\n\n@keyframes float {\n  0%, 100% { transform: translateY(0); }\n  50% { transform: translateY(-10px); }\n}\n\n@keyframes flicker {\n  0%, 19.999%, 22%, 62.999%, 64%, 64.999%, 70%, 100% {\n    opacity: 0.99;\n    filter: drop-shadow(0 0 1px rgba(255, 46, 195, 0.7));\n  }\n  20%, 21.999%, 63%, 63.999%, 65%, 69.999% {\n    opacity: 0.4;\n    filter: none;\n  }\n}\n\n@keyframes blob {\n  0% { transform: translate(0px, 0px) scale(1); border-radius: 60% 40% 30% 70% / 60% 30% 70% 40%; }\n  33% { transform: translate(30px, -50px) scale(1.1); border-radius: 30% 60% 70% 40% / 50% 60% 30% 60%; }\n  66% { transform: translate(-20px, 20px) scale(0.9); border-radius: 40% 40% 60% 40% / 40% 30% 50% 60%; }\n  100% { transform: translate(0px, 0px) scale(1); border-radius: 60% 40% 30% 70% / 60% 30% 70% 40%; }\n}\n\n@keyframes audio-pulse {\n  0%, 100% { transform: scale(1); opacity: 0.6; }\n  50% { transform: scale(1.15); opacity: 0.9; }\n}\n\n@keyframes spin-slow {\n  from { transform: rotate(0deg); }\n  to { transform: rotate(360deg); }\n}\n\n.animate-spin-slow {\n  animation: spin-slow 3s linear infinite;\n}\n\n.tutorial-highlight {\n  position: relative;\n  z-index: 100;\n  box-shadow: 0 0 0 4px rgba(255, 46, 195, 0.5), 0 0 20px rgba(255, 46, 195, 0.3);\n  border-radius: 8px;\n}\n\n/* SONGVERSUS DARK THEME */\n:root {\n  --background: 240 10% 2%;\n  --foreground: 0 0% 88%;\n\n  --card: 240 10% 5%;\n  --card-foreground: 0 0% 88%;\n\n  --popover: 240 10% 5%;\n  --popover-foreground: 0 0% 88%;\n\n  --primary: 316 100% 59%;\n  --primary-foreground: 0 0% 0%;\n\n  --secondary: 270 100% 65%;\n  --secondary-foreground: 0 0% 100%;\n\n  --muted: 240 5% 16%;\n  --muted-foreground: 240 5% 55%;\n\n  --accent: 45 93% 62%;\n  --accent-foreground: 0 0% 0%;\n\n  --destructive: 0 62.8% 30.6%;\n  --destructive-foreground: 0 0% 98%;\n\n  --border: 240 5% 16%;\n  --input: 240 5% 16%;\n  --ring: 316 100% 59%;\n\n  --radius: 0.25rem;\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n  body {\n    @apply font-sans antialiased bg-sv-black text-sv-offwhite overflow-x-hidden;\n    background-color: #050505;\n  }\n  h1, h2, h3, h4, h5, h6 {\n    @apply font-heading tracking-tight;\n  }\n\n  ::-webkit-scrollbar {\n    width: 8px;\n  }\n  ::-webkit-scrollbar-track {\n    background: #0f0f13; \n  }\n  ::-webkit-scrollbar-thumb {\n    background: #A64BFF; \n    border-radius: 4px;\n  }\n\n  ::selection {\n    background-color: #FF2EC3;\n    color: white;\n  }\n}\n\n@layer utilities {\n  .font-cyber {\n    font-family: 'Orbitron', sans-serif;\n  }\n  .font-punk {\n    font-family: 'Permanent Marker', cursive;\n  }\n  .font-hud {\n    font-family: 'Rajdhani', sans-serif;\n  }\n  .font-body {\n    font-family: 'Inter', sans-serif;\n  }\n\n  .bg-sv-black { background-color: #050505; }\n  .bg-sv-dark { background-color: #0f0f13; }\n  .bg-sv-pink { background-color: #FF2EC3; }\n  .bg-sv-purple { background-color: #A64BFF; }\n  .bg-sv-gold { background-color: #F6C844; }\n  .bg-sv-gray { background-color: #2a2a35; }\n\n  .text-sv-black { color: #050505; }\n  .text-sv-dark { color: #0f0f13; }\n  .text-sv-pink { color: #FF2EC3; }\n  .text-sv-purple { color: #A64BFF; }\n  .text-sv-gold { color: #F6C844; }\n  .text-sv-gray { color: #2a2a35; }\n  .text-sv-offwhite { color: #e0e0e0; }\n\n  .border-sv-pink { border-color: #FF2EC3; }\n  .border-sv-purple { border-color: #A64BFF; }\n  .border-sv-gold { border-color: #F6C844; }\n  .border-sv-gray { border-color: #2a2a35; }\n\n  .glow-pink { box-shadow: 0 0 15px rgba(255, 46, 195, 0.5); }\n  .glow-purple { box-shadow: 0 0 15px rgba(166, 75, 255, 0.5); }\n  .glow-gold { box-shadow: 0 0 15px rgba(246, 200, 68, 0.5); }\n\n  .text-outline-pink {\n    -webkit-text-stroke: 1px #FF2EC3;\n    color: transparent;\n  }\n  .text-outline-purple {\n    -webkit-text-stroke: 1px #A64BFF;\n    color: transparent;\n  }\n\n  .cyber-grid {\n    background-size: 40px 40px;\n    background-image: linear-gradient(to right, rgba(166, 75, 255, 0.1) 1px, transparent 1px),\n                      linear-gradient(to bottom, rgba(166, 75, 255, 0.1) 1px, transparent 1px);\n  }\n\n  .sketch-border {\n    filter: url(#squiggly-1);\n  }\n\n  .torn-paper {\n    clip-path: polygon(0% 0%, 100% 0%, 100% 90%, 95% 95%, 90% 90%, 85% 95%, 80% 90%, 75% 95%, 70% 90%, 65% 95%, 60% 90%, 55% 95%, 50% 90%, 45% 95%, 40% 90%, 35% 95%, 30% 90%, 25% 95%, 20% 90%, 15% 95%, 10% 90%, 5% 95%, 0% 90%);\n  }\n\n  .text-gradient {\n    @apply bg-clip-text text-transparent;\n    background-image: linear-gradient(to right, #FF2EC3, #A64BFF);\n  }\n  \n  .glass-panel {\n    @apply backdrop-blur-md;\n    background: rgba(15, 15, 19, 0.8);\n    border: 1px solid rgba(255, 255, 255, 0.1);\n  }\n\n  .neon-glow {\n    box-shadow: 0 0 20px -5px #FF2EC3;\n  }\n\n  .cyber-btn {\n    position: relative;\n    transform: skewX(-12deg);\n    transition: all 0.3s ease;\n  }\n  .cyber-btn > * {\n    transform: skewX(12deg);\n  }\n  .cyber-btn::before {\n    content: '';\n    position: absolute;\n    top: -2px;\n    right: -2px;\n    width: 8px;\n    height: 8px;\n    background: white;\n  }\n  .cyber-btn::after {\n    content: '';\n    position: absolute;\n    bottom: -2px;\n    left: -2px;\n    width: 8px;\n    height: 8px;\n    background: white;\n  }\n  .cyber-btn:hover {\n    box-shadow: 0 0 15px rgba(255, 46, 195, 0.5);\n  }\n\n  .punk-btn {\n    transition: all 0.3s ease;\n  }\n  .punk-btn:hover {\n    transform: rotate(-2deg);\n    background: rgba(255, 46, 195, 0.1);\n  }\n}\n\n.noise-overlay {\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  pointer-events: none;\n  z-index: 9999;\n  opacity: 0.04;\n  background-image: url(\"data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E\");\n}\n\n/* Disable heavy animations on mobile for better performance */\n@media (max-width: 768px) {\n  .animate-\\[blob_7s_infinite\\],\n  .animate-\\[blob_7s_infinite_2s\\],\n  [class*=\"animate-blob\"] {\n    animation: none !important;\n    transform: none !important;\n  }\n  \n  .animate-pulse {\n    animation: none !important;\n  }\n  \n  .animate-spin-slow {\n    animation: none !important;\n  }\n  \n  /* Reduce motion for framer-motion elements */\n  [style*=\"transform\"] {\n    transition: none !important;\n  }\n}\n\n/* Respect user preference for reduced motion */\n@media (prefers-reduced-motion: reduce) {\n  *,\n  *::before,\n  *::after {\n    animation-duration: 0.01ms !important;\n    animation-iteration-count: 1 !important;\n    transition-duration: 0.01ms !important;\n  }\n}\n","path":null,"size_bytes":8339,"size_tokens":null},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport { registerRoutes } from \"./routes\";\nimport { serveStatic } from \"./static\";\nimport { createServer } from \"http\";\nimport { runMigrations } from 'stripe-replit-sync';\nimport { getStripeSync } from \"./stripeClient\";\nimport { WebhookHandlers } from \"./webhookHandlers\";\n\nconst app = express();\nconst httpServer = createServer(app);\n\ndeclare module \"http\" {\n  interface IncomingMessage {\n    rawBody: unknown;\n  }\n}\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\nasync function initStripe() {\n  const databaseUrl = process.env.DATABASE_URL;\n\n  if (!databaseUrl) {\n    log('DATABASE_URL not found, skipping Stripe initialization', 'stripe');\n    return;\n  }\n\n  try {\n    log('Initializing Stripe schema...', 'stripe');\n    await runMigrations({ databaseUrl });\n    log('Stripe schema ready', 'stripe');\n\n    const stripeSync = await getStripeSync();\n\n    const domains = process.env.REPLIT_DOMAINS;\n    if (domains) {\n      log('Setting up managed webhook...', 'stripe');\n      const webhookBaseUrl = `https://${domains.split(',')[0]}`;\n      const { webhook, uuid } = await stripeSync.findOrCreateManagedWebhook(\n        `${webhookBaseUrl}/api/stripe/webhook`,\n        {\n          enabled_events: ['*'],\n          description: 'Managed webhook for SongVersus Stripe sync',\n        }\n      );\n      log(`Webhook configured: ${webhook.url} (UUID: ${uuid})`, 'stripe');\n    } else {\n      log('REPLIT_DOMAINS not set, skipping webhook setup', 'stripe');\n    }\n\n    log('Syncing Stripe data in background...', 'stripe');\n    stripeSync.syncBackfill()\n      .then(() => {\n        log('Stripe data synced', 'stripe');\n      })\n      .catch((err: Error) => {\n        log(`Error syncing Stripe data: ${err.message}`, 'stripe');\n      });\n  } catch (error: any) {\n    log(`Failed to initialize Stripe: ${error.message}`, 'stripe');\n  }\n}\n\n(async () => {\n  await initStripe();\n\n  app.post(\n    '/api/stripe/webhook/:uuid',\n    express.raw({ type: 'application/json' }),\n    async (req, res) => {\n      const signature = req.headers['stripe-signature'];\n\n      if (!signature) {\n        return res.status(400).json({ error: 'Missing stripe-signature' });\n      }\n\n      try {\n        const sig = Array.isArray(signature) ? signature[0] : signature;\n\n        if (!Buffer.isBuffer(req.body)) {\n          log('Webhook error: req.body is not a Buffer', 'stripe');\n          return res.status(500).json({ error: 'Webhook processing error' });\n        }\n\n        const { uuid } = req.params;\n        await WebhookHandlers.processWebhook(req.body as Buffer, sig, uuid);\n\n        res.status(200).json({ received: true });\n      } catch (error: any) {\n        log(`Webhook error: ${error.message}`, 'stripe');\n        res.status(400).json({ error: 'Webhook processing error' });\n      }\n    }\n  );\n\n  app.use(\n    express.json({\n      verify: (req, _res, buf) => {\n        req.rawBody = buf;\n      },\n    }),\n  );\n\n  app.use(express.urlencoded({ extended: false }));\n\n  app.use((req, res, next) => {\n    const start = Date.now();\n    const path = req.path;\n    let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n    const originalResJson = res.json;\n    res.json = function (bodyJson, ...args) {\n      capturedJsonResponse = bodyJson;\n      return originalResJson.apply(res, [bodyJson, ...args]);\n    };\n\n    res.on(\"finish\", () => {\n      const duration = Date.now() - start;\n      if (path.startsWith(\"/api\")) {\n        let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n        if (capturedJsonResponse) {\n          logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n        }\n\n        log(logLine);\n      }\n    });\n\n    next();\n  });\n\n  await registerRoutes(httpServer, app);\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  if (process.env.NODE_ENV === \"production\") {\n    serveStatic(app);\n  } else {\n    const { setupVite } = await import(\"./vite\");\n    await setupVite(httpServer, app);\n  }\n\n  const port = parseInt(process.env.PORT || \"5000\", 10);\n  httpServer.listen(\n    {\n      port,\n      host: \"0.0.0.0\",\n      reusePort: true,\n    },\n    () => {\n      log(`serving on port ${port}`);\n    },\n  );\n})();\n","path":null,"size_bytes":4666,"size_tokens":null},"shared/schema.ts":{"content":"import { sql } from \"drizzle-orm\";\nimport { pgTable, text, varchar, serial, integer, timestamp, boolean, index, jsonb } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\nexport const sessions = pgTable(\n  \"sessions\",\n  {\n    sid: varchar(\"sid\").primaryKey(),\n    sess: jsonb(\"sess\").notNull(),\n    expire: timestamp(\"expire\").notNull(),\n  },\n  (table) => [index(\"IDX_session_expire\").on(table.expire)],\n);\n\nexport const users = pgTable(\"users\", {\n  id: serial(\"id\").primaryKey(),\n  replitAuthId: varchar(\"replit_auth_id\").unique(),\n  email: varchar(\"email\").unique(),\n  emailVerified: boolean(\"email_verified\").notNull().default(false),\n  firstName: varchar(\"first_name\"),\n  lastName: varchar(\"last_name\"),\n  profileImageUrl: varchar(\"profile_image_url\"),\n  name: text(\"name\"),\n  role: text(\"role\").default(\"artist\"),\n  roleSelected: boolean(\"role_selected\").notNull().default(false),\n  coins: integer(\"coins\").notNull().default(1000),\n  xp: integer(\"xp\").notNull().default(0),\n  level: integer(\"level\").notNull().default(1),\n  wins: integer(\"wins\").notNull().default(0),\n  bio: text(\"bio\").default(\"\"),\n  membership: text(\"membership\").notNull().default(\"free\"),\n  stripeCustomerId: text(\"stripe_customer_id\"),\n  stripeSubscriptionId: text(\"stripe_subscription_id\"),\n  equippedPlateId: integer(\"equipped_plate_id\"),\n  equippedAnimationId: integer(\"equipped_animation_id\"),\n  equippedSphereId: integer(\"equipped_sphere_id\"),\n  tutorialCompleted: boolean(\"tutorial_completed\").notNull().default(false),\n  foundersBadge: boolean(\"founders_badge\").notNull().default(false),\n  membershipPurchasedAt: timestamp(\"membership_purchased_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const battles = pgTable(\"battles\", {\n  id: serial(\"id\").primaryKey(),\n  type: text(\"type\").notNull(),\n  genre: text(\"genre\").notNull(),\n  status: text(\"status\").notNull().default(\"pending\"),\n  leftArtist: text(\"left_artist\").notNull(),\n  leftTrack: text(\"left_track\").notNull(),\n  leftAudio: text(\"left_audio\").notNull(),\n  leftUserId: integer(\"left_user_id\").references(() => users.id),\n  rightArtist: text(\"right_artist\"),\n  rightTrack: text(\"right_track\"),\n  rightAudio: text(\"right_audio\"),\n  rightUserId: integer(\"right_user_id\").references(() => users.id),\n  leftVotes: integer(\"left_votes\").notNull().default(0),\n  rightVotes: integer(\"right_votes\").notNull().default(0),\n  endsAt: timestamp(\"ends_at\"),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\nexport const votes = pgTable(\"votes\", {\n  id: serial(\"id\").primaryKey(),\n  battleId: integer(\"battle_id\").notNull().references(() => battles.id),\n  userId: integer(\"user_id\").notNull().references(() => users.id),\n  side: text(\"side\").notNull(),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\nexport const comments = pgTable(\"comments\", {\n  id: serial(\"id\").primaryKey(),\n  battleId: integer(\"battle_id\").notNull().references(() => battles.id),\n  userId: integer(\"user_id\").notNull().references(() => users.id),\n  text: text(\"text\").notNull(),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\nexport const chatMessages = pgTable(\"chat_messages\", {\n  id: serial(\"id\").primaryKey(),\n  userId: integer(\"user_id\").notNull().references(() => users.id),\n  text: text(\"text\").notNull(),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\nexport const follows = pgTable(\"follows\", {\n  id: serial(\"id\").primaryKey(),\n  followerId: integer(\"follower_id\").notNull().references(() => users.id),\n  followingId: integer(\"following_id\").notNull().references(() => users.id),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\nexport const notifications = pgTable(\"notifications\", {\n  id: serial(\"id\").primaryKey(),\n  userId: integer(\"user_id\").notNull().references(() => users.id),\n  fromUserId: integer(\"from_user_id\").references(() => users.id),\n  type: text(\"type\").notNull(),\n  battleId: integer(\"battle_id\").references(() => battles.id),\n  message: text(\"message\").notNull(),\n  read: boolean(\"read\").notNull().default(false),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\nexport const messages = pgTable(\"messages\", {\n  id: serial(\"id\").primaryKey(),\n  fromUserId: integer(\"from_user_id\").notNull().references(() => users.id),\n  toUserId: integer(\"to_user_id\").notNull().references(() => users.id),\n  subject: text(\"subject\").notNull(),\n  content: text(\"content\").notNull(),\n  read: boolean(\"read\").notNull().default(false),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\nexport const customizations = pgTable(\"customizations\", {\n  id: serial(\"id\").primaryKey(),\n  category: text(\"category\").notNull(),\n  name: text(\"name\").notNull(),\n  description: text(\"description\"),\n  previewUrl: text(\"preview_url\"),\n  cssClass: text(\"css_class\"),\n  animationData: jsonb(\"animation_data\"),\n  unlockType: text(\"unlock_type\").notNull().default(\"level\"),\n  requiredLevel: integer(\"required_level\").default(1),\n  coinCost: integer(\"coin_cost\").default(0),\n  rarity: text(\"rarity\").notNull().default(\"common\"),\n  isDefault: boolean(\"is_default\").notNull().default(false),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\nexport const userCustomizations = pgTable(\"user_customizations\", {\n  id: serial(\"id\").primaryKey(),\n  userId: integer(\"user_id\").notNull().references(() => users.id),\n  customizationId: integer(\"customization_id\").notNull().references(() => customizations.id),\n  unlockedAt: timestamp(\"unlocked_at\").notNull().defaultNow(),\n}, (table) => [\n  index(\"user_customization_unique\").on(table.userId, table.customizationId),\n]);\n\nexport const emailVerificationTokens = pgTable(\"email_verification_tokens\", {\n  id: serial(\"id\").primaryKey(),\n  userId: integer(\"user_id\").notNull().references(() => users.id, { onDelete: 'cascade' }),\n  token: varchar(\"token\", { length: 64 }).notNull().unique(),\n  expiresAt: timestamp(\"expires_at\").notNull(),\n  consumedAt: timestamp(\"consumed_at\"),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n}, (table) => [\n  index(\"idx_verification_token\").on(table.token),\n  index(\"idx_verification_user\").on(table.userId),\n]);\n\nexport const passwordResetTokens = pgTable(\"password_reset_tokens\", {\n  id: serial(\"id\").primaryKey(),\n  userId: integer(\"user_id\").notNull().references(() => users.id, { onDelete: 'cascade' }),\n  token: varchar(\"token\", { length: 64 }).notNull().unique(),\n  expiresAt: timestamp(\"expires_at\").notNull(),\n  consumedAt: timestamp(\"consumed_at\"),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n}, (table) => [\n  index(\"idx_reset_token\").on(table.token),\n  index(\"idx_reset_user\").on(table.userId),\n]);\n\nexport const battleRequests = pgTable(\"battle_requests\", {\n  id: serial(\"id\").primaryKey(),\n  challengerId: integer(\"challenger_id\").notNull().references(() => users.id),\n  challengedId: integer(\"challenged_id\").notNull().references(() => users.id),\n  status: text(\"status\").notNull().default(\"pending\"),\n  battleType: text(\"battle_type\").notNull(),\n  genre: text(\"genre\").notNull().default(\"general\"),\n  challengerTrack: text(\"challenger_track\").notNull(),\n  challengerAudio: text(\"challenger_audio\").notNull(),\n  challengedTrack: text(\"challenged_track\"),\n  challengedAudio: text(\"challenged_audio\"),\n  message: text(\"message\"),\n  battleId: integer(\"battle_id\").references(() => battles.id),\n  expiresAt: timestamp(\"expires_at\").notNull(),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n  updatedAt: timestamp(\"updated_at\").notNull().defaultNow(),\n});\n\nexport type User = typeof users.$inferSelect;\nexport type UpsertUser = {\n  replitAuthId: string;\n  email?: string | null;\n  firstName?: string | null;\n  lastName?: string | null;\n  profileImageUrl?: string | null;\n};\n\nexport const insertBattleSchema = createInsertSchema(battles)\n  .omit({\n    id: true,\n    createdAt: true,\n    status: true,\n    leftVotes: true,\n    rightVotes: true,\n    rightArtist: true,\n    rightTrack: true,\n    rightAudio: true,\n    rightUserId: true,\n  })\n  .extend({\n    endsAt: z.union([z.date(), z.string().transform((s) => new Date(s))]).optional(),\n  });\n\nexport const joinBattleSchema = z.object({\n  battleId: z.number(),\n  artist: z.string().min(1),\n  track: z.string().min(1),\n  audio: z.string().min(1),\n});\n\nexport const insertVoteSchema = createInsertSchema(votes).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertCommentSchema = createInsertSchema(comments).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertChatMessageSchema = createInsertSchema(chatMessages).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertFollowSchema = createInsertSchema(follows).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertNotificationSchema = createInsertSchema(notifications).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport type Battle = typeof battles.$inferSelect;\nexport type InsertBattle = z.infer<typeof insertBattleSchema>;\n\nexport type Vote = typeof votes.$inferSelect;\nexport type InsertVote = z.infer<typeof insertVoteSchema>;\n\nexport type Comment = typeof comments.$inferSelect;\nexport type InsertComment = z.infer<typeof insertCommentSchema>;\n\nexport type ChatMessage = typeof chatMessages.$inferSelect;\nexport type InsertChatMessage = z.infer<typeof insertChatMessageSchema>;\n\nexport type Follow = typeof follows.$inferSelect;\nexport type InsertFollow = z.infer<typeof insertFollowSchema>;\n\nexport type Notification = typeof notifications.$inferSelect;\nexport type InsertNotification = z.infer<typeof insertNotificationSchema>;\n\nexport const insertMessageSchema = createInsertSchema(messages).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport type Message = typeof messages.$inferSelect;\nexport type InsertMessage = z.infer<typeof insertMessageSchema>;\n\nexport const insertCustomizationSchema = createInsertSchema(customizations).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertUserCustomizationSchema = createInsertSchema(userCustomizations).omit({\n  id: true,\n  unlockedAt: true,\n});\n\nexport type Customization = typeof customizations.$inferSelect;\nexport type InsertCustomization = z.infer<typeof insertCustomizationSchema>;\n\nexport type UserCustomization = typeof userCustomizations.$inferSelect;\nexport type InsertUserCustomization = z.infer<typeof insertUserCustomizationSchema>;\n\nexport const insertBattleRequestSchema = createInsertSchema(battleRequests).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n  status: true,\n  challengedTrack: true,\n  challengedAudio: true,\n  battleId: true,\n});\n\nexport type BattleRequest = typeof battleRequests.$inferSelect;\nexport type InsertBattleRequest = z.infer<typeof insertBattleRequestSchema>;\n","path":null,"size_bytes":10786,"size_tokens":null},"client/src/pages/Leaderboard.tsx":{"content":"import { Navbar } from \"@/components/layout/Navbar\";\nimport { Footer } from \"@/components/layout/Footer\";\nimport { Button } from \"@/components/ui/button\";\nimport { Avatar, AvatarImage, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Trophy, TrendingUp, Flame, Crown, Coins, Star, Loader2 } from \"lucide-react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { fetchLeaderboard } from \"@/lib/api\";\n\nexport default function Leaderboard() {\n  const { data: leaderboardData, isLoading } = useQuery({\n    queryKey: [\"leaderboard\"],\n    queryFn: fetchLeaderboard,\n  });\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-background flex flex-col\">\n        <Navbar />\n        <main className=\"flex-grow pt-24 pb-20 flex items-center justify-center\">\n          <Loader2 className=\"w-8 h-8 animate-spin text-violet-500\" />\n        </main>\n        <Footer />\n      </div>\n    );\n  }\n\n  const LEADERBOARD_DATA = (leaderboardData || []).map((user, index) => ({\n    rank: index + 1,\n    name: user.name,\n    xp: user.xp,\n    wins: user.wins,\n    coins: user.coins,\n    avatar: user.avatar,\n    trend: \"same\",\n  }));\n  return (\n    <div className=\"min-h-screen bg-background flex flex-col\">\n      <Navbar />\n      \n      <main className=\"flex-grow pt-24 pb-20\">\n        <div className=\"container mx-auto px-4\">\n          \n          <div className=\"flex flex-col md:flex-row items-end md:items-center justify-between gap-6 mb-10\">\n            <div>\n              <h1 className=\"text-4xl font-bold font-heading text-white mb-2\">Global Leaderboard</h1>\n              <p className=\"text-muted-foreground\">Top artists and producers ranked by XP.</p>\n            </div>\n            \n            <div className=\"flex items-center gap-4 bg-card/50 border border-white/10 rounded-full px-4 py-2 backdrop-blur-sm\">\n              <div className=\"flex items-center gap-2 text-sm text-muted-foreground border-r border-white/10 pr-4\">\n                <Star className=\"w-4 h-4 text-violet-400\" />\n                <span>Win Battle = <strong>+500 XP</strong></span>\n              </div>\n              <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                <Coins className=\"w-4 h-4 text-yellow-400\" />\n                <span>Win Coins = <strong>Store Items</strong></span>\n              </div>\n            </div>\n          </div>\n\n          {/* Top 3 Podium */}\n          {LEADERBOARD_DATA.length > 0 && (\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6 mb-12 items-end\">\n              {/* 2nd Place */}\n              {LEADERBOARD_DATA[1] && (\n                <div className=\"bg-card/50 border border-white/10 rounded-2xl p-6 flex flex-col items-center backdrop-blur-sm order-2 md:order-1 relative\">\n                  <div className=\"absolute -top-4 w-8 h-8 bg-slate-300 rounded-full flex items-center justify-center font-bold text-black border-2 border-background\">2</div>\n                  <Avatar className=\"w-20 h-20 border-2 border-slate-300 mb-4\">\n                    <AvatarImage src={LEADERBOARD_DATA[1].avatar} />\n                    <AvatarFallback>2</AvatarFallback>\n                  </Avatar>\n                  <h3 className=\"font-bold text-white text-lg mb-1\">{LEADERBOARD_DATA[1].name}</h3>\n                  <div className=\"text-violet-400 font-bold font-mono\">{LEADERBOARD_DATA[1].xp.toLocaleString()} XP</div>\n                  <div className=\"text-xs text-muted-foreground mt-2 flex items-center gap-1\">\n                    <Trophy className=\"w-3 h-3\" /> {LEADERBOARD_DATA[1].wins} Wins\n                  </div>\n                </div>\n              )}\n\n              {/* 1st Place */}\n              <div className=\"bg-linear-to-b from-violet-500/20 to-card/50 border border-violet-500/50 rounded-2xl p-8 flex flex-col items-center backdrop-blur-sm order-1 md:order-2 relative transform md:-translate-y-4 shadow-xl shadow-violet-500/10\">\n                <div className=\"absolute -top-6 w-12 h-12 bg-yellow-400 rounded-full flex items-center justify-center font-bold text-black border-4 border-background text-xl\">\n                  <Crown className=\"w-6 h-6\" />\n                </div>\n                <Avatar className=\"w-24 h-24 border-4 border-yellow-400 mb-4 shadow-lg shadow-yellow-400/20\">\n                  <AvatarImage src={LEADERBOARD_DATA[0].avatar} />\n                  <AvatarFallback>1</AvatarFallback>\n                </Avatar>\n                <h3 className=\"font-bold text-white text-xl mb-1\">{LEADERBOARD_DATA[0].name}</h3>\n                <div className=\"text-yellow-400 font-bold font-mono text-lg\">{LEADERBOARD_DATA[0].xp.toLocaleString()} XP</div>\n                <div className=\"text-sm text-muted-foreground mt-2 flex items-center gap-1\">\n                  <Trophy className=\"w-4 h-4 text-yellow-500\" /> {LEADERBOARD_DATA[0].wins} Wins\n                </div>\n              </div>\n\n              {/* 3rd Place */}\n              {LEADERBOARD_DATA[2] && (\n                <div className=\"bg-card/50 border border-white/10 rounded-2xl p-6 flex flex-col items-center backdrop-blur-sm order-3 relative\">\n                  <div className=\"absolute -top-4 w-8 h-8 bg-amber-600 rounded-full flex items-center justify-center font-bold text-black border-2 border-background\">3</div>\n                  <Avatar className=\"w-20 h-20 border-2 border-amber-600 mb-4\">\n                    <AvatarImage src={LEADERBOARD_DATA[2].avatar} />\n                    <AvatarFallback>3</AvatarFallback>\n                  </Avatar>\n                  <h3 className=\"font-bold text-white text-lg mb-1\">{LEADERBOARD_DATA[2].name}</h3>\n                  <div className=\"text-violet-400 font-bold font-mono\">{LEADERBOARD_DATA[2].xp.toLocaleString()} XP</div>\n                  <div className=\"text-xs text-muted-foreground mt-2 flex items-center gap-1\">\n                    <Trophy className=\"w-3 h-3\" /> {LEADERBOARD_DATA[2].wins} Wins\n                  </div>\n                </div>\n              )}\n            </div>\n          )}\n\n          {/* Full List */}\n          <div className=\"bg-card/30 border border-white/5 rounded-xl overflow-hidden backdrop-blur-sm\">\n            <div className=\"grid grid-cols-12 gap-4 p-4 border-b border-white/5 text-xs font-bold text-muted-foreground uppercase tracking-wider\">\n              <div className=\"col-span-1 text-center\">Rank</div>\n              <div className=\"col-span-5 md:col-span-4\">Artist</div>\n              <div className=\"col-span-2 text-right hidden md:block\">Wins</div>\n              <div className=\"col-span-3 md:col-span-2 text-right\">Coins</div>\n              <div className=\"col-span-3 text-right\">XP</div>\n            </div>\n            \n            {LEADERBOARD_DATA.slice(3).map((user) => (\n              <div key={user.rank} className=\"grid grid-cols-12 gap-4 p-4 items-center hover:bg-white/5 transition-colors border-b border-white/5 last:border-0\">\n                <div className=\"col-span-1 text-center font-mono font-bold text-muted-foreground\">{user.rank}</div>\n                <div className=\"col-span-5 md:col-span-4 flex items-center gap-3\">\n                  <Avatar className=\"w-8 h-8 border border-white/10\">\n                    <AvatarImage src={user.avatar} />\n                    <AvatarFallback>{user.name[0]}</AvatarFallback>\n                  </Avatar>\n                  <span className=\"font-bold text-white truncate\">{user.name}</span>\n                </div>\n                <div className=\"col-span-2 text-right text-muted-foreground hidden md:block\">{user.wins}</div>\n                <div className=\"col-span-3 md:col-span-2 text-right text-yellow-400 font-mono flex items-center justify-end gap-1\">\n                   {user.coins.toLocaleString()} <Coins className=\"w-3 h-3\" />\n                </div>\n                <div className=\"col-span-3 text-right font-bold text-white font-mono\">{user.xp.toLocaleString()}</div>\n              </div>\n            ))}\n          </div>\n\n        </div>\n      </main>\n      <Footer />\n    </div>\n  );\n}\n","path":null,"size_bytes":7993,"size_tokens":null},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center gap-2 rounded-md text-sm font-medium transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent shadow-sm hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-9 px-2 min-w-9\",\n        sm: \"h-8 px-1.5 min-w-8\",\n        lg: \"h-10 px-2.5 min-w-10\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","path":null,"size_bytes":1486,"size_tokens":null},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","path":null,"size_bytes":1419,"size_tokens":null},"client/src/components/ui/sidebar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, VariantProps } from \"class-variance-authority\"\nimport { PanelLeftIcon } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nfunction SidebarProvider({\n  defaultOpen = true,\n  open: openProp,\n  onOpenChange: setOpenProp,\n  className,\n  style,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  defaultOpen?: boolean\n  open?: boolean\n  onOpenChange?: (open: boolean) => void\n}) {\n  const isMobile = useIsMobile()\n  const [openMobile, setOpenMobile] = React.useState(false)\n\n  // This is the internal state of the sidebar.\n  // We use openProp and setOpenProp for control from outside the component.\n  const [_open, _setOpen] = React.useState(defaultOpen)\n  const open = openProp ?? _open\n  const setOpen = React.useCallback(\n    (value: boolean | ((value: boolean) => boolean)) => {\n      const openState = typeof value === \"function\" ? value(open) : value\n      if (setOpenProp) {\n        setOpenProp(openState)\n      } else {\n        _setOpen(openState)\n      }\n\n      // This sets the cookie to keep the sidebar state.\n      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n    },\n    [setOpenProp, open]\n  )\n\n  // Helper to toggle the sidebar.\n  const toggleSidebar = React.useCallback(() => {\n    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open)\n  }, [isMobile, setOpen, setOpenMobile])\n\n  // Adds a keyboard shortcut to toggle the sidebar.\n  React.useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (\n        event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n        (event.metaKey || event.ctrlKey)\n      ) {\n        event.preventDefault()\n        toggleSidebar()\n      }\n    }\n\n    window.addEventListener(\"keydown\", handleKeyDown)\n    return () => window.removeEventListener(\"keydown\", handleKeyDown)\n  }, [toggleSidebar])\n\n  // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n  // This makes it easier to style the sidebar with Tailwind classes.\n  const state = open ? \"expanded\" : \"collapsed\"\n\n  const contextValue = React.useMemo<SidebarContextProps>(\n    () => ({\n      state,\n      open,\n      setOpen,\n      isMobile,\n      openMobile,\n      setOpenMobile,\n      toggleSidebar,\n    }),\n    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n  )\n\n  return (\n    <SidebarContext.Provider value={contextValue}>\n      <TooltipProvider delayDuration={0}>\n        <div\n          data-slot=\"sidebar-wrapper\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH,\n              \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n              ...style,\n            } as React.CSSProperties\n          }\n          className={cn(\n            \"group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full\",\n            className\n          )}\n          {...props}\n        >\n          {children}\n        </div>\n      </TooltipProvider>\n    </SidebarContext.Provider>\n  )\n}\n\nfunction Sidebar({\n  side = \"left\",\n  variant = \"sidebar\",\n  collapsible = \"offcanvas\",\n  className,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  side?: \"left\" | \"right\"\n  variant?: \"sidebar\" | \"floating\" | \"inset\"\n  collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n}) {\n  const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n  if (collapsible === \"none\") {\n    return (\n      <div\n        data-slot=\"sidebar\"\n        className={cn(\n          \"bg-sidebar text-sidebar-foreground flex h-full w-[var(--sidebar-width)] flex-col\",\n          className\n        )}\n        {...props}\n      >\n        {children}\n      </div>\n    )\n  }\n\n  if (isMobile) {\n    return (\n      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n        <SheetContent\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar\"\n          data-mobile=\"true\"\n          className=\"bg-sidebar text-sidebar-foreground w-[var(--sidebar-width)] p-0 [&>button]:hidden\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n            } as React.CSSProperties\n          }\n          side={side}\n        >\n          <SheetHeader className=\"sr-only\">\n            <SheetTitle>Sidebar</SheetTitle>\n            <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n          </SheetHeader>\n          <div className=\"flex h-full w-full flex-col\">{children}</div>\n        </SheetContent>\n      </Sheet>\n    )\n  }\n\n  return (\n    <div\n      className=\"group peer text-sidebar-foreground hidden md:block\"\n      data-state={state}\n      data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n      data-variant={variant}\n      data-side={side}\n      data-slot=\"sidebar\"\n    >\n      {/* This is what handles the sidebar gap on desktop */}\n      <div\n        data-slot=\"sidebar-gap\"\n        className={cn(\n          \"relative w-[var(--sidebar-width)] bg-transparent transition-[width] duration-200 ease-linear\",\n          \"group-data-[collapsible=offcanvas]:w-0\",\n          \"group-data-[side=right]:rotate-180\",\n          variant === \"floating\" || variant === \"inset\"\n            ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4))]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)]\"\n        )}\n      />\n      <div\n        data-slot=\"sidebar-container\"\n        className={cn(\n          \"fixed inset-y-0 z-10 hidden h-svh w-[var(--sidebar-width)] transition-[left,right,width] duration-200 ease-linear md:flex\",\n          side === \"left\"\n            ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n            : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n          // Adjust the padding for floating and inset variants.\n          variant === \"floating\" || variant === \"inset\"\n            ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4)+2px)]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n          className\n        )}\n        {...props}\n      >\n        <div\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar-inner\"\n          className=\"bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm\"\n        >\n          {children}\n        </div>\n      </div>\n    </div>\n  )\n}\n\nfunction SidebarTrigger({\n  className,\n  onClick,\n  ...props\n}: React.ComponentProps<typeof Button>) {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      data-sidebar=\"trigger\"\n      data-slot=\"sidebar-trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeftIcon />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n}\n\nfunction SidebarRail({ className, ...props }: React.ComponentProps<\"button\">) {\n  const { toggleSidebar } = useSidebar()\n\n  // Note: Tailwind v3.4 doesn't support \"in-\" selectors. So the rail won't work perfectly.\n  return (\n    <button\n      data-sidebar=\"rail\"\n      data-slot=\"sidebar-rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"hover:after:bg-sidebar-border absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear group-data-[side=left]:-right-4 group-data-[side=right]:left-0 after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] sm:flex\",\n        \"in-data-[side=left]:cursor-w-resize in-data-[side=right]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"hover:group-data-[collapsible=offcanvas]:bg-sidebar group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInset({ className, ...props }: React.ComponentProps<\"main\">) {\n  return (\n    <main\n      data-slot=\"sidebar-inset\"\n      className={cn(\n        \"bg-background relative flex w-full flex-1 flex-col\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow-sm md:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInput({\n  className,\n  ...props\n}: React.ComponentProps<typeof Input>) {\n  return (\n    <Input\n      data-slot=\"sidebar-input\"\n      data-sidebar=\"input\"\n      className={cn(\"bg-background h-8 w-full shadow-none\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-header\"\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-footer\"\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarSeparator({\n  className,\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"sidebar-separator\"\n      data-sidebar=\"separator\"\n      className={cn(\"bg-sidebar-border mx-2 w-auto\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-content\"\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group\"\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupLabel({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-label\"\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"text-sidebar-foreground/70 ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:h-4 [&>svg]:w-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupAction({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"button\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-action\"\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground absolute top-3.5 right-3 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupContent({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group-content\"\n      data-sidebar=\"group-content\"\n      className={cn(\"w-full text-sm\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenu({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu\"\n      data-sidebar=\"menu\"\n      className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuItem({ className, ...props }: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-item\"\n      data-sidebar=\"menu-item\"\n      className={cn(\"group/menu-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:w-8! group-data-[collapsible=icon]:h-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:p-0!\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction SidebarMenuButton({\n  asChild = false,\n  isActive = false,\n  variant = \"default\",\n  size = \"default\",\n  tooltip,\n  className,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  isActive?: boolean\n  tooltip?: string | React.ComponentProps<typeof TooltipContent>\n} & VariantProps<typeof sidebarMenuButtonVariants>) {\n  const Comp = asChild ? Slot : \"button\"\n  const { isMobile, state } = useSidebar()\n\n  const button = (\n    <Comp\n      data-slot=\"sidebar-menu-button\"\n      data-sidebar=\"menu-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n      {...props}\n    />\n  )\n\n  if (!tooltip) {\n    return button\n  }\n\n  if (typeof tooltip === \"string\") {\n    tooltip = {\n      children: tooltip,\n    }\n  }\n\n  return (\n    <Tooltip>\n      <TooltipTrigger asChild>{button}</TooltipTrigger>\n      <TooltipContent\n        side=\"right\"\n        align=\"center\"\n        hidden={state !== \"collapsed\" || isMobile}\n        {...tooltip}\n      />\n    </Tooltip>\n  )\n}\n\nfunction SidebarMenuAction({\n  className,\n  asChild = false,\n  showOnHover = false,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  showOnHover?: boolean\n}) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-action\"\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground peer-hover/menu-button:text-sidebar-accent-foreground absolute top-1.5 right-1 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"peer-data-[active=true]/menu-button:text-sidebar-accent-foreground group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuBadge({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-menu-badge\"\n      data-sidebar=\"menu-badge\"\n      className={cn(\n        \"text-sidebar-foreground pointer-events-none absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums select-none\",\n        \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSkeleton({\n  className,\n  showIcon = false,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  showIcon?: boolean\n}) {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      data-slot=\"sidebar-menu-skeleton\"\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[var(--skeleton-width)] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n}\n\nfunction SidebarMenuSub({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu-sub\"\n      data-sidebar=\"menu-sub\"\n      className={cn(\n        \"border-sidebar-border mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l px-2.5 py-0.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubItem({\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-sub-item\"\n      data-sidebar=\"menu-sub-item\"\n      className={cn(\"group/menu-sub-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubButton({\n  asChild = false,\n  size = \"md\",\n  isActive = false,\n  className,\n  ...props\n}: React.ComponentProps<\"a\"> & {\n  asChild?: boolean\n  size?: \"sm\" | \"md\"\n  isActive?: boolean\n}) {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-sub-button\"\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground active:bg-sidebar-accent active:text-sidebar-accent-foreground [&>svg]:text-sidebar-accent-foreground flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 outline outline-2 outline-transparent outline-offset-2 focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","path":null,"size_bytes":21846,"size_tokens":null},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationLink,\n  PaginationItem,\n  PaginationPrevious,\n  PaginationNext,\n  PaginationEllipsis,\n}\n","path":null,"size_bytes":2751,"size_tokens":null},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","path":null,"size_bytes":140,"size_tokens":null},"client/src/components/layout/Navbar.tsx":{"content":"import { Link, useLocation } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Search, Bell, Menu, X, ShoppingBag, Coins, LogOut, Zap, Mail, UserPlus, Trophy, MessageSquare } from \"lucide-react\";\nimport { useState, useEffect } from \"react\";\nimport { useUser } from \"@/context/UserContext\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { formatDistanceToNow } from \"date-fns\";\n\ninterface Notification {\n  id: number;\n  userId: number;\n  fromUserId: number | null;\n  type: string;\n  battleId: number | null;\n  message: string;\n  read: boolean;\n  createdAt: string;\n  fromUserName?: string | null;\n  fromUserAvatar?: string | null;\n}\n\nexport function Navbar() {\n  const [location] = useLocation();\n  const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);\n  const { user, isLoading, login, logout } = useUser();\n  const queryClient = useQueryClient();\n\n  const { data: notifications = [] } = useQuery<Notification[]>({\n    queryKey: [\"notifications\", user?.id],\n    queryFn: async () => {\n      if (!user?.id) return [];\n      const res = await fetch(`/api/notifications/${user.id}`, { credentials: 'include' });\n      if (!res.ok) return [];\n      const data = await res.json();\n      return Array.isArray(data) ? data : [];\n    },\n    enabled: !!user?.id,\n    refetchInterval: 30000,\n  });\n\n  const { data: unreadCount = 0 } = useQuery<number>({\n    queryKey: [\"notificationCount\", user?.id],\n    queryFn: async () => {\n      if (!user?.id) return 0;\n      const res = await fetch(`/api/notifications/${user.id}/count`, { credentials: 'include' });\n      if (!res.ok) return 0;\n      const data = await res.json();\n      return data.count || 0;\n    },\n    enabled: !!user?.id,\n    refetchInterval: 30000,\n  });\n\n  const markAllReadMutation = useMutation({\n    mutationFn: async () => {\n      if (!user?.id) return;\n      await fetch(`/api/notifications/${user.id}/read-all`, { method: \"POST\" });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"notifications\"] });\n      queryClient.invalidateQueries({ queryKey: [\"notificationCount\"] });\n    },\n  });\n\n  const getNotificationIcon = (type: string) => {\n    switch (type) {\n      case \"follow\": return <UserPlus className=\"w-4 h-4 text-sv-purple\" />;\n      case \"message\": return <Mail className=\"w-4 h-4 text-sv-pink\" />;\n      case \"vote\": return <Trophy className=\"w-4 h-4 text-sv-gold\" />;\n      default: return <Bell className=\"w-4 h-4 text-gray-400\" />;\n    }\n  };\n\n  const isActive = (path: string) => location === path;\n\n  const displayName = user?.name || user?.firstName || user?.email?.split('@')[0] || 'User';\n  const avatarUrl = user?.profileImageUrl || 'https://github.com/shadcn.png';\n\n  return (\n    <>\n      <nav className=\"fixed top-0 w-full z-50 border-b border-sv-gray bg-sv-black/80 backdrop-blur-md\">\n        <div className=\"max-w-7xl mx-auto px-4 h-16 flex items-center justify-between\">\n          {/* Logo */}\n          <Link href=\"/\" className=\"flex items-center gap-2\">\n            <div className=\"w-8 h-8 bg-sv-pink skew-x-[-12deg] flex items-center justify-center border-2 border-white sketch-border\">\n              <span className=\"font-punk text-black text-xl font-bold -skew-x-[12deg]\">S</span>\n            </div>\n            <span className=\"font-cyber font-bold text-xl tracking-wider text-white hidden sm:block\">\n              SONG<span className=\"text-sv-pink\">VERSUS</span>\n            </span>\n          </Link>\n\n          {/* Desktop Nav */}\n          <div className=\"hidden md:flex items-center gap-6\">\n            <Link href=\"/battles\">\n              <span className={`font-hud font-bold uppercase tracking-widest text-sm transition-colors cursor-pointer ${isActive('/battles') ? 'text-sv-pink' : 'text-gray-400 hover:text-sv-pink'}`}>\n                Battles\n              </span>\n            </Link>\n            <Link href=\"/leaderboard\">\n              <span className={`font-hud font-bold uppercase tracking-widest text-sm transition-colors cursor-pointer ${isActive('/leaderboard') ? 'text-sv-pink' : 'text-gray-400 hover:text-sv-pink'}`}>\n                Leaderboard\n              </span>\n            </Link>\n            <Link href=\"/artists\">\n              <span className={`font-hud font-bold uppercase tracking-widest text-sm transition-colors cursor-pointer ${isActive('/artists') ? 'text-sv-pink' : 'text-gray-400 hover:text-sv-pink'}`}>\n                Artists\n              </span>\n            </Link>\n            <Link href=\"/producers\">\n              <span className={`font-hud font-bold uppercase tracking-widest text-sm transition-colors cursor-pointer ${isActive('/producers') ? 'text-sv-pink' : 'text-gray-400 hover:text-sv-pink'}`}>\n                Producers\n              </span>\n            </Link>\n             <Link href=\"/store\">\n              <span className={`font-hud font-bold uppercase tracking-widest text-sm transition-colors cursor-pointer flex items-center gap-1 ${isActive('/store') ? 'text-sv-gold' : 'text-gray-400 hover:text-sv-gold'}`}>\n                <ShoppingBag className=\"w-4 h-4\" /> Store\n              </span>\n            </Link>\n          </div>\n\n          {/* Actions */}\n          <div className=\"flex items-center gap-2 sm:gap-4\">\n            \n            {/* User Coins Display */}\n            {user && (\n              <div className=\"hidden lg:flex items-center gap-1.5 px-3 py-1.5 bg-sv-gold/10 border border-sv-gold/30 text-sv-gold text-xs font-cyber font-bold mr-2 skew-x-[-6deg]\">\n                <Coins className=\"w-3.5 h-3.5 skew-x-[6deg]\" />\n                <span className=\"skew-x-[6deg]\">{user.coins.toLocaleString()}</span>\n              </div>\n            )}\n\n            {/* Inbox Button */}\n            {user && (\n              <Link href=\"/inbox\">\n                <Button variant=\"ghost\" size=\"icon\" className=\"text-gray-400 hover:text-sv-pink hidden sm:flex relative\" data-testid=\"button-inbox\">\n                  <Mail className=\"w-5 h-5\" />\n                </Button>\n              </Link>\n            )}\n\n            {/* Notifications Dropdown */}\n            {user && (\n              <DropdownMenu>\n                <DropdownMenuTrigger asChild>\n                  <Button variant=\"ghost\" size=\"icon\" className=\"text-gray-400 hover:text-sv-pink hidden sm:flex relative\" data-testid=\"button-notifications\">\n                    <Bell className=\"w-5 h-5\" />\n                    {unreadCount > 0 && (\n                      <span className=\"absolute -top-1 -right-1 w-5 h-5 bg-sv-pink text-black text-xs font-bold flex items-center justify-center\">\n                        {unreadCount > 9 ? \"9+\" : unreadCount}\n                      </span>\n                    )}\n                  </Button>\n                </DropdownMenuTrigger>\n                <DropdownMenuContent className=\"w-80 bg-sv-dark border-sv-gray rounded-none\" align=\"end\">\n                  <DropdownMenuLabel className=\"flex items-center justify-between\">\n                    <span className=\"font-cyber text-white uppercase tracking-wider\">Notifications</span>\n                    {unreadCount > 0 && (\n                      <button \n                        className=\"text-xs text-sv-pink hover:text-white font-hud uppercase tracking-wider\"\n                        onClick={() => markAllReadMutation.mutate()}\n                      >\n                        Mark all read\n                      </button>\n                    )}\n                  </DropdownMenuLabel>\n                  <DropdownMenuSeparator className=\"bg-sv-gray\" />\n                  <ScrollArea className=\"h-[300px]\">\n                    {notifications.length === 0 ? (\n                      <div className=\"p-4 text-center text-gray-500 font-body\">\n                        No notifications yet\n                      </div>\n                    ) : (\n                      notifications.slice(0, 10).map((notification) => (\n                        <div \n                          key={notification.id} \n                          className={`p-3 border-b border-sv-gray/50 hover:bg-sv-purple/10 transition-colors ${!notification.read ? 'bg-sv-purple/5' : ''}`}\n                        >\n                          <div className=\"flex items-start gap-3\">\n                            <div className=\"mt-0.5\">\n                              {getNotificationIcon(notification.type)}\n                            </div>\n                            <div className=\"flex-1 min-w-0\">\n                              <p className=\"text-sm text-white font-body leading-tight\">\n                                {notification.message}\n                              </p>\n                              <p className=\"text-xs text-gray-500 mt-1 font-hud\">\n                                {formatDistanceToNow(new Date(notification.createdAt), { addSuffix: true })}\n                              </p>\n                            </div>\n                            {!notification.read && (\n                              <div className=\"w-2 h-2 bg-sv-pink mt-1.5\" />\n                            )}\n                          </div>\n                        </div>\n                      ))\n                    )}\n                  </ScrollArea>\n                  {notifications.length > 0 && (\n                    <>\n                      <DropdownMenuSeparator className=\"bg-sv-gray\" />\n                      <Link href=\"/inbox\">\n                        <DropdownMenuItem className=\"justify-center text-sv-pink hover:text-white font-hud uppercase tracking-wider text-sm cursor-pointer rounded-none\">\n                          View All\n                        </DropdownMenuItem>\n                      </Link>\n                    </>\n                  )}\n                </DropdownMenuContent>\n              </DropdownMenu>\n            )}\n\n            <Button variant=\"ghost\" size=\"icon\" className=\"text-gray-400 hover:text-sv-pink hidden sm:flex\">\n              <Search className=\"w-5 h-5\" />\n            </Button>\n            \n            <div className=\"h-6 w-px bg-sv-gray mx-1 hidden sm:block\" />\n            \n            {isLoading ? (\n              <div className=\"w-8 h-8 rounded-full bg-sv-gray animate-pulse\" />\n            ) : !user ? (\n              <button \n                className=\"cyber-btn bg-sv-pink text-black font-cyber font-bold py-2 px-6 uppercase tracking-wider text-sm hover:bg-white\"\n                onClick={login}\n                data-testid=\"button-login\"\n              >\n                <span className=\"flex items-center gap-2\">\n                  Login / Sign Up\n                </span>\n              </button>\n            ) : (\n              <DropdownMenu>\n                <DropdownMenuTrigger asChild>\n                  <Button variant=\"ghost\" className=\"relative h-8 w-8 rounded-none border border-sv-purple/50 p-0 hover:glow-purple\" data-testid=\"button-user-menu\">\n                    <Avatar className=\"h-8 w-8 rounded-none\">\n                      <AvatarImage src={avatarUrl} alt={displayName} className=\"rounded-none\" />\n                      <AvatarFallback className=\"rounded-none bg-sv-purple text-white font-punk\">{displayName[0]?.toUpperCase()}</AvatarFallback>\n                    </Avatar>\n                  </Button>\n                </DropdownMenuTrigger>\n                <DropdownMenuContent className=\"w-56 bg-sv-dark border-sv-gray text-sv-offwhite rounded-none\" align=\"end\" forceMount>\n                  <DropdownMenuLabel className=\"font-normal\">\n                    <div className=\"flex flex-col space-y-1\">\n                      <p className=\"text-sm font-cyber font-medium leading-none text-white\">{displayName}</p>\n                      <p className=\"text-xs leading-none text-sv-purple font-hud uppercase tracking-widest\">\n                        {user.role === 'producer' ? 'Producer' : 'Artist'}\n                      </p>\n                    </div>\n                  </DropdownMenuLabel>\n                  <DropdownMenuSeparator className=\"bg-sv-gray\" />\n                  <Link href=\"/profile\">\n                    <DropdownMenuItem className=\"focus:bg-sv-purple/20 focus:text-white cursor-pointer font-hud uppercase tracking-wider text-sm rounded-none\">\n                      Profile\n                    </DropdownMenuItem>\n                  </Link>\n                  <Link href=\"/my-battles\">\n                    <DropdownMenuItem className=\"focus:bg-sv-purple/20 focus:text-white cursor-pointer font-hud uppercase tracking-wider text-sm rounded-none\">\n                      My Battles\n                    </DropdownMenuItem>\n                  </Link>\n                  <Link href=\"/settings\">\n                    <DropdownMenuItem className=\"focus:bg-sv-purple/20 focus:text-white cursor-pointer font-hud uppercase tracking-wider text-sm rounded-none\">\n                      Settings\n                    </DropdownMenuItem>\n                  </Link>\n                  <DropdownMenuSeparator className=\"bg-sv-gray\" />\n                  <DropdownMenuItem className=\"focus:bg-red-500/20 focus:text-red-400 cursor-pointer text-red-400 font-hud uppercase tracking-wider text-sm rounded-none\" onClick={logout}>\n                    <LogOut className=\"mr-2 h-4 w-4\" />\n                    <span>Log out</span>\n                  </DropdownMenuItem>\n                </DropdownMenuContent>\n              </DropdownMenu>\n            )}\n\n            {/* Mobile Menu Toggle */}\n            <Button \n              variant=\"ghost\" \n              size=\"icon\" \n              className=\"md:hidden text-gray-400\"\n              onClick={() => setIsMobileMenuOpen(!isMobileMenuOpen)}\n            >\n              {isMobileMenuOpen ? <X className=\"w-5 h-5\" /> : <Menu className=\"w-5 h-5\" />}\n            </Button>\n          </div>\n        </div>\n\n        {/* Mobile Menu */}\n        {isMobileMenuOpen && (\n          <div className=\"md:hidden border-t border-sv-gray bg-sv-black/95 backdrop-blur-xl\">\n            <div className=\"max-w-7xl mx-auto px-4 py-4 flex flex-col gap-4\">\n              {user && (\n                 <div className=\"flex items-center gap-3 pb-4 border-b border-sv-gray\">\n                    <Avatar className=\"h-10 w-10 rounded-none border border-sv-purple\">\n                      <AvatarImage src={avatarUrl} className=\"rounded-none\" />\n                      <AvatarFallback className=\"rounded-none bg-sv-purple font-punk\">{displayName[0]?.toUpperCase()}</AvatarFallback>\n                    </Avatar>\n                    <div>\n                       <p className=\"font-cyber font-bold text-white\">{displayName}</p>\n                       <p className=\"text-xs text-sv-gold flex items-center gap-1 font-hud\">\n                         <Coins className=\"w-3 h-3\" /> {user.coins.toLocaleString()}\n                       </p>\n                    </div>\n                 </div>\n              )}\n              <Link href=\"/battles\" onClick={() => setIsMobileMenuOpen(false)} className=\"font-hud font-bold uppercase tracking-widest text-gray-400 hover:text-sv-pink\">Battles</Link>\n              <Link href=\"/leaderboard\" onClick={() => setIsMobileMenuOpen(false)} className=\"font-hud font-bold uppercase tracking-widest text-gray-400 hover:text-sv-pink\">Leaderboard</Link>\n              <Link href=\"/artists\" onClick={() => setIsMobileMenuOpen(false)} className=\"font-hud font-bold uppercase tracking-widest text-gray-400 hover:text-sv-pink\">Artists</Link>\n              <Link href=\"/producers\" onClick={() => setIsMobileMenuOpen(false)} className=\"font-hud font-bold uppercase tracking-widest text-gray-400 hover:text-sv-pink\">Producers</Link>\n              <Link href=\"/store\" onClick={() => setIsMobileMenuOpen(false)} className=\"font-hud font-bold uppercase tracking-widest text-sv-gold hover:text-sv-gold/80 flex items-center gap-2\"><ShoppingBag className=\"w-5 h-5\" /> Store</Link>\n              \n              {user && (\n                <>\n                  <div className=\"border-t border-sv-gray pt-4 mt-2\">\n                    <Link href=\"/profile\" onClick={() => setIsMobileMenuOpen(false)} className=\"font-hud font-bold uppercase tracking-widest text-gray-400 hover:text-sv-pink block py-1\">Profile</Link>\n                    <Link href=\"/my-battles\" onClick={() => setIsMobileMenuOpen(false)} className=\"font-hud font-bold uppercase tracking-widest text-gray-400 hover:text-sv-pink block py-1\">My Battles</Link>\n                    <Link href=\"/settings\" onClick={() => setIsMobileMenuOpen(false)} className=\"font-hud font-bold uppercase tracking-widest text-gray-400 hover:text-sv-pink block py-1\">Settings</Link>\n                  </div>\n                </>\n              )}\n              \n              {!user ? (\n                 <button \n                   className=\"cyber-btn w-full bg-sv-pink text-black font-cyber font-bold py-3 uppercase tracking-wider\" \n                   onClick={() => { setIsMobileMenuOpen(false); login(); }}\n                   data-testid=\"button-mobile-login\"\n                 >\n                   <span className=\"flex items-center justify-center gap-2\">\n                     Login / Sign Up\n                   </span>\n                 </button>\n              ) : (\n                 <button \n                   className=\"w-full border-2 border-red-500 text-red-400 font-hud font-bold py-2 uppercase tracking-widest hover:bg-red-500/10\" \n                   onClick={() => { logout(); setIsMobileMenuOpen(false); }}\n                 >\n                   Log Out\n                 </button>\n              )}\n            </div>\n          </div>\n        )}\n      </nav>\n    </>\n  );\n}\n","path":null,"size_bytes":17853,"size_tokens":null},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","path":null,"size_bytes":2712,"size_tokens":null},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","path":null,"size_bytes":768,"size_tokens":null},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const res = await fetch(url, {\n    method,\n    headers: data ? { \"Content-Type\": \"application/json\" } : {},\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const res = await fetch(queryKey.join(\"/\") as string, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","path":null,"size_bytes":1383,"size_tokens":null},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Minus } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-9 w-9 items-center justify-center border-y border-r border-input text-sm shadow-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-1 ring-ring\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Minus />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","path":null,"size_bytes":2143,"size_tokens":null},"client/src/App.tsx":{"content":"import { Switch, Route } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { useState, useEffect } from \"react\";\nimport NotFound from \"@/pages/not-found\";\nimport Home from \"@/pages/Home\";\nimport Battles from \"@/pages/Battles\";\nimport BattleDetail from \"@/pages/BattleDetail\";\nimport Artists from \"@/pages/Artists\";\nimport Producers from \"@/pages/Producers\";\nimport Store from \"@/pages/Store\";\nimport Leaderboard from \"@/pages/Leaderboard\";\nimport Profile from \"@/pages/Profile\";\nimport UserProfile from \"@/pages/UserProfile\";\nimport Notifications from \"@/pages/Notifications\";\nimport Inbox from \"@/pages/Inbox\";\nimport Settings from \"@/pages/Settings\";\nimport MyBattles from \"@/pages/MyBattles\";\nimport Customizations from \"@/pages/Customizations\";\nimport Legal from \"@/pages/Legal\";\nimport Support from \"@/pages/Support\";\nimport { SplashScreen } from \"@/components/SplashScreen\";\nimport { Tutorial } from \"@/components/Tutorial\";\nimport { ClassSelectionDialog } from \"@/components/ClassSelectionDialog\";\n\nfunction Router() {\n  return (\n    <Switch>\n      <Route path=\"/\" component={Home} />\n      <Route path=\"/battles\" component={Battles} />\n      <Route path=\"/battle/:id\" component={BattleDetail} />\n      <Route path=\"/artists\" component={Artists} />\n      <Route path=\"/producers\" component={Producers} />\n      <Route path=\"/store\" component={Store} />\n      <Route path=\"/leaderboard\" component={Leaderboard} />\n      <Route path=\"/profile\" component={Profile} />\n      <Route path=\"/user/:id\" component={UserProfile} />\n      <Route path=\"/notifications\" component={Notifications} />\n      <Route path=\"/inbox\" component={Inbox} />\n      <Route path=\"/settings\" component={Settings} />\n      <Route path=\"/my-battles\" component={MyBattles} />\n      <Route path=\"/customizations\" component={Customizations} />\n      <Route path=\"/legal/:type\" component={Legal} />\n      <Route path=\"/support\" component={Support} />\n      <Route component={NotFound} />\n    </Switch>\n  );\n}\n\nimport { GlobalChat } from \"@/components/chat/GlobalChat\";\nimport { SlotMachine } from \"@/components/games/SlotMachine\";\nimport { UserProvider, useUser } from \"@/context/UserContext\";\n\nfunction AppContent() {\n  const { user, refreshUser } = useUser();\n  const [showSplash, setShowSplash] = useState(() => {\n    return !sessionStorage.getItem(\"splash_seen\");\n  });\n  const [showTutorial, setShowTutorial] = useState(false);\n  const [showClassSelection, setShowClassSelection] = useState(false);\n  const [classSelectionDone, setClassSelectionDone] = useState(() => {\n    return sessionStorage.getItem(\"class_selection_done\") === \"true\";\n  });\n  const [tutorialDone, setTutorialDone] = useState(() => {\n    return sessionStorage.getItem(\"tutorial_seen\") === \"true\";\n  });\n\n  const handleSplashComplete = () => {\n    sessionStorage.setItem(\"splash_seen\", \"true\");\n    setShowSplash(false);\n    \n    if (user && !user.roleSelected && !classSelectionDone) {\n      setShowClassSelection(true);\n    } else if (user && !user.tutorialCompleted && !tutorialDone) {\n      setShowTutorial(true);\n    }\n  };\n\n  const handleClassSelectionComplete = async () => {\n    setShowClassSelection(false);\n    setClassSelectionDone(true);\n    sessionStorage.setItem(\"class_selection_done\", \"true\");\n    const updatedUser = await refreshUser();\n    if (updatedUser && !updatedUser.tutorialCompleted && !tutorialDone) {\n      setShowTutorial(true);\n    }\n  };\n\n  const handleTutorialComplete = async () => {\n    setShowTutorial(false);\n    setTutorialDone(true);\n    sessionStorage.setItem(\"tutorial_seen\", \"true\");\n    if (user) {\n      try {\n        await fetch(\"/api/tutorial/complete\", {\n          method: \"POST\",\n          credentials: \"include\",\n        });\n      } catch (error) {\n        console.error(\"Failed to mark tutorial complete:\", error);\n      }\n    }\n  };\n\n  const handleTutorialSkip = () => {\n    setShowTutorial(false);\n    setTutorialDone(true);\n    sessionStorage.setItem(\"tutorial_seen\", \"true\");\n  };\n\n  useEffect(() => {\n    if (user && !showSplash && !showClassSelection && !showTutorial) {\n      if (!user.roleSelected && !classSelectionDone) {\n        setShowClassSelection(true);\n      } else if (!user.tutorialCompleted && !tutorialDone) {\n        setShowTutorial(true);\n      }\n    }\n  }, [user, showSplash, showClassSelection, showTutorial, classSelectionDone, tutorialDone]);\n\n  return (\n    <>\n      {showSplash && <SplashScreen onComplete={handleSplashComplete} />}\n      {showClassSelection && user && (\n        <ClassSelectionDialog userId={user.id} onComplete={handleClassSelectionComplete} />\n      )}\n      {showTutorial && (\n        <Tutorial onComplete={handleTutorialComplete} onSkip={handleTutorialSkip} />\n      )}\n      <Toaster />\n      <Router />\n      <GlobalChat />\n      <SlotMachine />\n    </>\n  );\n}\n\nfunction App() {\n  return (\n    <QueryClientProvider client={queryClient}>\n      <UserProvider>\n        <TooltipProvider>\n          <AppContent />\n        </TooltipProvider>\n      </UserProvider>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;\n","path":null,"size_bytes":5254,"size_tokens":null},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","path":null,"size_bytes":4845,"size_tokens":null},"server/webhookHandlers.ts":{"content":"import { getStripeSync } from './stripeClient';\n\nexport class WebhookHandlers {\n  static async processWebhook(payload: Buffer, signature: string, uuid: string): Promise<void> {\n    if (!Buffer.isBuffer(payload)) {\n      throw new Error(\n        'STRIPE WEBHOOK ERROR: Payload must be a Buffer. ' +\n        'Received type: ' + typeof payload + '. ' +\n        'This usually means express.json() parsed the body before reaching this handler. ' +\n        'FIX: Ensure webhook route is registered BEFORE app.use(express.json()).'\n      );\n    }\n\n    const sync = await getStripeSync();\n    await sync.processWebhook(payload, signature, uuid);\n  }\n}\n","path":null,"size_bytes":644,"size_tokens":null},"client/src/components/home/Hero.tsx":{"content":"import { motion } from \"framer-motion\";\nimport { Link } from \"wouter\";\nimport { Zap, Play, Mic2, Disc3 } from \"lucide-react\";\nimport heroBg from \"@assets/generated_images/dark_cinematic_music_studio_background_with_neon_lighting.png\";\n\nexport function Hero() {\n  return (\n    <div className=\"relative min-h-screen flex flex-col items-center justify-center pt-16\">\n      {/* Cyber Grid Background */}\n      <div className=\"absolute inset-0 cyber-grid opacity-20 pointer-events-none overflow-x-hidden\"></div>\n      \n      {/* Gradient Background */}\n      <div className=\"absolute inset-0 z-0 overflow-x-hidden\">\n        <div className=\"absolute inset-0 bg-gradient-to-b from-sv-black via-sv-black/90 to-sv-black z-10\" />\n        <img \n          src={heroBg} \n          alt=\"Studio Background\" \n          className=\"w-full h-full object-cover opacity-30\"\n        />\n      </div>\n\n      {/* Animated Background Blobs - Hidden on mobile for performance */}\n      <div className=\"hidden md:block absolute top-1/4 left-1/4 w-96 h-96 bg-sv-pink/20 rounded-full blur-3xl animate-[blob_7s_infinite]\"></div>\n      <div className=\"hidden md:block absolute bottom-1/4 right-1/4 w-96 h-96 bg-sv-purple/20 rounded-full blur-3xl animate-[blob_7s_infinite_2s]\"></div>\n\n      {/* Content */}\n      <div className=\"relative z-10 px-4 text-center max-w-5xl mx-auto\">\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ duration: 0.8 }}\n        >\n          {/* Season Tag */}\n          <div className=\"relative inline-block mb-8\">\n            <span className=\"absolute -top-2 -right-8 md:-right-16 text-lg md:text-2xl font-punk text-sv-gold rotate-12 bg-sv-black px-2 sketch-border\">\n              SEASON 1\n            </span>\n          </div>\n          \n          {/* Main Title */}\n          <div className=\"relative mb-8\">\n            <h1 className=\"text-6xl md:text-9xl font-cyber font-black text-white leading-none\">\n              SONG\n            </h1>\n            <h1 className=\"text-6xl md:text-9xl font-cyber font-black text-sv-pink leading-none\">\n              VERSUS\n            </h1>\n          </div>\n          \n          <p className=\"font-body text-xl text-gray-400 max-w-2xl mx-auto mb-12\">\n            The underground arena where <span className=\"text-white font-bold\">Artists</span> and <span className=\"text-white font-bold\">Producers</span> clash. \n            Drop tracks. Win <span className=\"text-sv-gold font-bold\">ORBs</span>. Become Legend.\n          </p>\n          \n          {/* CTAs */}\n          <div className=\"flex flex-col md:flex-row gap-6 justify-center items-center mb-16\">\n            <Link href=\"/battles\">\n              <button className=\"group relative px-8 py-4 bg-sv-pink text-black font-cyber font-bold text-xl uppercase tracking-wider skew-x-[-12deg] hover:glow-pink transition-all\">\n                <div className=\"absolute inset-0 bg-white opacity-0 group-hover:opacity-20 transition-opacity\"></div>\n                <span className=\"block skew-x-[12deg] flex items-center gap-2\">\n                  Start Battle <Zap className=\"w-5 h-5 fill-black\" />\n                </span>\n                <div className=\"absolute -top-1 -right-1 w-2 h-2 bg-white\"></div>\n                <div className=\"absolute -bottom-1 -left-1 w-2 h-2 bg-white\"></div>\n              </button>\n            </Link>\n            <Link href=\"/battles\">\n              <button className=\"font-punk text-white text-xl border-b-2 border-sv-purple hover:text-sv-purple transition-colors rotate-2\">\n                Watch Top Battles\n              </button>\n            </Link>\n          </div>\n        </motion.div>\n\n        {/* Role Selection Cards */}\n        <motion.div \n          initial={{ opacity: 0, y: 40 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ delay: 0.3, duration: 0.8 }}\n          className=\"mt-8\"\n        >\n          <h3 className=\"text-center font-hud text-sv-gold tracking-[0.5em] mb-8 uppercase text-sm\">Choose Your Class</h3>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8 max-w-4xl mx-auto\">\n            \n            {/* Artist Card */}\n            <Link href=\"/artists\">\n              <div className=\"relative group cursor-pointer\">\n                <div className=\"absolute inset-0 bg-sv-pink/20 blur-xl opacity-0 group-hover:opacity-100 transition-opacity duration-500\"></div>\n                <div className=\"bg-sv-dark border border-sv-gray p-8 h-64 relative overflow-hidden flex flex-col items-center justify-end group-hover:border-sv-pink transition-colors\">\n                  <div className=\"absolute inset-0 opacity-30 flex items-center justify-center\">\n                    <Mic2 className=\"w-48 h-48 text-sv-pink stroke-[0.5] sketch-border group-hover:scale-110 transition-transform duration-500\" />\n                  </div>\n                  \n                  <div className=\"relative z-10 text-center\">\n                    <h2 className=\"text-4xl font-punk text-white mb-2 group-hover:text-sv-pink transition-colors text-outline-pink\">ARTIST</h2>\n                    <p className=\"font-hud text-gray-400 tracking-widest text-sm bg-sv-black/80 px-2 py-1\">VOCALS  RAP  LYRICS</p>\n                  </div>\n\n                  <div className=\"absolute top-4 right-4 opacity-0 group-hover:opacity-100 transition-opacity\">\n                    <div className=\"bg-sv-pink text-black font-bold font-mono text-xs px-2 py-1 rotate-3\">SELECT</div>\n                  </div>\n                </div>\n              </div>\n            </Link>\n\n            {/* Producer Card */}\n            <Link href=\"/producers\">\n              <div className=\"relative group cursor-pointer\">\n                <div className=\"absolute inset-0 bg-sv-purple/20 blur-xl opacity-0 group-hover:opacity-100 transition-opacity duration-500\"></div>\n                <div className=\"bg-sv-dark border border-sv-gray p-8 h-64 relative overflow-hidden flex flex-col items-center justify-end group-hover:border-sv-purple transition-colors\">\n                  <div className=\"absolute inset-0 opacity-30 flex items-center justify-center\">\n                    <Disc3 className=\"w-48 h-48 text-sv-purple stroke-[0.5] sketch-border group-hover:scale-110 transition-transform duration-500\" />\n                  </div>\n                  \n                  <div className=\"relative z-10 text-center\">\n                    <h2 className=\"text-4xl font-punk text-white mb-2 group-hover:text-sv-purple transition-colors text-outline-purple\">PRODUCER</h2>\n                    <p className=\"font-hud text-gray-400 tracking-widest text-sm bg-sv-black/80 px-2 py-1\">BEATS  LOOPS  MIX</p>\n                  </div>\n\n                  <div className=\"absolute top-4 right-4 opacity-0 group-hover:opacity-100 transition-opacity\">\n                    <div className=\"bg-sv-purple text-white font-bold font-mono text-xs px-2 py-1 -rotate-2\">SELECT</div>\n                  </div>\n                </div>\n              </div>\n            </Link>\n          </div>\n        </motion.div>\n\n        {/* Stats */}\n        <motion.div \n          initial={{ opacity: 0 }}\n          animate={{ opacity: 1 }}\n          transition={{ delay: 0.5, duration: 1 }}\n          className=\"grid grid-cols-2 md:grid-cols-4 gap-8 max-w-4xl mx-auto mt-20 border-t border-sv-gray pt-8\"\n        >\n          <div>\n            <div className=\"text-3xl font-cyber font-bold text-white\">24K+</div>\n            <div className=\"text-sm text-gray-500 font-hud uppercase tracking-widest\">Artists</div>\n          </div>\n          <div>\n            <div className=\"text-3xl font-cyber font-bold text-white\">12K+</div>\n            <div className=\"text-sm text-gray-500 font-hud uppercase tracking-widest\">Battles</div>\n          </div>\n          <div>\n            <div className=\"text-3xl font-cyber font-bold text-sv-gold\">18K+</div>\n            <div className=\"text-sm text-gray-500 font-hud uppercase tracking-widest\">Producers</div>\n          </div>\n          <div>\n            <div className=\"text-3xl font-cyber font-bold text-white\">1M+</div>\n            <div className=\"text-sm text-gray-500 font-hud uppercase tracking-widest\">Votes</div>\n          </div>\n        </motion.div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":8256,"size_tokens":null},"script/build.ts":{"content":"import { build as esbuild } from \"esbuild\";\nimport { build as viteBuild } from \"vite\";\nimport { rm, readFile } from \"fs/promises\";\n\n// server deps to bundle to reduce openat(2) syscalls\n// which helps cold start times\nconst allowlist = [\n  \"@google/generative-ai\",\n  \"@neondatabase/serverless\",\n  \"axios\",\n  \"connect-pg-simple\",\n  \"cors\",\n  \"date-fns\",\n  \"drizzle-orm\",\n  \"drizzle-zod\",\n  \"express\",\n  \"express-rate-limit\",\n  \"express-session\",\n  \"jsonwebtoken\",\n  \"memorystore\",\n  \"multer\",\n  \"nanoid\",\n  \"nodemailer\",\n  \"openai\",\n  \"passport\",\n  \"passport-local\",\n  \"stripe\",\n  \"uuid\",\n  \"ws\",\n  \"xlsx\",\n  \"zod\",\n  \"zod-validation-error\",\n];\n\nasync function buildAll() {\n  await rm(\"dist\", { recursive: true, force: true });\n\n  console.log(\"building client...\");\n  await viteBuild();\n\n  console.log(\"building server...\");\n  const pkg = JSON.parse(await readFile(\"package.json\", \"utf-8\"));\n  const allDeps = [\n    ...Object.keys(pkg.dependencies || {}),\n    ...Object.keys(pkg.devDependencies || {}),\n  ];\n  const externals = allDeps.filter((dep) => !allowlist.includes(dep));\n\n  await esbuild({\n    entryPoints: [\"server/index.ts\"],\n    platform: \"node\",\n    bundle: true,\n    format: \"cjs\",\n    outfile: \"dist/index.cjs\",\n    define: {\n      \"process.env.NODE_ENV\": '\"production\"',\n    },\n    minify: true,\n    external: externals,\n    logLevel: \"info\",\n  });\n}\n\nbuildAll().catch((err) => {\n  console.error(err);\n  process.exit(1);\n});\n","path":null,"size_bytes":1439,"size_tokens":null},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","path":null,"size_bytes":565,"size_tokens":null},"client/src/pages/Inbox.tsx":{"content":"import { Navbar } from \"@/components/layout/Navbar\";\nimport { Footer } from \"@/components/layout/Footer\";\nimport { Button } from \"@/components/ui/button\";\nimport { Avatar, AvatarImage, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Loader2, Mail, Send, Inbox as InboxIcon, CheckCheck, UserPlus, Trophy, Bell, Search, Swords, Check, X } from \"lucide-react\";\nimport { useUser } from \"@/context/UserContext\";\nimport { useLocation } from \"wouter\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useState } from \"react\";\nimport { formatDistanceToNow } from \"date-fns\";\nimport { AcceptBattleRequestDialog } from \"@/components/AcceptBattleRequestDialog\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface Message {\n  id: number;\n  fromUserId: number;\n  toUserId: number;\n  subject: string;\n  content: string;\n  read: boolean;\n  createdAt: string;\n  fromUserName?: string;\n  fromUserAvatar?: string;\n  toUserName?: string;\n  toUserAvatar?: string;\n}\n\ninterface Notification {\n  id: number;\n  userId: number;\n  fromUserId: number | null;\n  type: string;\n  battleId: number | null;\n  message: string;\n  read: boolean;\n  createdAt: string;\n  fromUserName?: string | null;\n  fromUserAvatar?: string | null;\n}\n\ninterface User {\n  id: number;\n  name: string;\n  profileImageUrl?: string;\n}\n\ninterface BattleRequest {\n  id: number;\n  challengerId: number;\n  challengedId: number;\n  status: string;\n  battleType: string;\n  genre: string;\n  challengerTrack: string;\n  challengerAudio: string;\n  challengedTrack: string | null;\n  challengedAudio: string | null;\n  message: string | null;\n  expiresAt: string;\n  createdAt: string;\n  challengerName: string | null;\n  challengerAvatar: string | null;\n}\n\nexport default function Inbox() {\n  const { user } = useUser();\n  const [, setLocation] = useLocation();\n  const queryClient = useQueryClient();\n  const { toast } = useToast();\n  const [composeOpen, setComposeOpen] = useState(false);\n  const [selectedMessage, setSelectedMessage] = useState<Message | null>(null);\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [recipientSearch, setRecipientSearch] = useState(\"\");\n  const [selectedRecipient, setSelectedRecipient] = useState<User | null>(null);\n  const [messageSubject, setMessageSubject] = useState(\"\");\n  const [messageContent, setMessageContent] = useState(\"\");\n  const [selectedBattleRequest, setSelectedBattleRequest] = useState<BattleRequest | null>(null);\n  const [acceptDialogOpen, setAcceptDialogOpen] = useState(false);\n\n  if (!user) {\n    return (\n      <div className=\"min-h-screen bg-sv-black flex flex-col\">\n        <Navbar />\n        <main className=\"flex-grow pt-24 pb-20 flex items-center justify-center\">\n          <div className=\"text-center\">\n            <p className=\"text-gray-400 mb-4 font-body\">You need to login to view your inbox</p>\n            <Button onClick={() => setLocation(\"/\")} className=\"cyber-btn bg-sv-pink text-black font-cyber\">\n              Go Home\n            </Button>\n          </div>\n        </main>\n        <Footer />\n      </div>\n    );\n  }\n\n  const { data: messages = [], isLoading: messagesLoading } = useQuery<Message[]>({\n    queryKey: [\"messages\", user.id],\n    queryFn: async () => {\n      const res = await fetch(`/api/messages/${user.id}`);\n      return res.json();\n    },\n    refetchInterval: 30000,\n  });\n\n  const { data: sentMessages = [], isLoading: sentLoading } = useQuery<Message[]>({\n    queryKey: [\"sentMessages\", user.id],\n    queryFn: async () => {\n      const res = await fetch(`/api/messages/${user.id}/sent`);\n      return res.json();\n    },\n    refetchInterval: 30000,\n  });\n\n  const { data: notifications = [], isLoading: notificationsLoading } = useQuery<Notification[]>({\n    queryKey: [\"notifications\", user.id],\n    queryFn: async () => {\n      const res = await fetch(`/api/notifications/${user.id}`);\n      return res.json();\n    },\n    refetchInterval: 30000,\n  });\n\n  const { data: searchResults = [] } = useQuery<User[]>({\n    queryKey: [\"userSearch\", recipientSearch],\n    queryFn: async () => {\n      if (!recipientSearch || recipientSearch.length < 2) return [];\n      const res = await fetch(`/api/leaderboard`);\n      const users = await res.json();\n      return users.filter((u: User) => {\n        const searchName = (u.name || \"\").toLowerCase();\n        return searchName.includes(recipientSearch.toLowerCase()) && u.id !== user.id && u.name;\n      }).slice(0, 5);\n    },\n    enabled: recipientSearch.length >= 2,\n  });\n\n  const { data: battleRequests = [], isLoading: battleRequestsLoading } = useQuery<BattleRequest[]>({\n    queryKey: [\"pendingBattleRequests\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/battle-requests/pending\", { credentials: \"include\" });\n      if (!res.ok) return [];\n      return res.json();\n    },\n    refetchInterval: 30000,\n  });\n\n  const declineBattleRequestMutation = useMutation({\n    mutationFn: async (requestId: number) => {\n      const res = await fetch(`/api/battle-requests/${requestId}/decline`, {\n        method: \"POST\",\n        credentials: \"include\",\n      });\n      if (!res.ok) {\n        const error = await res.json();\n        throw new Error(error.error || \"Failed to decline\");\n      }\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"pendingBattleRequests\"] });\n      toast({ title: \"Battle request declined\" });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Failed to decline\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const markAllNotificationsReadMutation = useMutation({\n    mutationFn: async () => {\n      await fetch(`/api/notifications/${user.id}/read-all`, { method: \"POST\" });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"notifications\"] });\n      queryClient.invalidateQueries({ queryKey: [\"notificationCount\"] });\n    },\n  });\n\n  const markMessageReadMutation = useMutation({\n    mutationFn: async (messageId: number) => {\n      await fetch(`/api/messages/${messageId}/read`, { method: \"POST\" });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"messages\"] });\n    },\n  });\n\n  const sendMessageMutation = useMutation({\n    mutationFn: async (data: { toUserId: number; subject: string; content: string }) => {\n      const res = await fetch(\"/api/messages\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ fromUserId: user.id, ...data }),\n      });\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"sentMessages\"] });\n      setComposeOpen(false);\n      setSelectedRecipient(null);\n      setMessageSubject(\"\");\n      setMessageContent(\"\");\n      setRecipientSearch(\"\");\n    },\n  });\n\n  const getNotificationIcon = (type: string) => {\n    switch (type) {\n      case \"follow\": return <UserPlus className=\"w-4 h-4 text-sv-purple\" />;\n      case \"message\": return <Mail className=\"w-4 h-4 text-sv-pink\" />;\n      case \"vote\": return <Trophy className=\"w-4 h-4 text-sv-gold\" />;\n      case \"battle_request\": return <Swords className=\"w-4 h-4 text-sv-pink\" />;\n      case \"battle_accepted\": return <Check className=\"w-4 h-4 text-green-500\" />;\n      case \"battle_declined\": return <X className=\"w-4 h-4 text-red-500\" />;\n      default: return <Bell className=\"w-4 h-4 text-gray-400\" />;\n    }\n  };\n\n  const unreadMessages = messages.filter(m => !m.read).length;\n  const unreadNotifications = notifications.filter(n => !n.read).length;\n\n  const handleSendMessage = () => {\n    if (!selectedRecipient || !messageSubject.trim() || !messageContent.trim()) return;\n    sendMessageMutation.mutate({\n      toUserId: selectedRecipient.id,\n      subject: messageSubject,\n      content: messageContent,\n    });\n  };\n\n  const handleOpenMessage = (message: Message) => {\n    setSelectedMessage(message);\n    if (!message.read) {\n      markMessageReadMutation.mutate(message.id);\n    }\n  };\n\n  if (messagesLoading || notificationsLoading) {\n    return (\n      <div className=\"min-h-screen bg-sv-black flex flex-col\">\n        <Navbar />\n        <main className=\"flex-grow pt-24 pb-20 flex items-center justify-center\">\n          <Loader2 className=\"w-8 h-8 animate-spin text-sv-pink\" />\n        </main>\n        <Footer />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-sv-black flex flex-col\">\n      <Navbar />\n\n      <main className=\"flex-grow pt-24 pb-20\">\n        <div className=\"container mx-auto px-4\">\n          <div className=\"max-w-4xl mx-auto\">\n            <div className=\"flex items-center justify-between mb-8\">\n              <div>\n                <h1 className=\"font-cyber text-4xl font-bold text-white tracking-wider\">\n                  <span className=\"text-sv-pink\">IN</span>BOX\n                </h1>\n                <p className=\"text-gray-400 mt-2 font-hud uppercase tracking-widest text-sm\">\n                  Messages & Notifications\n                </p>\n              </div>\n              \n              <Dialog open={composeOpen} onOpenChange={setComposeOpen}>\n                <DialogTrigger asChild>\n                  <button className=\"cyber-btn bg-sv-pink text-black font-cyber font-bold py-2 px-6 uppercase tracking-wider text-sm hover:bg-white\" data-testid=\"button-compose\">\n                    <Send className=\"w-4 h-4 mr-2 inline\" />\n                    Compose\n                  </button>\n                </DialogTrigger>\n                <DialogContent className=\"bg-sv-dark border-sv-gray rounded-none max-w-md\">\n                  <DialogHeader>\n                    <DialogTitle className=\"font-cyber text-white uppercase tracking-wider\">New Message</DialogTitle>\n                  </DialogHeader>\n                  <div className=\"space-y-4 mt-4\">\n                    <div className=\"relative\">\n                      <label className=\"text-sm text-gray-400 font-hud uppercase tracking-wider\">To</label>\n                      {selectedRecipient ? (\n                        <div className=\"flex items-center gap-2 mt-1 p-2 bg-sv-purple/20 border border-sv-purple/50\">\n                          <Avatar className=\"w-6 h-6 rounded-none\">\n                            <AvatarImage src={selectedRecipient.profileImageUrl} className=\"rounded-none\" />\n                            <AvatarFallback className=\"rounded-none bg-sv-purple text-white text-xs\">{(selectedRecipient.name || \"?\")[0]}</AvatarFallback>\n                          </Avatar>\n                          <span className=\"font-cyber text-white text-sm\">{selectedRecipient.name || \"Unknown\"}</span>\n                          <button \n                            className=\"ml-auto text-gray-400 hover:text-white\"\n                            onClick={() => setSelectedRecipient(null)}\n                          >\n                            \n                          </button>\n                        </div>\n                      ) : (\n                        <>\n                          <div className=\"relative mt-1\">\n                            <Search className=\"absolute left-2 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-500\" />\n                            <Input\n                              placeholder=\"Search users...\"\n                              value={recipientSearch}\n                              onChange={(e) => setRecipientSearch(e.target.value)}\n                              className=\"pl-8 bg-sv-black border-sv-gray text-white rounded-none font-body\"\n                              data-testid=\"input-recipient-search\"\n                            />\n                          </div>\n                          {searchResults.length > 0 && (\n                            <div className=\"absolute z-10 w-full mt-1 bg-sv-dark border border-sv-gray\">\n                              {searchResults.map((u) => (\n                                <button\n                                  key={u.id}\n                                  className=\"w-full flex items-center gap-2 p-2 hover:bg-sv-purple/20 transition-colors\"\n                                  onClick={() => {\n                                    setSelectedRecipient(u);\n                                    setRecipientSearch(\"\");\n                                  }}\n                                  data-testid={`select-recipient-${u.id}`}\n                                >\n                                  <Avatar className=\"w-6 h-6 rounded-none\">\n                                    <AvatarImage src={u.profileImageUrl} className=\"rounded-none\" />\n                                    <AvatarFallback className=\"rounded-none bg-sv-purple text-white text-xs\">{(u.name || \"?\")[0]}</AvatarFallback>\n                                  </Avatar>\n                                  <span className=\"font-cyber text-white text-sm\">{u.name || \"Unknown\"}</span>\n                                </button>\n                              ))}\n                            </div>\n                          )}\n                        </>\n                      )}\n                    </div>\n                    <div>\n                      <label className=\"text-sm text-gray-400 font-hud uppercase tracking-wider\">Subject</label>\n                      <Input\n                        placeholder=\"Message subject...\"\n                        value={messageSubject}\n                        onChange={(e) => setMessageSubject(e.target.value)}\n                        className=\"mt-1 bg-sv-black border-sv-gray text-white rounded-none font-body\"\n                        data-testid=\"input-message-subject\"\n                      />\n                    </div>\n                    <div>\n                      <label className=\"text-sm text-gray-400 font-hud uppercase tracking-wider\">Message</label>\n                      <Textarea\n                        placeholder=\"Write your message...\"\n                        value={messageContent}\n                        onChange={(e) => setMessageContent(e.target.value)}\n                        className=\"mt-1 bg-sv-black border-sv-gray text-white rounded-none font-body min-h-[120px]\"\n                        data-testid=\"input-message-content\"\n                      />\n                    </div>\n                    <button\n                      className=\"cyber-btn w-full bg-sv-pink text-black font-cyber font-bold py-2 uppercase tracking-wider disabled:opacity-50\"\n                      onClick={handleSendMessage}\n                      disabled={!selectedRecipient || !messageSubject.trim() || !messageContent.trim() || sendMessageMutation.isPending}\n                      data-testid=\"button-send-message\"\n                    >\n                      {sendMessageMutation.isPending ? (\n                        <Loader2 className=\"w-4 h-4 animate-spin inline mr-2\" />\n                      ) : (\n                        <Send className=\"w-4 h-4 inline mr-2\" />\n                      )}\n                      Send Message\n                    </button>\n                  </div>\n                </DialogContent>\n              </Dialog>\n            </div>\n\n            <Tabs defaultValue=\"inbox\" className=\"w-full\">\n              <TabsList className=\"w-full bg-sv-dark border border-sv-gray rounded-none mb-6\">\n                <TabsTrigger \n                  value=\"inbox\" \n                  className=\"flex-1 rounded-none font-hud uppercase tracking-wider text-sm data-[state=active]:bg-sv-pink data-[state=active]:text-black\"\n                  data-testid=\"tab-inbox\"\n                >\n                  <InboxIcon className=\"w-4 h-4 mr-2\" />\n                  Inbox\n                  {unreadMessages > 0 && (\n                    <span className=\"ml-2 bg-sv-pink text-black text-xs px-1.5 py-0.5 font-bold\">{unreadMessages}</span>\n                  )}\n                </TabsTrigger>\n                <TabsTrigger \n                  value=\"sent\" \n                  className=\"flex-1 rounded-none font-hud uppercase tracking-wider text-sm data-[state=active]:bg-sv-purple data-[state=active]:text-white\"\n                  data-testid=\"tab-sent\"\n                >\n                  <Send className=\"w-4 h-4 mr-2\" />\n                  Sent\n                </TabsTrigger>\n                <TabsTrigger \n                  value=\"notifications\" \n                  className=\"flex-1 rounded-none font-hud uppercase tracking-wider text-sm data-[state=active]:bg-sv-gold data-[state=active]:text-black\"\n                  data-testid=\"tab-notifications\"\n                >\n                  <Bell className=\"w-4 h-4 mr-2\" />\n                  Alerts\n                  {unreadNotifications > 0 && (\n                    <span className=\"ml-2 bg-sv-gold text-black text-xs px-1.5 py-0.5 font-bold\">{unreadNotifications}</span>\n                  )}\n                </TabsTrigger>\n                <TabsTrigger \n                  value=\"battles\" \n                  className=\"flex-1 rounded-none font-hud uppercase tracking-wider text-sm data-[state=active]:bg-gradient-to-r data-[state=active]:from-sv-pink data-[state=active]:to-sv-purple data-[state=active]:text-white\"\n                  data-testid=\"tab-battles\"\n                >\n                  <Swords className=\"w-4 h-4 mr-2\" />\n                  Battles\n                  {battleRequests.length > 0 && (\n                    <span className=\"ml-2 bg-sv-pink text-black text-xs px-1.5 py-0.5 font-bold\">{battleRequests.length}</span>\n                  )}\n                </TabsTrigger>\n              </TabsList>\n\n              <TabsContent value=\"inbox\" className=\"mt-0\">\n                {messages.length === 0 ? (\n                  <div className=\"text-center py-16 border border-sv-gray/30 bg-sv-dark/50\">\n                    <Mail className=\"w-12 h-12 text-gray-500 mx-auto mb-4\" />\n                    <p className=\"text-gray-400 font-body\">No messages yet</p>\n                    <p className=\"text-gray-500 text-sm mt-1 font-body\">Messages from other users will appear here</p>\n                  </div>\n                ) : (\n                  <div className=\"space-y-2\">\n                    {messages.map((message) => (\n                      <button\n                        key={message.id}\n                        className={`w-full text-left p-4 border transition-colors ${\n                          message.read \n                            ? \"border-sv-gray/30 bg-sv-dark/30 hover:bg-sv-dark/50\" \n                            : \"border-sv-pink/30 bg-sv-pink/5 hover:bg-sv-pink/10\"\n                        }`}\n                        onClick={() => handleOpenMessage(message)}\n                        data-testid={`message-${message.id}`}\n                      >\n                        <div className=\"flex items-start gap-3\">\n                          <Avatar className=\"w-10 h-10 rounded-none border border-sv-purple/50 flex-shrink-0\">\n                            <AvatarImage src={message.fromUserAvatar} className=\"rounded-none\" />\n                            <AvatarFallback className=\"rounded-none bg-sv-purple text-white font-punk\">\n                              {message.fromUserName?.[0] || \"?\"}\n                            </AvatarFallback>\n                          </Avatar>\n                          <div className=\"flex-1 min-w-0\">\n                            <div className=\"flex items-center gap-2\">\n                              <span className=\"font-cyber text-white text-sm\">{message.fromUserName || \"Unknown\"}</span>\n                              {!message.read && <span className=\"w-2 h-2 bg-sv-pink\" />}\n                            </div>\n                            <p className=\"font-body text-white font-medium truncate\">{message.subject}</p>\n                            <p className=\"text-gray-400 text-sm truncate font-body\">{message.content}</p>\n                          </div>\n                          <span className=\"text-xs text-gray-500 font-hud flex-shrink-0\">\n                            {formatDistanceToNow(new Date(message.createdAt), { addSuffix: true })}\n                          </span>\n                        </div>\n                      </button>\n                    ))}\n                  </div>\n                )}\n              </TabsContent>\n\n              <TabsContent value=\"sent\" className=\"mt-0\">\n                {sentMessages.length === 0 ? (\n                  <div className=\"text-center py-16 border border-sv-gray/30 bg-sv-dark/50\">\n                    <Send className=\"w-12 h-12 text-gray-500 mx-auto mb-4\" />\n                    <p className=\"text-gray-400 font-body\">No sent messages</p>\n                    <p className=\"text-gray-500 text-sm mt-1 font-body\">Messages you send will appear here</p>\n                  </div>\n                ) : (\n                  <div className=\"space-y-2\">\n                    {sentMessages.map((message) => (\n                      <div\n                        key={message.id}\n                        className=\"p-4 border border-sv-gray/30 bg-sv-dark/30\"\n                        data-testid={`sent-message-${message.id}`}\n                      >\n                        <div className=\"flex items-start gap-3\">\n                          <Avatar className=\"w-10 h-10 rounded-none border border-sv-purple/50 flex-shrink-0\">\n                            <AvatarImage src={message.toUserAvatar} className=\"rounded-none\" />\n                            <AvatarFallback className=\"rounded-none bg-sv-purple text-white font-punk\">\n                              {message.toUserName?.[0] || \"?\"}\n                            </AvatarFallback>\n                          </Avatar>\n                          <div className=\"flex-1 min-w-0\">\n                            <div className=\"flex items-center gap-2\">\n                              <span className=\"text-gray-400 text-sm font-hud\">To:</span>\n                              <span className=\"font-cyber text-white text-sm\">{message.toUserName || \"Unknown\"}</span>\n                            </div>\n                            <p className=\"font-body text-white font-medium truncate\">{message.subject}</p>\n                            <p className=\"text-gray-400 text-sm truncate font-body\">{message.content}</p>\n                          </div>\n                          <span className=\"text-xs text-gray-500 font-hud flex-shrink-0\">\n                            {formatDistanceToNow(new Date(message.createdAt), { addSuffix: true })}\n                          </span>\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                )}\n              </TabsContent>\n\n              <TabsContent value=\"notifications\" className=\"mt-0\">\n                <div className=\"flex justify-end mb-4\">\n                  {unreadNotifications > 0 && (\n                    <button\n                      className=\"text-sm text-sv-pink hover:text-white font-hud uppercase tracking-wider\"\n                      onClick={() => markAllNotificationsReadMutation.mutate()}\n                      data-testid=\"button-mark-all-notifications-read\"\n                    >\n                      <CheckCheck className=\"w-4 h-4 inline mr-1\" />\n                      Mark All Read\n                    </button>\n                  )}\n                </div>\n                {notifications.length === 0 ? (\n                  <div className=\"text-center py-16 border border-sv-gray/30 bg-sv-dark/50\">\n                    <Bell className=\"w-12 h-12 text-gray-500 mx-auto mb-4\" />\n                    <p className=\"text-gray-400 font-body\">No notifications yet</p>\n                    <p className=\"text-gray-500 text-sm mt-1 font-body\">You'll receive notifications when users interact with you</p>\n                  </div>\n                ) : (\n                  <div className=\"space-y-2\">\n                    {notifications.map((notification) => (\n                      <div\n                        key={notification.id}\n                        className={`p-4 border transition-colors ${\n                          notification.read \n                            ? \"border-sv-gray/30 bg-sv-dark/30\" \n                            : \"border-sv-purple/30 bg-sv-purple/5\"\n                        }`}\n                        data-testid={`notification-item-${notification.id}`}\n                      >\n                        <div className=\"flex items-start gap-3\">\n                          <div className=\"mt-0.5 flex-shrink-0\">\n                            {getNotificationIcon(notification.type)}\n                          </div>\n                          <div className=\"flex-1 min-w-0\">\n                            <p className=\"font-body text-white\">{notification.message}</p>\n                            <p className=\"text-xs text-gray-500 mt-1 font-hud\">\n                              {formatDistanceToNow(new Date(notification.createdAt), { addSuffix: true })}\n                            </p>\n                          </div>\n                          {!notification.read && <span className=\"w-2 h-2 bg-sv-purple mt-2\" />}\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                )}\n              </TabsContent>\n\n              <TabsContent value=\"battles\" className=\"mt-0\">\n                {battleRequests.length === 0 ? (\n                  <div className=\"text-center py-16 border border-sv-gray/30 bg-sv-dark/50\">\n                    <Swords className=\"w-12 h-12 text-gray-500 mx-auto mb-4\" />\n                    <p className=\"text-gray-400 font-body\">No battle challenges</p>\n                    <p className=\"text-gray-500 text-sm mt-1 font-body\">When someone challenges you to a battle, it will appear here</p>\n                  </div>\n                ) : (\n                  <div className=\"space-y-4\">\n                    {battleRequests.map((request) => (\n                      <div\n                        key={request.id}\n                        className=\"p-4 border border-sv-pink/30 bg-sv-pink/5 rounded-none\"\n                        data-testid={`battle-request-${request.id}`}\n                      >\n                        <div className=\"flex items-start gap-4\">\n                          <Avatar className=\"w-12 h-12 rounded-none border border-sv-purple/50 flex-shrink-0\">\n                            <AvatarImage src={request.challengerAvatar || undefined} className=\"rounded-none\" />\n                            <AvatarFallback className=\"rounded-none bg-sv-purple text-white font-punk\">\n                              {(request.challengerName || \"?\")[0]}\n                            </AvatarFallback>\n                          </Avatar>\n                          <div className=\"flex-1 min-w-0\">\n                            <div className=\"flex items-center gap-2 mb-1\">\n                              <span className=\"font-cyber text-white\">{request.challengerName || \"Unknown\"}</span>\n                              <span className=\"text-xs text-sv-pink font-hud uppercase\">{request.battleType} Battle</span>\n                            </div>\n                            <p className=\"text-gray-300 text-sm font-body mb-1\">\n                              Challenged you with: <span className=\"text-white font-medium\">{request.challengerTrack}</span>\n                            </p>\n                            <p className=\"text-xs text-sv-purple font-hud capitalize mb-1\">Genre: {request.genre}</p>\n                            {request.message && (\n                              <p className=\"text-sm text-gray-400 italic font-body\">\"{request.message}\"</p>\n                            )}\n                            <p className=\"text-xs text-gray-500 font-hud mt-2\">\n                              Expires {formatDistanceToNow(new Date(request.expiresAt), { addSuffix: true })}\n                            </p>\n                          </div>\n                          <div className=\"flex flex-col gap-2\">\n                            <Button\n                              size=\"sm\"\n                              className=\"bg-gradient-to-r from-sv-pink to-sv-purple text-white hover:opacity-90 font-cyber uppercase text-xs\"\n                              onClick={() => {\n                                setSelectedBattleRequest(request);\n                                setAcceptDialogOpen(true);\n                              }}\n                              data-testid={`button-accept-battle-${request.id}`}\n                            >\n                              <Check className=\"w-3 h-3 mr-1\" />\n                              Accept\n                            </Button>\n                            <Button\n                              size=\"sm\"\n                              variant=\"outline\"\n                              className=\"border-sv-gray text-gray-400 hover:text-white hover:border-white font-cyber uppercase text-xs\"\n                              onClick={() => declineBattleRequestMutation.mutate(request.id)}\n                              disabled={declineBattleRequestMutation.isPending}\n                              data-testid={`button-decline-battle-${request.id}`}\n                            >\n                              <X className=\"w-3 h-3 mr-1\" />\n                              Decline\n                            </Button>\n                          </div>\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                )}\n              </TabsContent>\n            </Tabs>\n\n            <Dialog open={!!selectedMessage} onOpenChange={() => setSelectedMessage(null)}>\n              <DialogContent className=\"bg-sv-dark border-sv-gray rounded-none max-w-lg\">\n                {selectedMessage && (\n                  <>\n                    <DialogHeader>\n                      <DialogTitle className=\"font-cyber text-white\">{selectedMessage.subject}</DialogTitle>\n                    </DialogHeader>\n                    <div className=\"mt-4\">\n                      <div className=\"flex items-center gap-3 pb-4 border-b border-sv-gray/50\">\n                        <Avatar className=\"w-10 h-10 rounded-none border border-sv-purple/50\">\n                          <AvatarImage src={selectedMessage.fromUserAvatar} className=\"rounded-none\" />\n                          <AvatarFallback className=\"rounded-none bg-sv-purple text-white font-punk\">\n                            {selectedMessage.fromUserName?.[0] || \"?\"}\n                          </AvatarFallback>\n                        </Avatar>\n                        <div>\n                          <p className=\"font-cyber text-white\">{selectedMessage.fromUserName}</p>\n                          <p className=\"text-xs text-gray-500 font-hud\">\n                            {formatDistanceToNow(new Date(selectedMessage.createdAt), { addSuffix: true })}\n                          </p>\n                        </div>\n                      </div>\n                      <div className=\"py-4\">\n                        <p className=\"font-body text-gray-300 whitespace-pre-wrap\">{selectedMessage.content}</p>\n                      </div>\n                      <button\n                        className=\"cyber-btn w-full bg-sv-purple text-white font-cyber font-bold py-2 uppercase tracking-wider\"\n                        onClick={() => {\n                          setSelectedMessage(null);\n                          setSelectedRecipient({ id: selectedMessage.fromUserId, name: selectedMessage.fromUserName || \"Unknown\", profileImageUrl: selectedMessage.fromUserAvatar });\n                          setMessageSubject(`Re: ${selectedMessage.subject}`);\n                          setComposeOpen(true);\n                        }}\n                        data-testid=\"button-reply\"\n                      >\n                        Reply\n                      </button>\n                    </div>\n                  </>\n                )}\n              </DialogContent>\n            </Dialog>\n          </div>\n        </div>\n      </main>\n      <Footer />\n\n      <AcceptBattleRequestDialog\n        open={acceptDialogOpen}\n        onOpenChange={setAcceptDialogOpen}\n        battleRequest={selectedBattleRequest}\n      />\n    </div>\n  );\n}\n","path":null,"size_bytes":32435,"size_tokens":null},"client/src/components/SplashScreen.tsx":{"content":"import { motion, AnimatePresence } from \"framer-motion\";\nimport { useState, useEffect } from \"react\";\n\ninterface SplashScreenProps {\n  onComplete: () => void;\n}\n\nexport function SplashScreen({ onComplete }: SplashScreenProps) {\n  const [progress, setProgress] = useState(0);\n  const [showTitle, setShowTitle] = useState(false);\n  const [showTagline, setShowTagline] = useState(false);\n  const [showEnterButton, setShowEnterButton] = useState(false);\n  const [isReady, setIsReady] = useState(false);\n\n  useEffect(() => {\n    const progressInterval = setInterval(() => {\n      setProgress(prev => {\n        if (prev >= 100) {\n          clearInterval(progressInterval);\n          setIsReady(true);\n          return 100;\n        }\n        return prev + 2;\n      });\n    }, 30);\n\n    const titleTimer = setTimeout(() => setShowTitle(true), 300);\n    const taglineTimer = setTimeout(() => setShowTagline(true), 800);\n    const enterTimer = setTimeout(() => setShowEnterButton(true), 1800);\n\n    return () => {\n      clearInterval(progressInterval);\n      clearTimeout(titleTimer);\n      clearTimeout(taglineTimer);\n      clearTimeout(enterTimer);\n    };\n  }, []);\n\n  const handleEnter = () => {\n    if (isReady) {\n      onComplete();\n    }\n  };\n\n  return (\n    <AnimatePresence>\n      <motion.div\n        initial={{ opacity: 1 }}\n        exit={{ opacity: 0 }}\n        className=\"fixed inset-0 z-[100] bg-sv-black flex flex-col items-center justify-center overflow-hidden\"\n        data-testid=\"splash-screen\"\n      >\n        <div className=\"absolute inset-0 cyber-grid opacity-10\"></div>\n        \n        <div className=\"hidden md:block absolute top-1/4 left-1/4 w-96 h-96 bg-sv-pink/10 rounded-full blur-3xl animate-pulse\"></div>\n        <div className=\"hidden md:block absolute bottom-1/4 right-1/4 w-96 h-96 bg-sv-purple/10 rounded-full blur-3xl animate-pulse delay-500\"></div>\n\n        <div className=\"relative z-10 flex flex-col items-center\">\n          <motion.div\n            initial={{ scale: 0 }}\n            animate={{ scale: 1 }}\n            transition={{ type: \"spring\", damping: 10, stiffness: 100 }}\n            className=\"relative mb-8\"\n          >\n            <div className=\"w-32 h-32 rounded-full bg-gradient-to-br from-sv-pink via-sv-purple to-sv-gold animate-spin-slow relative\">\n              <div className=\"absolute inset-2 rounded-full bg-sv-black flex items-center justify-center\">\n                <span className=\"text-4xl font-cyber font-black text-white\">SV</span>\n              </div>\n            </div>\n            <div className=\"absolute -inset-4 rounded-full border border-sv-pink/30 animate-ping\"></div>\n          </motion.div>\n\n          <AnimatePresence>\n            {showTitle && (\n              <motion.div\n                initial={{ opacity: 0, y: 20 }}\n                animate={{ opacity: 1, y: 0 }}\n                className=\"text-center mb-4\"\n              >\n                <h1 className=\"text-5xl md:text-7xl font-cyber font-black\">\n                  <span className=\"text-white\">SONG</span>\n                  <span className=\"text-sv-pink\">VERSUS</span>\n                </h1>\n              </motion.div>\n            )}\n          </AnimatePresence>\n\n          <AnimatePresence>\n            {showTagline && (\n              <motion.p\n                initial={{ opacity: 0 }}\n                animate={{ opacity: 1 }}\n                className=\"font-hud text-sv-gold tracking-[0.3em] uppercase text-sm mb-12\"\n              >\n                The Underground Arena\n              </motion.p>\n            )}\n          </AnimatePresence>\n\n          {!showEnterButton && (\n            <>\n              <div className=\"w-64 h-1 bg-sv-gray/30 rounded-full overflow-hidden\">\n                <motion.div\n                  className=\"h-full bg-gradient-to-r from-sv-pink via-sv-purple to-sv-gold\"\n                  initial={{ width: 0 }}\n                  animate={{ width: `${progress}%` }}\n                  transition={{ ease: \"easeOut\" }}\n                />\n              </div>\n              \n              <motion.p\n                initial={{ opacity: 0 }}\n                animate={{ opacity: 0.5 }}\n                className=\"mt-4 font-mono text-xs text-gray-500\"\n              >\n                LOADING ARENA...\n              </motion.p>\n            </>\n          )}\n\n          <AnimatePresence>\n            {showEnterButton && (\n              <motion.button\n                initial={{ opacity: 0, scale: 0.8 }}\n                animate={{ opacity: 1, scale: 1 }}\n                whileHover={{ scale: 1.05 }}\n                whileTap={{ scale: 0.95 }}\n                onClick={handleEnter}\n                className=\"relative group cursor-pointer\"\n                data-testid=\"button-enter-arena\"\n              >\n                <div className=\"absolute -inset-1 bg-gradient-to-r from-sv-pink via-sv-purple to-sv-gold rounded-lg blur opacity-75 group-hover:opacity-100 transition duration-200 animate-pulse\"></div>\n                <div className=\"relative px-12 py-4 bg-sv-black border-2 border-sv-pink rounded-lg\">\n                  <span className=\"font-cyber font-black text-2xl text-white tracking-wider group-hover:text-sv-pink transition-colors\">\n                    ENTER\n                  </span>\n                </div>\n              </motion.button>\n            )}\n          </AnimatePresence>\n        </div>\n\n        <div className=\"absolute bottom-8 left-0 right-0 flex justify-center\">\n          <p className=\"font-hud text-gray-600 text-xs tracking-widest\">SEASON 1</p>\n        </div>\n      </motion.div>\n    </AnimatePresence>\n  );\n}\n","path":null,"size_bytes":5577,"size_tokens":null},"client/src/pages/UserProfile.tsx":{"content":"import { useState } from \"react\";\nimport { Navbar } from \"@/components/layout/Navbar\";\nimport { Footer } from \"@/components/layout/Footer\";\nimport { Avatar, AvatarImage, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Button } from \"@/components/ui/button\";\nimport { Trophy, Zap, Coins, TrendingUp, Loader2, Users, UserPlus, Swords } from \"lucide-react\";\nimport { useRoute, useLocation } from \"wouter\";\nimport { useUser } from \"@/context/UserContext\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { MembershipBadge } from \"@/components/MembershipBadge\";\nimport { FoundersBadge } from \"@/components/FoundersBadge\";\nimport { ChallengeDialog } from \"@/components/ChallengeDialog\";\n\nexport default function UserProfile() {\n  const [, params] = useRoute(\"/user/:id\");\n  const [, setLocation] = useLocation();\n  const { user: currentUser } = useUser();\n  const [showChallengeDialog, setShowChallengeDialog] = useState(false);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const userId = parseInt(params?.id || \"0\");\n\n  const { data: user, isLoading } = useQuery({\n    queryKey: [\"user\", userId],\n    queryFn: async () => {\n      const res = await fetch(`/api/users/${userId}`);\n      if (!res.ok) throw new Error(\"Failed to fetch user\");\n      return res.json();\n    },\n    enabled: userId > 0,\n  });\n\n  const { data: followers = [] } = useQuery({\n    queryKey: [\"followers\", userId],\n    queryFn: async () => {\n      const res = await fetch(`/api/users/${userId}/followers`);\n      if (!res.ok) throw new Error(\"Failed to fetch followers\");\n      return res.json();\n    },\n    enabled: userId > 0,\n  });\n\n  const { data: following = [] } = useQuery({\n    queryKey: [\"following\", userId],\n    queryFn: async () => {\n      const res = await fetch(`/api/users/${userId}/following`);\n      if (!res.ok) throw new Error(\"Failed to fetch following\");\n      return res.json();\n    },\n    enabled: userId > 0,\n  });\n\n  const { data: isFollowing = false } = useQuery({\n    queryKey: [\"followStatus\", userId],\n    queryFn: async () => {\n      const res = await fetch(`/api/follow/${userId}/status`, { credentials: \"include\" });\n      if (!res.ok) return false;\n      const data = await res.json();\n      return data.isFollowing;\n    },\n    enabled: !!currentUser && currentUser.id !== userId,\n  });\n\n  const followMutation = useMutation({\n    mutationFn: async () => {\n      const res = await fetch(`/api/follow/${userId}`, {\n        method: \"POST\",\n        credentials: \"include\",\n      });\n      if (!res.ok) throw new Error(\"Failed to follow\");\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"followStatus\", userId] });\n      queryClient.invalidateQueries({ queryKey: [\"followers\", userId] });\n      toast({ title: \"Followed successfully\" });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const unfollowMutation = useMutation({\n    mutationFn: async () => {\n      const res = await fetch(`/api/follow/${userId}`, {\n        method: \"DELETE\",\n        credentials: \"include\",\n      });\n      if (!res.ok) throw new Error(\"Failed to unfollow\");\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"followStatus\", userId] });\n      queryClient.invalidateQueries({ queryKey: [\"followers\", userId] });\n      toast({ title: \"Unfollowed successfully\" });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-background flex flex-col\">\n        <Navbar />\n        <main className=\"flex-grow pt-24 pb-20 flex items-center justify-center\">\n          <Loader2 className=\"w-8 h-8 animate-spin text-violet-500\" />\n        </main>\n        <Footer />\n      </div>\n    );\n  }\n\n  if (!user) {\n    return (\n      <div className=\"min-h-screen bg-background flex flex-col\">\n        <Navbar />\n        <main className=\"flex-grow pt-24 pb-20 flex items-center justify-center\">\n          <div className=\"text-center\">\n            <p className=\"text-muted-foreground mb-4\">User not found</p>\n            <Button onClick={() => setLocation(\"/leaderboard\")}>Go to Leaderboard</Button>\n          </div>\n        </main>\n        <Footer />\n      </div>\n    );\n  }\n\n  const isOwnProfile = currentUser?.id === user.id;\n\n  return (\n    <div className=\"min-h-screen bg-background flex flex-col\">\n      <Navbar />\n\n      <main className=\"flex-grow pt-24 pb-20\">\n        <div className=\"container mx-auto px-4\">\n          <div className=\"max-w-2xl mx-auto\">\n            {/* Profile Header */}\n            <div className=\"bg-card/50 border border-white/10 rounded-2xl p-8 text-center mb-8 backdrop-blur-sm\">\n              <Avatar className=\"w-32 h-32 border-4 border-violet-500 mx-auto mb-6\">\n                <AvatarImage src={user.profileImageUrl || undefined} />\n                <AvatarFallback className=\"text-4xl font-bold\">{(user.name || \"?\")[0]}</AvatarFallback>\n              </Avatar>\n\n              <div className=\"flex items-center justify-center gap-3 mb-2 flex-wrap\">\n                <h1 className=\"text-4xl font-bold text-white\">{user.name || \"Unknown User\"}</h1>\n                {user.foundersBadge && <FoundersBadge size=\"md\" />}\n                <MembershipBadge membership={user.membership} size=\"md\" />\n              </div>\n              <p className=\"text-violet-400 font-mono mb-2 capitalize\">\n                {user.role === \"producer\" ? \" Producer\" : \" Artist\"}  Level {user.level || 1}\n              </p>\n              {user.bio && (\n                <p className=\"text-muted-foreground text-sm mb-6 max-w-md mx-auto\">{user.bio}</p>\n              )}\n\n              <div className=\"flex justify-center gap-8 flex-wrap mb-8\">\n                <div className=\"flex flex-col items-center\">\n                  <span className=\"text-3xl font-bold text-yellow-400\">{(user.xp || 0).toLocaleString()}</span>\n                  <span className=\"text-xs text-muted-foreground flex items-center gap-1 mt-1\">\n                    <TrendingUp className=\"w-3 h-3\" /> XP\n                  </span>\n                </div>\n                <div className=\"flex flex-col items-center\">\n                  <span className=\"text-3xl font-bold text-violet-400\">{user.wins || 0}</span>\n                  <span className=\"text-xs text-muted-foreground flex items-center gap-1 mt-1\">\n                    <Trophy className=\"w-3 h-3\" /> Wins\n                  </span>\n                </div>\n                <div className=\"flex flex-col items-center\">\n                  <span className=\"text-3xl font-bold text-sv-pink\">{followers.length}</span>\n                  <span className=\"text-xs text-muted-foreground flex items-center gap-1 mt-1\">\n                    <Users className=\"w-3 h-3\" /> Followers\n                  </span>\n                </div>\n                <div className=\"flex flex-col items-center\">\n                  <span className=\"text-3xl font-bold text-cyan-400\">{following.length}</span>\n                  <span className=\"text-xs text-muted-foreground flex items-center gap-1 mt-1\">\n                    <UserPlus className=\"w-3 h-3\" /> Following\n                  </span>\n                </div>\n              </div>\n\n              {!isOwnProfile && currentUser && (\n                <div className=\"flex gap-3 justify-center\">\n                  <Button\n                    className={isFollowing ? \"bg-white/20 border border-white/30 text-white hover:bg-white/30\" : \"bg-sv-pink text-black hover:bg-sv-pink/80\"}\n                    onClick={() => {\n                      if (isFollowing) {\n                        unfollowMutation.mutate();\n                      } else {\n                        followMutation.mutate();\n                      }\n                    }}\n                    disabled={followMutation.isPending || unfollowMutation.isPending}\n                    data-testid={isFollowing ? \"button-unfollow\" : \"button-follow\"}\n                  >\n                    {isFollowing ? \"Following\" : \"Follow\"}\n                  </Button>\n                  <Button\n                    className=\"bg-gradient-to-r from-sv-purple to-sv-pink text-white hover:opacity-90\"\n                    onClick={() => setShowChallengeDialog(true)}\n                    data-testid=\"button-challenge\"\n                  >\n                    <Swords className=\"w-4 h-4 mr-2\" />\n                    Challenge\n                  </Button>\n                </div>\n              )}\n            </div>\n\n            {/* Quick Actions */}\n            {isOwnProfile && (\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <Button\n                  className=\"bg-white text-black hover:bg-white/90 font-bold\"\n                  onClick={() => setLocation(\"/battles\")}\n                  data-testid=\"button-join-battle\"\n                >\n                  Join a Battle\n                </Button>\n                <Button\n                  variant=\"outline\"\n                  className=\"border-white/10\"\n                  onClick={() => setLocation(\"/store\")}\n                  data-testid=\"button-visit-store\"\n                >\n                  Visit Store\n                </Button>\n              </div>\n            )}\n          </div>\n        </div>\n      </main>\n      <Footer />\n\n      {user && !isOwnProfile && (\n        <ChallengeDialog\n          open={showChallengeDialog}\n          onOpenChange={setShowChallengeDialog}\n          targetUser={{\n            id: user.id,\n            name: user.name || \"Unknown User\",\n            role: user.role || \"artist\",\n          }}\n        />\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":9884,"size_tokens":null},"server/replitAuth.ts":{"content":"import * as client from \"openid-client\";\nimport { Strategy, type VerifyFunction } from \"openid-client/passport\";\n\nimport passport from \"passport\";\nimport session from \"express-session\";\nimport type { Express, RequestHandler } from \"express\";\nimport memoize from \"memoizee\";\nimport connectPg from \"connect-pg-simple\";\nimport { storage } from \"./storage\";\n\nconst getOidcConfig = memoize(\n  async () => {\n    return await client.discovery(\n      new URL(process.env.ISSUER_URL ?? \"https://replit.com/oidc\"),\n      process.env.REPL_ID!\n    );\n  },\n  { maxAge: 3600 * 1000 }\n);\n\nexport function getSession() {\n  const sessionTtl = 7 * 24 * 60 * 60 * 1000; // 1 week\n  const pgStore = connectPg(session);\n  const sessionStore = new pgStore({\n    conString: process.env.DATABASE_URL,\n    createTableIfMissing: false,\n    ttl: sessionTtl,\n    tableName: \"sessions\",\n  });\n  return session({\n    secret: process.env.SESSION_SECRET!,\n    store: sessionStore,\n    resave: false,\n    saveUninitialized: false,\n    cookie: {\n      httpOnly: true,\n      secure: true,\n      maxAge: sessionTtl,\n    },\n  });\n}\n\nfunction updateUserSession(\n  user: any,\n  tokens: client.TokenEndpointResponse & client.TokenEndpointResponseHelpers\n) {\n  user.claims = tokens.claims();\n  user.access_token = tokens.access_token;\n  user.refresh_token = tokens.refresh_token;\n  user.expires_at = user.claims?.exp;\n}\n\nasync function upsertUser(claims: any) {\n  await storage.upsertUser({\n    replitAuthId: claims[\"sub\"],\n    email: claims[\"email\"],\n    firstName: claims[\"first_name\"],\n    lastName: claims[\"last_name\"],\n    profileImageUrl: claims[\"profile_image_url\"],\n  });\n}\n\nexport async function setupAuth(app: Express) {\n  app.set(\"trust proxy\", 1);\n  app.use(getSession());\n  app.use(passport.initialize());\n  app.use(passport.session());\n\n  const config = await getOidcConfig();\n\n  const verify: VerifyFunction = async (\n    tokens: client.TokenEndpointResponse & client.TokenEndpointResponseHelpers,\n    verified: passport.AuthenticateCallback\n  ) => {\n    try {\n      const user = {};\n      updateUserSession(user, tokens);\n      await upsertUser(tokens.claims());\n      verified(null, user);\n    } catch (error) {\n      console.error(\"[auth] Error during verification:\", error);\n      verified(error as Error);\n    }\n  };\n\n  const registeredStrategies = new Set<string>();\n\n  const ensureStrategy = (domain: string) => {\n    const strategyName = `replitauth:${domain}`;\n    if (!registeredStrategies.has(strategyName)) {\n      const strategy = new Strategy(\n        {\n          name: strategyName,\n          config,\n          scope: \"openid email profile offline_access\",\n          callbackURL: `https://${domain}/api/callback`,\n        },\n        verify,\n      );\n      passport.use(strategy);\n      registeredStrategies.add(strategyName);\n    }\n  };\n\n  passport.serializeUser((user: Express.User, cb) => cb(null, user));\n  passport.deserializeUser((user: Express.User, cb) => cb(null, user));\n\n  app.get(\"/api/login\", (req, res, next) => {\n    ensureStrategy(req.hostname);\n    passport.authenticate(`replitauth:${req.hostname}`, {\n      prompt: \"login consent\",\n      scope: [\"openid\", \"email\", \"profile\", \"offline_access\"],\n    })(req, res, next);\n  });\n\n  app.get(\"/api/callback\", (req, res, next) => {\n    ensureStrategy(req.hostname);\n    passport.authenticate(`replitauth:${req.hostname}`, (err: any, user: any, info: any) => {\n      if (err) {\n        console.error(\"[auth] Callback error:\", err);\n        return res.redirect(`/?error=${encodeURIComponent(err.message || 'Authentication failed')}`);\n      }\n      if (!user) {\n        console.error(\"[auth] No user returned:\", info);\n        return res.redirect(\"/api/login\");\n      }\n      req.logIn(user, (loginErr) => {\n        if (loginErr) {\n          console.error(\"[auth] Login error:\", loginErr);\n          return res.redirect(`/?error=${encodeURIComponent(loginErr.message || 'Login failed')}`);\n        }\n        return res.redirect(\"/\");\n      });\n    })(req, res, next);\n  });\n\n  app.get(\"/api/logout\", (req, res) => {\n    req.logout(() => {\n      res.redirect(\n        client.buildEndSessionUrl(config, {\n          client_id: process.env.REPL_ID!,\n          post_logout_redirect_uri: `${req.protocol}://${req.hostname}`,\n        }).href\n      );\n    });\n  });\n}\n\nexport const isAuthenticated: RequestHandler = async (req, res, next) => {\n  const user = req.user as any;\n\n  if (!req.isAuthenticated() || !user.expires_at) {\n    return res.status(401).json({ message: \"Unauthorized\" });\n  }\n\n  const now = Math.floor(Date.now() / 1000);\n  if (now <= user.expires_at) {\n    return next();\n  }\n\n  const refreshToken = user.refresh_token;\n  if (!refreshToken) {\n    res.status(401).json({ message: \"Unauthorized\" });\n    return;\n  }\n\n  try {\n    const config = await getOidcConfig();\n    const tokenResponse = await client.refreshTokenGrant(config, refreshToken);\n    updateUserSession(user, tokenResponse);\n    return next();\n  } catch (error) {\n    res.status(401).json({ message: \"Unauthorized\" });\n    return;\n  }\n};\n","path":null,"size_bytes":5062,"size_tokens":null},"client/src/pages/Notifications.tsx":{"content":"import { Navbar } from \"@/components/layout/Navbar\";\nimport { Footer } from \"@/components/layout/Footer\";\nimport { Button } from \"@/components/ui/button\";\nimport { Avatar, AvatarImage, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Loader2, Trash2, CheckCheck } from \"lucide-react\";\nimport { useUser } from \"@/context/UserContext\";\nimport { useLocation } from \"wouter\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { getNotifications, markNotificationAsRead, markAllNotificationsAsRead } from \"@/lib/api\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useEffect, useRef } from \"react\";\nimport { useSoundEffects } from \"@/hooks/useSoundEffects\";\n\nexport default function Notifications() {\n  const { user } = useUser();\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const { playSound } = useSoundEffects();\n  const prevUnreadCountRef = useRef<number>(0);\n\n  if (!user) {\n    return (\n      <div className=\"min-h-screen bg-background flex flex-col\">\n        <Navbar />\n        <main className=\"flex-grow pt-24 pb-20 flex items-center justify-center\">\n          <div className=\"text-center\">\n            <p className=\"text-muted-foreground mb-4\">You need to login to view notifications</p>\n            <Button onClick={() => setLocation(\"/\")} className=\"bg-white text-black hover:bg-white/90\">\n              Go Home\n            </Button>\n          </div>\n        </main>\n        <Footer />\n      </div>\n    );\n  }\n\n  const { data: notifications, isLoading } = useQuery({\n    queryKey: [\"notifications\", user.id],\n    queryFn: () => getNotifications(user.id),\n    refetchInterval: 10000,\n  });\n\n  const markAsReadMutation = useMutation({\n    mutationFn: (notificationId: number) => markNotificationAsRead(notificationId),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"notifications\", user.id] });\n    },\n  });\n\n  const markAllAsReadMutation = useMutation({\n    mutationFn: () => markAllNotificationsAsRead(user.id),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"notifications\", user.id] });\n      playSound(\"success\");\n      toast({ title: \"All notifications marked as read\" });\n    },\n  });\n\n  useEffect(() => {\n    if (notifications) {\n      const currentUnreadCount = notifications.filter(n => !n.read).length;\n      if (prevUnreadCountRef.current > 0 && currentUnreadCount > prevUnreadCountRef.current) {\n        playSound(\"notification\");\n      }\n      prevUnreadCountRef.current = currentUnreadCount;\n    }\n  }, [notifications, playSound]);\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-background flex flex-col\">\n        <Navbar />\n        <main className=\"flex-grow pt-24 pb-20 flex items-center justify-center\">\n          <Loader2 className=\"w-8 h-8 animate-spin text-violet-500\" />\n        </main>\n        <Footer />\n      </div>\n    );\n  }\n\n  const unreadCount = notifications?.filter(n => !n.read).length || 0;\n\n  return (\n    <div className=\"min-h-screen bg-background flex flex-col\">\n      <Navbar />\n\n      <main className=\"flex-grow pt-24 pb-20\">\n        <div className=\"container mx-auto px-4\">\n          <div className=\"max-w-2xl mx-auto\">\n            {/* Header */}\n            <div className=\"flex items-center justify-between mb-8\">\n              <div>\n                <h1 className=\"text-3xl font-bold text-white\">Inbox</h1>\n                <p className=\"text-muted-foreground mt-2\">\n                  {unreadCount} unread notification{unreadCount !== 1 ? \"s\" : \"\"}\n                </p>\n              </div>\n              {unreadCount > 0 && (\n                <Button\n                  variant=\"outline\"\n                  className=\"border-white/10\"\n                  onClick={() => markAllAsReadMutation.mutate()}\n                  disabled={markAllAsReadMutation.isPending}\n                  data-testid=\"button-mark-all-read\"\n                >\n                  <CheckCheck className=\"w-4 h-4 mr-2\" />\n                  Mark All Read\n                </Button>\n              )}\n            </div>\n\n            {/* Notifications List */}\n            {notifications && notifications.length > 0 ? (\n              <div className=\"space-y-4\">\n                {notifications.map((notification) => (\n                  <div\n                    key={notification.id}\n                    className={`border rounded-lg p-4 transition-colors ${\n                      notification.read\n                        ? \"border-white/5 bg-white/2\"\n                        : \"border-violet-500/30 bg-violet-500/5\"\n                    }`}\n                    data-testid={`notification-${notification.id}`}\n                  >\n                    <div className=\"flex items-start gap-4\">\n                      {notification.fromUserName && (\n                        <Avatar className=\"w-10 h-10 flex-shrink-0\">\n                          <AvatarImage src={notification.fromUserAvatar} />\n                          <AvatarFallback>{notification.fromUserName[0]}</AvatarFallback>\n                        </Avatar>\n                      )}\n\n                      <div className=\"flex-grow min-w-0\">\n                        <p className=\"text-white font-medium\">{notification.message}</p>\n                        <p className=\"text-xs text-muted-foreground mt-1\">\n                          {new Date(notification.createdAt).toLocaleDateString()} at{\" \"}\n                          {new Date(notification.createdAt).toLocaleTimeString()}\n                        </p>\n                      </div>\n\n                      {!notification.read && (\n                        <Button\n                          size=\"icon\"\n                          variant=\"ghost\"\n                          className=\"h-8 w-8 flex-shrink-0\"\n                          onClick={() => markAsReadMutation.mutate(notification.id)}\n                          data-testid=\"button-mark-read\"\n                        >\n                          <CheckCheck className=\"w-4 h-4\" />\n                        </Button>\n                      )}\n                    </div>\n                  </div>\n                ))}\n              </div>\n            ) : (\n              <div className=\"text-center py-12\">\n                <p className=\"text-muted-foreground text-lg\">No notifications yet</p>\n                <p className=\"text-muted-foreground text-sm mt-2\">\n                  You'll receive notifications when users follow you or interact with your battles.\n                </p>\n              </div>\n            )}\n          </div>\n        </div>\n      </main>\n      <Footer />\n    </div>\n  );\n}\n","path":null,"size_bytes":6653,"size_tokens":null},"client/src/components/ClassSelectionDialog.tsx":{"content":"import { motion } from \"framer-motion\";\nimport { Mic, Music4, User } from \"lucide-react\";\nimport { useState } from \"react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Input } from \"@/components/ui/input\";\n\ninterface ClassSelectionDialogProps {\n  userId: number;\n  onComplete: () => void;\n}\n\nexport function ClassSelectionDialog({ userId, onComplete }: ClassSelectionDialogProps) {\n  const [step, setStep] = useState<1 | 2>(1);\n  const [displayName, setDisplayName] = useState(\"\");\n  const [selectedRole, setSelectedRole] = useState<\"artist\" | \"producer\" | null>(null);\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const { toast } = useToast();\n\n  const handleContinueToRole = () => {\n    if (displayName.trim().length < 2) {\n      toast({\n        title: \"Name Required\",\n        description: \"Please enter a display name (at least 2 characters)\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    setStep(2);\n  };\n\n  const handleSubmit = async () => {\n    if (!selectedRole || !displayName.trim()) return;\n    \n    setIsSubmitting(true);\n    try {\n      const response = await fetch(`/api/users/${userId}/role`, {\n        method: \"PATCH\",\n        headers: { \"Content-Type\": \"application/json\" },\n        credentials: \"include\",\n        body: JSON.stringify({ role: selectedRole, name: displayName.trim() }),\n      });\n\n      if (!response.ok) throw new Error(\"Failed to set role\");\n      \n      toast({\n        title: \"Welcome to SongVersus!\",\n        description: `You're now registered as ${displayName} (${selectedRole === \"artist\" ? \"Artist\" : \"Producer\"})`,\n      });\n      onComplete();\n    } catch (error) {\n      toast({\n        title: \"Error\",\n        description: \"Failed to complete setup. Please try again.\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  return (\n    <motion.div\n      initial={{ opacity: 0 }}\n      animate={{ opacity: 1 }}\n      className=\"fixed inset-0 z-[95] bg-black/90 backdrop-blur-sm flex items-center justify-center p-4\"\n      data-testid=\"class-selection-dialog\"\n    >\n      <motion.div\n        initial={{ scale: 0.9, y: 20 }}\n        animate={{ scale: 1, y: 0 }}\n        className=\"bg-sv-dark border border-sv-gray rounded-lg p-8 max-w-xl w-full text-center\"\n      >\n        {step === 1 ? (\n          <>\n            <div className=\"w-20 h-20 rounded-full mx-auto mb-6 flex items-center justify-center bg-gradient-to-r from-sv-pink to-sv-purple\">\n              <User className=\"w-10 h-10 text-white\" />\n            </div>\n            <h2 className=\"text-3xl font-cyber font-black text-white mb-2\">\n              WELCOME TO <span className=\"text-sv-pink\">SONGVERSUS</span>\n            </h2>\n            <p className=\"text-gray-400 mb-8\">\n              What should we call you in the arena?\n            </p>\n\n            <div className=\"mb-8\">\n              <Input\n                type=\"text\"\n                placeholder=\"Enter your display name...\"\n                value={displayName}\n                onChange={(e) => setDisplayName(e.target.value)}\n                className=\"bg-sv-black border-sv-gray text-white text-center text-lg py-6 focus:border-sv-pink\"\n                maxLength={30}\n                data-testid=\"input-display-name\"\n              />\n              <p className=\"text-xs text-gray-500 mt-2\">This is how other users will see you</p>\n            </div>\n\n            <motion.button\n              whileHover={{ scale: displayName.trim().length >= 2 ? 1.02 : 1 }}\n              whileTap={{ scale: displayName.trim().length >= 2 ? 0.98 : 1 }}\n              onClick={handleContinueToRole}\n              disabled={displayName.trim().length < 2}\n              className={`w-full py-4 rounded-lg font-cyber font-bold text-lg transition-all ${\n                displayName.trim().length >= 2\n                  ? \"bg-gradient-to-r from-sv-pink to-sv-purple text-white cursor-pointer hover:opacity-90\"\n                  : \"bg-sv-gray text-gray-500 cursor-not-allowed\"\n              }`}\n              data-testid=\"button-continue-to-role\"\n            >\n              CONTINUE\n            </motion.button>\n          </>\n        ) : (\n          <>\n            <h2 className=\"text-3xl font-cyber font-black text-white mb-2\">\n              CHOOSE YOUR <span className=\"text-sv-pink\">CLASS</span>\n            </h2>\n            <p className=\"text-gray-400 mb-2\">\n              Hey <span className=\"text-sv-gold font-bold\">{displayName}</span>! What's your specialty?\n            </p>\n            <p className=\"text-gray-500 text-sm mb-8\">\n              Artists compete in song battles, Producers compete in beat battles\n            </p>\n\n            <div className=\"grid grid-cols-2 gap-6 mb-8\">\n              <motion.button\n                whileHover={{ scale: 1.02 }}\n                whileTap={{ scale: 0.98 }}\n                onClick={() => setSelectedRole(\"artist\")}\n                className={`relative p-6 rounded-lg border-2 transition-all ${\n                  selectedRole === \"artist\"\n                    ? \"border-sv-pink bg-sv-pink/10\"\n                    : \"border-sv-gray hover:border-sv-pink/50\"\n                }`}\n                data-testid=\"button-select-artist\"\n              >\n                <div className={`w-20 h-20 rounded-full mx-auto mb-4 flex items-center justify-center ${\n                  selectedRole === \"artist\" ? \"bg-sv-pink\" : \"bg-sv-gray\"\n                }`}>\n                  <Mic className={`w-10 h-10 ${selectedRole === \"artist\" ? \"text-black\" : \"text-white\"}`} />\n                </div>\n                <h3 className=\"text-xl font-cyber font-bold text-white mb-2\">ARTIST</h3>\n                <p className=\"text-sm text-gray-400\">\n                  Vocalists, rappers, and songwriters\n                </p>\n                <p className=\"text-xs text-sv-pink mt-2 font-bold\">Song Battles</p>\n                {selectedRole === \"artist\" && (\n                  <div className=\"absolute -top-2 -right-2 w-6 h-6 bg-sv-pink rounded-full flex items-center justify-center\">\n                    <span className=\"text-black text-lg\"></span>\n                  </div>\n                )}\n              </motion.button>\n\n              <motion.button\n                whileHover={{ scale: 1.02 }}\n                whileTap={{ scale: 0.98 }}\n                onClick={() => setSelectedRole(\"producer\")}\n                className={`relative p-6 rounded-lg border-2 transition-all ${\n                  selectedRole === \"producer\"\n                    ? \"border-sv-purple bg-sv-purple/10\"\n                    : \"border-sv-gray hover:border-sv-purple/50\"\n                }`}\n                data-testid=\"button-select-producer\"\n              >\n                <div className={`w-20 h-20 rounded-full mx-auto mb-4 flex items-center justify-center ${\n                  selectedRole === \"producer\" ? \"bg-sv-purple\" : \"bg-sv-gray\"\n                }`}>\n                  <Music4 className={`w-10 h-10 ${selectedRole === \"producer\" ? \"text-white\" : \"text-white\"}`} />\n                </div>\n                <h3 className=\"text-xl font-cyber font-bold text-white mb-2\">PRODUCER</h3>\n                <p className=\"text-sm text-gray-400\">\n                  Beat makers and sound designers\n                </p>\n                <p className=\"text-xs text-sv-purple mt-2 font-bold\">Beat Battles</p>\n                {selectedRole === \"producer\" && (\n                  <div className=\"absolute -top-2 -right-2 w-6 h-6 bg-sv-purple rounded-full flex items-center justify-center\">\n                    <span className=\"text-white text-lg\"></span>\n                  </div>\n                )}\n              </motion.button>\n            </div>\n\n            <div className=\"flex gap-4\">\n              <motion.button\n                whileHover={{ scale: 1.02 }}\n                whileTap={{ scale: 0.98 }}\n                onClick={() => setStep(1)}\n                className=\"flex-1 py-4 rounded-lg font-cyber font-bold text-lg border-2 border-sv-gray text-gray-400 hover:border-sv-pink hover:text-sv-pink transition-all\"\n                data-testid=\"button-back-to-name\"\n              >\n                BACK\n              </motion.button>\n              <motion.button\n                whileHover={{ scale: selectedRole ? 1.02 : 1 }}\n                whileTap={{ scale: selectedRole ? 0.98 : 1 }}\n                onClick={handleSubmit}\n                disabled={!selectedRole || isSubmitting}\n                className={`flex-1 py-4 rounded-lg font-cyber font-bold text-lg transition-all ${\n                  selectedRole\n                    ? \"bg-gradient-to-r from-sv-pink to-sv-purple text-white cursor-pointer hover:opacity-90\"\n                    : \"bg-sv-gray text-gray-500 cursor-not-allowed\"\n                }`}\n                data-testid=\"button-confirm-class\"\n              >\n                {isSubmitting ? \"Setting up...\" : \"ENTER THE ARENA\"}\n              </motion.button>\n            </div>\n          </>\n        )}\n      </motion.div>\n    </motion.div>\n  );\n}\n","path":null,"size_bytes":9013,"size_tokens":null},"client/src/lib/authUtils.ts":{"content":"export function isUnauthorizedError(error: Error): boolean {\n  return /^401: .*Unauthorized/.test(error.message);\n}\n","path":null,"size_bytes":116,"size_tokens":null},"client/src/components/battle/AudioReactiveSphere.tsx":{"content":"import { useRef, useEffect, useState, useCallback } from \"react\";\nimport { cn } from \"@/lib/utils\";\nimport { useShouldReduceMotion } from \"@/hooks/useIsMobile\";\n\ninterface AudioReactiveSphereProps {\n  isPlaying?: boolean;\n  color?: \"cyan\" | \"violet\" | \"fuchsia\";\n  size?: number;\n  className?: string;\n}\n\nexport function AudioReactiveSphere({\n  isPlaying = false,\n  color = \"cyan\",\n  size = 300,\n  className,\n}: AudioReactiveSphereProps) {\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const animationRef = useRef<number>(0);\n  const timeRef = useRef<number>(0);\n  const [audioLevel, setAudioLevel] = useState(0);\n  const reduceMotion = useShouldReduceMotion();\n\n  const colorPalettes = {\n    cyan: {\n      primary: [0, 220, 255],\n      secondary: [100, 255, 218],\n      accent: [180, 100, 255],\n      highlight: [255, 255, 255],\n    },\n    violet: {\n      primary: [139, 92, 246],\n      secondary: [167, 139, 250],\n      accent: [236, 72, 153],\n      highlight: [255, 255, 255],\n    },\n    fuchsia: {\n      primary: [236, 72, 153],\n      secondary: [244, 114, 182],\n      accent: [139, 92, 246],\n      highlight: [255, 255, 255],\n    },\n  };\n\n  const palette = colorPalettes[color];\n\n  useEffect(() => {\n    if (!isPlaying || reduceMotion) {\n      setAudioLevel(0);\n      return;\n    }\n\n    const interval = setInterval(() => {\n      setAudioLevel(0.3 + Math.random() * 0.7);\n    }, 80);\n\n    return () => clearInterval(interval);\n  }, [isPlaying, reduceMotion]);\n\n  const noise = useCallback((x: number, y: number, t: number) => {\n    return (\n      Math.sin(x * 0.5 + t) * 0.5 +\n      Math.sin(y * 0.5 + t * 1.3) * 0.5 +\n      Math.sin((x + y) * 0.3 + t * 0.7) * 0.5 +\n      Math.sin(Math.sqrt(x * x + y * y) * 0.5 - t) * 0.5\n    );\n  }, []);\n\n  const draw = useCallback(() => {\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n\n    const ctx = canvas.getContext(\"2d\");\n    if (!ctx) return;\n\n    const width = canvas.width;\n    const height = canvas.height;\n    const centerX = width / 2;\n    const centerY = height / 2;\n    const radius = Math.min(width, height) * 0.42;\n\n    ctx.clearRect(0, 0, width, height);\n\n    const time = timeRef.current;\n    const intensity = isPlaying ? 0.5 + audioLevel * 0.5 : 0.3;\n    const morphSpeed = isPlaying ? 0.03 : 0.008;\n    const morphAmount = isPlaying ? 15 + audioLevel * 20 : 8;\n\n    const imageData = ctx.createImageData(width, height);\n    const data = imageData.data;\n\n    for (let y = 0; y < height; y++) {\n      for (let x = 0; x < width; x++) {\n        const dx = x - centerX;\n        const dy = y - centerY;\n        const dist = Math.sqrt(dx * dx + dy * dy);\n\n        const noiseVal = noise(x * 0.02, y * 0.02, time * morphSpeed);\n        const morphedRadius = radius + noiseVal * morphAmount;\n\n        if (dist < morphedRadius) {\n          const normalizedDist = dist / morphedRadius;\n          const sphereZ = Math.sqrt(1 - normalizedDist * normalizedDist);\n\n          const nx = dx / morphedRadius;\n          const ny = dy / morphedRadius;\n          const nz = sphereZ;\n\n          const lightX = 0.3;\n          const lightY = -0.5;\n          const lightZ = 0.8;\n          const lightLen = Math.sqrt(lightX * lightX + lightY * lightY + lightZ * lightZ);\n          const diffuse = Math.max(0, (nx * lightX + ny * lightY + nz * lightZ) / lightLen);\n\n          const reflectX = 2 * nz * nx - lightX;\n          const reflectY = 2 * nz * ny - lightY;\n          const reflectZ = 2 * nz * nz - lightZ;\n          const specular = Math.pow(Math.max(0, reflectZ / Math.sqrt(reflectX * reflectX + reflectY * reflectY + reflectZ * reflectZ)), 32);\n\n          const plasmaVal = noise(\n            nx * 3 + time * 0.02,\n            ny * 3 + time * 0.015,\n            nz * 3 + time * 0.01\n          );\n\n          const fresnel = Math.pow(1 - sphereZ, 2);\n\n          const colorMix = (plasmaVal + 1) * 0.5;\n          const r1 = palette.primary[0];\n          const g1 = palette.primary[1];\n          const b1 = palette.primary[2];\n          const r2 = palette.secondary[0];\n          const g2 = palette.secondary[1];\n          const b2 = palette.secondary[2];\n          const r3 = palette.accent[0];\n          const g3 = palette.accent[1];\n          const b3 = palette.accent[2];\n\n          let r, g, b;\n          if (colorMix < 0.33) {\n            const t = colorMix * 3;\n            r = r1 * (1 - t) + r2 * t;\n            g = g1 * (1 - t) + g2 * t;\n            b = b1 * (1 - t) + b2 * t;\n          } else if (colorMix < 0.66) {\n            const t = (colorMix - 0.33) * 3;\n            r = r2 * (1 - t) + r3 * t;\n            g = g2 * (1 - t) + g3 * t;\n            b = b2 * (1 - t) + b3 * t;\n          } else {\n            const t = (colorMix - 0.66) * 3;\n            r = r3 * (1 - t) + r1 * t;\n            g = g3 * (1 - t) + g1 * t;\n            b = b3 * (1 - t) + b1 * t;\n          }\n\n          const iridescence = Math.sin(normalizedDist * 6 + time * 0.05) * 0.3 + 0.7;\n          r *= iridescence;\n          g *= iridescence * 1.1;\n          b *= iridescence * 1.2;\n\n          const lighting = 0.4 + diffuse * 0.4 + fresnel * 0.3;\n          r = r * lighting * intensity + specular * 255 * 0.6;\n          g = g * lighting * intensity + specular * 255 * 0.6;\n          b = b * lighting * intensity + specular * 255 * 0.6;\n\n          const edgeFade = Math.pow(sphereZ, 0.3);\n          const alpha = edgeFade * 255;\n\n          const idx = (y * width + x) * 4;\n          data[idx] = Math.min(255, Math.max(0, r));\n          data[idx + 1] = Math.min(255, Math.max(0, g));\n          data[idx + 2] = Math.min(255, Math.max(0, b));\n          data[idx + 3] = alpha;\n        }\n      }\n    }\n\n    ctx.putImageData(imageData, 0, 0);\n\n    timeRef.current += 1;\n    animationRef.current = requestAnimationFrame(draw);\n  }, [isPlaying, audioLevel, noise, palette]);\n\n  useEffect(() => {\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n\n    const dpr = window.devicePixelRatio || 1;\n    canvas.width = size * dpr;\n    canvas.height = size * dpr;\n    canvas.style.width = `${size}px`;\n    canvas.style.height = `${size}px`;\n\n    const ctx = canvas.getContext(\"2d\");\n    if (ctx) {\n      ctx.scale(dpr, dpr);\n    }\n\n    if (!reduceMotion) {\n      animationRef.current = requestAnimationFrame(draw);\n    } else {\n      draw();\n    }\n\n    return () => {\n      if (animationRef.current) {\n        cancelAnimationFrame(animationRef.current);\n      }\n    };\n  }, [size, draw, reduceMotion]);\n\n  const staticColorClasses = {\n    cyan: \"from-cyan-500 to-cyan-300\",\n    violet: \"from-violet-500 to-violet-300\", \n    fuchsia: \"from-fuchsia-500 to-fuchsia-300\",\n  };\n\n  if (reduceMotion) {\n    return (\n      <div\n        className={cn(\n          \"relative flex items-center justify-center\",\n          className\n        )}\n        style={{ width: size, height: size }}\n      >\n        <div \n          className={cn(\n            \"rounded-full bg-gradient-to-br shadow-lg\",\n            staticColorClasses[color]\n          )}\n          style={{ \n            width: size * 0.8, \n            height: size * 0.8,\n            boxShadow: `0 0 ${size * 0.2}px ${color === 'cyan' ? 'rgba(0,220,255,0.5)' : color === 'violet' ? 'rgba(139,92,246,0.5)' : 'rgba(236,72,153,0.5)'}`\n          }}\n          data-testid=\"audio-reactive-sphere\"\n        />\n      </div>\n    );\n  }\n\n  return (\n    <div\n      className={cn(\n        \"relative flex items-center justify-center\",\n        className\n      )}\n      style={{ width: size, height: size }}\n    >\n      <canvas\n        ref={canvasRef}\n        className=\"absolute inset-0\"\n        style={{ width: size, height: size }}\n        data-testid=\"audio-reactive-sphere\"\n      />\n    </div>\n  );\n}\n","path":null,"size_bytes":7676,"size_tokens":null},"client/src/components/MembershipBadge.tsx":{"content":"import { Crown, Star } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\n\ninterface MembershipBadgeProps {\n  membership: string;\n  size?: \"sm\" | \"md\" | \"lg\";\n  showLabel?: boolean;\n}\n\nexport function MembershipBadge({ membership, size = \"sm\", showLabel = true }: MembershipBadgeProps) {\n  if (membership === \"free\") return null;\n\n  const sizeClasses = {\n    sm: \"px-2 py-0.5 text-xs\",\n    md: \"px-3 py-1 text-sm\",\n    lg: \"px-4 py-1.5 text-base\",\n  };\n\n  const iconSizes = {\n    sm: \"w-3 h-3\",\n    md: \"w-4 h-4\",\n    lg: \"w-5 h-5\",\n  };\n\n  if (membership === \"elite\") {\n    return (\n      <div className={cn(\n        \"flex items-center gap-1 bg-sv-gold/20 border border-sv-gold/50 rounded text-sv-gold font-bold\",\n        sizeClasses[size]\n      )}>\n        <Crown className={iconSizes[size]} />\n        {showLabel && <span>ELITE</span>}\n      </div>\n    );\n  }\n\n  if (membership === \"pro\") {\n    return (\n      <div className={cn(\n        \"flex items-center gap-1 bg-sv-purple/20 border border-sv-purple/50 rounded text-sv-purple font-bold\",\n        sizeClasses[size]\n      )}>\n        <Star className={iconSizes[size]} />\n        {showLabel && <span>PRO</span>}\n      </div>\n    );\n  }\n\n  return null;\n}\n","path":null,"size_bytes":1211,"size_tokens":null},"client/src/pages/Customizations.tsx":{"content":"import { Navbar } from \"@/components/layout/Navbar\";\nimport { Footer } from \"@/components/layout/Footer\";\nimport { Button } from \"@/components/ui/button\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useUser } from \"@/context/UserContext\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { motion } from \"framer-motion\";\nimport { Coins, Lock, Check, Sparkles, Palette, Zap, Circle, Frame, Loader2 } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\nimport { Link } from \"wouter\";\nimport type { Customization } from \"@shared/schema\";\n\nasync function fetchCustomizations(): Promise<Customization[]> {\n  const response = await fetch(\"/api/customizations\");\n  if (!response.ok) throw new Error(\"Failed to fetch customizations\");\n  return response.json();\n}\n\nasync function fetchUserCustomizations(userId: number): Promise<{ customizationId: number }[]> {\n  const response = await fetch(`/api/customizations/user/${userId}`, {\n    credentials: \"include\",\n  });\n  if (!response.ok) throw new Error(\"Failed to fetch user customizations\");\n  return response.json();\n}\n\nasync function purchaseCustomization(customizationId: number): Promise<any> {\n  const response = await fetch(`/api/customizations/${customizationId}/purchase`, {\n    method: \"POST\",\n    headers: { \"Content-Type\": \"application/json\" },\n    credentials: \"include\",\n  });\n  if (!response.ok) {\n    const error = await response.json();\n    throw new Error(error.error || \"Failed to purchase\");\n  }\n  return response.json();\n}\n\nasync function unlockCustomization(customizationId: number): Promise<any> {\n  const response = await fetch(\"/api/customizations/unlock\", {\n    method: \"POST\",\n    headers: { \"Content-Type\": \"application/json\" },\n    credentials: \"include\",\n    body: JSON.stringify({ customizationId }),\n  });\n  if (!response.ok) {\n    const error = await response.json();\n    throw new Error(error.error || \"Failed to unlock\");\n  }\n  return response.json();\n}\n\nasync function equipCustomization(category: string, customizationId: number): Promise<any> {\n  const response = await fetch(\"/api/customizations/equip\", {\n    method: \"POST\",\n    headers: { \"Content-Type\": \"application/json\" },\n    credentials: \"include\",\n    body: JSON.stringify({ category, customizationId }),\n  });\n  if (!response.ok) {\n    const error = await response.json();\n    throw new Error(error.error || \"Failed to equip\");\n  }\n  return response.json();\n}\n\nfunction CustomizationCard({\n  customization,\n  isOwned,\n  isEquipped,\n  userLevel,\n  userCoins,\n  onPurchase,\n  onEquip,\n  isPurchasing,\n}: {\n  customization: Customization;\n  isOwned: boolean;\n  isEquipped: boolean;\n  userLevel: number;\n  userCoins: number;\n  onPurchase: () => void;\n  onEquip: () => void;\n  isPurchasing: boolean;\n}) {\n  const canAfford = userCoins >= (customization.coinCost || 0);\n  const meetsLevel = userLevel >= (customization.requiredLevel || 1);\n  const canPurchase = canAfford && meetsLevel;\n\n  const isDefault = customization.isDefault;\n  const available = isDefault || isOwned;\n\n  const getRarityBorder = () => {\n    switch (customization.rarity) {\n      case \"legendary\": return \"border-yellow-500\";\n      case \"epic\": return \"border-violet-500\";\n      case \"rare\": return \"border-blue-500\";\n      default: return \"border-white/10\";\n    }\n  };\n\n  const getRarityGlow = () => {\n    switch (customization.rarity) {\n      case \"legendary\": return \"shadow-yellow-500/30\";\n      case \"epic\": return \"shadow-violet-500/30\";\n      case \"rare\": return \"shadow-blue-500/30\";\n      default: return \"\";\n    }\n  };\n\n  const getCategoryIcon = () => {\n    switch (customization.category) {\n      case \"plate\": return <Frame className=\"w-10 h-10 text-cyan-400\" />;\n      case \"animation\": return <Sparkles className=\"w-10 h-10 text-violet-400 animate-pulse\" />;\n      case \"sphere\": return <Circle className=\"w-10 h-10\" style={{ fill: customization.cssClass || \"#FF2EC3\", stroke: \"none\" }} />;\n      case \"theme\": return <Palette className=\"w-10 h-10 text-yellow-400\" />;\n      default: return <Palette className=\"w-10 h-10 text-gray-400\" />;\n    }\n  };\n\n  return (\n    <motion.div\n      initial={{ opacity: 0, y: 20 }}\n      animate={{ opacity: 1, y: 0 }}\n      className={cn(\n        \"relative bg-card/50 backdrop-blur-sm border-2 rounded-xl p-4 transition-all hover:scale-[1.02]\",\n        getRarityBorder(),\n        isEquipped && \"ring-2 ring-fuchsia-500\",\n        getRarityGlow() && `shadow-lg ${getRarityGlow()}`\n      )}\n      data-testid={`customization-${customization.id}`}\n    >\n      {isEquipped && (\n        <div className=\"absolute -top-2 -right-2 w-6 h-6 bg-fuchsia-500 rounded-full flex items-center justify-center\">\n          <Check className=\"w-4 h-4 text-white\" />\n        </div>\n      )}\n\n      {isOwned && !isEquipped && (\n        <div className=\"absolute top-2 right-2 px-2 py-0.5 bg-green-500/20 border border-green-500/30 rounded text-[10px] text-green-400 font-bold\">\n          OWNED\n        </div>\n      )}\n\n      <div className=\"mb-4 h-24 flex items-center justify-center bg-black/30 rounded-lg border border-white/5\">\n        {getCategoryIcon()}\n      </div>\n\n      <h3 className=\"font-bold text-white text-sm mb-1\">{customization.name}</h3>\n      <p className=\"text-xs text-muted-foreground mb-3 line-clamp-2\">{customization.description}</p>\n\n      <div className=\"flex items-center justify-between mb-3\">\n        <span className={cn(\n          \"text-xs px-2 py-0.5 rounded capitalize font-medium\",\n          customization.rarity === \"legendary\" && \"bg-yellow-500/20 text-yellow-400\",\n          customization.rarity === \"epic\" && \"bg-violet-500/20 text-violet-400\",\n          customization.rarity === \"rare\" && \"bg-blue-500/20 text-blue-400\",\n          customization.rarity === \"common\" && \"bg-gray-500/20 text-gray-400\"\n        )}>\n          {customization.rarity}\n        </span>\n        \n        {!isDefault && !isOwned && (\n          <span className=\"text-xs text-muted-foreground flex items-center gap-1\">\n            {customization.requiredLevel && customization.requiredLevel > 1 && (\n              <span className={cn(\"flex items-center gap-0.5\", !meetsLevel && \"text-red-400\")}>\n                <Zap className=\"w-3 h-3\" />\n                LVL {customization.requiredLevel}\n              </span>\n            )}\n          </span>\n        )}\n      </div>\n\n      {available ? (\n        <Button\n          size=\"sm\"\n          className={cn(\n            \"w-full font-bold\",\n            isEquipped\n              ? \"bg-muted text-muted-foreground\"\n              : \"bg-fuchsia-500 text-white hover:bg-fuchsia-600\"\n          )}\n          onClick={onEquip}\n          disabled={isEquipped}\n          data-testid={`equip-${customization.id}`}\n        >\n          {isEquipped ? \"Equipped\" : \"Equip\"}\n        </Button>\n      ) : (\n        <Button\n          size=\"sm\"\n          className={cn(\n            \"w-full font-bold\",\n            canPurchase\n              ? \"bg-violet-500 text-white hover:bg-violet-600\"\n              : \"bg-muted/50 text-muted-foreground cursor-not-allowed\"\n          )}\n          onClick={onPurchase}\n          disabled={!canPurchase || isPurchasing}\n          data-testid={`purchase-${customization.id}`}\n        >\n          {isPurchasing ? (\n            <Loader2 className=\"w-4 h-4 animate-spin\" />\n          ) : (\n            <>\n              <Coins className=\"w-3 h-3 mr-1 text-yellow-400\" />\n              {customization.coinCost || 0} Coins\n            </>\n          )}\n        </Button>\n      )}\n    </motion.div>\n  );\n}\n\nexport default function Customizations() {\n  const { user, refreshUser } = useUser();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const { data: customizations = [], isLoading } = useQuery({\n    queryKey: [\"customizations\"],\n    queryFn: fetchCustomizations,\n  });\n\n  const { data: userCustomizations = [] } = useQuery({\n    queryKey: [\"userCustomizations\", user?.id],\n    queryFn: () => user ? fetchUserCustomizations(user.id) : [],\n    enabled: !!user,\n  });\n\n  const purchaseMutation = useMutation({\n    mutationFn: purchaseCustomization,\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({ queryKey: [\"userCustomizations\"] });\n      refreshUser();\n      toast({\n        title: \"Purchase Complete!\",\n        description: `You've purchased a new customization! New balance: ${data.newBalance} coins`,\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Purchase Failed\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const equipMutation = useMutation({\n    mutationFn: ({ category, customizationId }: { category: string; customizationId: number }) =>\n      equipCustomization(category, customizationId),\n    onSuccess: () => {\n      refreshUser();\n      toast({\n        title: \"Equipped!\",\n        description: \"Your customization has been equipped!\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Failed to equip\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const ownedIds = new Set(userCustomizations.map((uc: any) => uc.id || uc.customizationId));\n\n  const plates = customizations.filter(c => c.category === \"plate\");\n  const animations = customizations.filter(c => c.category === \"animation\");\n  const spheres = customizations.filter(c => c.category === \"sphere\");\n  const themes = customizations.filter(c => c.category === \"theme\");\n\n  const getEquippedId = (category: string) => {\n    if (!user) return null;\n    if (category === \"plate\") return user.equippedPlateId;\n    if (category === \"animation\") return user.equippedAnimationId;\n    if (category === \"sphere\") return user.equippedSphereId;\n    return null;\n  };\n\n  if (!user) {\n    return (\n      <div className=\"min-h-screen bg-background flex flex-col\">\n        <Navbar />\n        <main className=\"flex-grow pt-24 pb-20 flex items-center justify-center\">\n          <div className=\"text-center\">\n            <h2 className=\"text-2xl font-bold text-white mb-4\">Sign In Required</h2>\n            <p className=\"text-muted-foreground mb-6\">Please sign in to access customizations.</p>\n            <Link href=\"/\">\n              <Button className=\"bg-fuchsia-500 hover:bg-fuchsia-600\">Go Home</Button>\n            </Link>\n          </div>\n        </main>\n        <Footer />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background flex flex-col\">\n      <Navbar />\n      \n      <main className=\"flex-grow pt-24 pb-20\">\n        <div className=\"container mx-auto px-4\">\n          <div className=\"text-center mb-12\">\n            <h1 className=\"text-4xl md:text-5xl font-heading font-black text-white mb-4\">\n              <span className=\"text-fuchsia-500\">CUSTOM</span>IZATIONS\n            </h1>\n            <p className=\"text-muted-foreground max-w-2xl mx-auto\">\n              Purchase and equip unique profile plates, battle effects, and sphere skins. \n              Stand out in the arena!\n            </p>\n            \n            <div className=\"flex items-center justify-center gap-6 mt-6\">\n              <div className=\"flex items-center gap-2 px-4 py-2 bg-card/50 border border-yellow-500/30 rounded-lg\">\n                <Coins className=\"w-5 h-5 text-yellow-400\" />\n                <span className=\"font-mono font-bold text-white\">{user.coins}</span>\n                <span className=\"text-xs text-muted-foreground\">coins</span>\n              </div>\n              <div className=\"flex items-center gap-2 px-4 py-2 bg-card/50 border border-violet-500/30 rounded-lg\">\n                <Zap className=\"w-5 h-5 text-violet-400\" />\n                <span className=\"font-mono font-bold text-white\">Level {user.level || 1}</span>\n              </div>\n            </div>\n\n            <div className=\"mt-4\">\n              <Link href=\"/store\">\n                <Button variant=\"outline\" size=\"sm\" className=\"border-yellow-500/30 hover:bg-yellow-500/10\">\n                  <Coins className=\"w-4 h-4 mr-2 text-yellow-400\" />\n                  Need more coins? Visit Store\n                </Button>\n              </Link>\n            </div>\n          </div>\n\n          {isLoading ? (\n            <div className=\"flex justify-center py-20\">\n              <Loader2 className=\"w-8 h-8 animate-spin text-fuchsia-500\" />\n            </div>\n          ) : customizations.length === 0 ? (\n            <div className=\"text-center py-20\">\n              <Palette className=\"w-16 h-16 mx-auto text-muted-foreground mb-4\" />\n              <h3 className=\"text-xl font-bold text-white mb-2\">No Customizations Available</h3>\n              <p className=\"text-muted-foreground\">Check back soon for new items!</p>\n            </div>\n          ) : (\n            <Tabs defaultValue=\"plates\" className=\"w-full\">\n              <TabsList className=\"w-full max-w-lg mx-auto grid grid-cols-4 mb-8 bg-card/50\">\n                <TabsTrigger value=\"plates\" className=\"data-[state=active]:bg-fuchsia-500 data-[state=active]:text-white\">\n                  <Frame className=\"w-4 h-4 mr-2\" />\n                  Plates\n                </TabsTrigger>\n                <TabsTrigger value=\"animations\" className=\"data-[state=active]:bg-fuchsia-500 data-[state=active]:text-white\">\n                  <Sparkles className=\"w-4 h-4 mr-2\" />\n                  Effects\n                </TabsTrigger>\n                <TabsTrigger value=\"spheres\" className=\"data-[state=active]:bg-fuchsia-500 data-[state=active]:text-white\">\n                  <Circle className=\"w-4 h-4 mr-2\" />\n                  Spheres\n                </TabsTrigger>\n                <TabsTrigger value=\"themes\" className=\"data-[state=active]:bg-fuchsia-500 data-[state=active]:text-white\">\n                  <Palette className=\"w-4 h-4 mr-2\" />\n                  Themes\n                </TabsTrigger>\n              </TabsList>\n\n              <TabsContent value=\"plates\">\n                {plates.length === 0 ? (\n                  <div className=\"text-center py-12 text-muted-foreground\">\n                    <Frame className=\"w-12 h-12 mx-auto mb-3 opacity-50\" />\n                    <p>No profile plates available yet.</p>\n                  </div>\n                ) : (\n                  <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4\">\n                    {plates.map((c) => (\n                      <CustomizationCard\n                        key={c.id}\n                        customization={c}\n                        isOwned={c.isDefault || ownedIds.has(c.id)}\n                        isEquipped={getEquippedId(\"plate\") === c.id}\n                        userLevel={user.level || 1}\n                        userCoins={user.coins || 0}\n                        onPurchase={() => purchaseMutation.mutate(c.id)}\n                        onEquip={() => equipMutation.mutate({ category: \"plate\", customizationId: c.id })}\n                        isPurchasing={purchaseMutation.isPending}\n                      />\n                    ))}\n                  </div>\n                )}\n              </TabsContent>\n\n              <TabsContent value=\"animations\">\n                {animations.length === 0 ? (\n                  <div className=\"text-center py-12 text-muted-foreground\">\n                    <Sparkles className=\"w-12 h-12 mx-auto mb-3 opacity-50\" />\n                    <p>No battle effects available yet.</p>\n                  </div>\n                ) : (\n                  <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4\">\n                    {animations.map((c) => (\n                      <CustomizationCard\n                        key={c.id}\n                        customization={c}\n                        isOwned={c.isDefault || ownedIds.has(c.id)}\n                        isEquipped={getEquippedId(\"animation\") === c.id}\n                        userLevel={user.level || 1}\n                        userCoins={user.coins || 0}\n                        onPurchase={() => purchaseMutation.mutate(c.id)}\n                        onEquip={() => equipMutation.mutate({ category: \"animation\", customizationId: c.id })}\n                        isPurchasing={purchaseMutation.isPending}\n                      />\n                    ))}\n                  </div>\n                )}\n              </TabsContent>\n\n              <TabsContent value=\"spheres\">\n                {spheres.length === 0 ? (\n                  <div className=\"text-center py-12 text-muted-foreground\">\n                    <Circle className=\"w-12 h-12 mx-auto mb-3 opacity-50\" />\n                    <p>No sphere skins available yet.</p>\n                  </div>\n                ) : (\n                  <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4\">\n                    {spheres.map((c) => (\n                      <CustomizationCard\n                        key={c.id}\n                        customization={c}\n                        isOwned={c.isDefault || ownedIds.has(c.id)}\n                        isEquipped={getEquippedId(\"sphere\") === c.id}\n                        userLevel={user.level || 1}\n                        userCoins={user.coins || 0}\n                        onPurchase={() => purchaseMutation.mutate(c.id)}\n                        onEquip={() => equipMutation.mutate({ category: \"sphere\", customizationId: c.id })}\n                        isPurchasing={purchaseMutation.isPending}\n                      />\n                    ))}\n                  </div>\n                )}\n              </TabsContent>\n\n              <TabsContent value=\"themes\">\n                {themes.length === 0 ? (\n                  <div className=\"text-center py-12 text-muted-foreground\">\n                    <Palette className=\"w-12 h-12 mx-auto mb-3 opacity-50\" />\n                    <p>No profile themes available yet.</p>\n                  </div>\n                ) : (\n                  <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4\">\n                    {themes.map((c) => (\n                      <CustomizationCard\n                        key={c.id}\n                        customization={c}\n                        isOwned={c.isDefault || ownedIds.has(c.id)}\n                        isEquipped={false}\n                        userLevel={user.level || 1}\n                        userCoins={user.coins || 0}\n                        onPurchase={() => purchaseMutation.mutate(c.id)}\n                        onEquip={() => {}}\n                        isPurchasing={purchaseMutation.isPending}\n                      />\n                    ))}\n                  </div>\n                )}\n              </TabsContent>\n            </Tabs>\n          )}\n        </div>\n      </main>\n      <Footer />\n    </div>\n  );\n}\n","path":null,"size_bytes":18847,"size_tokens":null},"client/src/hooks/useAuth.ts":{"content":"import { useQuery } from \"@tanstack/react-query\";\n\nexport function useAuth() {\n  const { data: user, isLoading } = useQuery({\n    queryKey: [\"/api/auth/user\"],\n    retry: false,\n  });\n\n  return {\n    user,\n    isLoading,\n    isAuthenticated: !!user,\n  };\n}\n","path":null,"size_bytes":257,"size_tokens":null},"client/src/components/battle/ProfileCard.tsx":{"content":"import { Trophy, Zap, Coins, Crown, Star, Shield } from \"lucide-react\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Link } from \"wouter\";\n\ninterface ProfileCardProps {\n  userId: number;\n  name: string;\n  avatar?: string | null;\n  role?: string;\n  level?: number;\n  xp?: number;\n  wins?: number;\n  coins?: number;\n  membership?: string;\n  foundersBadge?: boolean;\n  side: \"left\" | \"right\";\n  isWinner?: boolean;\n}\n\nexport function ProfileCard({\n  userId,\n  name,\n  avatar,\n  role = \"artist\",\n  level = 1,\n  xp = 0,\n  wins = 0,\n  coins,\n  membership = \"free\",\n  foundersBadge = false,\n  side,\n  isWinner = false,\n}: ProfileCardProps) {\n  const getFoundersBadge = () => {\n    if (!foundersBadge) return null;\n    return (\n      <div className=\"flex items-center gap-1 px-2 py-0.5 bg-gradient-to-r from-sv-gold/30 to-sv-pink/30 border border-sv-gold rounded text-sv-gold text-xs font-bold animate-pulse\" title=\"Founder\">\n        <Shield className=\"w-3 h-3 fill-sv-gold/50\" />\n        FOUNDER\n      </div>\n    );\n  };\n\n  const getMembershipBadge = () => {\n    if (membership === \"elite\") {\n      return (\n        <div className=\"flex items-center gap-1 px-2 py-0.5 bg-sv-gold/20 border border-sv-gold/50 rounded text-sv-gold text-xs font-bold\">\n          <Crown className=\"w-3 h-3\" />\n          ELITE\n        </div>\n      );\n    }\n    if (membership === \"pro\") {\n      return (\n        <div className=\"flex items-center gap-1 px-2 py-0.5 bg-sv-purple/20 border border-sv-purple/50 rounded text-sv-purple text-xs font-bold\">\n          <Star className=\"w-3 h-3\" />\n          PRO\n        </div>\n      );\n    }\n    return null;\n  };\n\n  const getRarityColor = () => {\n    if (level >= 40) return \"from-sv-gold via-yellow-300 to-sv-gold\";\n    if (level >= 25) return \"from-sv-purple via-purple-400 to-sv-purple\";\n    if (level >= 10) return \"from-blue-500 via-blue-400 to-blue-500\";\n    return \"from-gray-500 via-gray-400 to-gray-500\";\n  };\n\n  return (\n    <div\n      className={`relative ${side === \"right\" ? \"text-right\" : \"text-left\"}`}\n      data-testid={`profile-card-${side}`}\n    >\n      <Link href={`/user/${userId}`}>\n        <div className={`group cursor-pointer flex items-center gap-3 ${side === \"right\" ? \"flex-row-reverse\" : \"\"}`}>\n          <div className=\"relative\">\n            <div className={`absolute -inset-1 bg-gradient-to-r ${getRarityColor()} rounded-full opacity-50 blur-sm group-hover:opacity-100 transition-opacity`} />\n            <Avatar className=\"w-14 h-14 border-2 border-sv-gray relative\">\n              <AvatarImage src={avatar || undefined} alt={name} />\n              <AvatarFallback className=\"bg-sv-dark text-sv-pink font-bold text-lg\">\n                {(name || \"?\")[0].toUpperCase()}\n              </AvatarFallback>\n            </Avatar>\n            {isWinner && (\n              <div className=\"absolute -top-2 -right-2 w-6 h-6 bg-sv-gold rounded-full flex items-center justify-center\">\n                <Trophy className=\"w-3 h-3 text-black\" />\n              </div>\n            )}\n            <div className=\"absolute -bottom-1 left-1/2 -translate-x-1/2 px-2 py-0.5 bg-sv-black border border-sv-gray rounded text-xs font-mono text-gray-400\">\n              LVL {level}\n            </div>\n          </div>\n\n          <div className={`flex flex-col ${side === \"right\" ? \"items-end\" : \"items-start\"}`}>\n            <div className=\"flex items-center gap-2 flex-wrap\">\n              <span className=\"font-cyber text-white font-bold group-hover:text-sv-pink transition-colors\">\n                {name || \"Unknown\"}\n              </span>\n              {getFoundersBadge()}\n              {getMembershipBadge()}\n            </div>\n            \n            <div className={`flex items-center gap-3 text-xs text-gray-500 mt-1 ${side === \"right\" ? \"flex-row-reverse\" : \"\"}`}>\n              <span className=\"flex items-center gap-1 capitalize\">\n                {role === \"producer\" ? (\n                  <Zap className=\"w-3 h-3 text-sv-purple\" />\n                ) : (\n                  <Zap className=\"w-3 h-3 text-sv-pink\" />\n                )}\n                {role}\n              </span>\n              <span className=\"flex items-center gap-1\">\n                <Trophy className=\"w-3 h-3 text-sv-gold\" />\n                {wins} wins\n              </span>\n              <span className=\"flex items-center gap-1\">\n                <Star className=\"w-3 h-3 text-sv-purple\" />\n                {xp} XP\n              </span>\n            </div>\n          </div>\n        </div>\n      </Link>\n    </div>\n  );\n}\n","path":null,"size_bytes":4562,"size_tokens":null},"client/src/components/Tutorial.tsx":{"content":"import { motion, AnimatePresence } from \"framer-motion\";\nimport { useState, useEffect } from \"react\";\nimport { X, ChevronRight, ChevronLeft, Zap, Trophy, Users, MessageSquare, Coins, Sparkles } from \"lucide-react\";\n\ninterface TutorialStep {\n  id: string;\n  title: string;\n  description: string;\n  icon: React.ReactNode;\n  position?: \"top\" | \"bottom\" | \"left\" | \"right\" | \"center\";\n  highlight?: string;\n}\n\nconst tutorialSteps: TutorialStep[] = [\n  {\n    id: \"welcome\",\n    title: \"Welcome to SongVersus!\",\n    description: \"The underground arena where Artists and Producers clash in epic music battles. Let us show you around!\",\n    icon: <Zap className=\"w-8 h-8 text-sv-pink\" />,\n    position: \"center\",\n  },\n  {\n    id: \"battles\",\n    title: \"Music Battles\",\n    description: \"Create or join battles to compete against other musicians. Upload your tracks and let the community vote for the winner!\",\n    icon: <Trophy className=\"w-8 h-8 text-sv-gold\" />,\n    position: \"center\",\n    highlight: \"nav-battles\",\n  },\n  {\n    id: \"coins\",\n    title: \"Versus Coins\",\n    description: \"Earn coins by winning battles and voting. Use them to create new battles, unlock exclusive customizations, and more!\",\n    icon: <Coins className=\"w-8 h-8 text-sv-gold\" />,\n    position: \"center\",\n  },\n  {\n    id: \"community\",\n    title: \"Connect with Artists\",\n    description: \"Follow other artists, chat in real-time, and build your network in the music community.\",\n    icon: <Users className=\"w-8 h-8 text-sv-purple\" />,\n    position: \"center\",\n    highlight: \"nav-leaderboard\",\n  },\n  {\n    id: \"customizations\",\n    title: \"Unlock Customizations\",\n    description: \"Level up to unlock exclusive battle plates, animations, and audio-reactive sphere styles. Show off your achievements!\",\n    icon: <Sparkles className=\"w-8 h-8 text-sv-pink\" />,\n    position: \"center\",\n  },\n  {\n    id: \"ready\",\n    title: \"You're Ready!\",\n    description: \"Start battling, earn XP, climb the leaderboard, and become a legend. Good luck!\",\n    icon: <Zap className=\"w-8 h-8 text-sv-gold\" />,\n    position: \"center\",\n  },\n];\n\ninterface TutorialProps {\n  onComplete: () => void;\n  onSkip: () => void;\n}\n\nexport function Tutorial({ onComplete, onSkip }: TutorialProps) {\n  const [currentStep, setCurrentStep] = useState(0);\n  const [isVisible, setIsVisible] = useState(true);\n\n  const step = tutorialSteps[currentStep];\n  const isLastStep = currentStep === tutorialSteps.length - 1;\n  const isFirstStep = currentStep === 0;\n\n  const handleNext = () => {\n    if (isLastStep) {\n      setIsVisible(false);\n      setTimeout(onComplete, 300);\n    } else {\n      setCurrentStep(prev => prev + 1);\n    }\n  };\n\n  const handlePrev = () => {\n    if (!isFirstStep) {\n      setCurrentStep(prev => prev - 1);\n    }\n  };\n\n  const handleSkip = () => {\n    setIsVisible(false);\n    setTimeout(onSkip, 300);\n  };\n\n  useEffect(() => {\n    if (step.highlight) {\n      const element = document.querySelector(`[data-testid=\"${step.highlight}\"]`);\n      if (element) {\n        element.classList.add(\"tutorial-highlight\");\n        return () => element.classList.remove(\"tutorial-highlight\");\n      }\n    }\n  }, [step.highlight]);\n\n  return (\n    <AnimatePresence>\n      {isVisible && (\n        <motion.div\n          initial={{ opacity: 0 }}\n          animate={{ opacity: 1 }}\n          exit={{ opacity: 0 }}\n          className=\"fixed inset-0 z-[90] bg-black/80 backdrop-blur-sm flex items-center justify-center p-4\"\n          data-testid=\"tutorial-overlay\"\n        >\n          <motion.div\n            key={step.id}\n            initial={{ opacity: 0, scale: 0.9, y: 20 }}\n            animate={{ opacity: 1, scale: 1, y: 0 }}\n            exit={{ opacity: 0, scale: 0.9, y: -20 }}\n            transition={{ type: \"spring\", damping: 20 }}\n            className=\"relative bg-sv-dark border border-sv-gray rounded-lg p-8 max-w-md w-full\"\n          >\n            <button\n              onClick={handleSkip}\n              className=\"absolute top-4 right-4 text-gray-500 hover:text-white transition-colors\"\n              data-testid=\"tutorial-skip\"\n            >\n              <X className=\"w-5 h-5\" />\n            </button>\n\n            <div className=\"flex flex-col items-center text-center\">\n              <motion.div\n                initial={{ scale: 0 }}\n                animate={{ scale: 1 }}\n                transition={{ delay: 0.1, type: \"spring\" }}\n                className=\"w-16 h-16 rounded-full bg-sv-black border border-sv-gray flex items-center justify-center mb-6\"\n              >\n                {step.icon}\n              </motion.div>\n\n              <h2 className=\"text-2xl font-cyber font-bold text-white mb-4\">\n                {step.title}\n              </h2>\n\n              <p className=\"text-gray-400 mb-8 leading-relaxed\">\n                {step.description}\n              </p>\n\n              <div className=\"flex items-center gap-2 mb-6\">\n                {tutorialSteps.map((_, index) => (\n                  <div\n                    key={index}\n                    className={`w-2 h-2 rounded-full transition-colors ${\n                      index === currentStep\n                        ? \"bg-sv-pink\"\n                        : index < currentStep\n                        ? \"bg-sv-purple\"\n                        : \"bg-sv-gray\"\n                    }`}\n                  />\n                ))}\n              </div>\n\n              <div className=\"flex gap-4 w-full\">\n                {!isFirstStep && (\n                  <button\n                    onClick={handlePrev}\n                    className=\"flex-1 py-3 px-4 border border-sv-gray text-gray-400 rounded hover:border-sv-purple hover:text-white transition-colors flex items-center justify-center gap-2\"\n                    data-testid=\"tutorial-prev\"\n                  >\n                    <ChevronLeft className=\"w-4 h-4\" />\n                    Back\n                  </button>\n                )}\n                <button\n                  onClick={handleNext}\n                  className=\"flex-1 py-3 px-4 bg-sv-pink text-black font-bold rounded hover:bg-sv-pink/80 transition-colors flex items-center justify-center gap-2\"\n                  data-testid=\"tutorial-next\"\n                >\n                  {isLastStep ? \"Start Battling!\" : \"Next\"}\n                  {!isLastStep && <ChevronRight className=\"w-4 h-4\" />}\n                </button>\n              </div>\n            </div>\n          </motion.div>\n\n          {step.highlight && (\n            <motion.div\n              initial={{ opacity: 0 }}\n              animate={{ opacity: 1 }}\n              className=\"absolute pointer-events-none\"\n              style={{\n                top: \"50%\",\n                left: \"50%\",\n                transform: \"translate(-50%, -50%)\",\n              }}\n            >\n              <div className=\"w-64 h-64 border-2 border-sv-pink rounded-full animate-ping opacity-20\" />\n            </motion.div>\n          )}\n        </motion.div>\n      )}\n    </AnimatePresence>\n  );\n}\n","path":null,"size_bytes":6982,"size_tokens":null},"client/src/components/profile/EditProfileDialog.tsx":{"content":"import { Button } from \"@/components/ui/button\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { useState, useRef } from \"react\";\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { updateUserProfile } from \"@/lib/api\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Loader2, Upload, Camera, X } from \"lucide-react\";\nimport { Avatar, AvatarImage, AvatarFallback } from \"@/components/ui/avatar\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\n\ninterface EditProfileDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  userId: number;\n  currentAvatar: string;\n  currentBio: string;\n  userName?: string;\n}\n\nexport function EditProfileDialog({\n  open,\n  onOpenChange,\n  userId,\n  currentAvatar,\n  currentBio,\n  userName = \"User\",\n}: EditProfileDialogProps) {\n  const [avatar, setAvatar] = useState(currentAvatar);\n  const [bio, setBio] = useState(currentBio);\n  const [isUploading, setIsUploading] = useState(false);\n  const [previewUrl, setPreviewUrl] = useState<string | null>(null);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const handleFileSelect = async (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (!file) return;\n\n    if (file.size > 5 * 1024 * 1024) {\n      toast({\n        title: \"File too large\",\n        description: \"Please select an image under 5MB\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (!file.type.startsWith(\"image/\")) {\n      toast({\n        title: \"Invalid file type\",\n        description: \"Please select an image file\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    const localPreview = URL.createObjectURL(file);\n    setPreviewUrl(localPreview);\n    setIsUploading(true);\n\n    try {\n      const response = await fetch(\"/api/objects/upload\", {\n        method: \"POST\",\n        credentials: \"include\",\n      });\n      if (!response.ok) throw new Error(\"Failed to get upload URL\");\n      const { url } = await response.json();\n\n      const uploadResponse = await fetch(url, {\n        method: \"PUT\",\n        body: file,\n        headers: {\n          \"Content-Type\": file.type,\n        },\n      });\n\n      if (!uploadResponse.ok) throw new Error(\"Upload failed\");\n\n      const uploadedUrl = url.split(\"?\")[0];\n      const objectPath = uploadedUrl.replace(/^https?:\\/\\/[^\\/]+/, \"\");\n      setAvatar(objectPath);\n      toast({ title: \"Image uploaded successfully\" });\n    } catch (error) {\n      console.error(\"Upload error:\", error);\n      toast({\n        title: \"Upload failed\",\n        description: \"Please try again\",\n        variant: \"destructive\",\n      });\n      setPreviewUrl(null);\n    } finally {\n      setIsUploading(false);\n    }\n  };\n\n  const handleRemoveImage = () => {\n    setPreviewUrl(null);\n    setAvatar(\"\");\n    if (fileInputRef.current) {\n      fileInputRef.current.value = \"\";\n    }\n  };\n\n  const mutation = useMutation({\n    mutationFn: () => updateUserProfile(userId, avatar, bio),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"user\", userId] });\n      toast({ title: \"Profile updated successfully\" });\n      onOpenChange(false);\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to update profile\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const displayAvatar = previewUrl || avatar;\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"bg-card border-white/10 sm:max-w-[425px]\">\n        <DialogHeader>\n          <DialogTitle className=\"text-white\">Edit Profile</DialogTitle>\n          <DialogDescription>\n            Update your profile picture and bio\n          </DialogDescription>\n        </DialogHeader>\n\n        <div className=\"space-y-6\">\n          <div>\n            <label className=\"text-sm font-medium text-white mb-3 block\">\n              Profile Picture\n            </label>\n            <div className=\"flex items-center gap-4\">\n              <div className=\"relative\">\n                <Avatar className=\"w-20 h-20 border-2 border-sv-pink\">\n                  <AvatarImage src={displayAvatar || undefined} />\n                  <AvatarFallback className=\"bg-sv-dark text-sv-pink text-xl font-bold\">\n                    {userName[0]?.toUpperCase() || \"?\"}\n                  </AvatarFallback>\n                </Avatar>\n                {isUploading && (\n                  <div className=\"absolute inset-0 bg-black/50 rounded-full flex items-center justify-center\">\n                    <Loader2 className=\"w-6 h-6 animate-spin text-white\" />\n                  </div>\n                )}\n              </div>\n              \n              <div className=\"flex flex-col gap-2\">\n                <input\n                  ref={fileInputRef}\n                  type=\"file\"\n                  accept=\"image/*\"\n                  onChange={handleFileSelect}\n                  className=\"hidden\"\n                  data-testid=\"input-avatar-file\"\n                />\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  size=\"sm\"\n                  className=\"border-sv-pink text-sv-pink hover:bg-sv-pink/10\"\n                  onClick={() => fileInputRef.current?.click()}\n                  disabled={isUploading}\n                  data-testid=\"button-upload-avatar\"\n                >\n                  <Camera className=\"w-4 h-4 mr-2\" />\n                  {displayAvatar ? \"Change Photo\" : \"Upload Photo\"}\n                </Button>\n                {displayAvatar && (\n                  <Button\n                    type=\"button\"\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    className=\"text-red-400 hover:text-red-300 hover:bg-red-500/10\"\n                    onClick={handleRemoveImage}\n                    disabled={isUploading}\n                    data-testid=\"button-remove-avatar\"\n                  >\n                    <X className=\"w-4 h-4 mr-2\" />\n                    Remove\n                  </Button>\n                )}\n              </div>\n            </div>\n            <p className=\"text-xs text-muted-foreground mt-2\">\n              JPG, PNG or GIF. Max 5MB.\n            </p>\n          </div>\n\n          <div>\n            <label className=\"text-sm font-medium text-white mb-2 block\">\n              Bio\n            </label>\n            <Textarea\n              value={bio}\n              onChange={(e) => setBio(e.target.value)}\n              placeholder=\"Tell us about yourself...\"\n              className=\"bg-white/5 border-white/10 text-white resize-none\"\n              rows={4}\n              maxLength={500}\n              data-testid=\"input-bio\"\n            />\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              {bio.length}/500\n            </p>\n          </div>\n\n          <div className=\"flex gap-3 justify-end\">\n            <Button\n              variant=\"outline\"\n              className=\"border-white/10\"\n              onClick={() => onOpenChange(false)}\n              disabled={mutation.isPending || isUploading}\n              data-testid=\"button-cancel\"\n            >\n              Cancel\n            </Button>\n            <Button\n              className=\"bg-white text-black hover:bg-white/90\"\n              onClick={() => mutation.mutate()}\n              disabled={mutation.isPending || isUploading}\n              data-testid=\"button-save-profile\"\n            >\n              {mutation.isPending && <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />}\n              Save\n            </Button>\n          </div>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","path":null,"size_bytes":7825,"size_tokens":null},"server/objectAcl.ts":{"content":"import { File } from \"@google-cloud/storage\";\n\nconst ACL_POLICY_METADATA_KEY = \"custom:aclPolicy\";\n\nexport enum ObjectAccessGroupType {}\n\nexport interface ObjectAccessGroup {\n  type: ObjectAccessGroupType;\n  id: string;\n}\n\nexport enum ObjectPermission {\n  READ = \"read\",\n  WRITE = \"write\",\n}\n\nexport interface ObjectAclRule {\n  group: ObjectAccessGroup;\n  permission: ObjectPermission;\n}\n\nexport interface ObjectAclPolicy {\n  owner: string;\n  visibility: \"public\" | \"private\";\n  aclRules?: Array<ObjectAclRule>;\n}\n\nfunction isPermissionAllowed(\n  requested: ObjectPermission,\n  granted: ObjectPermission\n): boolean {\n  if (requested === ObjectPermission.READ) {\n    return [ObjectPermission.READ, ObjectPermission.WRITE].includes(granted);\n  }\n  return granted === ObjectPermission.WRITE;\n}\n\nabstract class BaseObjectAccessGroup implements ObjectAccessGroup {\n  constructor(\n    public readonly type: ObjectAccessGroupType,\n    public readonly id: string\n  ) {}\n  public abstract hasMember(userId: string): Promise<boolean>;\n}\n\nfunction createObjectAccessGroup(\n  group: ObjectAccessGroup\n): BaseObjectAccessGroup {\n  switch (group.type) {\n    default:\n      throw new Error(`Unknown access group type: ${group.type}`);\n  }\n}\n\nexport async function setObjectAclPolicy(\n  objectFile: File,\n  aclPolicy: ObjectAclPolicy\n): Promise<void> {\n  const [exists] = await objectFile.exists();\n  if (!exists) {\n    throw new Error(`Object not found: ${objectFile.name}`);\n  }\n  await objectFile.setMetadata({\n    metadata: {\n      [ACL_POLICY_METADATA_KEY]: JSON.stringify(aclPolicy),\n    },\n  });\n}\n\nexport async function getObjectAclPolicy(\n  objectFile: File\n): Promise<ObjectAclPolicy | null> {\n  const [metadata] = await objectFile.getMetadata();\n  const aclPolicy = metadata?.metadata?.[ACL_POLICY_METADATA_KEY];\n  if (!aclPolicy) {\n    return null;\n  }\n  return JSON.parse(aclPolicy as string);\n}\n\nexport async function canAccessObject({\n  userId,\n  objectFile,\n  requestedPermission,\n}: {\n  userId?: string;\n  objectFile: File;\n  requestedPermission: ObjectPermission;\n}): Promise<boolean> {\n  const aclPolicy = await getObjectAclPolicy(objectFile);\n  if (!aclPolicy) {\n    return false;\n  }\n  if (\n    aclPolicy.visibility === \"public\" &&\n    requestedPermission === ObjectPermission.READ\n  ) {\n    return true;\n  }\n  if (!userId) {\n    return false;\n  }\n  if (aclPolicy.owner === userId) {\n    return true;\n  }\n  for (const rule of aclPolicy.aclRules || []) {\n    const accessGroup = createObjectAccessGroup(rule.group);\n    if (\n      (await accessGroup.hasMember(userId)) &&\n      isPermissionAllowed(requestedPermission, rule.permission)\n    ) {\n      return true;\n    }\n  }\n  return false;\n}\n","path":null,"size_bytes":2695,"size_tokens":null},"client/src/components/ObjectUploader.tsx":{"content":"import { useState, useRef } from \"react\";\nimport type { ReactNode } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Loader2, Upload, CheckCircle2, XCircle } from \"lucide-react\";\n\ninterface ObjectUploaderProps {\n  maxFileSize?: number;\n  allowedFileTypes?: string[];\n  onGetUploadParameters: () => Promise<{\n    method: \"PUT\";\n    url: string;\n  }>;\n  onComplete?: (uploadUrl: string) => void;\n  buttonClassName?: string;\n  children: ReactNode;\n}\n\nexport function ObjectUploader({\n  maxFileSize = 10485760,\n  allowedFileTypes = [\"image/*\"],\n  onGetUploadParameters,\n  onComplete,\n  buttonClassName,\n  children,\n}: ObjectUploaderProps) {\n  const [showModal, setShowModal] = useState(false);\n  const [isUploading, setIsUploading] = useState(false);\n  const [uploadStatus, setUploadStatus] = useState<\"idle\" | \"success\" | \"error\">(\"idle\");\n  const [selectedFile, setSelectedFile] = useState<File | null>(null);\n  const [previewUrl, setPreviewUrl] = useState<string | null>(null);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n\n  const handleFileSelect = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (!file) return;\n\n    if (file.size > maxFileSize) {\n      alert(`File size must be less than ${Math.round(maxFileSize / 1024 / 1024)}MB`);\n      return;\n    }\n\n    setSelectedFile(file);\n    setUploadStatus(\"idle\");\n    \n    if (file.type.startsWith(\"image/\")) {\n      const url = URL.createObjectURL(file);\n      setPreviewUrl(url);\n    }\n  };\n\n  const handleUpload = async () => {\n    if (!selectedFile) return;\n\n    setIsUploading(true);\n    setUploadStatus(\"idle\");\n\n    try {\n      const { url } = await onGetUploadParameters();\n      \n      const response = await fetch(url, {\n        method: \"PUT\",\n        body: selectedFile,\n        headers: {\n          \"Content-Type\": selectedFile.type,\n        },\n      });\n\n      if (!response.ok) {\n        throw new Error(\"Upload failed\");\n      }\n\n      setUploadStatus(\"success\");\n      const uploadUrl = url.split(\"?\")[0];\n      onComplete?.(uploadUrl);\n      \n      setTimeout(() => {\n        setShowModal(false);\n        setSelectedFile(null);\n        setPreviewUrl(null);\n        setUploadStatus(\"idle\");\n      }, 1500);\n    } catch (error) {\n      console.error(\"Upload error:\", error);\n      setUploadStatus(\"error\");\n    } finally {\n      setIsUploading(false);\n    }\n  };\n\n  const handleClose = () => {\n    if (!isUploading) {\n      setShowModal(false);\n      setSelectedFile(null);\n      setPreviewUrl(null);\n      setUploadStatus(\"idle\");\n    }\n  };\n\n  return (\n    <>\n      <Button onClick={() => setShowModal(true)} className={buttonClassName}>\n        {children}\n      </Button>\n\n      <Dialog open={showModal} onOpenChange={handleClose}>\n        <DialogContent className=\"sm:max-w-md bg-sv-dark border-sv-gray\">\n          <DialogHeader>\n            <DialogTitle className=\"text-white\">Upload Image</DialogTitle>\n          </DialogHeader>\n          \n          <div className=\"space-y-4\">\n            <input\n              ref={fileInputRef}\n              type=\"file\"\n              accept={allowedFileTypes.join(\",\")}\n              onChange={handleFileSelect}\n              className=\"hidden\"\n            />\n\n            {!selectedFile ? (\n              <div\n                onClick={() => fileInputRef.current?.click()}\n                className=\"border-2 border-dashed border-sv-gray rounded-lg p-8 text-center cursor-pointer hover:border-sv-pink transition-colors\"\n              >\n                <Upload className=\"w-12 h-12 mx-auto mb-4 text-gray-400\" />\n                <p className=\"text-gray-400\">Click to select an image</p>\n                <p className=\"text-xs text-gray-500 mt-2\">Max size: {Math.round(maxFileSize / 1024 / 1024)}MB</p>\n              </div>\n            ) : (\n              <div className=\"space-y-4\">\n                {previewUrl && (\n                  <div className=\"relative aspect-square max-h-64 mx-auto overflow-hidden rounded-lg\">\n                    <img\n                      src={previewUrl}\n                      alt=\"Preview\"\n                      className=\"w-full h-full object-cover\"\n                    />\n                  </div>\n                )}\n                \n                <div className=\"flex items-center justify-between text-sm\">\n                  <span className=\"text-gray-300 truncate\">{selectedFile.name}</span>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    onClick={() => {\n                      setSelectedFile(null);\n                      setPreviewUrl(null);\n                    }}\n                    disabled={isUploading}\n                    className=\"text-gray-400\"\n                  >\n                    Change\n                  </Button>\n                </div>\n\n                {uploadStatus === \"success\" && (\n                  <div className=\"flex items-center gap-2 text-green-500\">\n                    <CheckCircle2 className=\"w-5 h-5\" />\n                    <span>Upload successful!</span>\n                  </div>\n                )}\n\n                {uploadStatus === \"error\" && (\n                  <div className=\"flex items-center gap-2 text-red-500\">\n                    <XCircle className=\"w-5 h-5\" />\n                    <span>Upload failed. Please try again.</span>\n                  </div>\n                )}\n\n                <Button\n                  onClick={handleUpload}\n                  disabled={isUploading || uploadStatus === \"success\"}\n                  className=\"w-full bg-sv-pink hover:bg-sv-pink/80 text-black font-bold\"\n                >\n                  {isUploading ? (\n                    <>\n                      <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n                      Uploading...\n                    </>\n                  ) : (\n                    \"Upload\"\n                  )}\n                </Button>\n              </div>\n            )}\n          </div>\n        </DialogContent>\n      </Dialog>\n    </>\n  );\n}\n","path":null,"size_bytes":6128,"size_tokens":null},"server/objectStorage.ts":{"content":"import { Storage, File } from \"@google-cloud/storage\";\nimport { Response } from \"express\";\nimport { randomUUID } from \"crypto\";\nimport {\n  ObjectAclPolicy,\n  ObjectPermission,\n  canAccessObject,\n  getObjectAclPolicy,\n  setObjectAclPolicy,\n} from \"./objectAcl\";\n\nconst REPLIT_SIDECAR_ENDPOINT = \"http://127.0.0.1:1106\";\n\nexport const objectStorageClient = new Storage({\n  credentials: {\n    audience: \"replit\",\n    subject_token_type: \"access_token\",\n    token_url: `${REPLIT_SIDECAR_ENDPOINT}/token`,\n    type: \"external_account\",\n    credential_source: {\n      url: `${REPLIT_SIDECAR_ENDPOINT}/credential`,\n      format: {\n        type: \"json\",\n        subject_token_field_name: \"access_token\",\n      },\n    },\n    universe_domain: \"googleapis.com\",\n  },\n  projectId: \"\",\n});\n\nexport class ObjectNotFoundError extends Error {\n  constructor() {\n    super(\"Object not found\");\n    this.name = \"ObjectNotFoundError\";\n    Object.setPrototypeOf(this, ObjectNotFoundError.prototype);\n  }\n}\n\nexport class ObjectStorageService {\n  constructor() {}\n\n  getPublicObjectSearchPaths(): Array<string> {\n    const pathsStr = process.env.PUBLIC_OBJECT_SEARCH_PATHS || \"\";\n    const paths = Array.from(\n      new Set(\n        pathsStr\n          .split(\",\")\n          .map((path) => path.trim())\n          .filter((path) => path.length > 0)\n      )\n    );\n    if (paths.length === 0) {\n      throw new Error(\n        \"PUBLIC_OBJECT_SEARCH_PATHS not set. Create a bucket in 'Object Storage' \" +\n          \"tool and set PUBLIC_OBJECT_SEARCH_PATHS env var (comma-separated paths).\"\n      );\n    }\n    return paths;\n  }\n\n  getPrivateObjectDir(): string {\n    const dir = process.env.PRIVATE_OBJECT_DIR || \"\";\n    if (!dir) {\n      throw new Error(\n        \"PRIVATE_OBJECT_DIR not set. Create a bucket in 'Object Storage' \" +\n          \"tool and set PRIVATE_OBJECT_DIR env var.\"\n      );\n    }\n    return dir;\n  }\n\n  async searchPublicObject(filePath: string): Promise<File | null> {\n    for (const searchPath of this.getPublicObjectSearchPaths()) {\n      const fullPath = `${searchPath}/${filePath}`;\n      const { bucketName, objectName } = parseObjectPath(fullPath);\n      const bucket = objectStorageClient.bucket(bucketName);\n      const file = bucket.file(objectName);\n      const [exists] = await file.exists();\n      if (exists) {\n        return file;\n      }\n    }\n    return null;\n  }\n\n  async downloadObject(file: File, res: Response, cacheTtlSec: number = 3600) {\n    try {\n      const [metadata] = await file.getMetadata();\n      const aclPolicy = await getObjectAclPolicy(file);\n      const isPublic = aclPolicy?.visibility === \"public\";\n      res.set({\n        \"Content-Type\": metadata.contentType || \"application/octet-stream\",\n        \"Content-Length\": metadata.size,\n        \"Cache-Control\": `${isPublic ? \"public\" : \"private\"}, max-age=${cacheTtlSec}`,\n      });\n      const stream = file.createReadStream();\n      stream.on(\"error\", (err) => {\n        console.error(\"Stream error:\", err);\n        if (!res.headersSent) {\n          res.status(500).json({ error: \"Error streaming file\" });\n        }\n      });\n      stream.pipe(res);\n    } catch (error) {\n      console.error(\"Error downloading file:\", error);\n      if (!res.headersSent) {\n        res.status(500).json({ error: \"Error downloading file\" });\n      }\n    }\n  }\n\n  async getObjectEntityUploadURL(): Promise<string> {\n    const privateObjectDir = this.getPrivateObjectDir();\n    if (!privateObjectDir) {\n      throw new Error(\n        \"PRIVATE_OBJECT_DIR not set. Create a bucket in 'Object Storage' \" +\n          \"tool and set PRIVATE_OBJECT_DIR env var.\"\n      );\n    }\n    const objectId = randomUUID();\n    const fullPath = `${privateObjectDir}/uploads/${objectId}`;\n    const { bucketName, objectName } = parseObjectPath(fullPath);\n    return signObjectURL({\n      bucketName,\n      objectName,\n      method: \"PUT\",\n      ttlSec: 900,\n    });\n  }\n\n  async getObjectEntityFile(objectPath: string): Promise<File> {\n    if (!objectPath.startsWith(\"/objects/\")) {\n      throw new ObjectNotFoundError();\n    }\n    const parts = objectPath.slice(1).split(\"/\");\n    if (parts.length < 2) {\n      throw new ObjectNotFoundError();\n    }\n    const entityId = parts.slice(1).join(\"/\");\n    let entityDir = this.getPrivateObjectDir();\n    if (!entityDir.endsWith(\"/\")) {\n      entityDir = `${entityDir}/`;\n    }\n    const objectEntityPath = `${entityDir}${entityId}`;\n    const { bucketName, objectName } = parseObjectPath(objectEntityPath);\n    const bucket = objectStorageClient.bucket(bucketName);\n    const objectFile = bucket.file(objectName);\n    const [exists] = await objectFile.exists();\n    if (!exists) {\n      throw new ObjectNotFoundError();\n    }\n    return objectFile;\n  }\n\n  normalizeObjectEntityPath(rawPath: string): string {\n    if (!rawPath.startsWith(\"https://storage.googleapis.com/\")) {\n      return rawPath;\n    }\n    const url = new URL(rawPath);\n    const rawObjectPath = url.pathname;\n    let objectEntityDir = this.getPrivateObjectDir();\n    if (!objectEntityDir.endsWith(\"/\")) {\n      objectEntityDir = `${objectEntityDir}/`;\n    }\n    if (!rawObjectPath.startsWith(objectEntityDir)) {\n      return rawObjectPath;\n    }\n    const entityId = rawObjectPath.slice(objectEntityDir.length);\n    return `/objects/${entityId}`;\n  }\n\n  async trySetObjectEntityAclPolicy(\n    rawPath: string,\n    aclPolicy: ObjectAclPolicy\n  ): Promise<string> {\n    const normalizedPath = this.normalizeObjectEntityPath(rawPath);\n    if (!normalizedPath.startsWith(\"/\")) {\n      return normalizedPath;\n    }\n    const objectFile = await this.getObjectEntityFile(normalizedPath);\n    await setObjectAclPolicy(objectFile, aclPolicy);\n    return normalizedPath;\n  }\n\n  async canAccessObjectEntity({\n    userId,\n    objectFile,\n    requestedPermission,\n  }: {\n    userId?: string;\n    objectFile: File;\n    requestedPermission?: ObjectPermission;\n  }): Promise<boolean> {\n    return canAccessObject({\n      userId,\n      objectFile,\n      requestedPermission: requestedPermission ?? ObjectPermission.READ,\n    });\n  }\n}\n\nfunction parseObjectPath(path: string): {\n  bucketName: string;\n  objectName: string;\n} {\n  if (!path.startsWith(\"/\")) {\n    path = `/${path}`;\n  }\n  const pathParts = path.split(\"/\");\n  if (pathParts.length < 3) {\n    throw new Error(\"Invalid path: must contain at least a bucket name\");\n  }\n  const bucketName = pathParts[1];\n  const objectName = pathParts.slice(2).join(\"/\");\n  return { bucketName, objectName };\n}\n\nasync function signObjectURL({\n  bucketName,\n  objectName,\n  method,\n  ttlSec,\n}: {\n  bucketName: string;\n  objectName: string;\n  method: \"GET\" | \"PUT\" | \"DELETE\" | \"HEAD\";\n  ttlSec: number;\n}): Promise<string> {\n  const request = {\n    bucket_name: bucketName,\n    object_name: objectName,\n    method,\n    expires_at: new Date(Date.now() + ttlSec * 1000).toISOString(),\n  };\n  const response = await fetch(\n    `${REPLIT_SIDECAR_ENDPOINT}/object-storage/signed-object-url`,\n    {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify(request),\n    }\n  );\n  if (!response.ok) {\n    throw new Error(\n      `Failed to sign object URL, errorcode: ${response.status}, ` +\n        `make sure you're running on Replit`\n    );\n  }\n  const { signed_url: signedURL } = await response.json();\n  return signedURL;\n}\n","path":null,"size_bytes":7348,"size_tokens":null},"client/src/components/battle/JoinBattleDialog.tsx":{"content":"import { useState, useRef } from \"react\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { useUser } from \"@/context/UserContext\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { joinBattle } from \"@/lib/api\";\nimport { Loader2, Upload, Music, ChevronLeft, ChevronRight, Coins, CheckCircle2, XCircle, Swords } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\n\ninterface JoinBattleDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  battleId: number;\n  battleType: string;\n  battleGenre: string;\n  opponentName: string;\n  opponentTrack: string;\n  battleCost: number;\n}\n\nexport function JoinBattleDialog({ \n  open, \n  onOpenChange, \n  battleId,\n  battleType,\n  battleGenre,\n  opponentName,\n  opponentTrack,\n  battleCost \n}: JoinBattleDialogProps) {\n  const { user, spendCoins } = useUser();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  \n  const [step, setStep] = useState<\"upload\" | \"confirm\">(\"upload\");\n  const [trackName, setTrackName] = useState(\"\");\n  const [audioFile, setAudioFile] = useState<File | null>(null);\n  const [audioUrl, setAudioUrl] = useState<string | null>(null);\n  const [isUploading, setIsUploading] = useState(false);\n  const [uploadStatus, setUploadStatus] = useState<\"idle\" | \"success\" | \"error\">(\"idle\");\n  const fileInputRef = useRef<HTMLInputElement>(null);\n\n  const joinBattleMutation = useMutation({\n    mutationFn: ({ battleId, userId, artist, track, audio }: { battleId: number; userId: number; artist: string; track: string; audio: string }) =>\n      joinBattle(battleId, userId, artist, track, audio),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"battles\"] });\n    },\n  });\n\n  const resetDialog = () => {\n    setStep(\"upload\");\n    setTrackName(\"\");\n    setAudioFile(null);\n    setAudioUrl(null);\n    setUploadStatus(\"idle\");\n  };\n\n  const handleClose = (forceClose = false) => {\n    if (forceClose || (!isUploading && !joinBattleMutation.isPending)) {\n      resetDialog();\n      onOpenChange(false);\n    }\n  };\n\n  const handleDialogChange = (open: boolean) => {\n    if (!open) {\n      handleClose(true);\n    }\n  };\n\n  const handleFileSelect = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (!file) return;\n\n    if (file.size > 50 * 1024 * 1024) {\n      toast({\n        title: \"File Too Large\",\n        description: \"Audio files must be under 50MB\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (!file.type.startsWith(\"audio/\")) {\n      toast({\n        title: \"Invalid File Type\",\n        description: \"Please upload an audio file (MP3, WAV, etc.)\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setAudioFile(file);\n    setUploadStatus(\"idle\");\n  };\n\n  const handleUpload = async () => {\n    if (!audioFile) return;\n\n    setIsUploading(true);\n    setUploadStatus(\"idle\");\n\n    try {\n      const response = await fetch(\"/api/objects/upload\", {\n        method: \"POST\",\n        credentials: \"include\",\n      });\n      \n      if (!response.ok) throw new Error(\"Failed to get upload URL\");\n      \n      const { uploadURL } = await response.json();\n      \n      const uploadResponse = await fetch(uploadURL, {\n        method: \"PUT\",\n        body: audioFile,\n        headers: {\n          \"Content-Type\": audioFile.type,\n        },\n      });\n\n      if (!uploadResponse.ok) {\n        throw new Error(\"Upload failed\");\n      }\n\n      const objectUrl = uploadURL.split(\"?\")[0];\n      \n      const aclResponse = await fetch(\"/api/objects/set-acl\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        credentials: \"include\",\n        body: JSON.stringify({ \n          objectUrl,\n          visibility: \"public\"\n        }),\n      });\n\n      if (!aclResponse.ok) {\n        console.warn(\"Failed to set ACL, using original URL\");\n      }\n\n      const aclData = await aclResponse.json().catch(() => ({ objectPath: objectUrl }));\n      setAudioUrl(aclData.objectPath || objectUrl);\n      setUploadStatus(\"success\");\n      setStep(\"confirm\");\n    } catch (error) {\n      console.error(\"Upload error:\", error);\n      setUploadStatus(\"error\");\n      toast({\n        title: \"Upload Failed\",\n        description: \"Failed to upload audio file. Please try again.\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsUploading(false);\n    }\n  };\n\n  const handleJoinBattle = async () => {\n    if (!user || !audioUrl) return;\n\n    if (user.coins < battleCost) {\n      toast({\n        title: \"Not Enough Coins\",\n        description: `You need ${battleCost} coins to join this battle.`,\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    try {\n      await joinBattleMutation.mutateAsync({\n        battleId,\n        userId: user.id,\n        artist: user.name || \"Anonymous\",\n        track: trackName || `New ${user.role === \"producer\" ? \"Beat\" : \"Song\"}`,\n        audio: audioUrl,\n      });\n\n      spendCoins(battleCost);\n\n      toast({\n        title: \"Battle Joined!\",\n        description: `You spent ${battleCost} coins to join the battle. Let's go!`,\n      });\n\n      handleClose(true);\n    } catch (error: any) {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to join battle\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  if (!user) return null;\n\n  return (\n    <Dialog open={open} onOpenChange={handleDialogChange}>\n      <DialogContent className=\"sm:max-w-lg bg-sv-dark border-sv-gray\">\n        <DialogHeader>\n          <DialogTitle className=\"text-white text-xl flex items-center gap-2\">\n            <Swords className=\"w-6 h-6 text-sv-pink\" />\n            Join Battle\n          </DialogTitle>\n          <DialogDescription className=\"text-gray-400\">\n            {step === \"upload\" && \"Upload your track to challenge the opponent\"}\n            {step === \"confirm\" && \"Review and enter the arena\"}\n          </DialogDescription>\n        </DialogHeader>\n\n        <div className=\"bg-sv-gray/30 rounded-lg p-3 mb-4 border border-sv-purple/30\">\n          <div className=\"flex items-center justify-between text-sm\">\n            <span className=\"text-gray-400\">Challenging</span>\n            <span className=\"text-white font-medium\">{opponentName}</span>\n          </div>\n          <div className=\"flex items-center justify-between text-sm mt-1\">\n            <span className=\"text-gray-400\">Their Track</span>\n            <span className=\"text-sv-pink\">{opponentTrack}</span>\n          </div>\n          <div className=\"flex items-center justify-between text-sm mt-1\">\n            <span className=\"text-gray-400\">Genre</span>\n            <span className=\"text-sv-purple capitalize\">{battleGenre}</span>\n          </div>\n        </div>\n\n        <div className=\"flex items-center justify-center gap-2 my-2\">\n          <div className={cn(\n            \"w-3 h-3 rounded-full transition-colors\",\n            step === \"upload\" ? \"bg-sv-pink\" : \"bg-sv-gray\"\n          )} />\n          <div className={cn(\n            \"w-3 h-3 rounded-full transition-colors\",\n            step === \"confirm\" ? \"bg-sv-pink\" : \"bg-sv-gray\"\n          )} />\n        </div>\n\n        {step === \"upload\" && (\n          <div className=\"space-y-4\">\n            <div>\n              <Label htmlFor=\"trackName\" className=\"text-white\">Your Track Name</Label>\n              <Input\n                id=\"trackName\"\n                value={trackName}\n                onChange={(e) => setTrackName(e.target.value)}\n                placeholder={`My ${user.role === \"producer\" ? \"Beat\" : \"Song\"}`}\n                className=\"bg-sv-gray/30 border-sv-gray text-white mt-1\"\n                data-testid=\"input-join-track-name\"\n              />\n            </div>\n\n            <div>\n              <Label className=\"text-white\">Audio File</Label>\n              <input\n                ref={fileInputRef}\n                type=\"file\"\n                accept=\"audio/*\"\n                onChange={handleFileSelect}\n                className=\"hidden\"\n              />\n              \n              {!audioFile ? (\n                <div\n                  onClick={() => fileInputRef.current?.click()}\n                  className=\"mt-1 border-2 border-dashed border-sv-gray rounded-lg p-6 text-center cursor-pointer hover:border-sv-pink transition-colors\"\n                  data-testid=\"join-upload-dropzone\"\n                >\n                  <Upload className=\"w-10 h-10 mx-auto mb-3 text-gray-400\" />\n                  <p className=\"text-gray-400\">Click to upload your audio file</p>\n                  <p className=\"text-xs text-gray-500 mt-1\">MP3, WAV, FLAC (max 50MB)</p>\n                </div>\n              ) : (\n                <div className=\"mt-1 border border-sv-gray rounded-lg p-4 bg-sv-gray/20\">\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"flex items-center gap-3\">\n                      <Music className=\"w-8 h-8 text-sv-pink\" />\n                      <div>\n                        <p className=\"text-white font-medium truncate max-w-[200px]\">{audioFile.name}</p>\n                        <p className=\"text-xs text-gray-400\">{(audioFile.size / 1024 / 1024).toFixed(2)} MB</p>\n                      </div>\n                    </div>\n                    <Button\n                      variant=\"ghost\"\n                      size=\"sm\"\n                      onClick={() => {\n                        setAudioFile(null);\n                        setUploadStatus(\"idle\");\n                      }}\n                      disabled={isUploading}\n                      className=\"text-gray-400\"\n                    >\n                      Change\n                    </Button>\n                  </div>\n\n                  {uploadStatus === \"success\" && (\n                    <div className=\"flex items-center gap-2 text-green-500 mt-2\">\n                      <CheckCircle2 className=\"w-4 h-4\" />\n                      <span className=\"text-sm\">Upload successful!</span>\n                    </div>\n                  )}\n\n                  {uploadStatus === \"error\" && (\n                    <div className=\"flex items-center gap-2 text-red-500 mt-2\">\n                      <XCircle className=\"w-4 h-4\" />\n                      <span className=\"text-sm\">Upload failed. Please try again.</span>\n                    </div>\n                  )}\n                </div>\n              )}\n            </div>\n\n            <div className=\"flex justify-end\">\n              <Button\n                onClick={handleUpload}\n                disabled={!audioFile || isUploading}\n                className=\"bg-sv-pink hover:bg-sv-pink/80 text-black font-bold\"\n                data-testid=\"button-join-upload-audio\"\n              >\n                {isUploading ? (\n                  <>\n                    <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n                    Uploading...\n                  </>\n                ) : (\n                  <>\n                    Upload & Continue <ChevronRight className=\"w-4 h-4 ml-1\" />\n                  </>\n                )}\n              </Button>\n            </div>\n          </div>\n        )}\n\n        {step === \"confirm\" && (\n          <div className=\"space-y-4\">\n            <div className=\"bg-sv-gray/20 rounded-lg p-4 space-y-3\">\n              <div className=\"flex justify-between\">\n                <span className=\"text-gray-400\">Battle Type</span>\n                <span className=\"text-white font-medium capitalize\">\n                  {battleType === \"beat\" ? \"Beat Battle\" : \"Song Battle\"}\n                </span>\n              </div>\n              <div className=\"flex justify-between\">\n                <span className=\"text-gray-400\">Your Track</span>\n                <span className=\"text-white font-medium\">\n                  {trackName || `New ${user.role === \"producer\" ? \"Beat\" : \"Song\"}`}\n                </span>\n              </div>\n              <div className=\"flex justify-between\">\n                <span className=\"text-gray-400\">Opponent</span>\n                <span className=\"text-sv-purple font-medium\">{opponentName}</span>\n              </div>\n              <div className=\"flex justify-between items-center pt-2 border-t border-sv-gray\">\n                <span className=\"text-gray-400\">Entry Fee</span>\n                <span className=\"text-sv-gold font-bold flex items-center gap-1\">\n                  <Coins className=\"w-4 h-4\" />\n                  {battleCost} Coins\n                </span>\n              </div>\n            </div>\n\n            <div className=\"bg-sv-pink/10 border border-sv-pink/30 rounded-lg p-3\">\n              <p className=\"text-sm text-gray-300\">\n                Your balance: <span className=\"text-sv-gold font-bold\">{user.coins} coins</span>\n                {user.coins < battleCost && (\n                  <span className=\"text-red-400 ml-2\">(Not enough coins!)</span>\n                )}\n              </p>\n            </div>\n\n            <div className=\"flex justify-between\">\n              <Button\n                variant=\"ghost\"\n                onClick={() => setStep(\"upload\")}\n                className=\"text-gray-400\"\n                data-testid=\"button-join-back-to-upload\"\n              >\n                <ChevronLeft className=\"w-4 h-4 mr-1\" /> Back\n              </Button>\n              <Button\n                onClick={handleJoinBattle}\n                disabled={joinBattleMutation.isPending || user.coins < battleCost}\n                className=\"bg-sv-pink hover:bg-sv-pink/80 text-black font-bold\"\n                data-testid=\"button-confirm-join-battle\"\n              >\n                {joinBattleMutation.isPending ? (\n                  <>\n                    <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n                    Joining...\n                  </>\n                ) : (\n                  <>\n                    <Swords className=\"w-4 h-4 mr-2\" />\n                    Join Battle ({battleCost} Coins)\n                  </>\n                )}\n              </Button>\n            </div>\n          </div>\n        )}\n      </DialogContent>\n    </Dialog>\n  );\n}\n","path":null,"size_bytes":14344,"size_tokens":null},"client/src/components/battle/StartBattleDialog.tsx":{"content":"import { useState, useRef } from \"react\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { useUser } from \"@/context/UserContext\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { createBattle } from \"@/lib/api\";\nimport { Loader2, Upload, Music, ChevronLeft, ChevronRight, Coins, CheckCircle2, XCircle } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\nimport { useSoundEffects } from \"@/hooks/useSoundEffects\";\n\nconst GENRES = [\n  { id: \"hip-hop\", label: \"Hip-Hop\", icon: \"\" },\n  { id: \"trap\", label: \"Trap\", icon: \"\" },\n  { id: \"r&b\", label: \"R&B\", icon: \"\" },\n  { id: \"pop\", label: \"Pop\", icon: \"\" },\n  { id: \"electronic\", label: \"Electronic\", icon: \"\" },\n  { id: \"lo-fi\", label: \"Lo-Fi\", icon: \"\" },\n  { id: \"rock\", label: \"Rock\", icon: \"\" },\n  { id: \"jazz\", label: \"Jazz\", icon: \"\" },\n  { id: \"classical\", label: \"Classical\", icon: \"\" },\n  { id: \"other\", label: \"Other\", icon: \"\" },\n];\n\ninterface StartBattleDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  battleCost: number;\n}\n\nexport function StartBattleDialog({ open, onOpenChange, battleCost }: StartBattleDialogProps) {\n  const { user, spendCoins } = useUser();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const { playSound } = useSoundEffects();\n  \n  const [step, setStep] = useState<\"genre\" | \"upload\" | \"confirm\">(\"genre\");\n  const [selectedGenre, setSelectedGenre] = useState<string | null>(null);\n  const [trackName, setTrackName] = useState(\"\");\n  const [audioFile, setAudioFile] = useState<File | null>(null);\n  const [audioUrl, setAudioUrl] = useState<string | null>(null);\n  const [isUploading, setIsUploading] = useState(false);\n  const [uploadStatus, setUploadStatus] = useState<\"idle\" | \"success\" | \"error\">(\"idle\");\n  const fileInputRef = useRef<HTMLInputElement>(null);\n\n  const createBattleMutation = useMutation({\n    mutationFn: createBattle,\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"battles\"] });\n    },\n  });\n\n  const resetDialog = () => {\n    setStep(\"genre\");\n    setSelectedGenre(null);\n    setTrackName(\"\");\n    setAudioFile(null);\n    setAudioUrl(null);\n    setUploadStatus(\"idle\");\n  };\n\n  const handleClose = () => {\n    if (!isUploading && !createBattleMutation.isPending) {\n      resetDialog();\n      onOpenChange(false);\n    }\n  };\n\n  const handleFileSelect = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (!file) return;\n\n    if (file.size > 50 * 1024 * 1024) {\n      toast({\n        title: \"File Too Large\",\n        description: \"Audio files must be under 50MB\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (!file.type.startsWith(\"audio/\")) {\n      toast({\n        title: \"Invalid File Type\",\n        description: \"Please upload an audio file (MP3, WAV, etc.)\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setAudioFile(file);\n    setUploadStatus(\"idle\");\n  };\n\n  const handleUpload = async () => {\n    if (!audioFile) return;\n\n    setIsUploading(true);\n    setUploadStatus(\"idle\");\n\n    try {\n      const response = await fetch(\"/api/objects/upload\", {\n        method: \"POST\",\n        credentials: \"include\",\n      });\n      \n      if (!response.ok) throw new Error(\"Failed to get upload URL\");\n      \n      const { uploadURL } = await response.json();\n      \n      const uploadResponse = await fetch(uploadURL, {\n        method: \"PUT\",\n        body: audioFile,\n        headers: {\n          \"Content-Type\": audioFile.type,\n        },\n      });\n\n      if (!uploadResponse.ok) {\n        throw new Error(\"Upload failed\");\n      }\n\n      const objectUrl = uploadURL.split(\"?\")[0];\n      \n      const aclResponse = await fetch(\"/api/objects/set-acl\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        credentials: \"include\",\n        body: JSON.stringify({ \n          objectUrl,\n          visibility: \"public\"\n        }),\n      });\n\n      if (!aclResponse.ok) {\n        console.warn(\"Failed to set ACL, using original URL\");\n      }\n\n      const aclData = await aclResponse.json().catch(() => ({ objectPath: objectUrl }));\n      setAudioUrl(aclData.objectPath || objectUrl);\n      setUploadStatus(\"success\");\n      setStep(\"confirm\");\n    } catch (error) {\n      console.error(\"Upload error:\", error);\n      setUploadStatus(\"error\");\n      toast({\n        title: \"Upload Failed\",\n        description: \"Failed to upload audio file. Please try again.\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsUploading(false);\n    }\n  };\n\n  const handleStartBattle = async () => {\n    if (!user || !selectedGenre || !audioUrl) return;\n\n    if (user.coins < battleCost) {\n      playSound(\"error\");\n      toast({\n        title: \"Not Enough Coins\",\n        description: `You need ${battleCost} coins to start a battle.`,\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    try {\n      await createBattleMutation.mutateAsync({\n        type: user.role === \"producer\" ? \"beat\" : \"song\",\n        genre: selectedGenre,\n        leftArtist: user.name || \"Anonymous\",\n        leftTrack: trackName || `New ${user.role === \"producer\" ? \"Beat\" : \"Song\"}`,\n        leftAudio: audioUrl,\n        leftUserId: user.id,\n        endsAt: new Date(Date.now() + 24 * 60 * 60 * 1000),\n      });\n\n      spendCoins(battleCost);\n      playSound(\"battleStart\");\n\n      toast({\n        title: \"Battle Started!\",\n        description: `You spent ${battleCost} coins to start a new battle. Waiting for opponent...`,\n      });\n\n      handleClose();\n    } catch (error: any) {\n      playSound(\"error\");\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to create battle\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  if (!user) return null;\n\n  return (\n    <Dialog open={open} onOpenChange={handleClose}>\n      <DialogContent className=\"sm:max-w-lg bg-sv-dark border-sv-gray\">\n        <DialogHeader>\n          <DialogTitle className=\"text-white text-xl flex items-center gap-2\">\n            <Music className=\"w-6 h-6 text-sv-pink\" />\n            Start a Battle\n          </DialogTitle>\n          <DialogDescription className=\"text-gray-400\">\n            {step === \"genre\" && \"Choose your genre to find the right opponents\"}\n            {step === \"upload\" && \"Upload your track to enter the arena\"}\n            {step === \"confirm\" && \"Review and launch your battle\"}\n          </DialogDescription>\n        </DialogHeader>\n\n        <div className=\"flex items-center justify-center gap-2 my-4\">\n          <div className={cn(\n            \"w-3 h-3 rounded-full transition-colors\",\n            step === \"genre\" ? \"bg-sv-pink\" : \"bg-sv-gray\"\n          )} />\n          <div className={cn(\n            \"w-3 h-3 rounded-full transition-colors\",\n            step === \"upload\" ? \"bg-sv-pink\" : \"bg-sv-gray\"\n          )} />\n          <div className={cn(\n            \"w-3 h-3 rounded-full transition-colors\",\n            step === \"confirm\" ? \"bg-sv-pink\" : \"bg-sv-gray\"\n          )} />\n        </div>\n\n        {step === \"genre\" && (\n          <div className=\"space-y-4\">\n            <div className=\"grid grid-cols-2 gap-2\">\n              {GENRES.map((genre) => (\n                <button\n                  key={genre.id}\n                  onClick={() => setSelectedGenre(genre.id)}\n                  className={cn(\n                    \"p-3 rounded-lg border transition-all text-left\",\n                    selectedGenre === genre.id\n                      ? \"border-sv-pink bg-sv-pink/10 text-white\"\n                      : \"border-sv-gray bg-sv-gray/20 text-gray-300 hover:border-sv-pink/50\"\n                  )}\n                  data-testid={`genre-${genre.id}`}\n                >\n                  <span className=\"text-xl mr-2\">{genre.icon}</span>\n                  <span className=\"font-medium\">{genre.label}</span>\n                </button>\n              ))}\n            </div>\n\n            <div className=\"flex justify-end\">\n              <Button\n                onClick={() => setStep(\"upload\")}\n                disabled={!selectedGenre}\n                className=\"bg-sv-pink hover:bg-sv-pink/80 text-black font-bold\"\n                data-testid=\"button-next-to-upload\"\n              >\n                Next <ChevronRight className=\"w-4 h-4 ml-1\" />\n              </Button>\n            </div>\n          </div>\n        )}\n\n        {step === \"upload\" && (\n          <div className=\"space-y-4\">\n            <div>\n              <Label htmlFor=\"trackName\" className=\"text-white\">Track Name</Label>\n              <Input\n                id=\"trackName\"\n                value={trackName}\n                onChange={(e) => setTrackName(e.target.value)}\n                placeholder={`My ${user.role === \"producer\" ? \"Beat\" : \"Song\"}`}\n                className=\"bg-sv-gray/30 border-sv-gray text-white mt-1\"\n                data-testid=\"input-track-name\"\n              />\n            </div>\n\n            <div>\n              <Label className=\"text-white\">Audio File</Label>\n              <input\n                ref={fileInputRef}\n                type=\"file\"\n                accept=\"audio/*\"\n                onChange={handleFileSelect}\n                className=\"hidden\"\n              />\n              \n              {!audioFile ? (\n                <div\n                  onClick={() => fileInputRef.current?.click()}\n                  className=\"mt-1 border-2 border-dashed border-sv-gray rounded-lg p-6 text-center cursor-pointer hover:border-sv-pink transition-colors\"\n                  data-testid=\"upload-dropzone\"\n                >\n                  <Upload className=\"w-10 h-10 mx-auto mb-3 text-gray-400\" />\n                  <p className=\"text-gray-400\">Click to upload your audio file</p>\n                  <p className=\"text-xs text-gray-500 mt-1\">MP3, WAV, FLAC (max 50MB)</p>\n                </div>\n              ) : (\n                <div className=\"mt-1 border border-sv-gray rounded-lg p-4 bg-sv-gray/20\">\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"flex items-center gap-3\">\n                      <Music className=\"w-8 h-8 text-sv-pink\" />\n                      <div>\n                        <p className=\"text-white font-medium truncate max-w-[200px]\">{audioFile.name}</p>\n                        <p className=\"text-xs text-gray-400\">{(audioFile.size / 1024 / 1024).toFixed(2)} MB</p>\n                      </div>\n                    </div>\n                    <Button\n                      variant=\"ghost\"\n                      size=\"sm\"\n                      onClick={() => {\n                        setAudioFile(null);\n                        setUploadStatus(\"idle\");\n                      }}\n                      disabled={isUploading}\n                      className=\"text-gray-400\"\n                    >\n                      Change\n                    </Button>\n                  </div>\n\n                  {uploadStatus === \"success\" && (\n                    <div className=\"flex items-center gap-2 text-green-500 mt-2\">\n                      <CheckCircle2 className=\"w-4 h-4\" />\n                      <span className=\"text-sm\">Upload successful!</span>\n                    </div>\n                  )}\n\n                  {uploadStatus === \"error\" && (\n                    <div className=\"flex items-center gap-2 text-red-500 mt-2\">\n                      <XCircle className=\"w-4 h-4\" />\n                      <span className=\"text-sm\">Upload failed. Please try again.</span>\n                    </div>\n                  )}\n                </div>\n              )}\n            </div>\n\n            <div className=\"flex justify-between\">\n              <Button\n                variant=\"ghost\"\n                onClick={() => setStep(\"genre\")}\n                className=\"text-gray-400\"\n                data-testid=\"button-back-to-genre\"\n              >\n                <ChevronLeft className=\"w-4 h-4 mr-1\" /> Back\n              </Button>\n              <Button\n                onClick={handleUpload}\n                disabled={!audioFile || isUploading}\n                className=\"bg-sv-pink hover:bg-sv-pink/80 text-black font-bold\"\n                data-testid=\"button-upload-audio\"\n              >\n                {isUploading ? (\n                  <>\n                    <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n                    Uploading...\n                  </>\n                ) : (\n                  <>\n                    Upload & Continue <ChevronRight className=\"w-4 h-4 ml-1\" />\n                  </>\n                )}\n              </Button>\n            </div>\n          </div>\n        )}\n\n        {step === \"confirm\" && (\n          <div className=\"space-y-4\">\n            <div className=\"bg-sv-gray/20 rounded-lg p-4 space-y-3\">\n              <div className=\"flex justify-between\">\n                <span className=\"text-gray-400\">Genre</span>\n                <span className=\"text-white font-medium capitalize\">\n                  {GENRES.find(g => g.id === selectedGenre)?.label || selectedGenre}\n                </span>\n              </div>\n              <div className=\"flex justify-between\">\n                <span className=\"text-gray-400\">Track</span>\n                <span className=\"text-white font-medium\">\n                  {trackName || `New ${user.role === \"producer\" ? \"Beat\" : \"Song\"}`}\n                </span>\n              </div>\n              <div className=\"flex justify-between\">\n                <span className=\"text-gray-400\">Type</span>\n                <span className=\"text-white font-medium capitalize\">\n                  {user.role === \"producer\" ? \"Beat Battle\" : \"Song Battle\"}\n                </span>\n              </div>\n              <div className=\"flex justify-between items-center pt-2 border-t border-sv-gray\">\n                <span className=\"text-gray-400\">Entry Fee</span>\n                <span className=\"text-sv-gold font-bold flex items-center gap-1\">\n                  <Coins className=\"w-4 h-4\" />\n                  {battleCost} Coins\n                </span>\n              </div>\n            </div>\n\n            <div className=\"bg-sv-pink/10 border border-sv-pink/30 rounded-lg p-3\">\n              <p className=\"text-sm text-gray-300\">\n                Your balance: <span className=\"text-sv-gold font-bold\">{user.coins} coins</span>\n                {user.coins < battleCost && (\n                  <span className=\"text-red-400 ml-2\">(Not enough coins!)</span>\n                )}\n              </p>\n            </div>\n\n            <div className=\"flex justify-between\">\n              <Button\n                variant=\"ghost\"\n                onClick={() => setStep(\"upload\")}\n                className=\"text-gray-400\"\n                data-testid=\"button-back-to-upload\"\n              >\n                <ChevronLeft className=\"w-4 h-4 mr-1\" /> Back\n              </Button>\n              <Button\n                onClick={handleStartBattle}\n                disabled={createBattleMutation.isPending || user.coins < battleCost}\n                className=\"bg-sv-pink hover:bg-sv-pink/80 text-black font-bold\"\n                data-testid=\"button-confirm-battle\"\n              >\n                {createBattleMutation.isPending ? (\n                  <>\n                    <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n                    Starting...\n                  </>\n                ) : (\n                  <>\n                    <Coins className=\"w-4 h-4 mr-2\" />\n                    Start Battle ({battleCost} Coins)\n                  </>\n                )}\n              </Button>\n            </div>\n          </div>\n        )}\n      </DialogContent>\n    </Dialog>\n  );\n}\n","path":null,"size_bytes":15972,"size_tokens":null},"client/src/components/battle/AudioPlayer.tsx":{"content":"import { useState, useRef, useEffect, useCallback } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Slider } from \"@/components/ui/slider\";\nimport { Play, Pause, Volume2, VolumeX } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\n\ninterface AudioPlayerProps {\n  audioUrl: string;\n  trackName: string;\n  artistName: string;\n  color?: \"cyan\" | \"fuchsia\" | \"pink\" | \"purple\";\n  isPlaying: boolean;\n  onPlayStateChange: (playing: boolean) => void;\n  disabled?: boolean;\n}\n\nexport function AudioPlayer({\n  audioUrl,\n  trackName,\n  artistName,\n  color = \"cyan\",\n  isPlaying,\n  onPlayStateChange,\n  disabled = false,\n}: AudioPlayerProps) {\n  const audioRef = useRef<HTMLAudioElement>(null);\n  const [currentTime, setCurrentTime] = useState(0);\n  const [duration, setDuration] = useState(0);\n  const [volume, setVolume] = useState(0.7);\n  const [isMuted, setIsMuted] = useState(false);\n  const [isLoading, setIsLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  const colorClasses = {\n    cyan: {\n      bg: \"bg-cyan-500\",\n      hover: \"hover:bg-cyan-600\",\n      text: \"text-cyan-400\",\n      slider: \"bg-cyan-500\",\n      glow: \"shadow-cyan-500/50\",\n    },\n    fuchsia: {\n      bg: \"bg-fuchsia-500\",\n      hover: \"hover:bg-fuchsia-600\",\n      text: \"text-fuchsia-400\",\n      slider: \"bg-fuchsia-500\",\n      glow: \"shadow-fuchsia-500/50\",\n    },\n    pink: {\n      bg: \"bg-sv-pink\",\n      hover: \"hover:bg-sv-pink/80\",\n      text: \"text-sv-pink\",\n      slider: \"bg-sv-pink\",\n      glow: \"shadow-sv-pink/50\",\n    },\n    purple: {\n      bg: \"bg-sv-purple\",\n      hover: \"hover:bg-sv-purple/80\",\n      text: \"text-sv-purple\",\n      slider: \"bg-sv-purple\",\n      glow: \"shadow-sv-purple/50\",\n    },\n  };\n\n  const colors = colorClasses[color];\n\n  useEffect(() => {\n    const audio = audioRef.current;\n    if (!audio) return;\n\n    const handleTimeUpdate = () => setCurrentTime(audio.currentTime);\n    const handleDurationChange = () => setDuration(audio.duration);\n    const handleCanPlay = () => setIsLoading(false);\n    const handleError = () => {\n      setError(\"Unable to load audio\");\n      setIsLoading(false);\n    };\n    const handleEnded = () => onPlayStateChange(false);\n\n    audio.addEventListener(\"timeupdate\", handleTimeUpdate);\n    audio.addEventListener(\"durationchange\", handleDurationChange);\n    audio.addEventListener(\"canplay\", handleCanPlay);\n    audio.addEventListener(\"error\", handleError);\n    audio.addEventListener(\"ended\", handleEnded);\n\n    return () => {\n      audio.removeEventListener(\"timeupdate\", handleTimeUpdate);\n      audio.removeEventListener(\"durationchange\", handleDurationChange);\n      audio.removeEventListener(\"canplay\", handleCanPlay);\n      audio.removeEventListener(\"error\", handleError);\n      audio.removeEventListener(\"ended\", handleEnded);\n    };\n  }, [onPlayStateChange]);\n\n  useEffect(() => {\n    const audio = audioRef.current;\n    if (!audio) return;\n\n    if (isPlaying) {\n      audio.play().catch(() => {\n        onPlayStateChange(false);\n      });\n    } else {\n      audio.pause();\n    }\n  }, [isPlaying, onPlayStateChange]);\n\n  useEffect(() => {\n    const audio = audioRef.current;\n    if (!audio) return;\n    audio.volume = isMuted ? 0 : volume;\n  }, [volume, isMuted]);\n\n  const togglePlay = useCallback(() => {\n    if (disabled || isLoading || error) return;\n    onPlayStateChange(!isPlaying);\n  }, [disabled, isLoading, error, isPlaying, onPlayStateChange]);\n\n  const handleSeek = useCallback((value: number[]) => {\n    const audio = audioRef.current;\n    if (!audio || !duration) return;\n    const newTime = (value[0] / 100) * duration;\n    audio.currentTime = newTime;\n    setCurrentTime(newTime);\n  }, [duration]);\n\n  const handleVolumeChange = useCallback((value: number[]) => {\n    setVolume(value[0] / 100);\n    if (value[0] > 0) setIsMuted(false);\n  }, []);\n\n  const toggleMute = useCallback(() => {\n    setIsMuted(!isMuted);\n  }, [isMuted]);\n\n  const formatTime = (seconds: number) => {\n    if (!isFinite(seconds)) return \"0:00\";\n    const mins = Math.floor(seconds / 60);\n    const secs = Math.floor(seconds % 60);\n    return `${mins}:${secs.toString().padStart(2, \"0\")}`;\n  };\n\n  const progress = duration > 0 ? (currentTime / duration) * 100 : 0;\n\n  return (\n    <div className={cn(\n      \"bg-black/40 backdrop-blur-sm border border-white/10 rounded-xl p-4 transition-all\",\n      isPlaying && `shadow-lg ${colors.glow}`\n    )}>\n      <audio ref={audioRef} src={audioUrl} preload=\"metadata\" />\n      \n      <div className=\"flex items-center gap-4\">\n        <Button\n          size=\"lg\"\n          className={cn(\n            \"w-14 h-14 rounded-full transition-all\",\n            isPlaying ? `${colors.bg} ${colors.hover} text-white` : \"bg-white/10 hover:bg-white/20 text-white\",\n            (disabled || isLoading || error) && \"opacity-50 cursor-not-allowed\"\n          )}\n          onClick={togglePlay}\n          disabled={disabled || isLoading || !!error}\n          data-testid={`button-play-${color}`}\n        >\n          {isPlaying ? (\n            <Pause className=\"w-6 h-6\" />\n          ) : (\n            <Play className=\"w-6 h-6 ml-1\" />\n          )}\n        </Button>\n\n        <div className=\"flex-1 min-w-0\">\n          <div className=\"flex items-center justify-between mb-1\">\n            <div className=\"truncate\">\n              <h4 className=\"font-bold text-white truncate\">{trackName}</h4>\n              <p className={cn(\"text-sm truncate\", colors.text)}>{artistName}</p>\n            </div>\n            <div className=\"text-xs text-gray-400 ml-2 whitespace-nowrap\">\n              {formatTime(currentTime)} / {formatTime(duration)}\n            </div>\n          </div>\n\n          <div className=\"relative group\">\n            <Slider\n              value={[progress]}\n              max={100}\n              step={0.1}\n              onValueChange={handleSeek}\n              disabled={disabled || isLoading || !!error}\n              className={cn(\n                \"cursor-pointer\",\n                \"[&_[role=slider]]:h-3 [&_[role=slider]]:w-3\",\n                \"[&_[role=slider]]:opacity-0 group-hover:[&_[role=slider]]:opacity-100\",\n                `[&_[role=slider]]:${colors.bg}`,\n                \"[&_[data-orientation=horizontal]>.range]:bg-gradient-to-r\",\n                color === \"cyan\" && \"[&_[data-orientation=horizontal]>.range]:from-cyan-600 [&_[data-orientation=horizontal]>.range]:to-cyan-400\",\n                color === \"fuchsia\" && \"[&_[data-orientation=horizontal]>.range]:from-fuchsia-600 [&_[data-orientation=horizontal]>.range]:to-fuchsia-400\",\n                color === \"pink\" && \"[&_[data-orientation=horizontal]>.range]:from-pink-600 [&_[data-orientation=horizontal]>.range]:to-pink-400\",\n                color === \"purple\" && \"[&_[data-orientation=horizontal]>.range]:from-purple-600 [&_[data-orientation=horizontal]>.range]:to-purple-400\"\n              )}\n            />\n          </div>\n\n          {error && (\n            <p className=\"text-xs text-red-400 mt-1\">{error}</p>\n          )}\n        </div>\n\n        <div className=\"flex items-center gap-2\">\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            className=\"w-8 h-8 text-gray-400 hover:text-white\"\n            onClick={toggleMute}\n          >\n            {isMuted || volume === 0 ? (\n              <VolumeX className=\"w-4 h-4\" />\n            ) : (\n              <Volume2 className=\"w-4 h-4\" />\n            )}\n          </Button>\n          <div className=\"w-20 hidden sm:block\">\n            <Slider\n              value={[isMuted ? 0 : volume * 100]}\n              max={100}\n              step={1}\n              onValueChange={handleVolumeChange}\n              className=\"cursor-pointer\"\n            />\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":7797,"size_tokens":null},"server/email.ts":{"content":"import { Resend } from 'resend';\n\nlet connectionSettings: any;\n\nasync function getCredentials() {\n  const hostname = process.env.REPLIT_CONNECTORS_HOSTNAME;\n  const xReplitToken = process.env.REPL_IDENTITY \n    ? 'repl ' + process.env.REPL_IDENTITY \n    : process.env.WEB_REPL_RENEWAL \n    ? 'depl ' + process.env.WEB_REPL_RENEWAL \n    : null;\n\n  if (!xReplitToken) {\n    throw new Error('X_REPLIT_TOKEN not found for repl/depl');\n  }\n\n  connectionSettings = await fetch(\n    'https://' + hostname + '/api/v2/connection?include_secrets=true&connector_names=resend',\n    {\n      headers: {\n        'Accept': 'application/json',\n        'X_REPLIT_TOKEN': xReplitToken\n      }\n    }\n  ).then(res => res.json()).then(data => data.items?.[0]);\n\n  if (!connectionSettings || (!connectionSettings.settings.api_key)) {\n    throw new Error('Resend not connected');\n  }\n  return { apiKey: connectionSettings.settings.api_key, fromEmail: connectionSettings.settings.from_email };\n}\n\nasync function getResendClient() {\n  const { apiKey, fromEmail } = await getCredentials();\n  return {\n    client: new Resend(apiKey),\n    fromEmail\n  };\n}\n\nconst BRAND_COLORS = {\n  pink: '#FF2EC3',\n  purple: '#A64BFF',\n  gold: '#F6C844',\n  dark: '#0D0D0D',\n  darkCard: '#1A1A1A',\n  gray: '#374151'\n};\n\nfunction getEmailHeader(): string {\n  return `\n    <div style=\"background: linear-gradient(135deg, ${BRAND_COLORS.dark} 0%, ${BRAND_COLORS.darkCard} 100%); padding: 40px 20px; text-align: center; border-bottom: 3px solid ${BRAND_COLORS.pink};\">\n      <h1 style=\"margin: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-size: 36px; font-weight: 900; letter-spacing: 2px;\">\n        <span style=\"color: ${BRAND_COLORS.pink};\">SONG</span><span style=\"color: white;\">VERSUS</span>\n      </h1>\n      <p style=\"color: ${BRAND_COLORS.gray}; margin: 10px 0 0 0; font-size: 14px; letter-spacing: 1px;\">WHERE MUSIC BATTLES</p>\n    </div>\n  `;\n}\n\nfunction getEmailFooter(): string {\n  return `\n    <div style=\"background: ${BRAND_COLORS.dark}; padding: 30px 20px; text-align: center; border-top: 1px solid ${BRAND_COLORS.gray};\">\n      <p style=\"color: ${BRAND_COLORS.gray}; margin: 0 0 10px 0; font-size: 12px;\">\n        This email was sent from SongVersus. If you didn't request this, you can safely ignore it.\n      </p>\n      <p style=\"color: ${BRAND_COLORS.gray}; margin: 0; font-size: 12px;\">\n        &copy; ${new Date().getFullYear()} SongVersus. All rights reserved.\n      </p>\n    </div>\n  `;\n}\n\nfunction getButton(text: string, url: string, color: string = BRAND_COLORS.pink): string {\n  return `\n    <a href=\"${url}\" style=\"display: inline-block; background: ${color}; color: ${color === BRAND_COLORS.gold ? BRAND_COLORS.dark : 'white'}; text-decoration: none; padding: 16px 40px; font-size: 16px; font-weight: bold; border-radius: 8px; letter-spacing: 1px; text-transform: uppercase; box-shadow: 0 4px 15px ${color}40;\">\n      ${text}\n    </a>\n  `;\n}\n\nfunction wrapEmail(content: string): string {\n  return `\n    <!DOCTYPE html>\n    <html>\n    <head>\n      <meta charset=\"utf-8\">\n      <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    </head>\n    <body style=\"margin: 0; padding: 0; background: #000000; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\">\n      <div style=\"max-width: 600px; margin: 0 auto; background: ${BRAND_COLORS.darkCard}; border-radius: 12px; overflow: hidden; box-shadow: 0 0 40px ${BRAND_COLORS.purple}20;\">\n        ${getEmailHeader()}\n        <div style=\"padding: 40px 30px; background: ${BRAND_COLORS.darkCard};\">\n          ${content}\n        </div>\n        ${getEmailFooter()}\n      </div>\n    </body>\n    </html>\n  `;\n}\n\nexport function getVerificationEmailTemplate(verificationUrl: string, userName: string): { subject: string; html: string } {\n  const content = `\n    <h2 style=\"color: white; margin: 0 0 20px 0; font-size: 24px; text-align: center;\">\n      Welcome to the Arena, <span style=\"color: ${BRAND_COLORS.gold};\">${userName || 'Artist'}</span>!\n    </h2>\n    \n    <p style=\"color: #9CA3AF; font-size: 16px; line-height: 1.6; text-align: center; margin-bottom: 30px;\">\n      You're one step away from joining the ultimate music battle platform. \n      Verify your email to start competing, voting, and rising through the ranks!\n    </p>\n\n    <div style=\"text-align: center; margin: 35px 0;\">\n      ${getButton('Verify My Email', verificationUrl, BRAND_COLORS.pink)}\n    </div>\n\n    <div style=\"background: ${BRAND_COLORS.dark}; border-radius: 8px; padding: 20px; margin-top: 30px; border-left: 4px solid ${BRAND_COLORS.purple};\">\n      <p style=\"color: ${BRAND_COLORS.gray}; font-size: 14px; margin: 0;\">\n        <strong style=\"color: ${BRAND_COLORS.purple};\">Tip:</strong> This link expires in 24 hours. If you didn't create an account on SongVersus, you can ignore this email.\n      </p>\n    </div>\n\n    <p style=\"color: ${BRAND_COLORS.gray}; font-size: 12px; text-align: center; margin-top: 30px;\">\n      If the button doesn't work, copy and paste this link into your browser:<br>\n      <span style=\"color: ${BRAND_COLORS.pink}; word-break: break-all;\">${verificationUrl}</span>\n    </p>\n  `;\n\n  return {\n    subject: 'Verify Your SongVersus Account',\n    html: wrapEmail(content)\n  };\n}\n\nexport function getPasswordResetEmailTemplate(resetUrl: string, userName: string): { subject: string; html: string } {\n  const content = `\n    <h2 style=\"color: white; margin: 0 0 20px 0; font-size: 24px; text-align: center;\">\n      Reset Your Password\n    </h2>\n    \n    <p style=\"color: #9CA3AF; font-size: 16px; line-height: 1.6; text-align: center; margin-bottom: 30px;\">\n      Hey <span style=\"color: ${BRAND_COLORS.gold};\">${userName || 'there'}</span>! \n      We received a request to reset your password. Click the button below to create a new one.\n    </p>\n\n    <div style=\"text-align: center; margin: 35px 0;\">\n      ${getButton('Reset Password', resetUrl, BRAND_COLORS.purple)}\n    </div>\n\n    <div style=\"background: ${BRAND_COLORS.dark}; border-radius: 8px; padding: 20px; margin-top: 30px; border-left: 4px solid ${BRAND_COLORS.gold};\">\n      <p style=\"color: ${BRAND_COLORS.gray}; font-size: 14px; margin: 0;\">\n        <strong style=\"color: ${BRAND_COLORS.gold};\">Security Notice:</strong> This link expires in 1 hour. If you didn't request a password reset, please ignore this email or contact support if you have concerns.\n      </p>\n    </div>\n\n    <p style=\"color: ${BRAND_COLORS.gray}; font-size: 12px; text-align: center; margin-top: 30px;\">\n      If the button doesn't work, copy and paste this link into your browser:<br>\n      <span style=\"color: ${BRAND_COLORS.purple}; word-break: break-all;\">${resetUrl}</span>\n    </p>\n  `;\n\n  return {\n    subject: 'Reset Your SongVersus Password',\n    html: wrapEmail(content)\n  };\n}\n\nexport function getWelcomeEmailTemplate(userName: string): { subject: string; html: string } {\n  const content = `\n    <h2 style=\"color: white; margin: 0 0 20px 0; font-size: 24px; text-align: center;\">\n      Welcome to <span style=\"color: ${BRAND_COLORS.pink};\">SongVersus</span>!\n    </h2>\n    \n    <p style=\"color: #9CA3AF; font-size: 16px; line-height: 1.6; text-align: center; margin-bottom: 30px;\">\n      Congratulations, <span style=\"color: ${BRAND_COLORS.gold};\">${userName || 'Artist'}</span>! \n      Your email is verified and you're officially part of the arena.\n    </p>\n\n    <div style=\"background: linear-gradient(135deg, ${BRAND_COLORS.dark} 0%, ${BRAND_COLORS.purple}20 100%); border-radius: 12px; padding: 25px; margin: 25px 0; border: 1px solid ${BRAND_COLORS.purple}40;\">\n      <h3 style=\"color: ${BRAND_COLORS.purple}; margin: 0 0 15px 0; font-size: 16px; text-transform: uppercase; letter-spacing: 1px;\">Here's What You Can Do:</h3>\n      <ul style=\"color: #9CA3AF; font-size: 14px; line-height: 2; margin: 0; padding-left: 20px;\">\n        <li><span style=\"color: ${BRAND_COLORS.pink};\">Battle</span> against other producers and artists</li>\n        <li><span style=\"color: ${BRAND_COLORS.purple};\">Vote</span> on battles and earn XP</li>\n        <li><span style=\"color: ${BRAND_COLORS.gold};\">Rise</span> through the leaderboard ranks</li>\n        <li><span style=\"color: ${BRAND_COLORS.pink};\">Customize</span> your profile with unique items</li>\n      </ul>\n    </div>\n\n    <p style=\"color: #9CA3AF; font-size: 14px; text-align: center; margin-top: 25px;\">\n      Ready to make your mark? Start your first battle now!\n    </p>\n  `;\n\n  return {\n    subject: 'Welcome to SongVersus - Let the Battles Begin!',\n    html: wrapEmail(content)\n  };\n}\n\nexport function getBattleInviteEmailTemplate(inviterName: string, battleTitle: string, battleUrl: string): { subject: string; html: string } {\n  const content = `\n    <h2 style=\"color: white; margin: 0 0 20px 0; font-size: 24px; text-align: center;\">\n      You've Been Challenged!\n    </h2>\n    \n    <p style=\"color: #9CA3AF; font-size: 16px; line-height: 1.6; text-align: center; margin-bottom: 30px;\">\n      <span style=\"color: ${BRAND_COLORS.gold};\">${inviterName}</span> has challenged you to a battle on SongVersus!\n    </p>\n\n    <div style=\"background: linear-gradient(135deg, ${BRAND_COLORS.dark} 0%, ${BRAND_COLORS.pink}20 100%); border-radius: 12px; padding: 25px; margin: 25px 0; text-align: center; border: 1px solid ${BRAND_COLORS.pink}40;\">\n      <p style=\"color: ${BRAND_COLORS.gray}; margin: 0 0 10px 0; font-size: 12px; text-transform: uppercase; letter-spacing: 1px;\">Battle</p>\n      <h3 style=\"color: ${BRAND_COLORS.pink}; margin: 0; font-size: 20px;\">${battleTitle}</h3>\n    </div>\n\n    <div style=\"text-align: center; margin: 35px 0;\">\n      ${getButton('Accept Challenge', battleUrl, BRAND_COLORS.gold)}\n    </div>\n\n    <p style=\"color: ${BRAND_COLORS.gray}; font-size: 14px; text-align: center; margin-top: 25px;\">\n      Show them what you've got. The arena awaits!\n    </p>\n  `;\n\n  return {\n    subject: `${inviterName} Challenged You on SongVersus!`,\n    html: wrapEmail(content)\n  };\n}\n\nexport async function sendEmail(to: string, subject: string, html: string): Promise<{ success: boolean; error?: string }> {\n  try {\n    const { client, fromEmail } = await getResendClient();\n    \n    // Use Resend's test domain if no verified domain is configured\n    const senderEmail = fromEmail && !fromEmail.includes('gmail.com') && !fromEmail.includes('yahoo.com') \n      ? fromEmail \n      : 'SongVersus <onboarding@resend.dev>';\n    \n    const { data, error } = await client.emails.send({\n      from: senderEmail,\n      to: [to],\n      subject,\n      html,\n    });\n\n    if (error) {\n      console.error('[email] Failed to send email:', error);\n      return { success: false, error: error.message };\n    }\n\n    console.log('[email] Email sent successfully:', data?.id);\n    return { success: true };\n  } catch (error: any) {\n    console.error('[email] Error sending email:', error);\n    return { success: false, error: error.message };\n  }\n}\n\nexport async function sendVerificationEmail(to: string, verificationUrl: string, userName: string): Promise<{ success: boolean; error?: string }> {\n  const { subject, html } = getVerificationEmailTemplate(verificationUrl, userName);\n  return sendEmail(to, subject, html);\n}\n\nexport async function sendPasswordResetEmail(to: string, resetUrl: string, userName: string): Promise<{ success: boolean; error?: string }> {\n  const { subject, html } = getPasswordResetEmailTemplate(resetUrl, userName);\n  return sendEmail(to, subject, html);\n}\n\nexport async function sendWelcomeEmail(to: string, userName: string): Promise<{ success: boolean; error?: string }> {\n  const { subject, html } = getWelcomeEmailTemplate(userName);\n  return sendEmail(to, subject, html);\n}\n\nexport async function sendBattleInviteEmail(to: string, inviterName: string, battleTitle: string, battleUrl: string): Promise<{ success: boolean; error?: string }> {\n  const { subject, html } = getBattleInviteEmailTemplate(inviterName, battleTitle, battleUrl);\n  return sendEmail(to, subject, html);\n}\n","path":null,"size_bytes":12006,"size_tokens":null},"client/src/pages/Support.tsx":{"content":"import { Navbar } from \"@/components/layout/Navbar\";\nimport { Footer } from \"@/components/layout/Footer\";\nimport { ArrowLeft, MessageCircle, Mail, HelpCircle, Bug, Lightbulb } from \"lucide-react\";\nimport { Link } from \"wouter\";\n\nexport default function Support() {\n  return (\n    <div className=\"min-h-screen bg-sv-black\">\n      <Navbar />\n      \n      <div className=\"max-w-4xl mx-auto px-4 py-12\">\n        <Link href=\"/\" className=\"inline-flex items-center gap-2 text-gray-400 hover:text-sv-pink transition-colors mb-8\" data-testid=\"link-back-home\">\n          <ArrowLeft className=\"w-4 h-4\" />\n          <span className=\"font-hud text-sm\">Back to Home</span>\n        </Link>\n\n        <div className=\"bg-sv-dark border border-sv-gray rounded-xl p-8 md:p-12\">\n          <h1 className=\"text-3xl md:text-4xl font-cyber font-bold text-white mb-4\" data-testid=\"text-support-title\">\n            Support Center\n          </h1>\n          <p className=\"text-gray-400 font-body text-lg mb-10\">\n            Need help? We're here for you. Choose how you'd like to get in touch.\n          </p>\n\n          <div className=\"grid gap-6 md:grid-cols-2\">\n            <a \n              href=\"https://discord.gg/pNdgdWqW4j\" \n              target=\"_blank\" \n              rel=\"noopener noreferrer\"\n              className=\"group bg-sv-black border border-sv-gray hover:border-sv-purple rounded-xl p-6 transition-all duration-300\"\n              data-testid=\"link-discord-support\"\n            >\n              <div className=\"flex items-start gap-4\">\n                <div className=\"w-12 h-12 bg-sv-purple/20 rounded-lg flex items-center justify-center group-hover:bg-sv-purple/30 transition-colors\">\n                  <MessageCircle className=\"w-6 h-6 text-sv-purple\" />\n                </div>\n                <div>\n                  <h3 className=\"text-lg font-cyber font-bold text-white mb-2\">Discord Community</h3>\n                  <p className=\"text-gray-400 font-body text-sm\">\n                    Join our Discord server for real-time support, community discussions, and the latest updates.\n                  </p>\n                  <span className=\"text-sv-purple font-hud text-sm mt-3 inline-block group-hover:underline\">\n                    Join Discord \n                  </span>\n                </div>\n              </div>\n            </a>\n\n            <a \n              href=\"mailto:support@songversus.com\"\n              className=\"group bg-sv-black border border-sv-gray hover:border-sv-pink rounded-xl p-6 transition-all duration-300\"\n              data-testid=\"link-email-support\"\n            >\n              <div className=\"flex items-start gap-4\">\n                <div className=\"w-12 h-12 bg-sv-pink/20 rounded-lg flex items-center justify-center group-hover:bg-sv-pink/30 transition-colors\">\n                  <Mail className=\"w-6 h-6 text-sv-pink\" />\n                </div>\n                <div>\n                  <h3 className=\"text-lg font-cyber font-bold text-white mb-2\">Email Support</h3>\n                  <p className=\"text-gray-400 font-body text-sm\">\n                    Send us an email and we'll get back to you within 24-48 hours.\n                  </p>\n                  <span className=\"text-sv-pink font-hud text-sm mt-3 inline-block group-hover:underline\">\n                    support@songversus.com\n                  </span>\n                </div>\n              </div>\n            </a>\n          </div>\n\n          <div className=\"mt-10 border-t border-sv-gray pt-10\">\n            <h2 className=\"text-xl font-cyber font-bold text-sv-gold mb-6\">Common Topics</h2>\n            \n            <div className=\"space-y-4\">\n              <div className=\"flex items-start gap-4 p-4 bg-sv-black rounded-lg border border-sv-gray\">\n                <HelpCircle className=\"w-5 h-5 text-sv-gold mt-0.5 flex-shrink-0\" />\n                <div>\n                  <h4 className=\"font-cyber font-bold text-white mb-1\">Account Issues</h4>\n                  <p className=\"text-gray-400 font-body text-sm\">\n                    Problems logging in, resetting password, or managing your account settings.\n                  </p>\n                </div>\n              </div>\n\n              <div className=\"flex items-start gap-4 p-4 bg-sv-black rounded-lg border border-sv-gray\">\n                <Bug className=\"w-5 h-5 text-sv-pink mt-0.5 flex-shrink-0\" />\n                <div>\n                  <h4 className=\"font-cyber font-bold text-white mb-1\">Bug Reports</h4>\n                  <p className=\"text-gray-400 font-body text-sm\">\n                    Found something broken? Let us know so we can fix it quickly.\n                  </p>\n                </div>\n              </div>\n\n              <div className=\"flex items-start gap-4 p-4 bg-sv-black rounded-lg border border-sv-gray\">\n                <Lightbulb className=\"w-5 h-5 text-sv-purple mt-0.5 flex-shrink-0\" />\n                <div>\n                  <h4 className=\"font-cyber font-bold text-white mb-1\">Feature Requests</h4>\n                  <p className=\"text-gray-400 font-body text-sm\">\n                    Have an idea to make SongVersus better? We'd love to hear it!\n                  </p>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <div className=\"mt-10 p-6 bg-gradient-to-r from-sv-purple/20 to-sv-pink/20 rounded-xl border border-sv-purple/30\">\n            <p className=\"text-center text-gray-300 font-body\">\n              For the fastest response, join our{\" \"}\n              <a \n                href=\"https://discord.gg/pNdgdWqW4j\" \n                target=\"_blank\" \n                rel=\"noopener noreferrer\"\n                className=\"text-sv-pink hover:underline font-bold\"\n              >\n                Discord server\n              </a>{\" \"}\n              where our team and community are ready to help!\n            </p>\n          </div>\n        </div>\n      </div>\n\n      <Footer />\n    </div>\n  );\n}\n","path":null,"size_bytes":5916,"size_tokens":null},"client/src/pages/Legal.tsx":{"content":"import { Navbar } from \"@/components/layout/Navbar\";\nimport { Footer } from \"@/components/layout/Footer\";\nimport { useRoute } from \"wouter\";\nimport { ArrowLeft } from \"lucide-react\";\nimport { Link } from \"wouter\";\n\nconst guidelinesContent = {\n  title: \"Rules & Guidelines\",\n  sections: [\n    {\n      title: \"1. General Conduct\",\n      items: [\n        \"Treat all members with respect. Harassment, bullying, hate speech, or personal attacks are strictly prohibited.\",\n        \"Keep language appropriate. Excessive profanity, sexual content, or offensive slurs are not allowed.\",\n        \"Avoid spam or self-promotion outside designated areas. Promote your music only in approved channels or submissions.\",\n        \"Do not impersonate other users, artists, or SongVersus staff.\"\n      ]\n    },\n    {\n      title: \"2. Content Guidelines\",\n      items: [\n        \"Only upload music, beats, or vocals that you own the rights to, or have permission to use. Unauthorized use of copyrighted material is prohibited.\",\n        \"All submissions must comply with SongVersus rules and cannot contain illegal, explicit, or harmful content.\",\n        \"Misleading titles, tags, or metadata (e.g., claiming your song is by a famous artist when it isn't) are not allowed.\",\n        \"Song files must be clear and audible. Extremely low-quality, corrupted, or incomplete files may be removed.\"\n      ]\n    },\n    {\n      title: \"2a. AI Content Rules\",\n      items: [\n        \"No fully AI-generated songs are allowed, except in specific tournament contexts. This ensures the community maintains creative integrity and fair competition.\",\n        \"AI vocals may be used in a production sense (e.g., backing harmonies, ad-libs, or texture layers), but the main performance must be human unless otherwise stated in tournament rules.\",\n        \"Songs that rely entirely on AI for vocals, lyrics, or production will be removed unless participating in an AI-allowed tournament.\",\n        \"Any use of AI must be disclosed in the submission metadata (e.g., \\\"Contains AI-generated backing vocals\\\").\",\n        \"Violations of AI content rules may result in removal of the song and/or account penalties.\"\n      ]\n    },\n    {\n      title: \"3. Battles & Challenges\",\n      items: [\n        \"Respect the competitive nature of SongVersus: critiques should be constructive. Personal attacks toward other participants are forbidden.\",\n        \"Submissions to battles must meet deadlines. Late submissions may be disqualified.\",\n        \"Votes should reflect personal opinion on music quality and creativity, not personal relationships.\",\n        \"Do not manipulate votes or create fake accounts to boost rankings.\"\n      ]\n    },\n    {\n      title: \"4. Intellectual Property\",\n      items: [\n        \"By uploading to SongVersus, you confirm you own the rights or have proper licenses for all submitted content.\",\n        \"SongVersus reserves the right to remove content that violates copyright laws, community standards, or AI content rules.\",\n        \"Users retain ownership of their music but grant SongVersus permission to display, stream, and promote submissions on the platform.\"\n      ]\n    },\n    {\n      title: \"5. Account & Safety\",\n      items: [\n        \"One account per user. Multiple accounts to bypass bans or manipulate votes are prohibited.\",\n        \"Keep your login information secure. SongVersus is not responsible for account theft due to sharing passwords.\",\n        \"Report any suspicious activity to SongVersus staff immediately.\"\n      ]\n    },\n    {\n      title: \"6. Moderation & Enforcement\",\n      items: [\n        \"Violation of any rules may result in warnings, content removal, temporary bans, or permanent account suspension.\",\n        \"Decisions by SongVersus moderators are final. Disputes will be reviewed fairly but respectfully.\",\n        \"Users can appeal moderation decisions through official support channels.\"\n      ]\n    },\n    {\n      title: \"7. Community Engagement\",\n      items: [\n        \"Constructive feedback is encouraged. Give detailed critiques rather than just positive/negative reactions.\",\n        \"Collaborations are encouraged but must follow the same rules as individual submissions.\",\n        \"Celebrate diversity: SongVersus welcomes all genres, styles, and backgrounds.\"\n      ]\n    },\n    {\n      title: \"8. AI & Tournaments Exception\",\n      items: [\n        \"Certain tournaments may allow fully AI-generated songs, but this will always be explicitly stated in the tournament rules.\",\n        \"Users entering these tournaments must follow the rules outlined for AI use in that specific competition.\",\n        \"Outside of tournaments, submissions must prioritize human creativity. AI can assist in production but cannot replace main creative elements.\"\n      ]\n    },\n    {\n      title: \"9. Updates to Rules\",\n      items: [\n        \"SongVersus reserves the right to update rules and guidelines at any time. Users are responsible for reviewing them regularly.\",\n        \"Major changes will be communicated via email or platform notifications.\"\n      ]\n    }\n  ]\n};\n\nconst aiRulesContent = {\n  title: \"AI Rules\",\n  sections: [\n    {\n      title: \"1. General AI Policy\",\n      items: [\n        \"Fully AI-generated songs are NOT allowed (except in tournaments).\",\n        \"AI vocals are allowed only for production purposes: backing harmonies, ad-libs, and vocal textures.\",\n        \"Main performance must always be human outside tournaments.\"\n      ]\n    },\n    {\n      title: \"2. AI Usage Disclosure\",\n      items: [\n        \"Always disclose AI use in your submission metadata. Example: \\\"Contains AI-generated backing vocals\\\"\",\n        \"Failure to disclose may lead to song removal or account penalties.\"\n      ]\n    },\n    {\n      title: \"3. Tournaments & Exceptions\",\n      items: [\n        \"Some tournaments may allow fully AI-generated songs.\",\n        \"Check the tournament rules carefully before submitting.\",\n        \"Outside of these tournaments, human creativity is required.\"\n      ]\n    },\n    {\n      title: \"4. Best Practices\",\n      items: [\n        \"Use AI to enhance your music, not replace it.\",\n        \"Keep the main vocals, lyrics, and composition human.\",\n        \"Transparency is key: your listeners should know what is AI-generated.\"\n      ]\n    },\n    {\n      title: \"5. Quick Reference\",\n      items: [\n        \"Fully AI-generated song: NOT allowed outside AI tournaments\",\n        \"AI backing vocals / production: ALLOWED (with disclosure)\",\n        \"Main vocals AI-generated: NOT allowed outside AI tournaments\",\n        \"AI-assisted instruments/effects: ALLOWED\"\n      ]\n    }\n  ]\n};\n\nconst privacyContent = {\n  title: \"Privacy Policy\",\n  lastUpdated: \"November 2024\",\n  sections: [\n    {\n      title: \"1. Information We Collect\",\n      items: [\n        \"Account information: email address, username, profile picture, and password (encrypted).\",\n        \"Content you upload: music files, beats, and associated metadata.\",\n        \"Usage data: how you interact with our platform, including battles participated in, votes cast, and pages visited.\",\n        \"Device information: browser type, IP address, and device identifiers for security and analytics purposes.\"\n      ]\n    },\n    {\n      title: \"2. How We Use Your Information\",\n      items: [\n        \"To provide and maintain the SongVersus platform and services.\",\n        \"To personalize your experience and show relevant content.\",\n        \"To process transactions and manage your account.\",\n        \"To communicate with you about updates, promotions, and platform changes.\",\n        \"To detect and prevent fraud, abuse, and security issues.\"\n      ]\n    },\n    {\n      title: \"3. Information Sharing\",\n      items: [\n        \"We do not sell your personal information to third parties.\",\n        \"We may share data with service providers who help us operate the platform (e.g., hosting, analytics).\",\n        \"Your public profile and submitted content are visible to other users as part of the platform experience.\",\n        \"We may disclose information if required by law or to protect our rights and safety.\"\n      ]\n    },\n    {\n      title: \"4. Data Security\",\n      items: [\n        \"We use industry-standard encryption to protect your data in transit and at rest.\",\n        \"Passwords are securely hashed and never stored in plain text.\",\n        \"We regularly review our security practices and update them as needed.\"\n      ]\n    },\n    {\n      title: \"5. Your Rights\",\n      items: [\n        \"You can access, update, or delete your account information at any time through your profile settings.\",\n        \"You can request a copy of your data or ask us to delete your account by contacting support.\",\n        \"You can opt out of promotional emails using the unsubscribe link in any email.\"\n      ]\n    },\n    {\n      title: \"6. Cookies & Tracking\",\n      items: [\n        \"We use cookies to maintain your session and remember your preferences.\",\n        \"We use analytics tools to understand how users interact with the platform.\",\n        \"You can control cookies through your browser settings.\"\n      ]\n    },\n    {\n      title: \"7. Contact Us\",\n      items: [\n        \"If you have questions about this Privacy Policy, please contact us through our support channels or Discord server.\"\n      ]\n    }\n  ]\n};\n\nconst termsContent = {\n  title: \"Terms of Service\",\n  lastUpdated: \"November 2024\",\n  sections: [\n    {\n      title: \"1. Acceptance of Terms\",\n      items: [\n        \"By accessing or using SongVersus, you agree to be bound by these Terms of Service.\",\n        \"If you do not agree to these terms, you may not use the platform.\",\n        \"We reserve the right to modify these terms at any time. Continued use constitutes acceptance of changes.\"\n      ]\n    },\n    {\n      title: \"2. Account Registration\",\n      items: [\n        \"You must be at least 13 years old to create an account.\",\n        \"You are responsible for maintaining the security of your account credentials.\",\n        \"You agree to provide accurate and complete information during registration.\",\n        \"One account per person. Creating multiple accounts is prohibited.\"\n      ]\n    },\n    {\n      title: \"3. User Content\",\n      items: [\n        \"You retain ownership of all content you upload to SongVersus.\",\n        \"By uploading content, you grant SongVersus a non-exclusive license to display, stream, and promote your content on the platform.\",\n        \"You represent that you own or have the necessary rights to all content you upload.\",\n        \"SongVersus may remove content that violates our guidelines or applicable laws.\"\n      ]\n    },\n    {\n      title: \"4. Virtual Currency (ORBs/Coins)\",\n      items: [\n        \"Virtual currency purchased or earned on SongVersus has no real-world monetary value.\",\n        \"Virtual currency cannot be exchanged for cash or transferred between accounts.\",\n        \"SongVersus reserves the right to modify the virtual economy at any time.\",\n        \"Unused virtual currency is non-refundable.\"\n      ]\n    },\n    {\n      title: \"5. Subscriptions & Payments\",\n      items: [\n        \"Subscription fees are billed according to the plan you select (monthly/yearly).\",\n        \"Subscriptions auto-renew unless cancelled before the renewal date.\",\n        \"Refunds are handled on a case-by-case basis according to our refund policy.\",\n        \"Prices may change with reasonable notice to subscribers.\"\n      ]\n    },\n    {\n      title: \"6. Prohibited Activities\",\n      items: [\n        \"Uploading content you do not have rights to use.\",\n        \"Manipulating votes, rankings, or battle outcomes.\",\n        \"Harassing, threatening, or abusing other users.\",\n        \"Attempting to hack, exploit, or disrupt the platform.\",\n        \"Using bots or automated tools without authorization.\"\n      ]\n    },\n    {\n      title: \"7. Termination\",\n      items: [\n        \"We may suspend or terminate your account for violating these terms.\",\n        \"You may delete your account at any time through your settings.\",\n        \"Upon termination, your access to the platform and any purchased virtual currency will be revoked.\"\n      ]\n    },\n    {\n      title: \"8. Limitation of Liability\",\n      items: [\n        \"SongVersus is provided \\\"as is\\\" without warranties of any kind.\",\n        \"We are not liable for any indirect, incidental, or consequential damages.\",\n        \"Our total liability is limited to the amount you paid us in the past 12 months.\"\n      ]\n    },\n    {\n      title: \"9. Governing Law\",\n      items: [\n        \"These terms are governed by the laws of the United States.\",\n        \"Any disputes will be resolved through binding arbitration.\"\n      ]\n    }\n  ]\n};\n\nconst copyrightContent = {\n  title: \"Copyright Policy\",\n  lastUpdated: \"November 2024\",\n  sections: [\n    {\n      title: \"1. Respect for Copyright\",\n      items: [\n        \"SongVersus respects the intellectual property rights of others and expects our users to do the same.\",\n        \"Uploading content that infringes on the copyright of others is strictly prohibited.\",\n        \"Repeat infringers may have their accounts terminated.\"\n      ]\n    },\n    {\n      title: \"2. Your Rights as a Creator\",\n      items: [\n        \"You retain full ownership of all original content you create and upload to SongVersus.\",\n        \"By uploading, you grant SongVersus a license to display and stream your content on the platform.\",\n        \"You can remove your content at any time, which will revoke the license granted to SongVersus.\"\n      ]\n    },\n    {\n      title: \"3. DMCA Takedown Requests\",\n      items: [\n        \"If you believe your copyrighted work has been posted on SongVersus without permission, you may submit a DMCA takedown notice.\",\n        \"Notices must include: identification of the copyrighted work, location of the infringing content, your contact information, and a statement of good faith belief.\",\n        \"We will respond to valid takedown requests within a reasonable timeframe.\"\n      ]\n    },\n    {\n      title: \"4. Counter-Notification\",\n      items: [\n        \"If you believe your content was wrongly removed, you may submit a counter-notification.\",\n        \"Counter-notifications must include your contact information, identification of the removed content, and a statement under penalty of perjury.\",\n        \"Content may be restored if no legal action is taken within 10-14 business days.\"\n      ]\n    },\n    {\n      title: \"5. Reporting Infringement\",\n      items: [\n        \"To report copyright infringement, contact us through our support channels.\",\n        \"Include as much detail as possible about the original work and the infringing content.\",\n        \"False claims of infringement may result in account suspension.\"\n      ]\n    },\n    {\n      title: \"6. Licensing & Samples\",\n      items: [\n        \"If you use samples, loops, or stems from other sources, ensure you have proper licenses.\",\n        \"Royalty-free content must still be used according to its license terms.\",\n        \"When in doubt, create original content or obtain explicit permission.\"\n      ]\n    }\n  ]\n};\n\nconst contentMap: Record<string, typeof guidelinesContent> = {\n  guidelines: guidelinesContent,\n  ai: aiRulesContent,\n  privacy: privacyContent,\n  terms: termsContent,\n  copyright: copyrightContent\n};\n\nexport default function Legal() {\n  const [, params] = useRoute(\"/legal/:type\");\n  const type = params?.type || \"guidelines\";\n  const content = contentMap[type] || guidelinesContent;\n\n  return (\n    <div className=\"min-h-screen bg-sv-black\">\n      <Navbar />\n      \n      <div className=\"max-w-4xl mx-auto px-4 py-12\">\n        <Link href=\"/\" className=\"inline-flex items-center gap-2 text-gray-400 hover:text-sv-pink transition-colors mb-8\" data-testid=\"link-back-home\">\n          <ArrowLeft className=\"w-4 h-4\" />\n          <span className=\"font-hud text-sm\">Back to Home</span>\n        </Link>\n\n        <div className=\"bg-sv-dark border border-sv-gray rounded-xl p-8 md:p-12\">\n          <h1 className=\"text-3xl md:text-4xl font-cyber font-bold text-white mb-2\" data-testid=\"text-legal-title\">\n            {content.title}\n          </h1>\n          \n          {'lastUpdated' in content && (\n            <p className=\"text-gray-500 font-hud text-sm mb-8\">\n              Last Updated: {(content as any).lastUpdated}\n            </p>\n          )}\n\n          <div className=\"space-y-8\">\n            {content.sections.map((section, idx) => (\n              <div key={idx} className=\"border-l-2 border-sv-purple pl-6\">\n                <h2 className=\"text-xl font-cyber font-bold text-sv-gold mb-4\" data-testid={`text-section-${idx}`}>\n                  {section.title}\n                </h2>\n                <ul className=\"space-y-3\">\n                  {section.items.map((item, itemIdx) => (\n                    <li key={itemIdx} className=\"text-gray-300 font-body leading-relaxed flex items-start gap-3\">\n                      <span className=\"text-sv-pink mt-1.5 text-xs\"></span>\n                      <span>{item}</span>\n                    </li>\n                  ))}\n                </ul>\n              </div>\n            ))}\n          </div>\n\n          <div className=\"mt-12 pt-8 border-t border-sv-gray\">\n            <p className=\"text-gray-500 font-body text-sm text-center\">\n              Questions? Contact us on{\" \"}\n              <a \n                href=\"https://discord.gg/pNdgdWqW4j\" \n                target=\"_blank\" \n                rel=\"noopener noreferrer\"\n                className=\"text-sv-pink hover:text-sv-purple transition-colors\"\n              >\n                Discord\n              </a>{\" \"}\n              or through our support channels.\n            </p>\n          </div>\n        </div>\n      </div>\n\n      <Footer />\n    </div>\n  );\n}\n","path":null,"size_bytes":17785,"size_tokens":null},"client/src/components/FoundersBadge.tsx":{"content":"import { Shield } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\n\ninterface FoundersBadgeProps {\n  size?: \"sm\" | \"md\" | \"lg\";\n  showLabel?: boolean;\n}\n\nexport function FoundersBadge({ size = \"sm\", showLabel = true }: FoundersBadgeProps) {\n  const sizeClasses = {\n    sm: \"px-2 py-0.5 text-xs\",\n    md: \"px-3 py-1 text-sm\",\n    lg: \"px-4 py-1.5 text-base\",\n  };\n\n  const iconSizes = {\n    sm: \"w-3 h-3\",\n    md: \"w-4 h-4\",\n    lg: \"w-5 h-5\",\n  };\n\n  return (\n    <div \n      className={cn(\n        \"flex items-center gap-1 bg-gradient-to-r from-sv-gold/30 to-sv-pink/30 border border-sv-gold rounded text-sv-gold font-bold animate-pulse\",\n        sizeClasses[size]\n      )}\n      title=\"One of the first 10 members to support SongVersus!\"\n      data-testid=\"badge-founder\"\n    >\n      <Shield className={cn(iconSizes[size], \"fill-sv-gold/50\")} />\n      {showLabel && <span>FOUNDER</span>}\n    </div>\n  );\n}\n","path":null,"size_bytes":914,"size_tokens":null},"client/src/hooks/useIsMobile.ts":{"content":"import { useState, useEffect } from \"react\";\n\nexport function useIsMobile(breakpoint: number = 768): boolean {\n  const [isMobile, setIsMobile] = useState(false);\n\n  useEffect(() => {\n    const checkMobile = () => {\n      setIsMobile(window.innerWidth < breakpoint);\n    };\n\n    checkMobile();\n    window.addEventListener(\"resize\", checkMobile);\n    return () => window.removeEventListener(\"resize\", checkMobile);\n  }, [breakpoint]);\n\n  return isMobile;\n}\n\nexport function useReducedMotion(): boolean {\n  const [prefersReducedMotion, setPrefersReducedMotion] = useState(false);\n\n  useEffect(() => {\n    const mediaQuery = window.matchMedia(\"(prefers-reduced-motion: reduce)\");\n    setPrefersReducedMotion(mediaQuery.matches);\n\n    const handler = (e: MediaQueryListEvent) => {\n      setPrefersReducedMotion(e.matches);\n    };\n\n    mediaQuery.addEventListener(\"change\", handler);\n    return () => mediaQuery.removeEventListener(\"change\", handler);\n  }, []);\n\n  return prefersReducedMotion;\n}\n\nexport function useShouldReduceMotion(): boolean {\n  const isMobile = useIsMobile();\n  const prefersReducedMotion = useReducedMotion();\n  return isMobile || prefersReducedMotion;\n}\n","path":null,"size_bytes":1172,"size_tokens":null},"client/src/components/ChallengeDialog.tsx":{"content":"import { useState, useRef } from \"react\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogDescription,\n  DialogFooter,\n} from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Loader2, Music, Upload, X } from \"lucide-react\";\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface ChallengeDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  targetUser: {\n    id: number;\n    name: string;\n    role: string;\n  };\n}\n\nexport function ChallengeDialog({ open, onOpenChange, targetUser }: ChallengeDialogProps) {\n  const [trackName, setTrackName] = useState(\"\");\n  const [audioFile, setAudioFile] = useState<File | null>(null);\n  const [audioUrl, setAudioUrl] = useState(\"\");\n  const [genre, setGenre] = useState(\"general\");\n  const [message, setMessage] = useState(\"\");\n  const [isUploading, setIsUploading] = useState(false);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const battleType = targetUser.role === \"producer\" ? \"beat\" : \"song\";\n\n  const uploadAudio = async (file: File): Promise<string> => {\n    setIsUploading(true);\n    try {\n      const formData = new FormData();\n      formData.append(\"file\", file);\n      formData.append(\"folder\", \".private/battle-audio\");\n\n      const res = await fetch(\"/api/objects/upload\", {\n        method: \"POST\",\n        credentials: \"include\",\n        body: formData,\n      });\n\n      if (!res.ok) throw new Error(\"Failed to upload audio\");\n      const data = await res.json();\n      return data.url || data.publicUrl || data.objectPath;\n    } finally {\n      setIsUploading(false);\n    }\n  };\n\n  const challengeMutation = useMutation({\n    mutationFn: async () => {\n      let finalAudioUrl = audioUrl;\n\n      if (audioFile) {\n        finalAudioUrl = await uploadAudio(audioFile);\n      }\n\n      if (!finalAudioUrl) {\n        throw new Error(\"Please upload an audio file\");\n      }\n\n      const res = await fetch(\"/api/battle-requests\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        credentials: \"include\",\n        body: JSON.stringify({\n          challengedId: targetUser.id,\n          battleType,\n          genre,\n          challengerTrack: trackName,\n          challengerAudio: finalAudioUrl,\n          message: message || null,\n        }),\n      });\n\n      if (!res.ok) {\n        const error = await res.json();\n        throw new Error(error.error || \"Failed to send challenge\");\n      }\n\n      return res.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Challenge Sent!\",\n        description: `Your battle challenge has been sent to ${targetUser.name}. They have 7 days to respond.`,\n      });\n      queryClient.invalidateQueries({ queryKey: [\"sentBattleRequests\"] });\n      resetForm();\n      onOpenChange(false);\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Failed to send challenge\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const resetForm = () => {\n    setTrackName(\"\");\n    setAudioFile(null);\n    setAudioUrl(\"\");\n    setGenre(\"general\");\n    setMessage(\"\");\n  };\n\n  const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (file) {\n      if (!file.type.startsWith(\"audio/\")) {\n        toast({\n          title: \"Invalid file type\",\n          description: \"Please upload an audio file (MP3, WAV, etc.)\",\n          variant: \"destructive\",\n        });\n        return;\n      }\n      if (file.size > 50 * 1024 * 1024) {\n        toast({\n          title: \"File too large\",\n          description: \"Audio file must be less than 50MB\",\n          variant: \"destructive\",\n        });\n        return;\n      }\n      setAudioFile(file);\n      setAudioUrl(\"\");\n    }\n  };\n\n  const genres = [\n    { value: \"general\", label: \"General\" },\n    { value: \"hiphop\", label: \"Hip-Hop\" },\n    { value: \"rnb\", label: \"R&B\" },\n    { value: \"pop\", label: \"Pop\" },\n    { value: \"electronic\", label: \"Electronic\" },\n    { value: \"rock\", label: \"Rock\" },\n    { value: \"latin\", label: \"Latin\" },\n    { value: \"country\", label: \"Country\" },\n    { value: \"jazz\", label: \"Jazz\" },\n    { value: \"classical\", label: \"Classical\" },\n    { value: \"other\", label: \"Other\" },\n  ];\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"sm:max-w-md bg-zinc-900 border-white/10\">\n        <DialogHeader>\n          <DialogTitle className=\"text-white flex items-center gap-2\">\n            <Music className=\"w-5 h-5 text-sv-pink\" />\n            Challenge {targetUser.name}\n          </DialogTitle>\n          <DialogDescription>\n            Send a {battleType} battle challenge. Upload your track and wait for them to respond.\n          </DialogDescription>\n        </DialogHeader>\n\n        <div className=\"space-y-4 py-4\">\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"trackName\" className=\"text-white\">Track Name</Label>\n            <Input\n              id=\"trackName\"\n              placeholder={`Enter your ${battleType} name`}\n              value={trackName}\n              onChange={(e) => setTrackName(e.target.value)}\n              className=\"bg-zinc-800 border-white/10\"\n              data-testid=\"input-track-name\"\n            />\n          </div>\n\n          <div className=\"space-y-2\">\n            <Label className=\"text-white\">Audio File</Label>\n            <input\n              type=\"file\"\n              accept=\"audio/*\"\n              ref={fileInputRef}\n              onChange={handleFileChange}\n              className=\"hidden\"\n            />\n            <div\n              className=\"border-2 border-dashed border-white/10 rounded-lg p-6 text-center cursor-pointer hover:border-sv-pink/50 transition-colors\"\n              onClick={() => fileInputRef.current?.click()}\n              data-testid=\"upload-audio-area\"\n            >\n              {audioFile ? (\n                <div className=\"flex items-center justify-center gap-2\">\n                  <Music className=\"w-5 h-5 text-sv-pink\" />\n                  <span className=\"text-white truncate max-w-[200px]\">{audioFile.name}</span>\n                  <button\n                    type=\"button\"\n                    onClick={(e) => {\n                      e.stopPropagation();\n                      setAudioFile(null);\n                    }}\n                    className=\"p-1 hover:bg-white/10 rounded\"\n                  >\n                    <X className=\"w-4 h-4 text-muted-foreground\" />\n                  </button>\n                </div>\n              ) : (\n                <>\n                  <Upload className=\"w-8 h-8 text-muted-foreground mx-auto mb-2\" />\n                  <p className=\"text-sm text-muted-foreground\">\n                    Click to upload audio file\n                  </p>\n                  <p className=\"text-xs text-muted-foreground mt-1\">\n                    MP3, WAV, or other audio formats (max 50MB)\n                  </p>\n                </>\n              )}\n            </div>\n          </div>\n\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"genre\" className=\"text-white\">Genre</Label>\n            <Select value={genre} onValueChange={setGenre}>\n              <SelectTrigger className=\"bg-zinc-800 border-white/10\" data-testid=\"select-genre\">\n                <SelectValue placeholder=\"Select a genre\" />\n              </SelectTrigger>\n              <SelectContent className=\"bg-zinc-800 border-white/10\">\n                {genres.map((g) => (\n                  <SelectItem key={g.value} value={g.value}>\n                    {g.label}\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          </div>\n\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"message\" className=\"text-white\">Message (optional)</Label>\n            <Textarea\n              id=\"message\"\n              placeholder=\"Add a message to your challenge...\"\n              value={message}\n              onChange={(e) => setMessage(e.target.value)}\n              className=\"bg-zinc-800 border-white/10 min-h-[80px]\"\n              data-testid=\"input-message\"\n            />\n          </div>\n        </div>\n\n        <DialogFooter className=\"gap-2\">\n          <Button\n            variant=\"outline\"\n            onClick={() => onOpenChange(false)}\n            className=\"border-white/10\"\n            data-testid=\"button-cancel-challenge\"\n          >\n            Cancel\n          </Button>\n          <Button\n            onClick={() => challengeMutation.mutate()}\n            disabled={!trackName || (!audioFile && !audioUrl) || challengeMutation.isPending || isUploading}\n            className=\"bg-gradient-to-r from-sv-pink to-sv-purple text-white hover:opacity-90\"\n            data-testid=\"button-send-challenge\"\n          >\n            {(challengeMutation.isPending || isUploading) ? (\n              <>\n                <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n                {isUploading ? \"Uploading...\" : \"Sending...\"}\n              </>\n            ) : (\n              \"Send Challenge\"\n            )}\n          </Button>\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","path":null,"size_bytes":9608,"size_tokens":null},"client/src/components/AcceptBattleRequestDialog.tsx":{"content":"import { useState, useRef } from \"react\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogDescription,\n  DialogFooter,\n} from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Loader2, Music, Upload, X, Play, Pause } from \"lucide-react\";\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface BattleRequest {\n  id: number;\n  challengerId: number;\n  challengedId: number;\n  status: string;\n  battleType: string;\n  genre: string;\n  challengerTrack: string;\n  challengerAudio: string;\n  challengedTrack: string | null;\n  challengedAudio: string | null;\n  message: string | null;\n  expiresAt: string;\n  createdAt: string;\n  challengerName: string | null;\n  challengerAvatar: string | null;\n}\n\ninterface AcceptBattleRequestDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  battleRequest: BattleRequest | null;\n}\n\nexport function AcceptBattleRequestDialog({ open, onOpenChange, battleRequest }: AcceptBattleRequestDialogProps) {\n  const [trackName, setTrackName] = useState(\"\");\n  const [audioFile, setAudioFile] = useState<File | null>(null);\n  const [isUploading, setIsUploading] = useState(false);\n  const [isPlaying, setIsPlaying] = useState(false);\n  const audioRef = useRef<HTMLAudioElement>(null);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const uploadAudio = async (file: File): Promise<string> => {\n    setIsUploading(true);\n    try {\n      const formData = new FormData();\n      formData.append(\"file\", file);\n      formData.append(\"folder\", \".private/battle-audio\");\n\n      const res = await fetch(\"/api/objects/upload\", {\n        method: \"POST\",\n        credentials: \"include\",\n        body: formData,\n      });\n\n      if (!res.ok) throw new Error(\"Failed to upload audio\");\n      const data = await res.json();\n      return data.url || data.publicUrl || data.objectPath;\n    } finally {\n      setIsUploading(false);\n    }\n  };\n\n  const acceptMutation = useMutation({\n    mutationFn: async () => {\n      if (!battleRequest || !audioFile) throw new Error(\"Missing data\");\n\n      const audioUrl = await uploadAudio(audioFile);\n\n      const res = await fetch(`/api/battle-requests/${battleRequest.id}/accept`, {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        credentials: \"include\",\n        body: JSON.stringify({\n          challengedTrack: trackName,\n          challengedAudio: audioUrl,\n        }),\n      });\n\n      if (!res.ok) {\n        const error = await res.json();\n        throw new Error(error.error || \"Failed to accept battle request\");\n      }\n\n      return res.json();\n    },\n    onSuccess: (data) => {\n      toast({\n        title: \"Battle Accepted!\",\n        description: \"The battle is now live. Let the voting begin!\",\n      });\n      queryClient.invalidateQueries({ queryKey: [\"pendingBattleRequests\"] });\n      queryClient.invalidateQueries({ queryKey: [\"battles\"] });\n      resetForm();\n      onOpenChange(false);\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Failed to accept battle\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const resetForm = () => {\n    setTrackName(\"\");\n    setAudioFile(null);\n    setIsPlaying(false);\n    if (audioRef.current) {\n      audioRef.current.pause();\n    }\n  };\n\n  const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (file) {\n      if (!file.type.startsWith(\"audio/\")) {\n        toast({\n          title: \"Invalid file type\",\n          description: \"Please upload an audio file (MP3, WAV, etc.)\",\n          variant: \"destructive\",\n        });\n        return;\n      }\n      if (file.size > 50 * 1024 * 1024) {\n        toast({\n          title: \"File too large\",\n          description: \"Audio file must be less than 50MB\",\n          variant: \"destructive\",\n        });\n        return;\n      }\n      setAudioFile(file);\n    }\n  };\n\n  const togglePlayChallenger = () => {\n    if (!battleRequest?.challengerAudio || !audioRef.current) return;\n    \n    if (isPlaying) {\n      audioRef.current.pause();\n    } else {\n      audioRef.current.play();\n    }\n    setIsPlaying(!isPlaying);\n  };\n\n  if (!battleRequest) return null;\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"sm:max-w-lg bg-zinc-900 border-white/10\">\n        <DialogHeader>\n          <DialogTitle className=\"text-white flex items-center gap-2\">\n            <Music className=\"w-5 h-5 text-sv-pink\" />\n            Accept Battle Challenge\n          </DialogTitle>\n          <DialogDescription>\n            {battleRequest.challengerName} challenged you to a {battleRequest.battleType} battle. Upload your track to accept.\n          </DialogDescription>\n        </DialogHeader>\n\n        <div className=\"space-y-4 py-4\">\n          <div className=\"p-4 bg-zinc-800 rounded-lg space-y-3\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm text-muted-foreground\">Challenger's Track</p>\n                <p className=\"text-white font-medium\">{battleRequest.challengerTrack}</p>\n                <p className=\"text-xs text-sv-purple capitalize\">{battleRequest.genre}</p>\n              </div>\n              <Button\n                variant=\"outline\"\n                size=\"icon\"\n                onClick={togglePlayChallenger}\n                className=\"border-white/10 hover:border-sv-pink/50\"\n                data-testid=\"button-play-challenger\"\n              >\n                {isPlaying ? <Pause className=\"w-4 h-4\" /> : <Play className=\"w-4 h-4\" />}\n              </Button>\n            </div>\n            <audio\n              ref={audioRef}\n              src={battleRequest.challengerAudio}\n              onEnded={() => setIsPlaying(false)}\n            />\n            {battleRequest.message && (\n              <div className=\"pt-2 border-t border-white/10\">\n                <p className=\"text-xs text-muted-foreground\">Message</p>\n                <p className=\"text-sm text-white italic\">\"{battleRequest.message}\"</p>\n              </div>\n            )}\n          </div>\n\n          <div className=\"border-t border-white/10 pt-4\">\n            <h4 className=\"text-sm font-medium text-white mb-3\">Your Response</h4>\n            \n            <div className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"trackName\" className=\"text-white\">Track Name</Label>\n                <Input\n                  id=\"trackName\"\n                  placeholder={`Enter your ${battleRequest.battleType} name`}\n                  value={trackName}\n                  onChange={(e) => setTrackName(e.target.value)}\n                  className=\"bg-zinc-800 border-white/10\"\n                  data-testid=\"input-response-track-name\"\n                />\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label className=\"text-white\">Audio File</Label>\n                <input\n                  type=\"file\"\n                  accept=\"audio/*\"\n                  ref={fileInputRef}\n                  onChange={handleFileChange}\n                  className=\"hidden\"\n                />\n                <div\n                  className=\"border-2 border-dashed border-white/10 rounded-lg p-4 text-center cursor-pointer hover:border-sv-pink/50 transition-colors\"\n                  onClick={() => fileInputRef.current?.click()}\n                  data-testid=\"upload-response-audio-area\"\n                >\n                  {audioFile ? (\n                    <div className=\"flex items-center justify-center gap-2\">\n                      <Music className=\"w-5 h-5 text-sv-pink\" />\n                      <span className=\"text-white truncate max-w-[200px]\">{audioFile.name}</span>\n                      <button\n                        type=\"button\"\n                        onClick={(e) => {\n                          e.stopPropagation();\n                          setAudioFile(null);\n                        }}\n                        className=\"p-1 hover:bg-white/10 rounded\"\n                      >\n                        <X className=\"w-4 h-4 text-muted-foreground\" />\n                      </button>\n                    </div>\n                  ) : (\n                    <>\n                      <Upload className=\"w-6 h-6 text-muted-foreground mx-auto mb-1\" />\n                      <p className=\"text-sm text-muted-foreground\">\n                        Click to upload your track\n                      </p>\n                    </>\n                  )}\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <DialogFooter className=\"gap-2\">\n          <Button\n            variant=\"outline\"\n            onClick={() => onOpenChange(false)}\n            className=\"border-white/10\"\n            data-testid=\"button-cancel-accept\"\n          >\n            Cancel\n          </Button>\n          <Button\n            onClick={() => acceptMutation.mutate()}\n            disabled={!trackName || !audioFile || acceptMutation.isPending || isUploading}\n            className=\"bg-gradient-to-r from-sv-pink to-sv-purple text-white hover:opacity-90\"\n            data-testid=\"button-confirm-accept\"\n          >\n            {(acceptMutation.isPending || isUploading) ? (\n              <>\n                <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n                {isUploading ? \"Uploading...\" : \"Accepting...\"}\n              </>\n            ) : (\n              \"Accept Battle\"\n            )}\n          </Button>\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","path":null,"size_bytes":9882,"size_tokens":null},"client/src/hooks/useSoundEffects.ts":{"content":"import { useCallback, useEffect, useRef } from \"react\";\n\nexport type SoundEffect = \n  | \"battleStart\"\n  | \"battleEnd\"\n  | \"vote\"\n  | \"chatMessage\"\n  | \"notification\"\n  | \"levelUp\"\n  | \"coinEarn\"\n  | \"buttonClick\"\n  | \"success\"\n  | \"error\";\n\ninterface SoundSettings {\n  enabled: boolean;\n  volume: number;\n  effects: Record<SoundEffect, boolean>;\n}\n\nconst DEFAULT_SETTINGS: SoundSettings = {\n  enabled: true,\n  volume: 0.5,\n  effects: {\n    battleStart: true,\n    battleEnd: true,\n    vote: true,\n    chatMessage: true,\n    notification: true,\n    levelUp: true,\n    coinEarn: true,\n    buttonClick: false,\n    success: true,\n    error: true,\n  },\n};\n\nconst STORAGE_KEY = \"songversus_sound_settings\";\n\nconst SOUND_FREQUENCIES: Record<SoundEffect, { frequencies: number[]; durations: number[]; type: OscillatorType }> = {\n  battleStart: { frequencies: [200, 300, 400, 600, 800], durations: [0.08, 0.08, 0.08, 0.08, 0.2], type: \"sawtooth\" },\n  battleEnd: { frequencies: [800, 600, 400, 300], durations: [0.1, 0.1, 0.1, 0.3], type: \"triangle\" },\n  vote: { frequencies: [440, 550, 660], durations: [0.06, 0.06, 0.12], type: \"sine\" },\n  chatMessage: { frequencies: [800, 1000], durations: [0.05, 0.08], type: \"sine\" },\n  notification: { frequencies: [523, 659, 784], durations: [0.1, 0.1, 0.15], type: \"sine\" },\n  levelUp: { frequencies: [261, 329, 392, 523, 659, 784, 1047], durations: [0.08, 0.08, 0.08, 0.08, 0.08, 0.08, 0.25], type: \"square\" },\n  coinEarn: { frequencies: [1200, 1400, 1600], durations: [0.05, 0.05, 0.1], type: \"sine\" },\n  buttonClick: { frequencies: [600], durations: [0.03], type: \"sine\" },\n  success: { frequencies: [523, 659, 784, 1047], durations: [0.08, 0.08, 0.08, 0.2], type: \"sine\" },\n  error: { frequencies: [200, 150], durations: [0.15, 0.2], type: \"sawtooth\" },\n};\n\nexport function getSoundSettings(): SoundSettings {\n  if (typeof window === \"undefined\") return DEFAULT_SETTINGS;\n  \n  try {\n    const stored = localStorage.getItem(STORAGE_KEY);\n    if (stored) {\n      const parsed = JSON.parse(stored);\n      return { ...DEFAULT_SETTINGS, ...parsed, effects: { ...DEFAULT_SETTINGS.effects, ...parsed.effects } };\n    }\n  } catch (e) {\n    console.error(\"Failed to load sound settings:\", e);\n  }\n  return DEFAULT_SETTINGS;\n}\n\nexport function saveSoundSettings(settings: SoundSettings): void {\n  if (typeof window === \"undefined\") return;\n  \n  try {\n    localStorage.setItem(STORAGE_KEY, JSON.stringify(settings));\n  } catch (e) {\n    console.error(\"Failed to save sound settings:\", e);\n  }\n}\n\nexport function useSoundEffects() {\n  const audioContextRef = useRef<AudioContext | null>(null);\n  const settingsRef = useRef<SoundSettings>(getSoundSettings());\n\n  useEffect(() => {\n    settingsRef.current = getSoundSettings();\n  }, []);\n\n  const getAudioContext = useCallback(() => {\n    if (!audioContextRef.current) {\n      audioContextRef.current = new (window.AudioContext || (window as any).webkitAudioContext)();\n    }\n    return audioContextRef.current;\n  }, []);\n\n  const playSound = useCallback((effect: SoundEffect) => {\n    const settings = getSoundSettings();\n    \n    if (!settings.enabled || !settings.effects[effect]) {\n      return;\n    }\n\n    try {\n      const ctx = getAudioContext();\n      \n      if (ctx.state === \"suspended\") {\n        ctx.resume();\n      }\n\n      const soundConfig = SOUND_FREQUENCIES[effect];\n      let startTime = ctx.currentTime;\n\n      soundConfig.frequencies.forEach((freq, index) => {\n        const oscillator = ctx.createOscillator();\n        const gainNode = ctx.createGain();\n\n        oscillator.type = soundConfig.type;\n        oscillator.frequency.setValueAtTime(freq, startTime);\n\n        const duration = soundConfig.durations[index];\n        gainNode.gain.setValueAtTime(settings.volume * 0.3, startTime);\n        gainNode.gain.exponentialRampToValueAtTime(0.001, startTime + duration);\n\n        oscillator.connect(gainNode);\n        gainNode.connect(ctx.destination);\n\n        oscillator.start(startTime);\n        oscillator.stop(startTime + duration);\n\n        startTime += duration;\n      });\n    } catch (e) {\n      console.error(\"Failed to play sound:\", e);\n    }\n  }, [getAudioContext]);\n\n  const updateSettings = useCallback((newSettings: Partial<SoundSettings>) => {\n    const current = getSoundSettings();\n    const updated = { ...current, ...newSettings };\n    saveSoundSettings(updated);\n    settingsRef.current = updated;\n  }, []);\n\n  const updateEffectSetting = useCallback((effect: SoundEffect, enabled: boolean) => {\n    const current = getSoundSettings();\n    const updated = {\n      ...current,\n      effects: { ...current.effects, [effect]: enabled },\n    };\n    saveSoundSettings(updated);\n    settingsRef.current = updated;\n  }, []);\n\n  const getSettings = useCallback(() => getSoundSettings(), []);\n\n  return {\n    playSound,\n    updateSettings,\n    updateEffectSetting,\n    getSettings,\n  };\n}\n\nexport const SOUND_EFFECT_LABELS: Record<SoundEffect, { label: string; description: string }> = {\n  battleStart: { label: \"Battle Start\", description: \"When a battle begins\" },\n  battleEnd: { label: \"Battle End\", description: \"When a battle concludes\" },\n  vote: { label: \"Vote Cast\", description: \"When you cast a vote\" },\n  chatMessage: { label: \"Chat Message\", description: \"When a new message arrives\" },\n  notification: { label: \"Notification\", description: \"For new notifications\" },\n  levelUp: { label: \"Level Up\", description: \"When you level up\" },\n  coinEarn: { label: \"Coins Earned\", description: \"When you earn coins\" },\n  buttonClick: { label: \"Button Clicks\", description: \"UI button interactions\" },\n  success: { label: \"Success\", description: \"Successful actions\" },\n  error: { label: \"Error\", description: \"Error alerts\" },\n};\n","path":null,"size_bytes":5736,"size_tokens":null}},"version":2}